@{
    ViewBag.Title = ViewBag.ModuleName;
}
@model IEnumerable<Tuhu.Provisioning.DataAccess.Entity.SE_HomePageModuleContentConfig>

<div class="ibox ibox-content">
    <div class="row" style="text-align:right;margin-bottom:5px;">
        <a href="javascript:void(0)" class="btn btn-danger btn-small " id="btnAdd" style="width: 150px;" data-toggle="modal" data-target="#edit">新 增</a>
    </div>
    <table class="table table-bordered" style="text-align:center;">
        <thead>
            <tr>
                <th>ID</th>
                <th>名称</th>
                <th>设备类型</th>
                @*<th>链接</th>*@
                <th>状态</th>
                <th>按钮图片</th>
                <th>Banner图片</th>
                <th>创建时间</th>
                <th>更新时间</th>
                <th>管 理</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null)
            {
                foreach (var item in Model)
                {
                    <tr>
                        <td>@item.ID</td>
                        <td>@item.Title</td>
                        <td>@(item.DeviceType == 1 ? "Android" : (item.DeviceType == 2 ? "IOS" : "移动站"))</td>
                        @*<td>@item.LinkUrl</td>*@
                        <td>@(item.IsEnabled == true ? "启用" : "禁用")</td>
                        <td>
                            @{
                                if (string.IsNullOrWhiteSpace(item.ButtonImageUrl) == false)
                                {
                                    <img src="@item.ButtonImageUrl" width="30" height="30"/>
                                }
                            }
                        </td>
                        <td>
                            @{
                                if (string.IsNullOrWhiteSpace(item.BannerImageUrl) == false)
                                {
                                    if (item.BannerImageUrl.Contains("http://") == true)
                                    {
                                        <img src="@item.BannerImageUrl" width="30" height="30" />
                                    }
                                    else
                                    {
                                       @item.BannerImageUrl
                                    }

                                }
                            }

                        </td>

                        <td>@(string.Format("{0:yyyy-MM-dd HH:mm:ss}",item.CreateDateTime))</td>
                        <td>@(string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.UpdateDateTime))</td>
                        <td>
                            <a href="javascript:void(0)" class="btn btn-default btn-sm" name="btnEdit" data-toggle="modal" data-target="#edit" data-id="@item.ID">编 辑</a>
                            <a href="javascript:void(0)" class="btn btn-default btn-sm" name="btnDelete" data-id="@item.ID">删 除</a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
<input type="hidden" id="hiddenModuleID" name="hiddenModuleID" value="@ViewBag.moduleID"/>
<input type="hidden" id="hiddenModuleHelperID" name="hiddenModuleHelperID" value="@ViewBag.moduleHelperID" />
<div id="edit" class="modal fade" aria-hidden="true" role="dialog" tabindex="-1">

</div>
@section scripts{
    <script type="text/javascript">
        $('#btnAdd').on('click', function () {
            var moduleID = $('#hiddenModuleID').val();
            var moduleHelperID = $('#hiddenModuleHelperID').val();
            var url = "/PersonalCenterConfigV2/HomePageModuleContent?id=0&moduleID=" + $('#hiddenModuleID').val() + "&moduleHelperID=" + $('#hiddenModuleHelperID').val();
            // dialogOpen("新增首页", url, "edit");
            var dialog = $('#edit');
            dialog.empty();
            dialog.html(dialog.load(url));
        });

        $('a[name="btnEdit"]').on('click', function () {
            var id = $(this).data("id");
            if (id) {
                var url = "/PersonalCenterConfigV2/HomePageModuleContent?id=" + id + "&moduleID=" + $('#hiddenModuleID').val() + "&moduleHelperID=" + $('#hiddenModuleHelperID').val();
                // dialogOpen("新增首页", url, "edit");
                var dialog = $('#edit');
                dialog.empty();
                dialog.html(dialog.load(url));
            }
        });

        $('a[name="btnDelete"]').on('click', function () {
            var id =$(this).data("id")
            if (confirm("您确定删除吗?")) {
                $.ajax({
                    url: '/PersonalCenterConfigV2/DeleteHomePageModuleContent',
                    type: 'post',
                    data: { id: id },
                    dataType:'json'
                }).done(function (result) {
                    if (result == 1) {
                        location.reload();
                    } else {
                        alert("删除失败");
                    }
                });
            }
        });

        ///showImg：上传时Image显示的标签ID
        //showUrl:真正显示的
        function UploadBgImg(obj, showImg, showUrl) {

            var pobj = $(obj);
            var rd = Math.ceil(Math.random() * 9999) + 1;
            var fileElId = $(obj).attr("id");
            console.log(fileElId);
            $.ajaxFileUpload({
                url: '/Article/ImageUploadToAli?rd=' + rd,
                secureuri: false,
                fileElementId: fileElId,
                dataType: 'json',
                async: false,
                success: function (result) {
                    if (result.BImage != "" && result.SImage != "") {
                        $("#" + showImg).attr("src", result.SImage).show();
                        $("#" + showUrl).val(result.BImage);
                    } else {
                        alert("上传失败！");
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            });
        }


    </script>
    }