@using Tuhu.Provisioning.DataAccess.Entity;
@{
    ViewBag.Title = "轮胎区域库存查询";
    Layout = "~/Views/Shared/_Layout.cshtml";
    IEnumerable<TireSizeModel> tireList = ViewData["tireSizes"] as IEnumerable<TireSizeModel>;
}
@section head{
    <style>
        .title {
            float: left;
        }

        .content {
            clear: both;
        }

        .condition .name {
            font-size: 16px;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .condition label {
            font-size: 14px;
            margin-left: 10px;
        }

        .condition > div {
            margin-bottom: 10px;
            padding-left: 82px;
            position: relative;
        }

        .f14 {
            font-size: 14px;
            margin-left: 10px;
        }

        .red {
            color: red;
        }

        .tiresize-append label.hide {
            display: none;
        }

        .tiresize-append label {
            margin-right: 50px;
            display: inline-block;
            min-width: 99px;
        }

        .list table {
            width: 100%;
        }

        .data_count {
            color: blue;
            font-size: 14px;
            font-weight: bold;
            margin-left: 10px;
        }

        #Tire_Width {
            margin-left: 13px;
        }

        div#BatchAddItem > div, div#ReplaceItem > div {
            margin-bottom: 20px;
        }

        img.img {
            width: 100px;
            height: 100px;
            cursor: pointer;
        }

        span.no {
            color: red;
        }

        .list {
            width: 100%;
            overflow-x: scroll;
        }
    </style>
}
<div class="title">
    <h2>轮胎区域库存查询</h2>
</div>
<div class="content">
    <div class="condition">

        <div>
            <span class="name">品牌：</span>
            <select id="BrandCriterion" name="BrandCriterion" style="width:200px;" onchange="BrandChange(this.value)"></select>
        </div>
        <div>
            <span class="name">车系：</span>
            <select id="VehicleCriterion" name="VehicleCriterion" style="width:200px;" onchange="VehicleChange(this.value)"></select>
        </div>
        <div>
            <span class="name">轮胎尺寸：</span>
            @Html.DropDownList("Tire_Width", tireList.Select(T => T.Width).Distinct().OrderBy(v => v).Select(value => new SelectListItem() { Text = value, Value = value }), "胎面宽")<b>/</b>
            @Html.DropDownList("Tire_AspectRatio", tireList.Select(T => T.AspectRatio).Distinct().OrderBy(v => v).Select(value => new SelectListItem() { Text = value, Value = value }), "扁平比")<b>R</b>
            @Html.DropDownList("Tire_Rim", tireList.Select(T => T.Rim).Distinct().OrderBy(v => v).Select(value => new SelectListItem() { Text = value, Value = value }), "直径")
        </div>
        <div>
            <span class="name">地区：</span>
            <select id="province">
                <option data-pkid="1" value="上海市">上海市</option>
            </select>
            <select id="city">
                <option data-pkid="1" value="上海市">上海市</option>
            </select>
        </div>
        <div>
            <span class="name">PID</span>
            <input type="text" name="PID" value="" style="width: 150px" />
        </div>
        <div>
            <span class="name">产品名称</span>
            <input type="text" name="productname" value="" style="width: 150px" />
        </div>
        <button class="select" onclick="RegionFunc.LoadList(1)" style="width: 200px; height: 30px; display: block; MARGIN-TOP: 12px;">查询</button>
        <br />
    </div>
    <div style="margin-bottom:30px">
        每页显示：
        <select class="PageSize">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="10000">10000</option>
        </select>条
        <span class="data_count"></span>
    </div>
    <img class="loadimg" src="~/Scripts/layer/skin/default/loading-2.gif" style="margin:5% 50%;display:none;" />
    <div class="list"></div>
</div>

<script src="~/Content/sweetalert/sweetalert.js"></script>
<script src="~/Scripts/Tire.js"></script>
<script>


    function LoadBrand() {
        $.ajax({
            url: "/WheelAdapterConfig/GetBrands",
            type: "POST",
            data: {},
            dataType: "json",
            async: false,
            success: function (data) {
                var html = "";
                var n = data.length;
                if (n > 0) {
                    html += "<option value=''>-选择品牌-</option>"
                    for (var j = 0; j < n; j++) {
                        html += "<option value='" + data[j].str + "'>" + data[j].str + "</option>";
                    }
                }
                else {
                    html += "<option value=''>无数据</option>";
                }
                $("#BrandCriterion").empty();
                $("#BrandCriterion").append(html);
                BrandChange($("#BrandCriterion").val());
            },
            error: function () {
                alert("请求失败！");
                var html = "<option value=''>无数据</option>";
                $("#BrandCriterion").empty();
                $("#BrandCriterion").append(html);
                BrandChange("");
            },
        });
    }
    function BrandChange(brand) {
        if (brand == "") {
            var html = "<option value=''>-选择车系-</option>";
            $("#VehicleCriterion").empty();
            $("#VehicleCriterion").append(html);
            //VehicleChange("");
        }
        else {
            $.ajax({
                url: "/WheelAdapterConfig/GetVehiclesAndId",
                type: "POST",
                data: {
                    brand: brand,
                },
                dataType: "json",
                async: false,
                success: function (data) {
                    var html = "";
                    var n = data.length;
                    if (n > 0) {
                        html += "<option value=''>-选择车系-</option>"
                        for (var j = 0; j < n; j++) {
                            html += "<option value='" + data[j].str1 + "'>" + data[j].str + "</option>";
                        }
                        $("#VehicleCriterion").empty();
                        $("#VehicleCriterion").append(html);

                    }
                    else {
                        html += "<option value=''>无数据</option>";
                        $("#VehicleCriterion").empty();
                        $("#VehicleCriterion").append(html);
                    }
                },
                error: function () {
                    alert("请求失败！");
                    var html = "<option value=''>无数据</option>";
                    $("#VehicleCriterion").empty();
                    $("#VehicleCriterion").append(html);
                },
            });
        }
    }
    function VehicleChange(value) { }

    $(function () {

        LoadBrand();

        $.get("/Tire/GetRegion", null, function (regions) {
            var html_p = '';
            $.map(regions, function (value, key) {
                if (value.RegionId != 1)
                    html_p += '<option data-pkid="' + value.RegionId + '" value="' + value.RegionName + '">' + value.RegionName + '</option>';
            });
            $("#province").append(html_p);

            $("#province").change(function () {
                var PKID = $("#province>option:selected").attr("data-pkid");
                var name = $("#province>option:selected").val();
                var html_c = '';
                var zxs = false;
                if (PKID == 1 || PKID == 2 || PKID == 19 || PKID == 20)
                    zxs = true;
                if (PKID && PKID.length) {
                    $.map(regions, function (value, key) {
                        if (value.RegionId == PKID) {
                            if (zxs) {
                                html_c += '<option data-pkid="' + PKID + '" value="' + name + '">' + name + '</option>'
                            }
                            else {
                                html_c += '<option value="">请选择</option>'
                                $.map(value.ChildRegions, function (v, k) {

                                    html_c += '<option data-pkid="' + v.RegionId + '" value="' + v.RegionName + '">' + v.RegionName + '</option>';
                                });
                            }
                        }
                    });
                }
                $("#city").empty().append(html_c);
            });
        });
        RegionFunc.LoadList(1);
        $(".list").on("click", ".pager>a", function (event) {
            event.preventDefault();
            var url = $(this).attr("href");
            if (url) {
                $.post(url, function (html, status) {
                    if (status === "success") {
                        $(".list").html(html);
                    }
                });
            }
        })
        $(".PageSize").change(function () {
            LoadList(1);
        });
    });


</script>
<script>
    var RegionFunc = {
        LoadList: function (index) {
            var cityId = $("#city option:selected").attr("data-pkid"),
                PID = $("[name=PID]").val().trim(),
                productname = $("[name=productname]").val().trim(),
                pageSize = $(".PageSize>option:selected").val(),
                address = $("#province option:selected").val() + ';' + $("#city option:selected").text();
            var BrandCriterion = $("#BrandCriterion option:selected").val();
            var VehicleCriterion = $("#VehicleCriterion option:selected").val();
            //VehicleId


            var Tire_Width = $("#Tire_Width").val();
            var Tire_AspectRatio = $("#Tire_AspectRatio").val();
            var Tire_Rim = $("#Tire_Rim").val();
            var TireSize = "";
            if (BrandCriterion && !VehicleCriterion) {
                alert("查询参数不足");
                return;
            }

            if (Tire_Width && Tire_AspectRatio && Tire_Rim) {
                TireSize = Tire_Width + '/' + Tire_AspectRatio + 'R' + Tire_Rim;
            }
            if ((!TireSize && VehicleCriterion) || (TireSize && !VehicleCriterion)) {
                alert("查询参数不足");
                return;
            }
            if (!TireSize && VehicleCriterion) {

            }
            $.get("/Tire/SelectRegionStockList", {
                CityId: cityId,
                PID: PID,
                ProductName: productname,
                VehicleId: VehicleCriterion,
                TireSize: TireSize,
                Address: address,
                PageSize: pageSize,
                PageIndex: index
            }, function (html, status) {
                if (status === "success") {
                    $(".loadimg").hide();
                    $(".list").html(html);
                    $(".data_count").text('共' + ($(".table").length ? $(".table").attr("data-count") : 0) + '条数据');
                }
            });
        },
    }



</script>
