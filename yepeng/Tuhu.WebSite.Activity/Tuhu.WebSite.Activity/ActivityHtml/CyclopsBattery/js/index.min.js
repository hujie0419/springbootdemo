function GetHuoDongImage(){$.ajax({url:"http://huodong.tuhu.cn/Activity/GetBatteryBanner",type:"GET",data:{},dataType:"json",async:!1,success:function(n){n&&($("#LodImg").attr("src",n.Image),n.Display?($(".notice").show(),$(".notice-bg").show()):($(".notice").hide(),$(".notice-bg").hide()))}})}function connectWebViewJavascriptBridge(n){window.WebViewJavascriptBridge?n(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){n(WebViewJavascriptBridge)},!1)}function Login(){userAgentInfo.indexOf("Android")>=0?window.WebViewJavascriptBridge.callHandler("actityBridge",{param:""},function(n){n!=null&&CallBackAppLoginResponse(n)}):iosend("aboutTuhuUserinfologin","CallBackAppLoginResponse")}function CallBackAppLoginResponse(n){var t=null;userAgentInfo.indexOf("Android")>=0?(t=JSON.parse(n),ProvinceName=t.Province,CountyName=t.County):(t=n,ProvinceName=t.province);CountyName=t.district;UserId=t.userid;Phone=t.phone;CityName=arryZhiXiaSHi.indexOf(ProvinceName)>-1?CountyName:t.city;SetCookie("UserId",UserId);SetCookie("Phone",Phone);SetCookie("Uuid",t.uuid);SelectCarObject(t.userid)}function iosend(n,t){location.href="#testapp#"+n+"#"+encodeURIComponent(t)}function GetTID(n,t,i,r){$.ajax({url:DomainItem+"Car/SelectVehicle",type:"GET",data:{VehicleID:t,PaiLiang:i,Nian:r,IsBattery:!0},dataType:"jsonp",async:!1,success:function(u){var f,e;if(u.Code=="1"){$(".progress").hide();$(".cx-title").show();$(".cx-container").show();$(".notice-bg").show();f="";console.log(JSON.stringify(u));for(e in u.SalesName)f+='<div class="cx" tid="'+u.SalesName[e].TID+'">'+u.SalesName[e].Name+"<\/div>";$(".cx-wrapper").append(f);$(".cx").on("click",function(){$(".cx-title").hide();$(".notice-bg").hide();TID=$(this).attr("tid");GetBatteryList(TID);$(".cx-container").hide();UpdateDefultCar(n,t,i,r,TID)})}else u.Code=="0"&&GetWuJi(t,i,r)}})}function UpdateDefultCar(n,t,i,r,u){$.ajax({method:"GET",url:DomainItem+"CarHistory/UpdateCarObject.html",data:{CarID:n,ProductID:t,IsDefaultCar:!0,TID:u,UserID:UserId,Pailiang:i,Nian:r,PropertyList:""},dataType:"json"}).done(function(){}).fail(function(){})}function GetWuJi(n,t,i){$.ajax({url:DomainItem+"Car/GetVehicleSalesName",type:"GET",data:{VehicleID:n,PaiLiang:t,Nian:i},dataType:"jsonp",async:!1,success:function(n){if(n.Code=="1"){if(TID=n.SalesName[0].TID,TID==null||TID=="null"||TID=="")return NoneFooter(),!1;GetBatteryList(TID)}else NoneFooter()}})}function GetPailiang(n){$.ajax({url:DomainItem+"Car/SelectVehicle",type:"GET",data:{VehicleID:n,PaiLiang:"",Nian:""},dataType:"jsonp",async:!1,success:function(n){if(n.Code=="1"){if(userAgentInfo.indexOf("Android")>=0)if(isAndroidVersion)window.WebViewJavascriptBridge.callHandler("setUserCarInfo",function(){});else return NoneFooterForOld(),!1;else isIosVersion?NoneFooter():NoneFooterForOld();NoneFooterForOld()}else n.Code=="0"&&NoneFooter();return!1}})}function SelectCarObject(n){$.ajax({url:DomainItem+"CarHistory/SelectCarObject.html",type:"GET",data:{userID:n},dataType:"jsonp",async:!1,success:function(n){var t,i,s,h,f,e;if(n.Code=="1"&&n.CarHistory.length>0)for(t in n.CarHistory)if(n.CarHistory[t].IsDefaultCar=="1"){var o=n.CarHistory[t].CarID,c=n.CarHistory[t].LIYANGID,u=n.CarHistory[t].Nian,r=n.CarHistory[t].Pailiang;if(TID=n.CarHistory[t].TID,i=n.CarHistory[t].ProductID,Vehicle=n.CarHistory[t].Vehicle,s=n.CarHistory[t].Brand,VehicleLogin="http://image.tuhu.cn"+n.CarHistory[t].VehicleLogin,h=n.CarHistory[t].SalesName,$("#vehicleName").html(Vehicle),$("#loginImg").css({"background-image":"url("+VehicleLogin+")","background-repeat":" no-repeat","background-size":"contain"}),f=r+" "+u,$("#plNian").html(f),i!=""&&r=="")GetPailiang(i);else{TID=="null"||TID==null||TID==""?GetTID(o,i,r,u):GetBatteryList(TID);e={CarID:n.CarHistory[t].CarID,LIYANGID:n.CarHistory[t].LIYANGID,Nian:n.CarHistory[t].Nian,Pailiang:n.CarHistory[t].Pailiang,TID:n.CarHistory[t].TID,ProductID:n.CarHistory[t].ProductID,Vehicle:n.CarHistory[t].Vehicle,Brand:n.CarHistory[t].Brand,VehicleLogin:"http://image.tuhu.cn"+n.CarHistory[t].VehicleLogin,SalesName:n.CarHistory[t].SalesName};SetCookie("carData",JSON.stringify(e));break}}else{var o=n.CarHistory[0].CarID,c=n.CarHistory[0].LIYANGID,u=n.CarHistory[0].Nian,r=n.CarHistory[0].Pailiang;if(TID=n.CarHistory[0].TID,i=n.CarHistory[0].ProductID,Vehicle=n.CarHistory[0].Vehicle,s=n.CarHistory[0].Brand,VehicleLogin="http://image.tuhu.cn"+n.CarHistory[0].VehicleLogin,h=n.CarHistory[0].SalesName,$("#vehicleName").html(Vehicle),$("#loginImg").css({"background-image":"url("+VehicleLogin+")","background-repeat":" no-repeat","background-size":"contain"}),f=r+" "+u,$("#plNian").html(f),i!=""&&r=="")GetPailiang(i);else{TID=="null"||TID==null||TID==""?GetTID(o,i,r,u):GetBatteryList(TID);e={CarID:n.CarHistory[0].CarID,LIYANGID:n.CarHistory[0].LIYANGID,Nian:n.CarHistory[0].Nian,Pailiang:n.CarHistory[0].Pailiang,TID:n.CarHistory[0].TID,ProductID:n.CarHistory[0].ProductID,Vehicle:n.CarHistory[0].Vehicle,Brand:n.CarHistory[0].Brand,VehicleLogin:"http://image.tuhu.cn"+n.CarHistory[0].VehicleLogin,SalesName:n.CarHistory[0].SalesName};SetCookie("carData",JSON.stringify(e));break}}else if(userAgentInfo.indexOf("Android")>=0)if(isAndroidVersion)window.WebViewJavascriptBridge.callHandler("setUserCarInfo",function(){});else return NoneFooterForOld(),!1;else if(!isIosVersion)return NoneFooterForOld(),!1},error:function(){}})}function GetQueryString(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t!=null?unescape(t[2]):null}function GetBatteryList(n){$.ajax({url:"http://wx.tuhu.cn/Battery/GetBatteryListV1",type:"GET",data:{LiYangID:n,TID:n,r:Math.random()},dataType:"jsonp",async:!1,success:function(n){var i,t;if(n.IsSuccess){if($(".btn").removeClass("disabled"),$(".no-data").hide(),i="",ProvinceList=n.ResultProvinceList,CityList=n.ResultCityList,ProductData=n.ResultData,$.each(ProvinceList,function(n,t){i+=(n==0?"<span class='closebtn'><\/span>":"")+"<li onclick='SelectProvinceItem(\""+t.Pid+"\",this);'  data-value='"+t.Pid+"' data-name='"+t.PName+"' >"+t.PName.substr(0,5)+"<br/>"+t.PName.substr(5)+"<\/li>";$("#province-ul").html(i)}),ProvinceName!=null&&ProvinceName!=""){for(t in ProvinceList)ProvinceList[t].PName==ProvinceName&&(ProvinceId=ProvinceList[t].Pid);if(CityName!=null&&CityName!="")for(t in CityList)CityList[t].CName==CityName&&(CityId=CityList[t].Cid)}else $("#province-ul").show();AutoFillRegionByGPS(ProvinceId,CityId);$(".progress").hide()}else return NoneFooter(),!1},error:function(){}})}function NoneFooter(){$(".select-city").css("display","none");$(".view-more").html("<span style='color:red;font-size:24px;'>\u60a8\u7684\u8f66\u578b\u6682\u65e0\u6b64\u670d\u52a1\uff01<\/span>");$(".foot").css("display","none");$(".view-more").css({"text-align":"center","margin-top":"0%",display:"block"});$("#province-ul").css("display","none");$(".progress").hide();$(".notice-bg").hide()}function NoneFooterForOld(){$(".select-city").css("display","none");$(".view-more").html("<div style='font-size:24px;'>\u60a8\u7684\u8f66\u578b\u4fe1\u606f\u4e0d\u5b8c\u6574 <br/>1\u3001\u8bf7\u5230\u7231\u8f66\u6863\u6848\u91cc\u5b8c\u5584\u8f66\u578b\u53c2\u6570 <br/>2\u3001\u6709\u4e9b\u8f66\u578b\u65e0\u53c2\u6570\uff0c\u6682\u65e0\u7535\u74f6\u670d\u52a1<\/div>");$(".foot").css("display","none");$(".view-more").css({"text-align":"center","margin-top":"0%",display:"block",color:"red"});$("#province-ul").css("display","none");$(".progress").hide();$(".notice-bg").hide()}function SelectProvinceItem(n,t){SelectedPid=n;console.log(n);$(".provinceid").val(n);SetCookie("RegionPid",n);CurrentCityList=CityList.filter(function(t){return t.Pid==n?!0:!1});var i="";$.each(CurrentCityList,function(n,t){i+=(n==0?"<span class=''><\/span>":"")+"<li onclick='SelectCityItem(\""+t.Cid+"\",this);'  data-value='"+t.Cid+"' data-name='"+t.CName+"' >"+t.CName.substr(0,5)+"<br/>"+t.CName.substr(5)+"<\/li>"});$("#province").find(".default").html($(t).attr("data-name"));$("#city").find(".default").html("\u57ce\u5e02/\u5730\u533a\u3001\u81ea\u6cbb\u5dde");$("#city-ul").html(i);$("#province-ul").css("display","none");$("#city-ul").css("display","block")}function SelectCityItem(n,t){$(".areaSelect").css("border","");$(".cityid").val(n);SetCookie("RegionCid",n);$("#city").find(".default").html($(t).attr("data-name"));CurrentCityItem=CurrentCityList.filter(function(t){return n==t.Cid?!0:!1})[0];$("#city-ul").hide();AppendProudts()}function AppendProudts(){var s=[],h=-1,n,u,t,f,i,r,o;for(n in ProductData)for(u in CurrentCityItem.BrandCoverList)ProductData[n].Brand==CurrentCityItem.BrandCoverList[u].Brand&&CurrentCityItem.BrandCoverList[u].Cid==ProductData[n].CityId&&(t={ProductID:"",VariantID:"",Image:"",DisplayName:"",SalesQuantity:"",CommentTimes:"",Price:"",ServiceRemark:"",CP_ShuXing5:"",CP_Tab:""},t.ProductID=ProductData[n].ProductID,t.Image=ProductData[n].Image,t.DisplayName=ProductData[n].DisplayName,t.SalesQuantity=ProductData[n].SalesQuantity,t.CommentTimes=ProductData[n].CommentTimes,t.Price=ProductData[n].Price,t.VariantID=ProductData[n].VariantID,t.CP_Tab=ProductData[n].CP_Tab,t.CP_ShuXing5=ProductData[n].CP_ShuXing5,t.ServiceRemark=CurrentCityItem.BrandCoverList[u].ServiceRemark,h++,s[h]=t);f="";i=s;console.log(JSON.stringify(i));$(".scroll .product").remove();for(r in i)if(i[r].ProductID){var l=i[r].CP_ShuXing5||"",e=l.split("#"),c="";c=e[1]?'<span style="display:none" class="tip red">\u8d60\u5c0f\u7c73\u7535\u6e90<\/span><span class="tip green">'+e[1]+"<\/span>":'<span style="display:none" class="tip red">\u8d60\u5c0f\u7c73\u7535\u6e90<\/span><span class="tip green" style="display:none">'+e[1]+"<\/span>";o="";i[r].Image&&(o=i[r].Image.replace("https","http"));f+=' <div class="product" style="display:none;"><div class="t clear"><div class="checkbox">\u9009\u62e9<\/div><img style="display:none" src="img/icon.png" alt="" class="right" /><span>&yen; <span>'+i[r].Price+'<\/span><\/span><p style="display:none;" class="datajson">'+JSON.stringify(i[r])+'<\/p><\/div><div class="m clear"><img src="'+o+'" alt="" /><div><div>'+i[r].DisplayName+"<\/div>"+c+"<div>\u914d\u9001\u8303\u56f4\uff1a"+i[r].ServiceRemark+"<\/div><\/div><\/div><\/div>"}i.length>2?($(".view-more").css("display","block"),$(".view-more>p").css("display","block")):$(".view-more>p").css("display","none");f?$(".view-more").before(f):NoneFooter();$(".product").eq(0).css("display","block");$(".product").eq(0).find("span").addClass("recommend");$(".product").eq(0).find(".right").css("display","block");$(".product").eq(1).css("display","block");$(".product").eq(0).find(".checkbox").toggleClass("checked");SelectedProductItem=JSON.parse($(".product").eq(0).find(".datajson").text());SetCookie("currentSelectProduct",JSON.stringify(SelectedProductItem));SelectedProductItem&&$(".p-price").html(SelectedProductItem.Price)}function SelectedProduct(n){$(".product .checkbox").not(n).removeClass("checked");$(n).find(".checkbox").toggleClass("checked");SelectedProductItem=JSON.parse($(n).parents(".product").find(".datajson").text());SetCookie("currentSelectProduct",JSON.stringify(SelectedProductItem));$(".p-price").html(SelectedProductItem.Price)}function GetMore(n){$(".product").css("display","block");$(n).css("display","none")}function PayClick(){if(SetCookie("vehicleName",Vehicle),SetCookie("vehicleLogin",VehicleLogin),$(this).hasClass("disabled")||$(".areaSelect>li").eq(1).find(".selectItem").children(".default").text()=="\u57ce\u5e02/\u5730\u533a\u3001\u81ea\u6cbb\u5dde")$(".areaSelect").css("border","2px solid red");else if($(".p-price").text()!=""&&$(".p-price").text()!=null){var n=$(".areaSelect>li").eq(0).find(".selectItem").children(".default").text(),t=$(".areaSelect>li").eq(1).find(".selectItem").children(".default").text(),i=$(".provinceid").val(),r=$(".cityid").val(),u={ProvinceName:n,CityName:t,ProvinceId:i,CityId:r},f=encodeURIComponent(JSON.stringify(u));window.location.href="http://huodong.tuhu.cn/ActivityHtml/CyclopsBattery/Order.html?RegionSelect="+f+"&v=7"}else alert("\u8bf7\u9009\u62e9\u4ea7\u54c1\uff01")}function ToDetail(n){var u=JSON.parse($(n).parent().children().find(".datajson").text()),r=u.ProductID,i=u.VariantID,e={ProductID:r,VariantID:i,ChePingTyPe:"4",FunctionID:"cn.TuHu.Activity.AutomotiveProducts.AutomotiveProductsDetialUI",isPAy:0},f={productID:r,VariantID:i,goodsListDetailType:2},t;userAgentInfo.indexOf("Android")>=0?(t="http://item.tuhu.cn/MobileClient/Introduce/"+r,t=i>0?t+"/"+i+".html":t+".html",location.href=t):location.href="#testapp#customSegue#TNGoodsListDetailViewController#"+encodeURIComponent(JSON.stringify(f))}function AutoFillRegion(){var n=GetCookie("RegionPid"),t=GetCookie("RegionCid");n!=null&&$("[data-value='"+n+"']").length>0&&SelectProvinceItem(n,$("[data-value='"+n+"']"));t!=null&&$("[data-value='"+t+"']").length>0&&SelectCityItem(t,$("[data-value='"+t+"']"))}function SetCookie(n,t){var i=new Date;i.setTime(i.getTime()+6048e5);document.cookie=n+"="+escape(t)+";path=/;expires="+i.toGMTString()}function GetCookie(n){var t=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}function AutoFillRegionByGPS(n,t){n!=null&&$("[data-value='"+n+"']").length>0&&SelectProvinceItem(n,$("[data-value='"+n+"']"));t!=null&&$("[data-value='"+t+"']").length>0&&SelectCityItem(t,$("[data-value='"+t+"']"))}function VersionForIos(){isIosVersion=!0}function VersionForAndroid(){isAndroidVersion=!0}var userAgentInfo,SelectedPid,isIosVersion,isAndroidVersion;$(function(){var i,t,n;if($(".chooseItem").hide(),$(".view-more").hide(),GetHuoDongImage(),i={width:"100%",height:$(document).height(),"background-color":"rgba(0, 0, 0, 0.24)",zIndex:1e4,position:"absolute",top:0,left:0,display:"none"},$("<div class='layer'/>").css(i).appendTo($("body")),$(".car-info").length){$(".btn").tap(function(n){$(".notice").toggle();$(".notice-bg").toggle();n.stopPropagation()});$(".pay").tap(function(n){PayClick();n.stopPropagation()});$(".action-icon").tap(function(n){$(".notice").toggle();$(".notice-bg").toggle();n.stopPropagation()});$(".scroll").on("tap",".t",function(){SelectedProduct(this)});$(".scroll").on("tap",".m",function(){ToDetail(this)});$(".view-more").on("tap","p",function(){GetMore(this)});t=$("#province-ul");n=$("#city-ul");$(".areaSelect").on("tap","li",function(){var i=$(this).index();if(i===0){if(n.css("display")=="block")return!1;t.css("display")=="block"?t.hide():t.show()}else n.css("display")=="block"?n.hide():n.show()})}Login()});userAgentInfo=navigator.userAgent;connectWebViewJavascriptBridge(function(n){n.init(function(n,t){t({"Javascript Responds":"Wee!"})});n.registerHandler("functionInJs",function(n,t){t("Javascript Says Right back aka!")})});var TID="",VehicleLogin="",Vehicle="",UserId="",Phone="",ProvinceName="",CityName="",CountyName="",DomainItem="http://item.tuhu.cn/",arryZhiXiaSHi=["\u4e0a\u6d77\u5e02","\u5317\u4eac\u5e02","\u5929\u6d25\u5e02","\u91cd\u5e86\u5e02"];var RegionData=null,CurrentCityList=null,ProductData=null,ProvinceList=null,CityList=null,CurrentCityItem=null,SelectedProductItem=null,ProvinceId=0,CityId=0;SelectedPid=null;isIosVersion=!1;isAndroidVersion=!1;