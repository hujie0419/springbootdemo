@model IEnumerable<Tuhu.Provisioning.DataAccess.Entity.GaiZhuangRelateArticleModel>

@{
    var title = "改装文章配置";

    ViewBag.Title = title;
}
<style>
    .ui-dialog {
        border-radius: 3px;
        padding: 0px;
        width: auto;
    }

    .ui-dialog-grid {
        width: 100%;
    }

    .ui-dialog-title {
        width: 75%;
        padding: 8px 15px 8px 15px;
    }

    .ui-dialog-close {
        top: 8px;
    }

    .ui-dialog-body {
        padding: 10px;
    }

    .ui-dialog-content {
        padding: 0px;
    }

    .ui-dialog-footer {
        padding: 5px 10px 5px 5px;
        background: #ffffff;
        border-top: 1px solid #eee;
    }

        .ui-dialog-footer button {
            padding: 3px 15px;
            border-radius: 2px;
            box-shadow: 0 1px 1px rgba(0,0,0,.15);
            font-size: 12px;
        }

            .ui-dialog-footer button.ui-dialog-autofocus {
                font-weight: 700;
                text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
            }

    .button1 {
        border-radius: 5px;
        padding: 5px 25px;
        border: none;
        color: #F0F0F0;
        font-size: 12px;
        font-family: "Microsoft Yahei";
        outline: none;
        cursor: pointer;
        background: #0088cc;
        border-color: #0088cc;
    }

    table th {
        color: white;
        padding: 6px 5px;
        text-align: left;
        background-color: #0088cc;
        border: solid 1px #0088cc;
    }
</style>
<script src="../../Scripts/ajaxfileupload.js" type="text/javascript"></script>
<link rel="stylesheet" href="/Scripts/artDialog6.0.4/css/ui-dialog.css" />
<script src="~/Scripts/artDialog6.0.4/dist/dialog-min.js"></script>
<script src="~/Scripts/artDialog6.0.4/dist/dialog-plus-min.js"></script>

<h2 style="">改装文章配置</h2>

<div id="advertcategoryconfig" style="overflow:hidden">
    <div id="advertcategoryconfigList">
        <a class="button1" href="javascript:;" style="margin-bottom: 20px; float: right;" onclick="AddArticle();">添加文章</a>
        
        <table style="text-align: center; width: 100%;">
            <tr>
                <th>文章名称</th>
                <th>文章链接</th>
                <th>适配车型</th>
                <th>操作</th>
            </tr>
            @foreach (var item in Model)
            {
                <tr>
                    <td style="width: 30%">@item.ArticleName</td>
                    <td style="width: 20%">@item.ArticleLink</td>
                    <td style="width: 20%; overflow: hidden;">
                        
                        <a value="@(item.PKID)" id="@(item.PKID)_Show" onclick="ShowVehicle(@(item.PKID))">适配车型</a>
                    </td>
                    <td style="width: 30%">
                        <a class="EditArticleItem" value="@(item.PKID)" id="@(item.PKID)_Update" href="/ConfigCategory/ArticleCategory?pkid=@item.PKID" onclick="UpdateArticleCategory(@(item.PKID))">编辑</a>
                        <a class="DeleteArticleItem" value="@(item.PKID)" id="@(item.PKID)_Delete" onclick="DeleteArticleCategory(@(item.PKID))">删除</a>
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

<script>
    function AddArticle() {

        window.location.href="/ConfigCategory/ArticleCategory?categoryid="+@ViewData["articlecategoryid"];
    }
    function insertarticle() {
        var categoryid=@ViewData["articlecategoryid"];
        var dialgpResult = dialog({
            height: 400,
            width: 800,
            title: "添加文章",
            button: [
            {
                value: "保存",
                callback: function () {
                    var paramItems = [];
                    var checkItems = [];
                    var checkBoxArray = $(".search-list").find("input[type='checkbox']:checked");

                    for (var i = 0; i < checkBoxArray.length; i++) {
                        var item = {};
                        var level = $(checkBoxArray[i]).attr("id");
                        var name = $(checkBoxArray[i]).attr("name");
                        //console.log(level + name + ',');
                        item.Level = level;
                        item.Name = name;
                        checkItems.push(item);
                    }
                    var level1Items = _.filter(checkItems, function (dataItem) { return dataItem.Level == 'level1'; });
                    var level2Items = _.filter(checkItems, function (dataItem) { return dataItem.Level == 'level2'; });
                    var level3Items = _.filter(checkItems, function (dataItem) { return dataItem.Level == 'level3'; });
                    var level4Items = _.filter(checkItems, function (dataItem) { return dataItem.Level == 'level4'; });
                    var level5Items = _.filter(checkItems, function (dataItem) { return dataItem.Level == 'level5'; });

                    fillLevelItems(paramItems, level1Items, "level1");
                    fillLevelItems(paramItems, level2Items, "level2");
                    fillLevelItems(paramItems, level3Items, "level3");
                    fillLevelItems(paramItems, level4Items, "level4");
                    fillLevelItems(paramItems, level5Items, "level5");

                    var selectParams = getPostDataParams();
                    alert(JSON.stringify(paramItems));
                    alert(JSON.stringify(selectParams));
                    $.ajax({
                        url: '/ConfigCategory/InsertArticleItem',
                        type: 'POST',
                        dataType: 'JSON',
                        data: { param: JSON.stringify(paramItems),  selectItems: JSON.stringify(selectParams),categoryId:categoryid,articleName: $("#ArticleName").val(),articleLink:$("#ArticleLink").val()},
                        success: function (result) {
                            if (result) {
                                window.location.reload(true);

                            }
                            else {
                                alert("保存失败！");

                            }

                        }
                    });

                }
            },
            {
                value: "关闭"
            }]
        });

        $.ajax({
            url: "/ConfigCategory/ArticleCategory?categoryid="+categoryid,
            data: { categoryid: categoryid },
            type: "GET",
            success: function (result) {

                dialgpResult.content(result);
                dialgpResult.showModal();

            }
        });
    };

    function UpdateArticleCategory(e) {
        var dialgpResult = dialog({
            height: 400,
            width: 800,
            title: "编辑文章",
            button: [
            {
                value: "保存",
                callback: function () {
                    $.ajax({
                        type: "POST",
                        url: "/ConfigCategory/UpdateArticleItem",
                        data: {
                            "pkid": e,
                            "categoryID": $("#CategoryID").val(),
                            "pid": $("#PID").val(),
                            "vehicleID": $("#VehicleID").val(),
                            "articleName": $("#ArticleName").val(),
                            "articleLink": $("#ArticleLink").val()
                        },
                        success: function (result) {
                            if (result) {
                                window.location.reload(true);

                            }
                            else {
                                alert("保存失败！");

                            }
                        }
                    });
                }
            },
            {
                value: "关闭"
            }]
        });

        $.ajax({
            url: "/ConfigCategory/ArticleCategory?pkid=" + e,
            data: { pkid: e },
            type: "GET",
            success: function (result) {

                dialgpResult.content(result);
                dialgpResult.showModal();

            }
        });
    };

    function DeleteArticleCategory(e) {
        if (confirm("确定要删除吗")) {
            $.ajax({
                type: "POST",
                url: "/ConfigCategory/DeleteArticleCategory",
                data: {
                    "pkid": e
                },
                success: function (result) {
                    if (result) {
                        window.location.reload(true);

                    }
                    else {
                        alert("删除失败！");

                    }
                }
            });
        };
    }

    function ShowVehicle(e) {

        var dialgpResult = dialog({
            height: 350,
            width: 700,
            title: "适配车型"
            
        });

        $.ajax({
            url: "/ConfigCategory/ShowVehicles?articleId="+e,
            data: {articleId:e},
            type: "GET",
            success: function (result) {

                dialgpResult.content(result);
                dialgpResult.showModal();

            }
        });
    };
</script>


