!function(){function c(){var n=navigator.userAgent.toLowerCase(),t=n.indexOf("android")>-1;return t?!0:!1}function l(n){return c()?n.BannerUrlAndroid:n.BannerUrlIOS}function u(n,t){var r=n/1e3,u=Math.floor(r/3600),i=Math.floor((r-u*3600)/60),f=Math.floor(r-u*3600-i*60);t.hour=u;t.minute=i>=10?i:"0"+i;t.second=f>=10?f:"0"+f}function o(t,i){function c(t,r){var u=function(i,r){var u={ouSurplusMAX:["您购买的",t.PName,"数量超出该商品的剩余数量！该商品剩余",t.surplusQuantity,"件"].join(""),hasBUYMAX:["该产品限购买",t.MaxQuantity,"件，您已不能再次购买！"].join(""),hasBUY:["该产品限购买",t.MaxQuantity,"件，您已购买",r,"件！"].join(""),outLimitMAX:["该产品限购",t.MaxQuantity,"件哦！"].join("")};return n(u[i]||""),!1},e,f;if(t.TotalQuantity>0&&r>t.surplusQuantity)return u("ouSurplusMAX");if(e=i.filter(function(n){return n.PID=t.PID}),e.length){if(f=e[0].Quantity,t.MaxQuantity!==0){if(f>=t.MaxQuantity)return u("hasBUYMAX");if(f+r>t.MaxQuantity)return u("hasBUY",f)}}else if(r>t.MaxQuantity&&t.MaxQuantity>0)return u("outLimitMAX");return!0}var o=l(t),f;o&&$("#bannerImg").attr("src",o);t.BackgoundColor&&$(document.body).attr("backgroundColor",t.BackgoundColor);t.bannerImg=o;t.ActivityName&&(document.title=t.ActivityName);f=r.actid;var a={add:function(n,t){var r,u,i;try{r=n.toString().split(".")[1].length}catch(f){r=0}try{u=t.toString().split(".")[1].length}catch(f){u=0}return i=Math.pow(10,Math.max(r,u)),(this.mul(n,i)+this.mul(t,i))/i},mul:function(n,t){var i=0,r=n.toString(),u=t.toString();try{i+=r.split(".")[1].length}catch(f){}try{i+=u.split(".")[1].length}catch(f){}return Number(r.replace(".",""))*Number(u.replace(".",""))/Math.pow(10,i)}},v={add:function(n){var t=Number(n.Quantity+1)||0;c(n,t)&&(n.Quantity=t,this.update());n.Quantity>0&&!n.enSub&&(n.enSub=!0)},sub:function(n){n.enSub&&(n.Quantity=Math.max(n.Quantity-1,0),n.Quantity===0&&(n.enSub=!1),this.update())},input:function(n){n.Quantity=Number(n.Quantity)||0;c(n,n.Quantity)||(n.Quantity=0);this.update()},toDetail:function(n){var u=e._children[0].status,t=n.PID.split("|"),r=!1,i;n.PID.indexOf("TR")==0&&(r=!0);i=f;switch(u){case"DNS":case"END":i=null}TuhuWebViewBridge.os==="Android"?TuhuWebViewBridge.toDetail({ProductID:t[0],VariantID:t[1],FunctionID:r?"cn.TuHu.Activity.TireInfoUI":"cn.TuHu.Activity.AutomotiveProducts.AutomotiveProductsDetialUI",activityId:i,flashSaleNum:n.Quantity},n.PID.indexOf("TR-")>=0?"Tire":"ChePing"):r?TuhuWebViewBridge.send("TNTireInfoVC",JSON.stringify({ProductID:t[0],VariantID:t[1],activityId:i}),null,1):TuhuWebViewBridge.send("TNGoodsListDetailViewController",JSON.stringify({productID:t[0],VariantID:t[1],activityId:i}),null,1)},update:function(){var n=0,t=0;[].concat(this.Products).filter(function(n){return n.Quantity>0}).forEach(function(i){n=a.add(n,a.mul(i.Quantity,i.Price));t+=i.Quantity});this.TotalPrice=n;this.TotalQuantity=t},submit:function(){var c=e._children[0].status,i,u,r;switch(c){case"DNS":n("活动还未开始");break;case"END":n("活动已结束");break;case"BEG":if(i=[].concat(this.Products).filter(function(n){return n.Quantity>0}),i.length===0){n("还未选择商品");return}var o=[],s=[],h=3;TuhuWebViewBridge.os==="IOS"?(u=0,i=i.map(function(n){return n.PID.indexOf("TR")==0||n.PID.indexOf("LG")==0?o.push(n.PID):s.push(n.PID),u+=n.Quantity*n.Price,{name:n.DisplayName,count:n.Quantity,price:n.Price.toFixed(2),productID:n.PID.split("|")[0],variantID:n.PID.split("|")[1],image:n.Image}}),r={"goods<THGoods>":i,totalPrice:u,orderType:h,orderAddressType:t.ShippType,couponType:8,activityId:f},console.log(r),TuhuWebViewBridge.send("THCreatOrderVC",JSON.stringify(r),null,1)):(i=i.map(function(n){return n.PID.indexOf("TR")==0||n.PID.indexOf("LG")==0?o.push(n.PID):s.push(n.PID),{orderTitle:n.DisplayName,orderNum:n.Quantity,orderPrice:n.Price.toFixed(2),ProductID:n.PID.split("|")[0],VariantID:n.PID.split("|")[1],produteImg:n.Image}}),r={activityId:f,OrderChannel:"1",CouponType:"8",orderType:h,carTypeSize:"",ChePingTyPe:"6",typeService:{Type:"",Name:"",Description:"",Count:""},quanType:"tire",Goods:i,Car:{VehicleID:"",VehicleName:"",Brand:"",Nian:"",PaiLiang:"",LiYangID:""}},TuhuWebViewBridge.send("toOrder",JSON.stringify(r)))}}},e=new Vue({el:s.body,data:{currentView:t.ShowType===2?"singleView":"listView",Products:t.Products,ShowCountDown:t.IsNoActiveTime,isEnd:+new Date(t.EndDateTime)<=+new Date(t.ServiceTime)},components:{countDown:{template:h,replace:!0,data:function(){function f(){var t=+new Date-s+o;t>r||r<=i?(u(0,n),n.status==="END"||(n.status="END",e&&(e.isEnd=!0)),n.showTime=!1,clearInterval(h)):t<i?(u(i-t,n),n.status==="DNS"||(n.status="DNS")):(u(r-t,n),n.status==="BEG"||(n.status="BEG"))}var o=+new Date(t.ServiceTime),s=+new Date,i=+new Date(t.StartTime),r=+new Date(t.EndDateTime),n={hour:0,minute:0,second:0,tips:{DNS:"活动开始倒计时",BEG:"距离本场结束还剩",END:"活动已结束"},status:"DNS",showTime:!0},h=setInterval(f,1e3);return f(),n}},listView:{template:"#tmpl_list",methods:v,data:function(){return t}},singleView:{template:"#tmpl_single",methods:v,data:function(){return t.Products=t.Products[0],t}}},compiled:function(){$(".spa-loader").hide()}})}var s=document,v=window,h='<div class="header" ><label class="txt" v-text="tips[status]">活动已结束<\/label>\t\t<b v-show="showTime"><span v-text="hour">10<\/span> : <span v-text="minute">13<\/span> : <span v-text="second">36<\/span><\/b><\/div>',r=function(){var n=window.location.search,t={};return n=n.substring(1,n.length),n.split("&").forEach(function(n){var i=n.split("=");i.length>0&&(t[i[0]]=i.length>1?i[1]:"")}),t}(),n=function(){var t=$("#tipsContent"),n=$("#popTips");return function(i){t.text(i);n.show();setTimeout(function(){n.hide()},3e3)}}(),t={},f,e,i,a;t.TopDomain=".tuhu.cn";/\.tuhu\.(\w+)$/.test(location.host)&&(t.TopDomain=".tuhu."+RegExp.$1);t.ApiSite="//api"+t.TopDomain;i={getProducts:function(){return $.ajax({type:"get",url:t.ApiSite+"/action/GetFlashSaleProduct",data:{actid:r.actid},dataType:"jsonp"}).then(function(t){if(t)return t.Products||(t.Products=[]),t.Products=t.Products.map(function(n){return n.surplusQuantity=n.TotalQuantity-n.SaleOutQuantity,n.Quantity=0,n.enSub=!1,n.enAdd=!0,n}),t.TotalPrice=0,t.TotalQuantity=0,t;n("活动不存在")},function(){n("加载出错")})},getBuyRecords:function(i,u){return $.ajax({type:"get",url:t.ApiSite+"/action/GetFlashSaleBuyRecord",data:{userID:i,phone:u,actid:r.actid},dataType:"jsonp"}).then(function(n){return n||[]},function(){n("加载出错")})}};TuhuWebViewBridge.login(function(n){function t(n){return n==="(null)"||n==="null"||!n}t(n.userid)||t(n.phone)?i.getProducts().then(function(n){o(n,[])}):(f=n.userid,e=n.phone,$.when(i.getProducts(),i.getBuyRecords(f,e)).then(function(n,t){o(n,t||[])}))});a=new Date}();
//# sourceMappingURL=index.min.js.map
