<!DOCTYPE html>
<html class="thxc">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>途虎5分洗车</title>
    <link rel="stylesheet" href="css/thxc.css" />

    <link rel="stylesheet" href="http://resource.tuhu.cn/CSS/toastr.css" />
    <script src="http://resource.tuhu.cn/Scripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="http://resource.tuhu.cn/Js/toastr.js" type="text/javascript"></script>
    <script src="http://resource.tuhu.cn/Js/WebViewJavascriptBridge.js"></script>
    <script type="text/javascript">
        /*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
        (function (factory) {
            if (typeof define === 'function' && define.amd) {
                // AMD
                define(['jquery'], factory);
            } else if (typeof exports === 'object') {
                // CommonJS
                factory(require('jquery'));
            } else {
                // Browser globals
                factory(jQuery);
            }
        }(function ($) {

            var pluses = /\+/g;

            function encode(s) {
                return config.raw ? s : encodeURIComponent(s);
            }

            function decode(s) {
                return config.raw ? s : decodeURIComponent(s);
            }

            function stringifyCookieValue(value) {
                return encode(config.json ? JSON.stringify(value) : String(value));
            }

            function parseCookieValue(s) {
                if (s.indexOf('"') === 0) {
                    // This is a quoted cookie as according to RFC2068, unescape...
                    s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
                }

                try {
                    // Replace server-side written pluses with spaces.
                    // If we can't decode the cookie, ignore it, it's unusable.
                    // If we can't parse the cookie, ignore it, it's unusable.
                    s = decodeURIComponent(s.replace(pluses, ' '));
                    return config.json ? JSON.parse(s) : s;
                } catch (e) { }
            }

            function read(s, converter) {
                var value = config.raw ? s : parseCookieValue(s);
                return $.isFunction(converter) ? converter(value) : value;
            }

            var config = $.cookie = function (key, value, options) {

                // Write

                if (value !== undefined && !$.isFunction(value)) {
                    options = $.extend({}, config.defaults, options);

                    if (typeof options.expires === 'number') {
                        var days = options.expires, t = options.expires = new Date();
                        t.setTime(+t + days * 864e+5);
                    }

                    return (document.cookie = [
                        encode(key), '=', stringifyCookieValue(value),
                        options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
                        options.path ? '; path=' + options.path : '',
                        options.domain ? '; domain=' + options.domain : '',
                        options.secure ? '; secure' : ''
                    ].join(''));
                }

                // Read

                var result = key ? undefined : {};

                // To prevent the for loop in the first place assign an empty array
                // in case there are no cookies at all. Also prevents odd result when
                // calling $.cookie().
                var cookies = document.cookie ? document.cookie.split('; ') : [];

                for (var i = 0, l = cookies.length; i < l; i++) {
                    var parts = cookies[i].split('=');
                    var name = decode(parts.shift());
                    var cookie = parts.join('=');

                    if (key && key === name) {
                        // If second argument (value) is a function it's a converter...
                        result = read(cookie, value);
                        break;
                    }

                    // Prevent storing a cookie that we couldn't decode.
                    if (!key && (cookie = read(cookie)) !== undefined) {
                        result[name] = cookie;
                    }
                }

                return result;
            };

            config.defaults = {};

            $.removeCookie = function (key, options) {
                if ($.cookie(key) === undefined) {
                    return false;
                }

                // Must not alter options, thus extending a fresh object...
                $.cookie(key, '', $.extend({}, options, { expires: -1 }));
                return !$.cookie(key);
            };

        }));

        var domain = 'http://faxian.tuhu.cn';
        if (new Date() > new Date("2115-6-3")) {  // *
            window.location.href = "http://resource.tuhu.cn/sp/ActiveNinety.html";
        } else {
            var userAgentInfo = navigator.userAgent;
            var Agents = new Array("iPhone", "iPad", "iPod");
            var flag = true;
            for (var v = 0; v < Agents.length; v++) {
                if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
            }
            function connectWebViewJavascriptBridge(callback) {
                if (window.WebViewJavascriptBridge) {
                    callback(WebViewJavascriptBridge)
                } else {
                    document.addEventListener(
                        'WebViewJavascriptBridgeReady'
                        , function () {
                            callback(WebViewJavascriptBridge)
                        },
                        false
                    );
                }
            }
            connectWebViewJavascriptBridge(function (bridge) {
                bridge.init(function (message, responseCallback) {
                    var data = {
                        'Javascript Responds': 'Wee!'
                    };
                    responseCallback(data);
                });
                bridge.registerHandler("functionInJs", function (data, responseCallback) {
                    var responseData = "Javascript Says Right back aka!";
                    responseCallback(responseData);
                });
            })

            function sendCommand(cmd, param) {
                var url = "#testapp#" + cmd + "#" + param;
                document.location = url;
            }
            function processclick(da) {
                $.cookie('cent5_' + da.phone, 'ok');                               // *
                var hdurl = 'http://faxian.tuhu.cn/lottery/gmhca.html?phone=' + da.phone;  // *
                $.ajax({
                    type: "get",
                    url: 'http://wx.tuhu.cn/ZeroActive/IsHasPromotion?Mobile=' + da.phone,
                    async: false,
                    success: function (data) {
                        if (data.IsHasPromotion) {
                            location.href = 'http://faxian.tuhu.cn/ActivityHtml/Channels/gm/success.html';
                        }
                        $.ajax({ url: hdurl }).done(function (data) {
                            var usuccess = domain + '/ActivityHtml/Channels/gm/success.html';  // *
                            location.href = usuccess;
                        });
                    }
                });

            }
            window.debug = false;
            function getPromotion(skipclick) {
                if (window.debug) {
                    processclick({ phone: '13774352220' });
                    return;
                }
                if (userAgentInfo.indexOf("Android") >= 0) {
                    window.WebViewJavascriptBridge.callHandler(
                        'actityBridge'
                        , { 'param': "" }
                        , function (responseData) {
                            if (responseData != null) {
                                var da = JSON.parse(responseData);
                                if (!skipclick) {
                                    processclick(da);
                                } else {
                                    var c = $.cookie('cent5_' + da.phone);  // *
                                    if (c == 'ok') {
                                        var uu = domain + '/ActivityHtml/Channels/gm/success.html'; // *
                                        location.href = uu;
                                    }
                                }
                            }
                        });
                } else {
                    //sendCommand("actityBridge", "TNCouponAndMessageVC");
                }
            }
            getPromotion(true);
            $(function () {
                $('#bstart').click(function () {
                    getPromotion();
                });
            });
        }
    </script>

</head>
<body >
	<div id="bstart" class="ljlq">立即领取</div>
</body>
</html> 