@{
    ViewBag.Title = "HFive";
    Layout = "~/Views/Shared/_Form.cshtml";
}
@model Tuhu.Provisioning.DataAccess.Entity.Router.RouterLink


<div style="font-size: 13px">
    <div class="container" id="container" style="margin-top: 50px; min-height: 280px; overflow-y: auto; width: 800px;">
    @if (ViewBag.linkKind == 1)
    {
        <div class="form-group">
            <label class="col-sm-2 control-label">车型要求:</label>
            <div class="col-sm-3">
                <select id="tireType" name="tireType" class="form-control">
                    <option value="">无</option>
                    <option value="requireCarLevel2=1">二级车型</option>
                    <option value="requireCarLevel4=1">4级车型</option>
                    <option value="requireCarLevel5=1">5级车型</option>
                </select>
            </div>
        </div>
        <br/>
        <br/>
        <div class="form-group">
            <label class="col-sm-2 control-label">URL：</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="appurl" value="@ViewBag.url"/>
            </div>
        </div>
        <br/>
        <br/>
        <div class="form-group">
            <label class="col-sm-2 control-label">页面标题:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="title" value="@ViewBag.Pagetitle"/>
            </div>
        </div>
    }
    @if (ViewBag.linkKind == 2)
    {
        <div class="form-group">
            <label class="col-sm-2 control-label">活动页Hash值:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="hash" value="@ViewBag.hash" />
            </div>
        </div>
    }
        <br />
        <br />
        <div class="form-group">

            @if (Model != null)
            {
                foreach (var item in Model.RouterParameterList)
                {
                    if (item.Kind == 1)
                    {
                        <div class="col-sm-3">
                            <input type="radio" class="check" value="@item.Content" style="font-size: 100px" @(item.State == 1 ? "checked=\"checked\"" : "") /><span>@item.Discription</span>
                        </div>
                    }
                    else if (item.Kind == 2)
                    {
                        <div class="col-sm-4">
                            <label>@item.Discription</label>
                        </div>
                        <div class="col-sm-9">
                            <input type="text" name="text" class="text" id="text" value="@item.Url" />
                        </div>
                    }
                }

                <div class="col-sm-4">
                    <input type="hidden" class="form-control" id="MainLinkContent" name="MainLinkContent" value="@Model.MainLink.Content" />
                </div>
                <div class="col-sm-4">
                    <input type="hidden" class="form-control" id="para" name="para" value="@ViewBag.paraArray" />
                </div>
                <div class="col-sm-12">
                    <input type="hidden" class="form-control" id="linkId" name="linkId" value="@ViewBag.linkId" />
                </div>
                <div class="col-sm-12">
                    <input type="hidden" class="form-control" id="noLinkId" name="noLinkId" value="@ViewBag.noLinkId" />
                </div>
                <div class="col-sm-12">
                    <input type="hidden" class="form-control" id="linkKind" name="linkKind" value="@ViewBag.linkKind" />
                </div>
            }
        </div>
    </div>
    <div class="form-group">
        <div class="modal-footer" style="text-align: center;">
            <button type="button" class="btn btn-default btn-sm" style="width: 160px;" id="btnSave" name="btnSave">生成</button>
        </div>
    </div>
</div>

<link rel="stylesheet" href="~/Scripts/multiple/multiple-select.css" type="text/css"/>
<script type="text/javascript" src="~/Scripts/multiple/multiple-select.js"></script>
<script type="text/javascript">


    $(function() {

        //保存按钮点击事件
        $('#btnSave').on('click',
            function() {
                var mainLinkContent = $('#MainLinkContent').val();
                var appurl = $('#appurl').val();
                var title = $('#title').val();
                var linkKind = $('#linkKind').val();
                var hash = $('#hash').val();
                if (appurl === "") {

                    parent.layer.msg('请填写URL', { shade: 0.3 });
                    return;
                }


                var check = "";
                var tireType = $('#tireType').val();
                if ($('#tireType').val() !== "")
                    tireType = "&" + encodeURIComponent(tireType);
                $("input[class^='check']").each(function() { //遍历每一个名以check开头的input.

                    if ($(this).prop("checked")) {
                        check += "&" + (encodeURIComponent($(this).val()));
                    }
                });
                var url="";
                switch (linkKind) {
                    case "1": //APP
                    url = mainLinkContent +
                    "?url=" +
                    encodeURIComponent(appurl) +
                    (title !== "" ? ("&title=" + encodeURIComponent(title)) : "") +
                    check +
                            tireType;
                    break;
                    case "2":
                        url = mainLinkContent +
                            "?id=" +hash;
                        break;
                        }
                var linkId = $('#linkId').val();
                var noLinkId = $('#noLinkId').val();
                if (linkId !== "" && noLinkId !== "") {


                    $("#Link").val(url);
                    parent.$("#" + linkId).val(url);
                    parent.$("#" + noLinkId).val(decodeURIComponent(url));

                    //关闭窗口
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                }

            });
        //设置radio可以取消
        $(":radio").click(
            function() {
                var nm = $(this).attr("name");
                $(":radio[name=" + nm + "]:not(:checked)").attr("tag", 0);
                if ($(this).attr("tag") == 1) {
                    $(this).attr("checked", false);
                    $(this).attr("tag", 0);
                } else {
                    $(this).attr("tag", 1);
                }
            }
        );

    });

    //预置车型选择
    function initTireType() {
        var require = $("#para").val();

        if ("" !== require) {
            // alert(require);
            var paraArray = require.split('&');

            var select = document.getElementById("tireType");
            for (var i = 0; i < select.length; i++) {
                for (var j = 0; j < paraArray.length; j++) {
                    if (select.options[i].value === paraArray[j]) {
                        select.options[i].setAttribute("selected", true);

                    }
                }

            }


        }
    }

    initTireType();

</script>