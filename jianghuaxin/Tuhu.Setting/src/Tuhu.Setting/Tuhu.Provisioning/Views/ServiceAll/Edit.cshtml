@{
    ViewBag.Title = "瀑布流配置";
    Layout = null;
}
@model Tuhu.Provisioning.DataAccess.Entity.SE_HomePageFlowConfig

<div class="modal-dialog">
    <div class="modal-content" style="width:800px;">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                &times;
            </button>
            <h4 class="modal-title">
                编辑瀑布流配置
            </h4>
        </div>
        <div class="modal-body">
            <form id="form1" class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-2 form-label">名称：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" id="Title" name="Title" value="@Model.Title" />
                    </div>
                    <label class="col-sm-2">渠道:</label>
                    <div class="col-sm-4">
                        <select id="Channel" name="Channel">
                            <option value="0" @(Model.Channel == 0 ? "selected=\"selected\"" : "")>全部</option>
                            <option value="1" @(Model.Channel == 1 ? "selected=\"selected\"" : "")>Android</option>
                            <option value="2" @(Model.Channel == 2 ? "selected=\"selected\"" : "")>IOS</option>
                            <option value="3" @(Model.Channel == 3 ? "selected=\"selected\"" : "")>移动站</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">开始版本：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" id="StartVersion" name="StartVersion" value="@Model.StartVersion" />
                    </div>
                    <label class="col-sm-2 control-label">结束版本：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" id="EndVersion" name="EndVersion" value="@Model.EndVersion" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">链接:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="LinkUrl" name="LinkUrl" value="@Model.LinkUrl" />
                    </div>

                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">没有编码链接:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="NoLinkUrl" name="NoLinkUrl" value="@(Model.LinkUrl)" readonly="readonly" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">背景图片:</label>
                    <div class="col-sm-4">
                        <img width="30" id="imgBgImageUrl" height="30" @(string.IsNullOrWhiteSpace(Model.BgImageUrl) == false ? "src=" + Model.BgImageUrl : "") style="display:inline;" />
                        <input type="file" id="uploadBgImageUrl" name="uploadBgImageUrl" onchange="UploadBgImg(this, 'imgBgImageUrl', 'BgImageUrl')" style="display:inline;width:100px;" />
                        @*<input type="hidden" id="BgImageUrl" name="BgImageUrl" value="@Model.BgImageUrl" />*@
                    </div>
                    <label class="col-sm-2 control-label">背景图片Url:</label>
                    <div class="col-sm-4">
                        <input type="text" id="BgImageUrl" name="BgImageUrl" value="@Model.BgImageUrl" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">统计：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" id="UriCount" name="UriCount" value="@Model.UriCount" />
                    </div>
                    <label class="col-sm-2 control-label">状态:</label>
                    <div class="col-sm-4">
                        <input type="radio" name="IsEnabled" value="true" @(Model.IsEnabled == true ? "checked=\"checked\"" : "") /><span>启用</span>
                        <input type="radio" name="IsEnabled" value="false" @(Model.IsEnabled == false ? "checked=\"checked\"" : "") /><span>禁用</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">优先级:</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" id="PriorityLevel" name="PriorityLevel" value="@Model.PriorityLevel" />
                    </div>
                </div>
                <input type="hidden" id="ID" name="ID" value="@Model.ID" />
                <input type="hidden" id="Type" name="Type" value="@Model.Type" />
            </form>
        </div>
        <div class="modal-footer">
            <a href="javascript:void(0)" class="btn btn-danger btn-sm " id="btnToobal" onclick="Toolbar()" style="width: 80px;" data-toggle="modal" data-target="#toobal">小工具</a>
            <button type="button" id="btnSave" name="btnSave" class="btn btn-primary">

                保 存
            </button>
            <button type="button" class="btn btn-default" data-dismiss="modal">
                取 消
            </button>
        </div>
    </div>
</div>
<script type="text/javascript">


    $(function () {
        $('#Title').on('change', function () {
            $("#UriCount").val("waterfall_" + $('#PriorityLevel').val() + "_" + $(this).val());
        });
        $('#PriorityLevel').on('change', function () {
            $("#UriCount").val("waterfall_" + $(this).val() + "_" + $('#Title').val());
        });

        $('#btnSave').on('click', function () {
            var data = {};
            data.ID = $('#ID').val();
            data.Title = $('#Title').val();
            data.Channel = $('#Channel').val();
            data.StartVersion = $('#StartVersion').val();
            data.EndVersion = $('#EndVersion').val();
            data.LinkUrl = $('#LinkUrl').val();
            data.UriCount = $('#UriCount').val();
            data.IsEnabled = $('input[name="IsEnabled"]:checked').val();
            //data.IsCountDown = $('input[name="IsCountDown"]:checked').val();
            //data.IsChildProduct = $('input[name="IsChildProduct"]:checked').val();
            //data.StartDateTime = $('#StartDateTime').val();
            //data.EndDateTime = $('#EndDateTime').val();
            data.BgImageUrl = $('#BgImageUrl').val();
            data.PriorityLevel = $('#PriorityLevel').val();
            data.ParentPKID =@(ViewBag.ParentPKID);
            data.Type = $('#Type').val();
            if (!data.BgImageUrl) {
                alert("请上传背景图片");
                return;
            }

            $(this).attr("disabled", "disabled");
            $.ajax({
                url: '/HomePageConfigV2/FlowSave',
                type: 'post',
                data: data,
                dataType:'json'
            }).done(function (result) {
                if (result == 1) {
                    alert('保存成功');
                    $('#edit').modal("hide");
                    location.reload();
                } else {
                    alert("保存失败");
                }
            });
        });

        if ($('#NoLinkUrl').val()) {
            $('#NoLinkUrl').val(decodeURIComponent($('#NoLinkUrl').val()));
        }
    });
</script>
