function ToIosFor3M(n,t){location.href="#testapp#"+n+"#"+encodeURIComponent(t)}function SubmitOrderFor3MToApp(n,t,i,r,u,f){var o,e;userAgentInfo.indexOf("Android")>=0?(o={FunctionID:"cn.TuHu.Activity.OrderSubmit.PayOrderConfirm",SerialNumbers:n,PayAmount:t,subject:i,body:r},window.WebViewJavascriptBridge.callHandler("toActityBridge",{FunctionID:"cn.TuHu.Activity.OrderSubmit.PayOrderConfirm",SerialNumbers:n,PayAmount:t,subject:i,body:r,OrderNO:f},function(){})):(e={casgiersData:u,orderID:f},ToIosFor3M("customSegue#THOrderCashiersVC",JSON.stringify(e)))}function SubmitOrderFor3M(){var f,t,i,n,r,e,u;if(!$(".userinfo .username").val())return $(".userinfo .username").css("border","2px solid red"),allowSubmit=!0,!1;if(!$(".userinfo .tel").val()||(f=/^1\d{10}$/,!f.test($(".userinfo .tel").val())))return $(".userinfo .tel").css("border","2px solid red"),allowSubmit=!0,!1;t=[];for(i in Selected3MPackage.Items)n={ProductId:"",VariantId:"",Quantity:""},Selected3MPackage.Items[i].CatalogName=="\u673a\u6cb9\u6ee4\u6e05\u5668"&&(n.ProductId=Selected3MPackage.Items[i].ProductPid.split("|")[0],n.VariantId=Selected3MPackage.Items[i].ProductPid.split("|")[1],n.Quantity=Selected3MPackage.Items[i].Quantity,t.push(n));console.log(JSON.stringify(t));for(i in Selected3MPackage.InstallServiceses)n={ProductId:"",VariantId:"",Quantity:""},n.ProductId=Selected3MPackage.InstallServiceses[i].PID.split("|")[0],n.VariantId=Selected3MPackage.InstallServiceses[i].PID.split("|")[1],n.Quantity=1,t.push(n);console.log(JSON.stringify(t));r={ProductId:"",VariantId:"",Quantity:""};r.ProductId=Selected3MPackage.PackagePid.split("|")[0];r.VariantId=Selected3MPackage.PackagePid.split("|")[1];r.Quantity=1;t.push(r);console.log(JSON.stringify(t));e=JSON.parse(GetCookie("SelectedCarDataFor3M"));u={BookType:1,Name:$(".userinfo .username").val(),Cellphone:$(".userinfo .tel").val(),UserId:UserloginObject3M.UserId,ShopId:parseInt(GetQueryString("id")),PayMothed:1,OrderChannel:"kH5",ShippingMoney:FeightFor3MPrice,BookDatetime:$("#carUseTime").val(),PromotionCode:CouponsId,OrderList:t,DefaultCar:e};console.log(JSON.stringify(u));$.ajax({method:"POST",url:apiDomain+"/Order/CreateOrder",data:{jsonStr:JSON.stringify(u)},dataType:"json"}).done(function(n){var t,i;allowSubmit=!1;console.log(JSON.stringify(n));var r=n.PayInfo.SerialNumbers,u=n.PayInfo.Price,f=n.PayInfo.Title,e=n.PayInfo.Body,o=n.PayInfo.OrderNO;for(t=0;t<n.Cashier.length;t++)n.Cashier[t].Payment_way_name!="\u652f\u4ed8\u5b9d"&&n.Cashier[t].Payment_way_name!="\u5fae\u4fe1"&&delete n.Cashier[t];i=n;SubmitOrderFor3MToApp(r,u,f,e,i,o)}).fail(function(){})}function GetFeightFor3M(){var t=[],r=-1,i,n;for(i in Selected3MPackage.Items)n={ProductID:"",ProductNumber:""},n.ProductID=Selected3MPackage.Items[i].ProductPid,n.ProductNumber=Selected3MPackage.Items[i].Quantity,r++,t[r]=n;console.log(JSON.stringify(t));$.ajax({method:"GET",url:"http://wx.tuhu.cn/Order/GetFeightFor3M",data:{products:JSON.stringify(t),Province:UserloginObject3M.Province,City:UserloginObject3M.City,OrderType:"BaoYang",isInstall:"true",callBack:"0"},dataType:"jsonp"}).done(function(n){var t,i;if(console.log(n),n.Code=="1"){FeightFor3MPrice=n.DeliveryFee;$(".payinfo p").eq(2).find(".price").html("\u00a5"+FeightFor3MPrice);t={};t[Selected3MPackage.PackagePid]=1;for(i in Selected3MPackage.InstallServiceses)t[Selected3MPackage.InstallServiceses[i].PID]=1;GetCouponsListFor3M(JSON.stringify(t),UserloginObject3M.UserId)}}).fail(function(){})}function GetCouponsListFor3M(n,t){$.ajax({method:"POST",url:"http://api.tuhu.cn/User/SelectPromotion",async:!1,data:{Products:n,UserID:t,ActivityId:"",OrderType:"BaoYang"},dataType:"jsonp"}).done(function(n){var r=JSON.parse(JSON.stringify(n)),t,i;console.log(JSON.stringify(n));r.Code=="1"&&r.PromotionCodeList.length>0?(t=r.PromotionCodeList,t.length>0?(i="",$(t).each(function(n){i+=' <li class="" yh="1" pkid="'+t[n].PKID+'" price="'+t[n].Discount+'"><span class="red">\u00a5'+t[n].Discount+"<\/span>\u517b\u8f66\u4f18\u60e0\u5238 <\/li>"}),i+=' <li yh="0" pkid="" price="0" class="">\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238<\/li>',$(".coupons .ul_list").append(i),$(".coupons .ul_list li").click(function(n){$(this).attr("yh")=="0"?$(".coupons .title").find(".choose").html("\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238").removeClass("active"):$(".coupons .title").find(".choose").html("\u00a5"+$(this).attr("price")).removeClass("active");$(".coupons .ul_list li").not(n).removeClass("selected");$(this).toggleClass("selected");$(".coupons").attr("pkid",$(this).attr("pkid"));$(".coupons").attr("price",$(this).attr("price"));$(".coupons .ul_list").toggle();$(".payinfo p").eq(3).find(".price").html("-\u00a5"+$(this).attr("price"));CostingFor3M();n.stopPropagation()}),$(".coupons").show()):$(".coupons").hide()):$(".coupons").hide();CostingFor3M()}).fail(function(){})}function CostingFor3M(){var n=$(".coupons").attr("price"),t;CouponsId=$(".coupons").attr("pkid");n<=0||n==undefined||n=="undefined"?$(".submitorder .price").html(Selected3MPackage.Price+parseFloat(GetQueryString("price"))+FeightFor3MPrice):(t=Selected3MPackage.Price-n,$(".submitorder .price").html(t+parseFloat(GetQueryString("price"))+FeightFor3MPrice))}function connectWebViewJavascriptBridge(n){window.WebViewJavascriptBridge?n(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){n(WebViewJavascriptBridge)},!1)}function GetQueryString(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t!=null?decodeURIComponent(t[2]):null}function SetCookie(n,t){var i=new Date;i.setTime(i.getTime()+6048e5);document.cookie=n+"="+escape(t)+";path=/;expires="+i.toGMTString()}function GetCookie(n){var t=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}var FeightFor3MPrice,apiDomain,CouponsId,userAgentInfo;$(function(){var e=(new Date).getFullYear(),n={},i=new Date,o=new Date(i.setDate(i.getDate()+2)),u,f,r,t;n.date={preset:"date"};n.datetime={preset:"datetime"};n.time={preset:"time"};n.default={preset:"date",theme:"android-ics light",display:"modal",mode:"scroller",dateFormat:"yy-mm-dd",setText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",dateOrder:"yymmdd",dayText:"\u65e5",monthText:"\u6708",yearText:"\u5e74",startYear:e,endYear:2050,minDate:o};$("#carUseTime").mobiscroll($.extend(n.date,n["default"]));UserloginObject3M=JSON.parse(GetCookie("UserloginObject3M"));$(".userinfo .tel").val(UserloginObject3M.Phone);u=new Date(i.setDate(i.getDate()));$("#carUseTime").val(u.FormatDate("yyyy-MM-dd"));f=GetQueryString("name")+"<i>"+GetQueryString("km")+"<\/i>";$(".md .choose").html(f);$(".products .title").on("click",function(){$(this).toggleClass("selected");$(this).siblings(".ul_list").toggle()});$(".payway .title").on("click",function(){});$(".coupons .title").on("click",function(){$(this).toggleClass("selected");$(this).siblings(".ul_list").toggle()});Selected3MPackage=JSON.parse(window.name);console.log(JSON.stringify(Selected3MPackage));$(".products .title .choose #products").html(Selected3MPackage.Items.length);$(".products .title .choose #services").html(Selected3MPackage.InstallServiceses.length);r="";for(t in Selected3MPackage.Items)r+='  <li><div class="type">'+Selected3MPackage.Items[t].CatalogName+'<\/div><div class="name"><p>'+Selected3MPackage.Items[t].DisplayName+"<\/p><\/div><\/li>";for(t in Selected3MPackage.InstallServiceses)r+='  <li> <div class="type">\u670d\u52a1<\/div><div class="name"> '+Selected3MPackage.InstallServiceses[t].DisplayName+" <\/div><\/li>";$(".products .ul_list").html(r);$(".payinfo p").eq(0).find(".price").html("\u00a5"+Selected3MPackage.Price);$(".payinfo p").eq(1).find(".price").html("\u00a5"+GetQueryString("price"));GetFeightFor3M();$(".submitorder .subbtn").on("click",function(){allowSubmit&&(allowSubmit=!1,SubmitOrderFor3M())})});var allowSubmit=!0,UserloginObject3M="",Selected3MPackage="";FeightFor3MPrice=0;apiDomain="http://api.tuhu.cn";CouponsId="";userAgentInfo=navigator.userAgent;connectWebViewJavascriptBridge(function(n){n.init(function(n,t){t({"Javascript Responds":"Wee!"})});n.registerHandler("functionInJs",function(n,t){t("Javascript Says Right back aka!")})});Date.prototype.FormatDate=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};