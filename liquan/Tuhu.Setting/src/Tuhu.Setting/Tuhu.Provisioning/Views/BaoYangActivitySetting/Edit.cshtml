@model Tuhu.Provisioning.DataAccess.Entity.BaoYangActivitySetting
@{
    Layout = null;
}

<style>
    .btn {
        margin-top: 20px;
        padding: 5px 25px;
        border: none;
        color: #F0F0F0;
        font-size: 12px;
        outline: none;
        cursor: pointer;
        background: cornflowerblue;
        border-color: cornflowerblue;
    }

    a {
        color: cornflowerblue;
    }
</style>
<script src="../../Scripts/ajaxfileupload.js" type="text/javascript"></script>

@using (Html.BeginForm(new { @enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    @Html.HiddenFor(m => m.Id)
    @Html.HiddenFor(m => m.RelevanceServicesCatalogs)
    @Html.HiddenFor(m => m.StoreAuthentication)
    @Html.HiddenFor(model => model.RelevanceServicesTypes)
    @Html.HiddenFor(model => model.ActivityNum)
    @Html.HiddenFor(model => model.CouponId)
    <div>
        <table style="width:100%">
            <tbody>

                <tr>
                    <td>活动名称</td>
                    <td>@Html.TextBoxFor(model => model.ActivityName)</td>
                </tr>
                <tr>
                    <td>活动状态</td>
                    <td>
                        @Html.RadioButtonFor(m => m.ActivityStatus, true) 启用
                        @Html.RadioButtonFor(m => m.ActivityStatus, false) 禁用
                    </td>

                </tr>
               
                <tr>
                    <td>主入口浮层状态</td>
                    <td>
                        @Html.RadioButtonFor(m => m.LayerStatus, true) 启用
                        @Html.RadioButtonFor(m => m.LayerStatus, false) 禁用
                    </td>
                </tr>
                <tr>
                    <td>浮层图片</td>
                    <td>
                        <img height="40" class="vwPicture" src="@Model.LayerImage" />                       
                        <form method="post" action="" enctype="multipart/form-data">
                            <input style="width:150px;" type="file" onchange="Edit.UploadImg(this)" id="2" name="2" />
                        </form>
                        <input type="text" name="LayerImage" class="image" value="@Model.LayerImage" />
                    </td>
                </tr>
                <tr>
                    <td>新浮层图片</td>
                    <td>
                        <img height="40" class="vwPicture" src="@Model.LayerImage2" />
                        <form method="post" action="" enctype="multipart/form-data">
                            <input style="width:150px;" type="file" onchange="Edit.UploadImg(this)" id="2_1" name="2_1" />
                        </form>
                        <input type="text" name="LayerImage2" class="image" value="@Model.LayerImage2" /><label style="margin-left:10px;">524*692</label>
                    </td>
                </tr>
                <tr>
                    <td>活动图标状态</td>
                    <td>
                        @Html.RadioButtonFor(m => m.CheckStatus, true) 启用
                        @Html.RadioButtonFor(m => m.CheckStatus, false) 禁用
                    </td>
                </tr>
                <tr>
                    <td>活动图标</td>
                    <td>
                        <img height="40" class="vwPicture" src="@Model.ActivityImage" />
                        <input type="hidden" name="ActivityImage" class="image" value="@Model.ActivityImage" />
                        <form method="post" action="" enctype="multipart/form-data">
                            <input style="width:150px;" type="file" onchange="Edit.UploadImg(this)" id="02" name="02" />
                        </form>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">优惠券GUID</td>
                    <td>
                        @Html.TextBoxFor(model => model.GetRuleGUID)
                        <p id="couponname"></p>
                    </td>
                </tr>
                <tr>
                    <td>按钮文字</td>
                    <td>@Html.TextBoxFor(model => model.ButtonChar)</td>
                </tr>
                <tr>
                    <td>
                        <a href="javascript:;">门店认证</a>
                    </td>
                    <td>
                        @Html.TextAreaFor(model => model.StoreAuthenticationName, new { @style = "width:300px", @readonly = "readonly" })
                        <a href="javascript:;" onclick="Edit.AddStoreAuthentication()" style="color: cornflowerblue;">选择</a>
                    </td>
                </tr>
            
                <tr>
                    <td></td>
                    <td>
                        <input class="btn" type="submit" value="保存" />
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
}


<div id="AddStoreAuthentication"></div>
<script>
    var types = $("#RelevanceServicesTypes").val() || "";
    var typesArry = new Array();
    typesArry = types.split(";");
    $(function () {
        $(".servicetype :checkbox").each(function (i) {
            if (typesArry.indexOf($(this).attr("key")) >= 0) {
                $(this).attr("checked", "checked");
            }
        });
        $.ajax({
            type: "GET",
            url: "/BaoYangActivitySetting/BaoYangTypeConfig",
            data: {
            },
            dataType: "JSON",
            success: function (result) {
                var names = "";
                for (var item in result) {
                    for (var types in typesArry) {
                        if (typesArry[types] == result[item].ServiceType) {
                            names += result[item].ServiceTypeName + ";"
                            $("#RelevanceServicesNames").val(names.substr(0, names.length - 1));
                        }
                    }
                }
            }
        })
    });

    $("#GetRuleGUID").blur(function () {
        $.ajax({
            type: "POST",
            url: "/ActivityV1/CouponVlidate",
            data: {
                "couponRulePKID": $("#GetRuleGUID").val()
            },
            dataType: "JSON",
            success: function (result) {
                var data = result.Name + "；" + result.Description
                $("#couponname").html(data);
                $("#GetRuleGUID").val(result.GetRuleGUID);
                $("#CouponId").val(result.PKID);
            },
            error: function (result) {

            }
        });
    })

    var Edit = {
          "AddStoreAuthentication": function () {
            $("#AddStoreAuthentication").load('/BaoYangActivitySetting/ShopAuthentication');
            $("#AddStoreAuthentication").dialog({
                title: "添加门店认证",
                width: 450,
                height: 680,
                modal: true
            });
        },

        "AddServiceType": function () {
            $("#AddServiceType").load('/BaoYangActivitySetting/ServiceType');
            $("#AddServiceType").dialog({
                title: "添加服务类型",
                width: 450,
                height: 680,
                modal: true
            });
        },
        "AddBand": function () {
            $("#AddBand").load('/BaoYangActivitySetting/Brand?catalogNames=' + $("#RelevanceServicesCatalogs").val());
            $("#AddBand").dialog({
                title: "根据服务类型关联品牌",
                width: 450,
                height: 680,
                modal: true
            });
        },
        "AddSerie": function () {
            $("#AddSerie").load('/BaoYangActivitySetting/Serie?brands=' + $("#RelevanceBrands").val());
            $("#AddSerie").dialog({
                title: "根据品牌添加系列",
                width: 450,
                height: 680,
                modal: true
            });
        },

        "UploadImg": function (e) {
            var $e = $(e);
            var $ee = $e.parents("tr").find("td").eq(1).find("img");
            var $smallImage = $e.parents("tr").find("td").eq(1).find("input[class='smallImage']");
            var $image = $e.parents("tr").find("td").eq(1).find("input[class='image']");
            $.ajaxFileUpload({
                url: '/Article/AddArticleImg2',
                secureuri: false,
                fileElementId: $e.attr("id"),
                dataType: 'json',
                data: {},
                type: "post",
                success: function (result) {
                    if (result.BImage != "" && result.SImage != "") {
                        $ee.attr("src", result.SImage);
                        $(".vwPicture").show();
                        $smallImage.val(result.SImage);
                        $image.val(result.BImage);
                    } else {
                        alert("上传失败！");
                    }
                }
            });
        }
    }

</script>