@using Tuhu.Provisioning.Business.Push
@using Tuhu.Service.Push.Models.Push

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@functions {

    List<SelectListItem> converttoselect<T>(string value)
    {
        var list = new List<SelectListItem>();
        list.Add(new SelectListItem()
        {
            Text = "All",
            Value = "",
            Selected = value == ""
        });
        list.AddRange(Enum.GetValues(typeof(T)).Cast<T>().Select(v => new SelectListItem
        {
            Text = typeof(T) == typeof(PushStatus) ? PushManagerNew.GetPushStatusName((PushStatus)Enum.Parse(typeof(PushStatus), v.ToString())) : v.ToString(),
            Value = Convert.ToInt32(v).ToString(),
            Selected = v.ToString() == value
        }));
        return list;
    }

}
@section head{
    <link href="~/Content/nfine/js/bootstrap/bootstrap.min.css" rel="stylesheet" />
}
<div class="content" id="SinglePush">
    <div class="form-inline">
        <div class="form-group form-group-sm">
            <label>计划ID</label>
            <input class="form-control" name="BatchID" type="text" v-model="BatchID" />
        </div>
        <div class="form-group form-group-sm">
            <label>计划名称</label> <input class="form-control" name="PlanName" v-model="PlanName" type="text" />
        </div>
        <div class="form-group form-group-sm">
            <label>计划状态</label>
            <select class="form-control" v-model="IsEnable">
                <option value="">All</option>
                <option value="1">启用</option>
                <option value="0">禁用</option>
            </select>
        </div>
        <div class="form-group form-group-sm">
            <label>沟通渠道</label>
            <select class="form-control" v-model="DeviceType">
                <option value="">All</option>
                <option value="1">iOS</option>
                <option value="2">Android</option>
                <option value="3">MessageBox</option>
                <option value="4">WeChat</option>
                <option value="6">WeiXinApp</option>
            </select>

        </div>
        <div class="form-group form-group-sm">
            <label>创建人</label> <input class="form-control" name="CreateUser" v-model="CreateUser" type="text" />
        </div>
        <div class="form-group form-group-sm">
            <label>创建时间</label> <input class="form-control" name="CreateStartTime" id="CreateStartTime" v-model="CreateStartTime" type="text" />
            <label>-</label> <input class="form-control" name="CreateEndTime" id="CreateEndTime" v-model="CreateEndTime" type="text" />
        </div>
        <div class="form-group form-group-sm">
            <input id="submit" class="btn btn-primary btn-small" type="button" v-on:click="DoSearch" :disabled="status.loading" value="搜索" />
        </div>
        <p></p>
    </div>
    <div>

        <a href="@Url.Action("EditSinglePushTemplate")" class="btn btn-primary btn-small">创建</a>
        <p></p>
    </div>
    <div>
        <table class="table" style="width: 100%">
            <tr>
                <th>ID</th>
                <th>计划名称</th>
                <th>模版标题</th>
                <th>计划状态</th> 
                <th>沟通类型</th>
                <th>创建人</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
            <tr v-for="template in Templates">
                <td>{{template.BatchID}}</td>
                <td>{{template.PlanName}}</td>
                <td>{{template.Title}}</td>
                <td>{{template.IsEnable?"启用":"禁用"}}</td>
                <td>{{template.DeviceType}}</td>
                <td>{{template.CreateUser}}</td>
                <td>{{template.CreateTime}}</td>
                <td>
                    <a href="/PushManager/EditSinglePushTemplate?batchid={{template.BatchID}}">编辑</a>
                    <a href="/PushManager/ShowTemplateLog?templateid={{template.PKID}}">查看操作日志</a>
                </td>
            </tr>
        </table>
        <div class="row">
            <div class="col-md-12">
                <nav aria-label="...">
                    <ul class="pager">
                        <li v-bind:class="{ disabled: Pager.PageIndex<=1 }"><a href="javascript:void(0)" v-on:click="PreviousPage">Previous</a></li>
                        <li class="active">
                            <input type="number" style="width:60px" v-model="JumpPageIndex" />
                        </li>
                        <li class="active"><a :disabled="status.loading" href="javascript:void(0)" v-on:click="PageJump">跳转</a></li>

                        <li v-bind:class="{ disabled: Pager.CurrentPage>=Pager.Total }"><a href="javascript:void(0)" v-on:click="NextPage">Next</a></li>
                        <li>  <span>共{{Pager.PageCount}}页</span></li>
                    </ul>

                </nav>
            </div>
        </div>
    </div>
</div>
<script src="https://res.tuhu.org/lib/vuejs/vue.min.js?v=20160704" type="text/javascript"></script>
<script src="https://res.tuhu.org/lib/require/require.min.js" type="text/javascript"></script>
<script src="/Scripts/jquery-ui-timepicker-addon/jquery-ui-sliderAccess.js" type="text/javascript"></script>
<script src="/Scripts/jquery-ui-timepicker-addon/jquery-ui-timepicker-addon.js" type="text/javascript"></script>
<script src="~/Scripts/Push/SinglePush.js?v=1213"></script>

<script>
    $(function () {
        //$("[id=IOSExpireTime],[id=IOSPushTime],[id=AndroidPushTime],[id=AndroidExpireTime]").datetimepicker({
        $("[id=CreateStartTime],[id=CreateEndTime]").datetimepicker({
            //minDate: new Date(),
            controlType: 'select',
            dateFormat: "yy-mm-dd",
            timeFormat: 'HH:mm'
        });
    });
    require(['vue-push-single'])
</script>