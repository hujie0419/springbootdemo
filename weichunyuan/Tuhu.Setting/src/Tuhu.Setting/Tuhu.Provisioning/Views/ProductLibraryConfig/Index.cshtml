@using Tuhu.Provisioning.DataAccess.Entity;
@{
    ViewBag.Title = "产品库优惠券配置";
    Layout = "../Shared/_Layout.cshtml";
}
<link href="~/Scripts/zTree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" />
<script src="~/Scripts/zTree/js/jquery.ztree.core-3.5.min.js" type="text/javascript"></script>
<script src="~/Scripts/zTree/js/jquery.ztree.excheck-3.5.min.js" type="text/javascript"></script>
<script src="~/Scripts/jquery-ui-timepicker-addon/jquery-ui-timepicker-addon.min.js"></script>
<style type="text/css">
    #rizhi, input[type=button], input[type=reset], input[type=submit] {
        background: #08c none repeat scroll 0 0;
        border: medium none #08c;
        border-radius: 5px;
        color: #f0f0f0;
        cursor: pointer;
        font-family: "Microsoft Yahei";
        font-size: 12px;
        outline: medium none;
        padding: 5px 25px
    }
    #CategoryMenu {
        border: 1px red red
    }

    #CategoryMenu {
        border: 1px red red
    }

    #ParamsList_Brand span, #ParamsList_Rim span, #ParamsList_Tab span {
        display: inline-block;
        width: 156px;
        margin-right: 10px
    }

    .pageStyle {
        display: inline-block;
        border: 1px solid #000;
        width: 36px;
        height: 16px;
        background: #ccc;
        margin: 0 5px;
        color: #000;
        cursor: pointer
    }
</style>

<div style="margin-top:20px;">
    <label><input type="radio" name="CheckMenu" value="3" onclick="zTreeSetting.expandAll(true);" />展开全部</label>
    <label><input type="radio" name="CheckMenu" value="4" onclick="zTreeSetting.expandAll(false);" />折叠全部</label>
    <input type="hidden" name="PublicCategory" id="PublicCategory" value="1" />
    <input type="hidden" id="imput_pid_Ids" />
</div>
<form action="/ProductLibraryConfig/InputProductIds" id="form-product-condition" method="post" enctype="multipart/form-data">
    <div style="margin:10px 0 0 0;">
        <ul id="CategoryTagTree" style="width:15%;border:2px solid #808080;background-color:#ccc;float:left;" class="ztree"></ul>
        <div id="ListItems" style="width:75%;float:left;margin:0 30px;">
            <div id="ParamsList">
                <input type="button" value="收起 / 展开" data-value="1" onclick="ProductLibraryConfig.DownOrUp(this);" /><span style="font-size:smaller;margin-left:10px;color:red">*品牌、标签、尺寸筛选条件不要超过二十个</span>
                <div id="div-condition">
                    <!--条件部分加载-->
                </div>
                <div id="div-product-list">
                    <!--数据列表加载-->
                </div>
            </div>
        </div>
        <div style="clear:both;"></div>
    </div>
    <input type="file" id="fileInputPIds" name="fileInputPIds" style="display:none" accept=".xls,.xlsx" data-uploadName="" onchange="ProductLibraryConfig.ImputPidsSearch(this)" />
    <input type="submit" id="btn_excel_submit"  style="display:none" />
</form>
<div id="ShowProductCouponDetail"></div>
<div id="BatchAddCouponView"></div>
<div id="CouponUseMoneyConfig" style="display:none">
    <table id="CouponUseMoneyConfigTable">
        <tr>
            <td>
                <label>毛利警戒线：</label>
                <input id="profitLevel" type="text" oninput="ProductLibraryConfig.ProfitChange()" />
            </td>
            <td>
                <input type="button" value="添加新的规则" onclick="ProductLibraryConfig.AddCouponUseMoneyRow()" />
                @*<input type="button" value="验证产品" onclick="ProductLibraryConfig.VerfyProductCoupon()" />*@
            </td>
            <td>
                <input type="button" value="添加已有规则" onclick="ProductLibraryConfig.AddExistRuleRow()" />
            </td>
        </tr>
    </table>
    <table id="NotAvaiableProductTips" style="display:none">
        <tr>
            <th>
                低于最低毛利的产品：
            </th>
        </tr>
    </table>
    <table id="NotAvaiableProduct" style="display:none">
        <tr>
            <th>
                序号
            </th>
            <th>
                PID
            </th>
            <th>
                产品名
            </th>
            <th>
                价格
            </th>
            <th>
                成本
            </th>
        </tr>
    </table>
    <table style="margin-bottom:10px;float:right">
        <tr>
            <td>
                <input type="button" style="margin-right:50px" value="下一步" class="nextStep" onclick="ProductLibraryConfig.StepChange(this)" />
            </td>
        </tr>
    </table>
    <img class="loadingImg" src="~/Images/loading.gif" style="display:none" />
    <table id="CouponUseMoneyConfigTemplate" style="display:none">
        <tr>
            <td>
                <label class="newRule">新的规则</label>
            </td>
            <td>
                <label>满</label>
                <input class="miniMoney" type="text" onchange="ProductLibraryConfig.CouponRuleRowChange(this)" />
            </td>
            <td>
                <label>减</label>
                <input class="discount" type="text" onchange="ProductLibraryConfig.CouponRuleRowChange(this)" />
            </td>
            <td>
                <input type="button" value="删除" onclick="ProductLibraryConfig.RemoveCurrentRow(this)" />
            </td>
            <td>
                <input type="button" value="查看可用产品" onclick="ProductLibraryConfig.ShowPassedProducts(this)" />
            </td>
        </tr>
    </table>
    <table id="ExistRuleTemplate" style="display:none">
        <tr>
            <td>
                <label>规则ID</label>
                <input type="text" class="rulePKID" onblur="ProductLibraryConfig.FillRuleInfo(this)" />
            </td>
            <td>
                <label>满</label>
                <input class="miniMoney" type="text" readonly="readonly" />
            </td>
            <td>
                <label>减</label>
                <input class="discount" type="text" readonly="readonly" />
            </td>
            <td>
                <input type="button" value="删除" onclick="ProductLibraryConfig.RemoveCurrentRow(this)" />
            </td>
            <td>
                <input type="button" value="查看可用产品" onclick="ProductLibraryConfig.ShowPassedProducts(this)" />
            </td>
        </tr>
    </table>
    <table id="SimpleProductTemplate" style="display:none">
        <tr>
            <td>
                $index$
            </td>
            <td>
                $productId$
            </td>
            <td>
                $productName$
            </td>
            <td>
                $price$
            </td>
            <td>
                $cost$
            </td>
        </tr>
    </table>
</div>

<div id="AvaiableProducts" style="display:none">
    <table id="AvaiableProductsTable">
        <tr>
            <th>
                序号
            </th>
            <th>
                产品Id
            </th>
            <th>
                产品名
            </th>
            <th>
                价格
            </th>
            <th>
                成本
            </th>
        </tr>
    </table>
</div>

<div id="CreateCoupon" style="display:none">
    <table id="publicParentCouponInfo">
        <tr>
            <th>
                母券信息
            </th>
        </tr>
        <tr>
            <td>
                <label>名称</label>
                <input type="text" class="name" />
            </td>
        </tr>
        <tr>
            <td>
                <label>订单类型：</label>
                <input type="radio" checked="checked" name="OrderType" value="0" />
                <label>所有订单</label>
                <input type="radio" name="OrderType" value="1" />
                <label>仅到家订单</label>
                <input type="radio" name="OrderType" value="2" />
                <label>仅到店订单</label>
            </td>
        </tr>
        <tr>
            <td>
                <label>优惠券类型：</label>
                <input type="radio" checked="checked" name="CouponType" value="0" />
                <label>满减券</label>
                <input type="radio" name="CouponType" value="1" />
                <label>后返券</label>
                <input type="radio" name="CouponType" value="2" />
                <label>实付券</label>
            </td>
        </tr>
        <tr style="display:none">
            <td>
                <label>跳转着陆页：</label>
                <input type="radio" name="JumpType" value="0" />
                <label>优惠券说明</label>
                <input type="radio" name="JumpType" value="1" checked="checked" />
                <label>轮胎列表</label>
                <input type="radio" name="JumpType" value="2" />
                <label>保养列表</label>
                <input type="radio" name="JumpType" value="3" />
                <label>车品商城</label>
                <input type="radio" name="JumpType" value="4" />
                <label>商品列表</label>
                <input type="radio" name="JumpType" value="5" />
                <label>洗车</label>
                <input type="radio" name="JumpType" value="6" />
                <label>打蜡</label>
                <input type="radio" name="JumpType" value="7" />
                <label>内饰清洗</label>
            </td>
        </tr>
        <tr style="display:none">
            <td>
                <label>APP自定义跳转着陆页：</label>
                <input type="text" id="AppJumpPage" />
            </td>
        </tr>
        <tr style="display:none">
            <td>
                <label>小程序自定义跳转着陆页：</label>
                <input type="text" id="H5JumpPage" />
            </td>
        </tr>
        <tr>
            <td>
                <label>商品范围</label>
                <label>*按PID*</label>
            </td>
        </tr>
    </table>
    <table id="publicChildCouponInfo">
        <tr>
            <th>
                子券信息
            </th>
        </tr>
        <tr>
            <td>
                <label>优惠券有效期</label>
            </td>
            <td>
                <input type="radio" name="validity" checked="checked" class="afterReceiveType" />
                <label>自领取后</label>
                <input type="text" class="dayAfterReceive" />
                <label>天</label>
                <label>最终有效期</label>
                <input type="text" class="finalValidity" />
            </td>
            <td>
                <input type="radio" name="validity" class="fixedDateType" />
                <label>固定日期</label>
                <input type="text" class="startDate" />
                <input type="text" class="endDate" />
            </td>
        </tr>
        <tr>
            <td>
                <label>每人限领数量</label>
            </td>
            <td>
                <input type="text" class="limitCount" />
            </td>
        </tr>
        <tr>
            <td>
                <label>发行量</label>
            </td>
            <td>
                <input type="text" class="Circulation" />
                <label>修改发行量时只能增加不能减少,请谨慎设置</label>
            </td>
        </tr>
        <tr>
            <td>
                <label>渠道</label>
            </td>
            <td>
                <select id="channel">
                    <option selected="selected" value="整网">整网</option>
                    <option value="轮胎">轮胎</option>
                    <option value="保养">保养</option>
                    <option value="车品">车品</option>
                    <option value="美容">美容</option>
                    <option value="蓄电池">蓄电池</option>
                    <option value="漆面修补">漆面修补</option>
                    <option value="李强">李强</option>
                    <option value="吴哲漢">吴哲漢</option>
                    <option value="王婵娟">王婵娟</option>
                    <option value="戴秀梅">戴秀梅</option>
                    <option value="浦隆飚">浦隆飚</option>
                    <option value="叶晓娟">叶晓娟</option>
                    <option value="朱佩琼">朱佩琼</option>
                    <option value="张智健">张智健</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <label>电销可发放</label>
            </td>
            <td>
                <input type="radio" checked="checked" value="1" name="isSalerCanSend" />
                <label>是</label>
                <input type="radio" value="0" name="isSalerCanSend" />
                <label>否</label>
            </td>
        </tr>
        <tr>
            <td>
                <label>支持的用户范围</label>
            </td>
            <td>
                <input type="radio" checked="checked" name="supportUserType" value="0" />
                <label>全部</label>
                <input type="radio" name="supportUserType" value="1" />
                <label>新用户</label>
                <input type="radio" name="supportUserType" value="2" />
                <label>老用户</label>
            </td>
        </tr>
        <tr>
            <td>
                <label>详情页展示时间</label>
            </td>
            <td>
                <input type="text" class="ShowStartTime" />
                <label>-</label>
                <input type="text" class="ShowEndTime" />
            </td>
        </tr>
        <tr>
            <td>
                <label>部门</label>
            </td>
            <td>
                <select id="partList" onchange="ProductLibraryConfig.ReloadUseList()">
                    <option></option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <label>用途</label>
            </td>
            <td>
                <select id="useList">
                    <option></option>
                </select>
            </td>
        </tr>
    </table>
    <table id="IndividualInfo">
        <tr>
            <th>
                个性化信息
            </th>
        </tr>
    </table>
    <table>
        <tr>
            <td>
                <input type="button" value="上一步" class="lastStep" onclick="ProductLibraryConfig.StepChange(this)" />
            </td>
            <td>
                <input type="button" value="下一步" class="nextStep" onclick="ProductLibraryConfig.StepChange(this)" />
            </td>
        </tr>
    </table>
    <table id="IndividualInfoTemplate" style="display:none">
        <tr>
            <td>
                <label>满：</label>
                <label class="miniMoney">$miniMoney$</label>
            </td>
            <td>
                <label>减:</label>
                <label class="discount">$discount$</label>
            </td>
            <td>
                <label>
                    优惠券名称：
                </label>
                <input type="text" class="couponName" />
            </td>
            <td>
                <label>
                    优惠券描述：
                </label>
                <input type="text" class="description" />
            </td>
        </tr>
    </table>
</div>

<div id="notPassedProduct" style="display:none">
    <table id="notPassedProductTable">
        <tr>
            <th>
                序号
            </th>
            <th>
                PID
            </th>
            <th>
                名字
            </th>
            <th>
                价格
            </th>
            <th>
                成本
            </th>
        </tr>
    </table>
</div>

<div style="border:0;display:none" id="DivLoadingData">

</div>

<script id="AssignCouponView" type="text/template">
    <tr>
        <td><input attribute="CouponNum" class="couponBlur" type="number" value="{{CouponNum}}" data-Oid="{{Oid}}" data-statusType="" onblur="ProductLibraryConfig.MatchingCoupon(this);" /></td>
        <td attribute="CouponName">{{Description}}</td>
        <td attribute="CouponMinmoney">{{CouponMinmoney}}</td>
        <td attribute="CouponDiscount">{{CouponDiscount}}</td>
        <td attribute="CouponSaleAmount">{{CouponSaleAmount}}</td>
        <td attribute="CouponSalePercent">{{CouponSalePercent}}</td>
        <td attribute="CouponExplain">{{CouponExplain}}</td>
        @*<td attribute="Condition">{{SupportUserRange}}</td>*@
        <td><input type="button" value="删除" onclick="ProductLibraryConfig.RemoveCoupon(this);" /> </td>
    </tr>
</script>
<script id="BatchDeleteCoupon" type="text/template">
    <tr>
        <td><input attribute="CouponNum" class="couponBlur" type="number" value="{{CouponNum}}" onblur="ProductLibraryConfig.MatchingCoupon(this,'BatchDelete');" /></td>
        <td attribute="CouponName">{{Description}}</td>
        <td attribute="CouponExplain">{{CouponExplain}}</td>
        <td attribute="Condition">{{SupportUserRange}}</td>
        <td><input type="button" value="删除" onclick="ProductLibraryConfig.RemoveCoupon(this);" /> </td>
    </tr>
</script>
<script src="~/Scripts/Product/productLibraryConfig.js?v=1.2"></script>
<script type="text/javascript">
    $(function () {
        zTreeSetting.zTreeJson =@Html.Raw(ViewBag.CategoryTagManager);
        zTreeSetting.zTreeInit();
    });
    //zTreeSetting.expandAll(true);
    //setTimeout(zTreeSetting.expandAll,500);
</script>


