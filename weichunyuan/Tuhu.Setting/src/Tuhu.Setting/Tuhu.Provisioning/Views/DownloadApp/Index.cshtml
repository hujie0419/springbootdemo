@using Tuhu.Provisioning.Models
@model Tuhu.Component.Common.Models.ListModel<Tuhu.Provisioning.DataAccess.Entity.DownloadApp>
    @{
        ViewBag.Title = "App下载页列表";

    }
    <style>
        .ui-dialog {
            border-radius: 3px;
            padding: 0px;
            width: auto;
        }

        .ui-dialog-grid {
            width: 100%;
        }

        .ui-dialog-title {
            width: 75%;
            padding: 8px 15px 8px 15px;
        }

        .ui-dialog-close {
            top: 8px;
        }

        .ui-dialog-body {
            padding: 10px;
        }

        .ui-dialog-content {
            padding: 0px;
        }

        .ui-dialog-footer {
            padding: 5px 10px 5px 5px;
            background: #ffffff;
            border-top: 1px solid #eee;
        }

            .ui-dialog-footer button {
                padding: 3px 15px;
                border-radius: 2px;
                box-shadow: 0 1px 1px rgba(0,0,0,.15);
                font-size: 12px;
            }

                .ui-dialog-footer button.ui-dialog-autofocus {
                    font-weight: 700;
                    text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
                }

        .button1 {
            margin-top: 20px;
            padding: 5px 25px;
            border: none;
            color: #F0F0F0;
            font-size: 12px;
            font-family: "Microsoft Yahei";
            outline: none;
            cursor: pointer;
            background: #0088cc;
            border-color: #0088cc;
        }

        table th {
            color: white;
            padding: 6px 5px;
            text-align: left;
            background-color: #0088cc;
            border: solid 1px #0088cc;
        }
    </style>
    <h2>App下载页列表</h2>
    <script src="../../Scripts/ajaxfileupload.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/Scripts/artDialog6.0.4/css/ui-dialog.css" />
    <script src="~/Scripts/artDialog6.0.4/dist/dialog-min.js"></script>
    <script src="~/Scripts/artDialog6.0.4/dist/dialog-plus-min.js"></script>

    <input type="button" class="button1" id="Insert" value="添加(老)" />
    <input type="button" class="button1" id="InsertNew" value="添加(新)" />
    <div style="margin-top:20px;">
        <table>
            <tbody>
                <tr>
                    <td>Id:</td>
                    <td><input type="text" id="id" /></td>
                    <td>Title:</td>
                    <td><input type="text" id="titlename" /></td>
                    <td><input type="button" value="查询" id="Search" class="button1" /></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div style="margin-top:20px;">
        <table style="width:100%;">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Title</th>
                    <th>Url</th>
                    <th>CreateTime</th>
                    <th>UpdateTime</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
            {
                    <tr>
                        <td>@item.Id</td>
                        <td>@item.Title</td>
                        <td>
                            @{
                                string domain = Request.Url.Host.Contains("tuhu.cn") ? "https://res.tuhu.org" : "http://resource.tuhu.test";

                            }
                            @if (item.Type != 1)
                            {
                                <a href="https://huodong.tuhu.cn/ActivityHtml/Download/Index.html?Id=@item.Id" target="_blank"> https://huodong.tuhu.cn/ActivityHtml/Download/Index.html?Id=@item.Id</a>
                            }
                            else
                            {
                                <a href="@domain/ActivityHtml/DownloadApp/Index.html?id=@item.Id" target="_blank"> @domain/ActivityHtml/DownloadApp/Index.html?id=@item.Id</a>
                            }

                        </td>

                        <td>@item.CreateTime</td>
                        <td>@item.UpdateTime</td>
                        <td>
                            @if (item.Type != 1)
                            {
                                <a href="javascript:;" pkid="@item.Id" onclick="UpdateClick(@item.Id)">编辑</a>
                                <a href="javascript:;" pkid="@item.Id" onclick="DeleteClick(this)">删除</a>
                            }
                            else
                            {
                                <a href="javascript:;" pkid="@item.Id" onclick="UpdateNewClick(@item.Id)">编辑</a>
                                <a href="javascript:;" pkid="@item.Id" onclick="DeleteClick(this)">删除</a>
                            }
                        </td>
                    </tr>
                                }

            </tbody>
        </table>
    </div>
    <div>
        @Html.Pager(Model.Pager, pageIndex => Url.RouteUrl(new { pageIndex }))
    </div>
    <script>
        $(function () {

            $("#Search").click(function () {
                var id = 0;
                if ($("#id").val()) {
                    id = $("#id").val();
                }
                window.location.href = "/DownloadApp/Index?id=" + id + "&title=" + $("#titlename").val()
            })

        })
        $("#Insert").click(function () {
            Insert();
        })
        $("#InsertNew").click(function () {
            InsertNew();
        })
        function Insert() {
            var dialgpResult = dialog({
                height: 450,
                width: 1000,
                fixed: true,
                title: "添加App下载页",
                button: [
                {
                    value: "保存",
                    callback: function () {

                        if ($("#title_name").val() == "" || $("#title_name").val() == null) {
                            alert("title不能为空！")
                            return false;
                        }
                        var td_table1 = $("#table1 tbody tr td");
                        var td_table2 = $("#table2 tbody tr td");
                        var timerContent = {
                            "SmallImage": td_table2.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table2.eq(0).find("input[class='image']").val(),
                            "IOSLink": td_table2.eq(1).find("input[type='text']").val(),
                            "AndroidLink": td_table2.eq(2).find("input[type='text']").val(),
                            "PCLink": td_table2.eq(3).find("input[type='text']").val(),
                            "WeiXinLink": td_table2.eq(4).find("input[type='text']").val()
                        };
                        var bottomContent = {
                            "SmallImage": td_table1.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table1.eq(0).find("input[class='image']").val(),
                            "IOSLink": td_table1.eq(1).find("input[type='text']").val(),
                            "AndroidLink": td_table1.eq(2).find("input[type='text']").val(),
                            "PCLink": td_table1.eq(3).find("input[type='text']").val(),
                            "WeiXinLink": td_table1.eq(4).find("input[type='text']").val()
                        };

                        var timerStatus = td_table2.eq(5).find("select").val() == "1" ? "true" : "false";
                        var bottomStatus = td_table1.eq(5).find("select").val() == "1" ? "true" : "false";

                        var dataArray = new Array();
                        $('#table3 >tbody> tr').each(function (i) {
                            if (i >= 0) {
                                var columns = $(this).children();
                                var jsonData = { "SmallImage": "", "Image": "", "IOSLink": "", "AndroidLink": "", "PCLink": "", "WeiXinLink": "" };

                                jsonData.SmallImage = columns.eq(0).find("input[class='smallImage']").val();
                                jsonData.Image = columns.eq(0).find("input[class='image']").val();
                                jsonData.IOSLink = columns.eq(1).find("input[type='text']").val();
                                jsonData.AndroidLink = columns.eq(2).find("input[type='text']").val();
                                jsonData.PCLink = columns.eq(3).find("input[type='text']").val();
                                jsonData.WeiXinLink = columns.eq(4).find("input[type='text']").val();
                                dataArray[i] = jsonData;
                            }
                        });

                        var imageContent = JSON.stringify(dataArray);
                        console.log(bottomStatus);
                        console.log(timerStatus);
                        console.log(imageContent);
                        console.log(JSON.stringify(timerContent));
                        console.log(JSON.stringify(bottomContent));

                        $.ajax({
                            type: "POST",
                            url: "/DownloadApp/AddDownloadApp",
                            data: {
                                "Title": $("#title_name").val(),
                                "BottomContent": JSON.stringify(bottomContent),
                                "ImageContent": imageContent,
                                "TimerContent": JSON.stringify(timerContent),
                                "TimerStatus": timerStatus,
                                "BottomStatus": bottomStatus
                            },
                            success: function (result) {
                                if (result) {
                                    window.location.reload(true);
                                }
                                else {
                                    alert("保存失败！");
                                }
                            },
                            error: function (result) {
                                alert("失败!")
                            }
                        });
                    }
                },
                {
                    value: "关闭"
                }]
            });

            $.ajax({
                url: "/DownloadApp/Add",
                data: {},
                type: "GET",
                success: function (result) {

                    dialgpResult.content(result);
                    dialgpResult.showModal();

                }
            });
        };
        function InsertNew() {
            var dialgpResult = dialog({
                height: 450,
                width: 600,
                fixed: true,
                title: "添加App下载页",
                button: [
                {
                    value: "保存",
                    callback: function () {

                        if ($("#title_name").val() == "" || $("#title_name").val() == null) {
                            alert("title不能为空！")
                            return false;
                        }
                        var td_table1 = $("#table1 tbody tr td");
                        var td_table2 = $("#table2 tbody tr td");
                        var timerContent = {
                            "SmallImage": td_table2.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table2.eq(0).find("input[class='image']").val(),
                            "MLink": td_table2.eq(1).find("input[type='text']").val(),

                        };
                        var bottomContent = {
                            "SmallImage": td_table1.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table1.eq(0).find("input[class='image']").val(),
                            "MLink": td_table1.eq(1).find("input[type='text']").val(),
                        };

                        var timerStatus = td_table2.eq(5).find("select").val() == "1" ? "true" : "false";
                        var bottomStatus = td_table1.eq(5).find("select").val() == "1" ? "true" : "false";

                        var dataArray = new Array();
                        $('#table3 >tbody> tr').each(function (i) {
                            if (i >= 0) {
                                var columns = $(this).children();
                                var jsonData = { "SmallImage": "", "Image": "", "MLink": "" };

                                jsonData.SmallImage = columns.eq(0).find("input[class='smallImage']").val();
                                jsonData.Image = columns.eq(0).find("input[class='image']").val();
                                jsonData.MLink = columns.eq(1).find("input[type='text']").val();

                                dataArray[i] = jsonData;
                            }
                        });

                        var imageContent = JSON.stringify(dataArray);
                        console.log(bottomStatus);
                        console.log(timerStatus);
                        console.log(imageContent);
                        console.log(JSON.stringify(timerContent));
                        console.log(JSON.stringify(bottomContent));

                        $.ajax({
                            type: "POST",
                            url: "/DownloadApp/AddDownloadApp",
                            data: {
                                "Title": $("#title_name").val(),
                                "BottomContent": JSON.stringify(bottomContent),
                                "ImageContent": imageContent,
                                "TimerContent": JSON.stringify(timerContent),
                                "TimerStatus": timerStatus,
                                "BottomStatus": bottomStatus,
                                "Type": 1
                            },
                            success: function (result) {
                                if (result) {
                                    window.location.reload(true);
                                }
                                else {
                                    alert("保存失败！");
                                }
                            },
                            error: function (result) {
                                alert("失败!")
                            }
                        });
                    }
                },
                {
                    value: "关闭"
                }]
            });

            $.ajax({
                url: "/DownloadApp/AddNew",
                data: {},
                type: "GET",
                success: function (result) {

                    dialgpResult.content(result);
                    dialgpResult.showModal();

                }
            });
        };

        function DeleteClick(e) {

            if (window.confirm("你确定要删除吗？")) {
                $.ajax({
                    type: "POST",
                    url: "/DownloadApp/DeleteDownloadApp",
                    data: {
                        "id": $(e).attr("pkid")
                    },
                    success: function (result) {
                        window.location.reload(true);
                    },
                    error: function (result) {
                        alert("失败!")
                    }
                });

            }
        };

        function UpdateClick(e) {
            var dialgpResult = dialog({
                height: 450,
                width: 1000,
                fixed: true,
                title: "编辑App下载页",
                button: [
                {
                    value: "保存",
                    callback: function () {
                        if ($("#title_name").val() == "" || $("#title_name").val() == null) {
                            alert("title不能为空！")
                            return false;
                        }

                        var td_table1 = $("#table1 tbody tr td");
                        var td_table2 = $("#table2 tbody tr td");
                        var timerContent = {
                            "SmallImage": td_table2.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table2.eq(0).find("input[class='image']").val(),
                            "IOSLink": td_table2.eq(1).find("input[type='text']").val(),
                            "AndroidLink": td_table2.eq(2).find("input[type='text']").val(),
                            "PCLink": td_table2.eq(3).find("input[type='text']").val(),
                            "WeiXinLink": td_table2.eq(4).find("input[type='text']").val()
                        };
                        var bottomContent = {
                            "SmallImage": td_table1.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table1.eq(0).find("input[class='image']").val(),
                            "IOSLink": td_table1.eq(1).find("input[type='text']").val(),
                            "AndroidLink": td_table1.eq(2).find("input[type='text']").val(),
                            "PCLink": td_table1.eq(3).find("input[type='text']").val(),
                            "WeiXinLink": td_table1.eq(4).find("input[type='text']").val()
                        };
                        var timerStatus = td_table2.eq(5).find("select").val() == "1" ? "true" : "false";
                        var bottomStatus = td_table1.eq(5).find("select").val() == "1" ? "true" : "false";

                        var dataArray = new Array();
                        $('#table3 >tbody> tr').each(function (i) {
                            if (i >= 0) {
                                var columns = $(this).children();
                                var jsonData = { "SmallImage": "", "Image": "", "IOSLink": "", "AndroidLink": "", "PCLink": "", "WeiXinLink": "" };
                                jsonData.SmallImage = columns.eq(0).find("input[class='smallImage']").val();
                                jsonData.Image = columns.eq(0).find("input[class='image']").val();
                                jsonData.IOSLink = columns.eq(1).find("input[type='text']").val();
                                jsonData.AndroidLink = columns.eq(2).find("input[type='text']").val();
                                jsonData.PCLink = columns.eq(3).find("input[type='text']").val();
                                jsonData.WeiXinLink = columns.eq(4).find("input[type='text']").val();
                                dataArray[i] = jsonData;
                            }
                        });

                        var imageContent = JSON.stringify(dataArray);
                        console.log(bottomStatus);
                        console.log(timerStatus);
                        console.log(imageContent);
                        console.log(JSON.stringify(timerContent));
                        console.log(JSON.stringify(bottomContent));

                        $.ajax({
                            type: "POST",
                            url: "/DownloadApp/UpdateDownloadApp",
                            data: {
                                "Title": $("#title_name").val(),
                                "BottomContent": JSON.stringify(bottomContent),
                                "ImageContent": imageContent,
                                "TimerContent": JSON.stringify(timerContent),
                                "TimerStatus": timerStatus,
                                "BottomStatus": bottomStatus,
                                "id": e
                            },
                            success: function (result) {
                                if (result) {
                                    window.location.reload(true);
                                }
                                else {
                                    alert("保存失败！");
                                }
                            },
                            error: function (result) {
                                alert("失败!")
                            }
                        });

                    }
                },
                {
                    value: "关闭"
                }]
            });

            $.ajax({
                url: "/DownloadApp/Edit?id=" + e,
                data: {},
                type: "GET",
                success: function (result) {

                    dialgpResult.content(result);
                    dialgpResult.showModal();

                }
            });
        };
        function UpdateNewClick(e) {
            var dialgpResult = dialog({
                height: 450,
                width: 500,
                fixed: true,
                title: "编辑App下载页",
                button: [
                {
                    value: "保存",
                    callback: function () {
                        if ($("#title_name").val() == "" || $("#title_name").val() == null) {
                            alert("title不能为空！")
                            return false;
                        }

                        var td_table1 = $("#table1 tbody tr td");
                        var td_table2 = $("#table2 tbody tr td");
                        var timerContent = {
                            "SmallImage": td_table2.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table2.eq(0).find("input[class='image']").val(),
                            "MLink": td_table2.eq(1).find("input[type='text']").val(),

                        };
                        var bottomContent = {
                            "SmallImage": td_table1.eq(0).find("input[class='smallImage']").val(),
                            "Image": td_table1.eq(0).find("input[class='image']").val(),
                            "MLink": td_table1.eq(1).find("input[type='text']").val(),
                        };
                        var timerStatus = td_table2.eq(2).find("select").val() == "1" ? "true" : "false";
                        var bottomStatus = td_table1.eq(2).find("select").val() == "1" ? "true" : "false";

                        var dataArray = new Array();
                        $('#table3 >tbody> tr').each(function (i) {
                            if (i >= 0) {
                                var columns = $(this).children();
                                var jsonData = { "SmallImage": "", "Image": "", "IOSLink": "", "AndroidLink": "", "PCLink": "", "WeiXinLink": "" };
                                jsonData.SmallImage = columns.eq(0).find("input[class='smallImage']").val();
                                jsonData.Image = columns.eq(0).find("input[class='image']").val();
                                jsonData.MLink = columns.eq(1).find("input[type='text']").val();

                                dataArray[i] = jsonData;
                            }
                        });

                        var imageContent = JSON.stringify(dataArray);
                        console.log(bottomStatus);
                        console.log(timerStatus);
                        console.log(imageContent);
                        console.log(JSON.stringify(timerContent));
                        console.log(JSON.stringify(bottomContent));

                        $.ajax({
                            type: "POST",
                            url: "/DownloadApp/UpdateDownloadApp",
                            data: {
                                "Title": $("#title_name").val(),
                                "BottomContent": JSON.stringify(bottomContent),
                                "ImageContent": imageContent,
                                "TimerContent": JSON.stringify(timerContent),
                                "TimerStatus": timerStatus,
                                "BottomStatus": bottomStatus,
                                "id": e,
                                "Type": 1
                            },
                            success: function (result) {
                                if (result) {
                                    window.location.reload(true);
                                }
                                else {
                                    alert("保存失败！");
                                }
                            },
                            error: function (result) {
                                alert("失败!")
                            }
                        });

                    }
                },
                {
                    value: "关闭"
                }]
            });

            $.ajax({
                url: "/DownloadApp/EditNew?id=" + e,
                data: {},
                type: "GET",
                success: function (result) {

                    dialgpResult.content(result);
                    dialgpResult.showModal();

                }
            });
        };
    </script>
