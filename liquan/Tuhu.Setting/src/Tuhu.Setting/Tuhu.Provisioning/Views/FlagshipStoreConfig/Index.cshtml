@{
    ViewBag.Title = "旗舰店";
}
@model IEnumerable<Tuhu.Provisioning.DataAccess.Entity.SE_FlagshipStoreConfig>

@section head{
    <link href="~/Scripts/jQuery-EasyUI/themes/default/easyui.css" type="text/css" rel="stylesheet" />
    <link href="~/Scripts/jQuery-EasyUI/themes/icon.css" type="text/css" rel="stylesheet" />
}
<div id="toobar">
    <a href="javascript:void(0)" id="btnAdd" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true">新 增</a>
    <a href="javascript:void(0)" id="btnEdit" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" style="margin-left:5px;margin-right:5px;">编 辑</a>

    <a href="javascript:void(0)" id="btnDelete" class="easyui-linkbutton" data-options="iconCls:'icon-cancel',plain:true" style="margin-left:5px;margin-right:5px;position:absolute;right:10px;">删 除</a>
</div>
<table id="flagshipStore" class="easyui-datagrid" data-options="toolbar:'#toobar',singleSelect:true,checkOnSelect:true,width:'100%'" title="品牌旗舰店管理">
    <thead>
        <tr>
            <th data-options="field:'PKID',width:'5%',checkbox:true"></th>
            <th data-options="field:'Brand',width:'15%'">品牌</th>
            <th data-options="field:'Name',width:'15%'">名称</th>
            <th data-options="field:'ImageUrl',width:'5%',formatter:function(value,row,index){  if(value!='' && value != null&& value != undefined){return '<img src='+value+' width=40 height=23 />'; }}">品牌图片</th>
            <th data-options="field:'Describe',width:'10%'">描述</th>
            <th data-options="field:'Uri',width:'20%'">链接</th>
            <th data-options="field:'Remark',width:'10%'">分享参数</th>
            <th data-options="field:'CreateDT',width:'10%'">创建时间</th>
            <th data-options="field:'UpdateDT',width:'10%'">更新时间</th>
        </tr>
    </thead>
   <tbody>
       @if (Model != null)
       {
           foreach (var item in Model)
           {
               <tr>
                   <td>@item.PKID</td>
                   <td>@item.Brand</td>
                   <td>@item.Name</td>
                   <td>
                       @item.ImageUrl
                   </td>
                   <td>@item.Describe</td>
                   <td>@item.Uri</td>
                   <td>@item.Remark</td>
                   <td>@item.CreateDT.ToString("yyyy-MM-dd HH:mm:ss")</td>
                   <td>@item.UpdateDT.ToString("yyyy-MM-dd HH:mm:ss")</td>
               </tr>
           }
       }
   </tbody>
</table>
<div id="Edit"></div>


@section scripts{
    <script type="text/javascript" src="~/Scripts/jQuery-EasyUI/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="~/Scripts/jQuery-EasyUI/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="~/Scripts/ajaxfileupload.js"></script>
    <script type="text/javascript">
        $('#btnAdd').on('click', function () {
           
            $('#Edit').dialog({
                title: "编辑品牌旗舰店",
                width: 450,
                height: 400,
                cache: false,
                model: true,
                shadow:true,
                href: '/FlagshipStoreConfig/Edit',
                queryParams: null,
                method: 'post',
                buttons: [{
                    text: "保 存",
                    iconCls: 'icon-add',
                    handler: function () {
                        $('#FlagshipForm').form("submit", {
                            success: function (result) {
                               
                                if (result == "1") {
                                    $.messager.alert("系统提示", "保存成功!");
                                    $('#Edit').dialog('close');
                                    location.reload();
                                } else {
                                    $.messager.alert("系统提示", "保存失败!");
                                }
                            }
                        });
                    }
                }, {
                    text: "取 消",
                    iconCls: 'icon-cancel',
                    handler: function () {
                        $('#Edit').dialog('close');
                    }
                }]
            });
            $('#Edit').dialog("center");
        });
       
        $('#btnEdit').on('click', function () {
           
          //  $('#Edit').dialog("center");
            var selRow = $('#flagshipStore').datagrid("getSelected");
            console.log(selRow);
            if (selRow) {
                console.log(selRow);
                $('#Edit').empty();
                $('#Edit').dialog({
                    title: "编辑品牌旗舰店",
                    width: 450,
                    height: 400,
                    cache: false,
                    model: true,
                    shadow: true,
                    href: '/FlagshipStoreConfig/Edit',
                    queryParams: selRow,
                    method:'post',
                    buttons: [{
                        text: "保 存",
                        iconCls: 'icon-add',
                        handler: function () {
                            $('#FlagshipForm').form("submit", {
                                success: function (result) {
                                  
                                    if (result == "1") {
                                        $.messager.alert("系统提示", "保存成功!");
                                      
                                        $('#Edit').dialog('clear');
                                        location.reload();
                                    } else {
                                        $.messager.alert("系统提示", "保存失败!");
                                    }
                                }
                            });
                        }
                    }, {
                        text: "取 消",
                        iconCls: 'icon-cancel',
                        handler: function () {
                            $('#flagshipStore').datagrid("clearSelections")
                            $('#Edit').dialog('close');
                        }
                    }]
                });
                $('#Edit').dialog("center");
            } else {
                $.messager.alert("系统提示","请要编辑的选择行！");
            }
        });

        $('#btnDelete').on('click', function () {
            var selRow = $('#flagshipStore').datagrid("getSelected");
            if (selRow) {
                $.messager.confirm("系统提示", "您确定删除吗?", function (r) {
                    if (r) {
                        $.ajax({
                            url: '/FlagshipStoreConfig/Delete',
                            type: 'post',
                            data: {PKID:selRow.PKID}
                        }).done(function (result) {
                            if (result == 1) {
                                $.messager.alert("系统提示", "删除成功！");
                                location.reload();
                            } else {
                                $.messager.alert("系统提示", "删除失败");
                            }
                        }).fail(function () {
                            $.messager.alert("系统提示","删除失败");
                        });
                    }
                });
            } else {
                $.messager.alert("系统提示","请选择要删除的行");
            }
        });
      
        function Upload(obj, showImg, hidImg) {

            var pobj = $(obj);
            var rd = Math.ceil(Math.random() * 9999) + 1;
            var fileElId = $(obj).attr("id");
            console.log(fileElId);
            $.ajaxFileUpload({
                url: '/Article/ImageUploadToAli?rd=' + rd,
                secureuri: false,
                fileElementId: fileElId,
                dataType: 'json',
                async: false,
                success: function (result) {
                    if (result.BImage != "" && result.SImage != "") {
                        $("#" + showImg).attr("src", result.SImage).show();
                        $('#' + hidImg).val(result.BImage);
                    } else {
                        alert("上传失败！");
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            });
        }
    </script>
}