@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "车务日志";
}
<link rel="stylesheet" href="/Scripts/artDialog6.0.4/css/ui-dialog.css" />
<style type="text/css">
    [v-cloak] {
        display: none;
    }

    .tableContainer {
        width: 100%;
    }

        .tableContainer th {
            background: #66ABEF;
            color: #F3F7FA;
            border: 1px solid #559BD0;
            font-weight: 600;
            font-family: "Microsoft Yahei";
            text-align: center;
        }

        .tableContainer td {
            font-size: 75%;
            padding: 8px 3px 8px 3px;
            font-family: "Microsoft Yahei";
            text-align: center;
            border: 1px solid #eee;
        }

    .pager > button {
        float: right;
        margin-right: 4px;
    }

    .ui-dialog {
        width: auto;
    }
</style>
<div id="div" style="margin-top:20px" v-cloak>
    <div style="margin-bottom:20px">
        <input type="text" placeholder="开始时间" class="startTime" value="@ViewBag.StartTime" style="width:200px;float:left;margin-left:15px;height:30px;" v-on:click="WdatePicker({ dateFmt: 'yyyy/MM/dd' })" />
        <input type="text" placeholder="结束时间" class="endTime" value="@ViewBag.EndTime" style="width:200px;float:left;margin-left:15px;height:30px" v-on:click="WdatePicker({ dateFmt: 'yyyy/MM/dd' })" />
        <select v-model="filterCondition.orderType" style="float:left;margin-left:15px;height:30px">
            <option value="None">订单类型</option>
        </select>
        <input type="button" value="查询" v-on:click="pager.currentPage=0;" style="margin-left:15px;height:30px;width:80px" />
    </div>
    <table class="tableContainer" style="margin-top:30px">
        <thead>
            <tr>
                <th>#</th>
                <th>订单号</th>
                <th>状态</th>
                <th>信息</th>
                <th>订单类型</th>
                <th>时间</th>
            </tr>
        </thead>
        <tr v-if="list.length<=0&&!loading">
            <td colspan="6">无数据</td>
        </tr>
        <tr v-if="loading">
            <td colspan="6"><img src="/Images/loading.gif" /></td>
        </tr>
        <tr v-for="(item,index) in list">
            <td>{{++index}}</td>
            <td>{{item.WithdrawalsAmount}}</td>
            <td>{{item.CreateTime|formatDate}}</td>
            <td>{{item.CreateUser}}</td>
            <td>{{item.Verifier | formatValue}}</td>
            <td>{{item.CheckStatus | formatCheckStatus}}</td>
        </tr>
    </table>
    <div style="margin-top:20px;">
        <span>
            每页显示:
            <select v-model="pager.size">
                <option v-for="size in sizes" v-bind:value="size">{{size}}</option>
            </select>
            条
        </span>
        <span>
            <button type="button" v-on:click="pager.currentPage=1" v-bind:disabled="pager.currentPage<=1">首页</button>
            <button type="button" v-on:click="pager.currentPage-=1" v-bind:disabled="pager.currentPage<=1">上一页</button>
            <button type="button" v-on:click="pager.currentPage+=1" v-bind:disabled="pager.currentPage>=pager.pages">下一页</button>
            <button type="button" v-on:click="pager.currentPage=pager.pages" v-bind:disabled="pager.currentPage>=pager.pages">尾页</button>
        </span>
        <span style="float:right">
            <span>当前第{{pager.currentPage}}页/共{{pager.pages}}页&nbsp;&nbsp;转到<input style="width:30px" type="text" v-model="pager.inputPage">页</span>
            <button type="button" v-on:click="pager.currentPage=pager.inputPage" v-bind:disabled="pager.inputPage<=0 || pager.inputPage>pager.pages">确定</button>
        </span>
    </div>
</div>
<script type="text/javascript" src="~/Scripts/vue.min.js"></script>
<script type="text/javascript" src="~/Content/My97DatePicker/WdatePicker.js"></script>
<script src="/Scripts/artDialog6.0.4/dist/dialog-min.js"></script>
<script src="/Scripts/artDialog6.0.4/dist/dialog-plus-min.js"></script>
<script type="text/javascript">
    function formatCheckStatus(value) {
        var result = "无";
        switch (value) {
            case 1:
                result = "待审核";
                break;
            case 2:
                result = "拒绝";
                break;
            case 3:
                result = "待财务操作";
                break;
            case 4:
                result = "成功";
                break;
        }
        return result;
    }
    Vue.filter('formatCheckStatus', formatCheckStatus);
    var vue = new Vue({
        el: "#div",
        data: {
            pager: {
                total: 0,
                pages: 0,
                currentPage: 1,
                size: 20,
                inputPage: 0,
            },
            users: [],
            loading: false,
            list: [],
            sizes: [5, 10, 20, 40, 50, 100, 200],
            filterCondition: {
                startTime: "",
                endTime: "",
                orderType: "None"
            },
        },
        watch: {
            "pager.total": function () {
                var self = this;
                self.pager.pages = Math.ceil(self.pager.total / self.pager.size);
            },
            "pager.size": function () {
                var self = this;
                if (self.pager.size <= 0) {
                    self.pager.size = 1;
                    return;
                }
                if (self.pager.size > 200) {
                    self.pager.size = 200;
                    return;
                }
                self.pager.pages = Math.ceil(self.pager.total / self.pager.size);
                this.Init();
            },
            "pager.currentPage": function () {
                var self = this;
                if (self.pager.currentPage <= 0) {
                    self.pager.currentPage = 1;
                    return;
                }
                if (self.pager.pages > 1 && self.pager.currentPage > self.pager.pages) {
                    self.pager.currentPage = self.pager.pages;
                    return;
                }
                self.Init();
            },
        },
        created: function () {
            this.Init();
        },
        methods: {
            Init: function () {
                var self = this;
                self.loading = true;
                self.list = [];
                self.filterCondition.startTime = $(".startTime").val();
                self.filterCondition.endTime = $(".endTime").val();
                $.get("SelectCarsAffairsLog", {
                    orderType: self.filterCondition.orderType,
                    startTime: self.filterCondition.startTime, endTime: self.filterCondition.endTime,
                    pageIndex: self.pager.currentPage, pageSize: self.pager.size
                }, function (result) {
                    self.loading = false;
                    self.list = result;
                    self.pager.total = result.length > 0 ? result[0].Total : 0;
                });
            },
        },
    });
</script>
