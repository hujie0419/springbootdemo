@model Tuhu.Provisioning.DataAccess.Entity.RecommendGetGiftConfig
@using System.Linq
@{
    Layout = null;
}
<script src="~/Scripts/UEditor/ueditor.config.js"></script>
<script src="~/Scripts/UEditor/ueditor.all.min.js"></script>
<script src="~/Scripts/UEditor/lang/zh-cn/zh-cn.js"></script>
<style>
    .btn {
        margin-top: 20px;
        padding: 5px 25px;
        border: none;
        color: #F0F0F0;
        font-size: 12px;
        outline: none;
        cursor: pointer;
        background: cornflowerblue;
        border-color: cornflowerblue;
    }

    a {
        color: cornflowerblue;
    }

    input[type=text] {
        width: 120px;
    }

    input[type=number] {
        width: 50px;
    }
</style>
<script src="../../Scripts/ajaxfileupload.js" type="text/javascript"></script>
<script src="~/Scripts/UEditor/ueditor.config.js"></script>
<script src="~/Scripts/UEditor/ueditor.all.min.js"></script>
<script src="~/Scripts/UEditor/lang/zh-cn/zh-cn.js"></script>
<form action="/RecommendGetGiftConfig/Edit" method="post">
    <input type="hidden" value="@Model.Id" name="Id" />
    <input type="hidden" value="@Model.TabName" name="TabName"/>
    <div>
        <table style="display:none">
            <tr>
                <td style="width:30%">名称</td>
                <td style="width:70%">
                    <input type="text" value="@Model.Name" name="Name" />
                </td>
            </tr>
            <tr>
                <td>背景图</td>
                <td>
                    <img height="50" class="vwPicture" src="@Model.Banner" />
                    <form method="post" action="" enctype="multipart/form-data">
                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="1" name="1" />
                    </form>
                    <br />
                    <input type="text" name="Banner" class="image" value="@Model.Banner" />
                </td>
            </tr>
            <tr>
                <td>分享模式</td>
                <td>
                    <input type="radio" value="0" name="IsSendCode" @((Model.IsSendCode??false) ? "" : "checked='checked'") />普通分享<br />
                    <input type="radio" value="1" name="IsSendCode" @((Model.IsSendCode??false) ? "checked='checked'" : "") />发码分享     人群编号<input type="text" id="userGroupId" name="userGroupId" value="@Model.UserGroupId" />
                </td>
            </tr>
            <tr>
                <td>每天首次分享积分奖励额度</td>
                <td><input type="number" value="@Model.AwardLimit" name="AwardLimit" /></td>
            </tr>

            <tr>
                <td>用户下单奖励</td>
                <td>
                    <select id="AwardType" name="AwardType">
                        @if (Model.AwardType.Trim() == "Coupon")
                        {
                            <option value="Coupon" selected="selected">优惠券</option>
                            <option value="Point">定额积分</option>
                            <option value="Times">订单金额倍数积分奖励</option>
                        }
                        else if (Model.AwardType.Trim() == "Point")
                        {
                            <option value="Coupon">优惠券</option>
                            <option value="Point" selected="selected">定额积分</option>
                            <option value="Times">订单金额倍数积分奖励</option>
                        }
                        else if (Model.AwardType.Trim() == "Times")
                        {
                            <option value="Coupon">优惠券</option>
                            <option value="Point">定额积分</option>
                            <option value="Times" selected="selected">订单金额倍数积分奖励</option>
                        }
                        else
                        {
                            <option value="Point">定额积分</option>
                            <option value="Coupon">优惠券</option>
                            <option value="Times">订单金额倍数积分奖励</option>
                        }

                    </select>

                </td>
            </tr>
            <tr>
                <td>用户下单奖励值</td>
                <td>
                    <input type="number" value="@Model.AwardValue" min="0" name="AwardValue" id="AwardValue" /><br />
                    <label style="color:red">当用户下单奖励为(订单金额积分倍数奖励)：最高为20，支持倍数后一位小数</label><br />
                    <label style="color:red">当用户下单奖励为(定额积分)：输入奖励积分数，不能小于0</label>
                </td>
            </tr>
            <tr>
                <td>优惠券GUID</td>
                <td>
                    @{
                        string[] coupons = new string[] { "" };
                        if (!string.IsNullOrWhiteSpace(Model.GetRuleGUID))
                        {
                            coupons = Model.GetRuleGUID.Split(',');
                        }

                    }

                    <input type="text" value="@(coupons.Length>=1?coupons[0]:"")" class="GetRuleGUID" /><br />
                    <input type="text" value="@(coupons.Length>=2?coupons[1]:"")" class="GetRuleGUID" /><br />
                    <input type="text" value="@(coupons.Length>=3?coupons[2]:"")" class="GetRuleGUID" /><br />
                    <input type="text" value="@(coupons.Length>=4?coupons[3]:"")" class="GetRuleGUID" /><br />
                    <input type="text" value="@(coupons.Length>=5?coupons[4]:"")" class="GetRuleGUID" /><br />
                    <label style="color:red">当用户下单奖励为(优惠券)：输入优惠券ID或GUID</label>
                </td>
            </tr>
            <tr>
                <td style="width:35%"><span class="hint"></span>配置开始生效时间：<input type="text" id="StartTime" name="StartTime" readonly="readonly" value="@Model.StartTime" /></td>
                <td><span class="hint"></span>配置结束生效时间：<input type="text" id="EndTime" name="EndTime" readonly="readonly" value="@Model.EndTime" /></td>
            </tr>
            <tr>
                <td>推荐新用户完成注册文案</td>
                <td>
                    <input type="text" value="@Model.RegisteredText" name="RegisteredText" />
                </td>
            </tr>
            <tr>
                <td>推荐的新用户完成订单的奖励到账</td>
                <td>
                    <input type="text" value="@Model.AwardedText" name="AwardedText" />
                </td>
            </tr>
            <tr>
                <td>分享按钮文案</td>
                <td>
                    <input type="text" value="@Model.ShareButtonValue" name="ShareButtonValue" />
                </td>

            </tr>
        </table>
        <table>
            <thead>
                <tr>
                    <td>分享渠道</td>
                    <td>
                        缩略图
                    </td>
                    <td>标题</td>
                    <td>描述</td>
                    <td>url</td>
                    <td>选择</td>
                    <td>顺序</td>
                    <td>类型</td>
                    <td>背景图</td>
                </tr>
            </thead>
            <tbody>
                @if (!string.IsNullOrWhiteSpace(Model.ShareChannel) && Model.ShareChannel != null)
                {
                    foreach (var item in Model.Channel)
                    {
                        if (item.key == "onMenuShareAppMessage")
                        {
                            <tr id="onMenuShareAppMessage">
                                <td>微信好友</td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="3" name="3" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareImage" class="image" />
                                </td>
                                <td><input type="text" value="@item.data.shareTitle" class="title" /></td>
                                <td>
                                    <input type="text" value="@item.data.shareDescrip" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="@item.data.shareUrl" class="url" />
                                </td>
                                <td>
                                    @if (item.status)
                                    {
                                        <input type="checkbox" checked="checked" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" />
                                    }

                                </td>
                                <td><input type="number" value="@item.data.shareSort" class="sort" /></td>
                                <td>
                                    <select>
                                        @if (item.data.shareType == "link")
                                        {
                                            <option value="link" selected="selected">链接</option>
                                            <option value="img">图片</option>
                                        }
                                        else
                                        {
                                            <option value="link">链接</option>
                                            <option value="img" selected="selected">图片</option>
                                        }

                                    </select>
                                </td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareBgImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="30" name="30" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareBgImage" class="image"  />
                                </td>
                            </tr>
                        }

                        if (item.key == "onMenuShareTimeline")
                        {
                            <tr id="onMenuShareTimeline">
                                <td>微信朋友圈</td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="4" name="4" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareImage" class="image" />
                                </td>
                                <td><input type="text" value="@item.data.shareTitle" class="title" /></td>
                                <td>
                                    <input type="text" value="@item.data.shareDescrip" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="@item.data.shareUrl" class="url" />
                                </td>
                                <td>
                                    @if (item.status)
                                    {
                                        <input type="checkbox" checked="checked" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" />
                                    }

                                </td>
                                <td><input type="number" value="@item.data.shareSort" class="sort" /></td>
                                <td>
                                    <select>
                                        @if (item.data.shareType == "link")
                                        {
                                            <option value="link" selected="selected">链接</option>
                                            <option value="img">图片</option>
                                        }
                                        else
                                        {
                                            <option value="link">链接</option>
                                            <option value="img" selected="selected">图片</option>
                                        }

                                    </select>
                                </td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareBgImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="40" name="40" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareBgImage" class="image" />
                                </td>
                            </tr>
                        }

                        if (item.key == "onMenuShareQQ")
                        {
                            <tr id="onMenuShareQQ">
                                <td>QQ好友</td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="5" name="5" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareImage" class="image" />
                                </td>
                                <td><input type="text" value="@item.data.shareTitle" class="title" /></td>
                                <td>
                                    <input type="text" value="@item.data.shareDescrip" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="@item.data.shareUrl" class="url" />
                                </td>
                                <td>
                                    @if (item.status)
                                    {
                                        <input type="checkbox" checked="checked" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" />
                                    }

                                </td>
                                <td><input type="number" value="@item.data.shareSort" class="sort" /></td>
                                <td>
                                    <select>
                                        @if (item.data.shareType == "link")
                                        {
                                            <option value="link" selected="selected">链接</option>
                                            <option value="img">图片</option>
                                        }
                                        else
                                        {
                                            <option value="link">链接</option>
                                            <option value="img" selected="selected">图片</option>
                                        }

                                    </select>
                                </td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareBgImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="50" name="50" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareBgImage" class="image" />
                                </td>
                            </tr>
                        }

                        if (item.key == "onMenuShareQZone")
                        {
                            <tr id="onMenuShareQZone">
                                <td>QQ空间</td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="6" name="6" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareImage" class="image" />
                                </td>
                                <td><input type="text" value="@item.data.shareTitle" class="title" /></td>
                                <td>
                                    <input type="text" value="@item.data.shareDescrip" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="@item.data.shareUrl" class="url" />
                                </td>
                                <td>
                                    @if (item.status)
                                    {
                                        <input type="checkbox" checked="checked" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" />
                                    }

                                </td>
                                <td><input type="number" value="@item.data.shareSort" class="sort" /></td>
                                <td>
                                    <select>
                                        @if (item.data.shareType == "link")
                                        {
                                            <option value="link" selected="selected">链接</option>
                                            <option value="img">图片</option>
                                        }
                                        else
                                        {
                                            <option value="link">链接</option>
                                            <option value="img" selected="selected">图片</option>
                                        }

                                    </select>
                                </td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareBgImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="60" name="60" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareBgImage" class="image" />
                                </td>
                            </tr>
                        }

                        if (item.key == "onMenuShareWeibo")
                        {
                            <tr id="onMenuShareWeibo">
                                <td>新浪微博</td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="7" name="7" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareImage" class="image" />
                                </td>
                                <td><input type="text" value="@item.data.shareTitle" class="title" /></td>
                                <td>
                                    <input type="text" value="@item.data.shareDescrip" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="@item.data.shareUrl" class="url" />
                                </td>
                                <td>
                                    @if (item.status)
                                    {
                                        <input type="checkbox" checked="checked" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" />
                                    }

                                </td>
                                <td><input type="number" value="@item.data.shareSort" class="sort" /></td>
                                <td>
                                    <select>
                                        @if (item.data.shareType == "link")
                                        {
                                            <option value="link" selected="selected">链接</option>
                                            <option value="img">图片</option>
                                        }
                                        else
                                        {
                                            <option value="link">链接</option>
                                            <option value="img" selected="selected">图片</option>
                                        }

                                    </select>
                                </td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareBgImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="70" name="70" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareBgImage" class="image" />
                                </td>
                            </tr>
                        }
                        if (item.key == "onMessage")
                        {
                            <tr id="onMessage">
                                <td>短信</td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="28" name="28" />
                                    </form>
                                    <br />
                                    <input type="text"   class="image" value="@item.data.shareImage"/>
                                </td>
                                <td><input type="text"  value="@item.data.shareTitle" class="title" /></td>
                                <td>
                                    <input type="text" value="@item.data.shareDescrip" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="@item.data.shareUrl" class="url" />
                                </td>
                                <td>
                                    @if (item.status)
                                    {
                                        <input type="checkbox" checked="checked" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" />
                                    }

                                </td>
                                <td><input type="number" value="@item.data.shareSort" class="sort" /></td>
                                <td>
                                    <select>
                                        <option value="link" selected="selected">链接</option>
                                    </select>
                                </td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareBgImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="280" name="280" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareBgImage" class="image" />
                                </td>
                            </tr>
                        }
                        if (item.key == "onLink")
                        {
                            <tr id="onLink">
                                <td>复制链接</td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg(this)" id="29" name="29" />
                                    </form>
                                    <br />
                                    <input type="text"  class="image" value="@item.data.shareImage" />
                                </td>
                                <td><input type="text"  value="@item.data.shareTitle" class="title" /></td>
                                <td>
                                    <input type="text"  value="@item.data.shareDescrip" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="@item.data.shareUrl" class="url" />
                                </td>
                                <td>
                                    @if (item.status)
                                    {
                                        <input type="checkbox" checked="checked" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" />
                                    }

                                </td>
                                <td><input type="number" value="@item.data.shareSort" class="sort" /></td>
                                <td>
                                    <select>
                                        <option value="link" selected="selected">链接</option>
                                    </select>
                                </td>
                                <td>
                                    <img height="50" class="vwPicture" src="@item.data.shareBgImage" />
                                    <form method="post" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="290" name="290" />
                                    </form>
                                    <br />
                                    <input type="text" value="@item.data.shareBgImage" class="image" />
                                </td>
                            </tr>
                        }
                    }
                    if (!Model.Channel.Any(x => x.key == "onLink")&& !Model.Channel.Any(x => x.key == "onMessage"))
                    {
                        <tr id="onMessage">
                            <td>短信</td>
                            <td>
                                <img height="50" class="vwPicture" src="" />
                                <form method="post" action="" enctype="multipart/form-data">
                                    <input style="width:150px;" type="file" id="25" name="25" />
                                </form>
                                <br />
                                <input type="text" disabled="disabled" value="" class="image" />
                            </td>
                            <td><input type="text" disabled="disabled" value="" class="title" /></td>
                            <td>
                                <input type="text" value="" class="content" />
                            </td>
                            <td>
                                <input type="text" value="" class="url" />
                            </td>
                            <td>
                                <input type="checkbox" />
                            </td>
                            <td><input type="number" class="sort" /></td>
                            <td>
                                <select>
                                    <option value="link">链接</option>

                                </select>
                            </td>
                            <td>
                                <img height="50" class="vwPicture" src="" />
                                <form method="post" action="" enctype="multipart/form-data">
                                    <input style="width:150px;" type="file" id="250" name="250" />
                                </form>
                                <br />
                                <input type="text" disabled="disabled" value="" class="image" />
                            </td>
                        </tr>
                        <tr id="onLink">
                                <td>复制链接</td>
                                <td>
                                    <img height="50" class="vwPicture" src="" />
                                    <form method="post" disabled="disabled" action="" enctype="multipart/form-data">
                                        <input style="width:150px;" type="file" id="26" name="26" />
                                    </form>
                                    <br />
                                    <input type="text" disabled="disabled" value="" class="image" />
                                </td>
                                <td><input type="text" disabled="disabled" value="" class="title" /></td>
                                <td>
                                    <input type="text" disabled="disabled" value="" class="content" />
                                </td>
                                <td>
                                    <input type="text" value="" class="url" />
                                </td>
                                <td>
                                    <input type="checkbox" />
                                </td>
                                <td><input type="number" class="sort" /></td>
                            <td>
                                <select>
                                    <option value="link">链接</option>
                                </select>
                            </td>
                            <td>
                                <img height="50" class="vwPicture" src="" />
                                <form method="post" disabled="disabled" action="" enctype="multipart/form-data">
                                    <input style="width:150px;" type="file" id="260" name="260" />
                                </form>
                                <br />
                                <input type="text" disabled="disabled" value="" class="image" />
                            </td>
                            </tr>
                    }
                }
                else
                {
                    <tr id="onMenuShareAppMessage">
                        <td>微信好友</td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg(this)" id="9" name="9" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                        <td><input type="text" value="" class="title" /></td>
                        <td>
                            <input type="text" value="" class="content" />
                        </td>
                        <td>
                            <input type="text" value="" class="url" />
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td><input type="number" class="sort" /></td>
                        <td>
                            <select>
                                <option value="link">链接</option>
                                <option value="img">图片</option>
                            </select>
                        </td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="90" name="90" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                    </tr>

                    <tr id="onMenuShareTimeline">
                        <td>微信朋友圈</td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg(this)" id="10" name="10" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                        <td><input type="text" value="" class="title" /></td>
                        <td>
                            <input type="text" value="" class="content" />
                        </td>
                        <td>
                            <input type="text" value="" class="url" />
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td><input type="number" class="sort" /></td>
                        <td>
                            <select>
                                <option value="link">链接</option>
                                <option value="img">图片</option>
                            </select>
                        </td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="100" name="100" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                    </tr>

                    <tr id="onMenuShareQQ">
                        <td>QQ好友</td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg(this)" id="11" name="11" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                        <td><input type="text" value="" class="title" /></td>
                        <td>
                            <input type="text" value="" class="content" />
                        </td>
                        <td>
                            <input type="text" value="" class="url" />
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td><input type="number" class="sort" /></td>
                        <td>
                            <select>
                                <option value="link">链接</option>
                                <option value="img">图片</option>
                            </select>
                        </td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="110" name="110" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                    </tr>

                    <tr id="onMenuShareQZone">
                        <td>QQ空间</td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg(this)" id="13" name="13" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                        <td><input type="text" value="" class="title" /></td>
                        <td>
                            <input type="text" value="" class="content" />
                        </td>
                        <td>
                            <input type="text" value="" class="url" />
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td><input type="number" class="sort" /></td>
                        <td>
                            <select>
                                <option value="link">链接</option>
                                <option value="img">图片</option>
                            </select>
                        </td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="130" name="130" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                    </tr>

                    <tr id="onMenuShareWeibo">
                        <td>新浪微博</td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg(this)" id="14" name="14" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                        <td><input type="text" value="" class="title" /></td>
                        <td>
                            <input type="text" value="" class="content" />
                        </td>
                        <td>
                            <input type="text" value="" class="url" />
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td><input type="number" class="sort" /></td>
                        <td>
                            <select>
                                <option value="link">链接</option>
                                <option value="img">图片</option>
                            </select>
                        </td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" onchange="UploadImg2(this)" id="140" name="140" />
                            </form>
                            <br />
                            <input type="text" value="" class="image" />
                        </td>
                    </tr>
                    <tr id="onMessage">
                        <td>短信</td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" id="25" name="25" />
                            </form>
                            <br />
                            <input type="text" disabled="disabled" value="" class="image" />
                        </td>
                        <td><input type="text" disabled="disabled" value="" class="title" /></td>
                        <td>
                            <input type="text" value="" class="content" />
                        </td>
                        <td>
                            <input type="text" value="" class="url" />
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td><input type="number" class="sort" /></td>
                        <td>
                            <select>
                                <option value="link">链接</option>

                            </select>
                        </td>
                    </tr>
                    <tr id="onLink">
                        <td>复制链接</td>
                        <td>
                            <img height="50" class="vwPicture" src="" />
                            <form method="post" disabled="disabled" action="" enctype="multipart/form-data">
                                <input style="width:150px;" type="file" id="26" name="26" />
                            </form>
                            <br />
                            <input type="text" disabled="disabled" value="" class="image" />
                        </td>
                        <td><input type="text" disabled="disabled" value="" class="title" /></td>
                        <td>
                            <input type="text" disabled="disabled" value="" class="content" />
                        </td>
                        <td>
                            <input type="text" value="" class="url" />
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td><input type="number" class="sort" /></td>
                        <td>
                            <select>
                                <option value="link">链接</option>
                            </select>
                        </td>
                    </tr>
                }

            </tbody>
        </table>

        <table style="display:none;">
            <tbody>
                <tr>
                    <td>活动规则</td>
                </tr>
                <tr>
                    <td>
                        <textarea id="editor" name="editor"></textarea>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <input type="button" value="保存" class="btn" onclick="saveModel()" />
    </div>

</form>
<script>

    $(".GetRuleGUID").blur(function () {
        var t=$(this);
        $.ajax({
            type: "POST",
            url: "/RecommendGetGiftConfig/GetCoupon",
            data: {
                "guidOrId": t.val()
            },
            dataType: "JSON",
            success: function (result) {
                if (result) {
                    t.val(result.GetRuleGUID);

                }else{
                    t.val("");
                }
            },
            error: function (result) {

            }
        });
    })

    var ueditor_recommend = UE.getEditor('editor_recommend', {
        UEDITOR_HOME_URL: "/Scripts/UEditor/",
        allowDivTransToP: false,
        autoHeightEnabled: false,
        initialFrameWidth: 650,
        initialFrameHeight: 250,
        zIndex: 1000,
        enterTag: ''
    });

    var ueditor_convene = UE.getEditor('editor_convene', {
        UEDITOR_HOME_URL: "/Scripts/UEditor/",
        allowDivTransToP: false,
        autoHeightEnabled: false,
        initialFrameWidth: 650,
        initialFrameHeight: 250,
        zIndex: 1000,
        enterTag: ''
    });

    //$("#AwardType").change(function(){
    //    if ($("#AwardType").val()=="Coupon") {
    //        $("#AwardValue").attr("disabled","disabled");
    //    }else{
    //        $("#GetRuleGUID").attr("disabled","disabled");
    //    }
    //})
    $(function () {

        //if ($("#AwardType").val()!="Coupon") {
        //    $("#GetRuleGUID").attr("disabled","disabled");
        //}else{
        //    $("#AwardValue").attr("disabled","disabled");
        //}
        if(@Model.Id!=0){
            ueditor_recommend.addListener( 'ready', function() {
                ueditor_recommend.setContent(decodeURIComponent('@Model.Rules'), "");
            });

            ueditor_convene.addListener( 'ready', function() {
                ueditor_convene.setContent(decodeURIComponent('@Model.TimeLimitCollectRules'), "");
            } );
        }
    })
    function saveModel() {
        var onMenuShareTimelineUrl=$.trim($("#onMenuShareTimeline").find("td").eq(4).find(".url").val());
        if (onMenuShareTimelineUrl.length>0) {
            if (onMenuShareTimelineUrl.indexOf("http")>=0) {
                onMenuShareTimelineUrl=onMenuShareTimelineUrl.indexOf("?")<0?onMenuShareTimelineUrl+"?v=1":onMenuShareTimelineUrl;
            }else{
                alert("微信朋友圈分享url不正确！");
                return false;
            }

        }else{
            onMenuShareTimelineUrl="";
        }
        var onMenuShareAppMessageUrl=$.trim($("#onMenuShareAppMessage").find("td").eq(4).find(".url").val());
        if (onMenuShareAppMessageUrl.length>0) {
            if (onMenuShareAppMessageUrl.indexOf("http")>=0) {
                onMenuShareAppMessageUrl=onMenuShareAppMessageUrl.indexOf("?")<0?onMenuShareAppMessageUrl+"?v=1":onMenuShareAppMessageUrl;
            }else{
                alert("微信好友分享url不正确！");
                return false;
            }

        }else{
            onMenuShareAppMessageUrl="";
        }

        var onMenuShareQQUrl =$.trim($("#onMenuShareQQ").find("td").eq(4).find(".url").val());
        if (onMenuShareQQUrl.length>0) {
            if (onMenuShareQQUrl.indexOf("http")>=0) {
                onMenuShareQQUrl=onMenuShareQQUrl.indexOf("?")<0?onMenuShareQQUrl+"?v=1":onMenuShareQQUrl;
            }else{
                alert("QQ好友分享url不正确！");
                return false;
            }

        }else{
            onMenuShareQQUrl="";
        }

        var onMenuShareWeiboUrl =$.trim($("#onMenuShareWeibo").find("td").eq(4).find(".url").val());
        if (onMenuShareWeiboUrl.length>0) {
            if (onMenuShareWeiboUrl.indexOf("http")>=0) {
                onMenuShareWeiboUrl=onMenuShareWeiboUrl.indexOf("?")<0?onMenuShareWeiboUrl+"?v=1":onMenuShareWeiboUrl;
            }else{
                alert("新浪微博分享url不正确！");
                return false;
            }

        }else{
            onMenuShareWeiboUrl="";
        }

        var onMenuShareQZoneUrl =$.trim($("#onMenuShareQZone").find("td").eq(4).find(".url").val());
        if (onMenuShareQZoneUrl.length>0) {
            if (onMenuShareQZoneUrl.indexOf("http")>=0) {
                onMenuShareQZoneUrl=onMenuShareQZoneUrl.indexOf("?")<0?onMenuShareQZoneUrl+"?v=1":onMenuShareQZoneUrl;
            }else{
                alert("QQ空间分享url不正确！");
                return false;
            }

        }else{
            onMenuShareQZoneUrl="";
        }
       if($("input[name='IsSendCode']:checked").val()==1)
       {
           if ($("#onMenuShareTimeline").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"&&$("#onMenuShareTimeline").find("td").eq(8).find(".image").val().length<=0) {
               alert("微信朋友圈分享背景图需要配置！");
               return false;
           }
           if ($("#onMenuShareAppMessage").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"&&$("#onMenuShareAppMessage").find("td").eq(8).find(".image").val().length<=0) {
               alert("微信好友分享背景图需要配置！");
               return false;
           }
           if ($("#onMenuShareQQ").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"&&$("#onMenuShareQQ").find("td").eq(8).find(".image").val().length<=0) {
               alert("QQ好友分享背景图需要配置！");
               return false;
           }
           if ($("#onMenuShareWeibo").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"&&$("#onMenuShareWeibo").find("td").eq(8).find(".image").val().length<=0) {
               alert("新浪微博分享背景图需要配置！");
               return false;
           }
           if ($("#onMenuShareQZone").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"&&$("#onMenuShareQZone").find("td").eq(8).find(".image").val().length<=0) {
               alert("QQ空间分享背景图需要配置！");
               return false;
           }
           if ($("#onMessage").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"&&$("#onMessage").find("td").eq(8).find(".image").val().length<=0) {
               alert("短信分享背景图需要配置！");
               return false;
           }
           if ($("#onLink").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"&&$("#onLink").find("td").eq(8).find(".image").val().length<=0) {
               alert("复制链接分享背景图需要配置！");
               return false;
           }
       }


        var channel = [
                        {
                            "status": $("#onMenuShareTimeline").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"?true:false,
                            "key": "onMenuShareTimeline",
                            "data": {
                                "shareImage": $("#onMenuShareTimeline").find("td").eq(1).find(".image").val()?$("#onMenuShareTimeline").find("td").eq(1).find(".image").val():"",
                                "shareBgImage": $("#onMenuShareTimeline").find("td").eq(8).find(".image").val()?$("#onMenuShareTimeline").find("td").eq(8).find(".image").val():"",
                                "shareTitle": $("#onMenuShareTimeline").find("td").eq(2).find(".title").val()?$("#onMenuShareTimeline").find("td").eq(2).find(".title").val():"",
                                "shareDescrip":$("#onMenuShareTimeline").find("td").eq(3).find(".content").val()?$("#onMenuShareTimeline").find("td").eq(3).find(".content").val():"",
                                "shareUrl":onMenuShareTimelineUrl,
                                "shareSort":$("#onMenuShareTimeline").find("td").eq(6).find(".sort").val()?$("#onMenuShareTimeline").find("td").eq(6).find(".sort").val():0,
                                "shareType":$("#onMenuShareTimeline").find("td").eq(7).find("select").val()
                            }
                        },
                        {
                            "status": $("#onMenuShareAppMessage").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"?true:false,
                            "key": "onMenuShareAppMessage",
                            "data": {
                                "shareImage": $("#onMenuShareAppMessage").find("td").eq(1).find(".image").val()?$("#onMenuShareAppMessage").find("td").eq(1).find(".image").val():"",
                                "shareBgImage": $("#onMenuShareAppMessage").find("td").eq(8).find(".image").val()?$("#onMenuShareAppMessage").find("td").eq(8).find(".image").val():"",
                                "shareTitle": $("#onMenuShareAppMessage").find("td").eq(2).find(".title").val()?$("#onMenuShareAppMessage").find("td").eq(2).find(".title").val():"",
                                "shareDescrip":  $("#onMenuShareAppMessage").find("td").eq(3).find(".content").val()?$("#onMenuShareAppMessage").find("td").eq(3).find(".content").val():"",
                                "shareUrl": onMenuShareAppMessageUrl,
                                "shareSort":$("#onMenuShareAppMessage").find("td").eq(6).find(".sort").val()?$("#onMenuShareAppMessage").find("td").eq(6).find(".sort").val():0,
                                "shareType":$("#onMenuShareAppMessage").find("td").eq(7).find("select").val()
                            }
                        },
                        {
                            "status": $("#onMenuShareQQ").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"?true:false,
                            "key": "onMenuShareQQ",
                            "data": {
                                "shareImage": $("#onMenuShareQQ").find("td").eq(1).find(".image").val()?$("#onMenuShareQQ").find("td").eq(1).find(".image").val():"",
                                "shareBgImage": $("#onMenuShareQQ").find("td").eq(8).find(".image").val()?$("#onMenuShareQQ").find("td").eq(8).find(".image").val():"",
                                "shareTitle": $("#onMenuShareQQ").find("td").eq(2).find(".title").val()?$("#onMenuShareQQ").find("td").eq(2).find(".title").val():"",
                                "shareDescrip": $("#onMenuShareQQ").find("td").eq(3).find(".content").val()?$("#onMenuShareQQ").find("td").eq(3).find(".content").val():"",
                                "shareUrl": onMenuShareQQUrl,
                                "shareSort":$("#onMenuShareQQ").find("td").eq(6).find(".sort").val()?$("#onMenuShareQQ").find("td").eq(6).find(".sort").val():0,
                                "shareType":$("#onMenuShareQQ").find("td").eq(7).find("select").val()
                            }
                        },
                        {
                            "status": $("#onMenuShareWeibo").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"?true:false,
                            "key": "onMenuShareWeibo",
                            "data": {
                                "shareImage": $("#onMenuShareWeibo").find("td").eq(1).find(".image").val()?$("#onMenuShareWeibo").find("td").eq(1).find(".image").val():"",
                                "shareBgImage": $("#onMenuShareWeibo").find("td").eq(8).find(".image").val()?$("#onMenuShareWeibo").find("td").eq(8).find(".image").val():"",
                                "shareTitle": $("#onMenuShareWeibo").find("td").eq(2).find(".title").val()?$("#onMenuShareWeibo").find("td").eq(2).find(".title").val():"",
                                "shareDescrip": $("#onMenuShareWeibo").find("td").eq(3).find(".content").val()? $("#onMenuShareWeibo").find("td").eq(3).find(".content").val():"",
                                "shareUrl": onMenuShareWeiboUrl,
                                "shareSort":$("#onMenuShareWeibo").find("td").eq(6).find(".sort").val()?$("#onMenuShareWeibo").find("td").eq(6).find(".sort").val():0,
                                "shareType":$("#onMenuShareWeibo").find("td").eq(7).find("select").val()
                            }
                        },
                        {
                            "status": $("#onMenuShareQZone").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"?true:false,
                            "key": "onMenuShareQZone",
                            "data": {
                                "shareImage": $("#onMenuShareQZone").find("td").eq(1).find(".image").val()?$("#onMenuShareQZone").find("td").eq(1).find(".image").val():"",
                                "shareBgImage": $("#onMenuShareQZone").find("td").eq(8).find(".image").val()?$("#onMenuShareQZone").find("td").eq(8).find(".image").val():"",
                                "shareTitle": $("#onMenuShareQZone").find("td").eq(2).find(".title").val()?$("#onMenuShareQZone").find("td").eq(2).find(".title").val():"",
                                "shareDescrip": $("#onMenuShareQZone").find("td").eq(3).find(".content").val()?$("#onMenuShareQZone").find("td").eq(3).find(".content").val():"",
                                "shareUrl": onMenuShareQZoneUrl,
                                "shareSort":$("#onMenuShareQZone").find("td").eq(6).find(".sort").val()?$("#onMenuShareQZone").find("td").eq(6).find(".sort").val():0,
                                "shareType":$("#onMenuShareQZone").find("td").eq(7).find("select").val()
                            }
                        },
                        {
                            "status": $("#onMessage").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"?true:false,
                            "key": "onMessage",
                            "data": {
                                "shareImage": $("#onMessage").find("td").eq(1).find(".image").val()?$("#onMessage").find("td").eq(1).find(".image").val():"",
                                "shareBgImage": $("#onMessage").find("td").eq(8).find(".image").val()?$("#onMessage").find("td").eq(8).find(".image").val():"",
                                "shareTitle": $("#onMessage").find("td").eq(2).find(".title").val()?$("#onMessage").find("td").eq(2).find(".title").val():"",
                                "shareDescrip": $("#onMessage").find("td").eq(3).find(".content").val()?$("#onMessage").find("td").eq(3).find(".content").val():"",
                                "shareUrl": onMenuShareQZoneUrl,
                                "shareSort":$("#onMessage").find("td").eq(6).find(".sort").val()?$("#onMessage").find("td").eq(6).find(".sort").val():0,
                                "shareType":$("#onMessage").find("td").eq(7).find("select").val()
                            }
                        },
                        {
                            "status": $("#onLink").find("td").eq(5).find("input[type=checkbox]").attr("checked")=="checked"?true:false,
                            "key": "onLink",
                            "data": {
                                "shareImage": $("#onLink").find("td").eq(1).find(".image").val()?$("#onLink").find("td").eq(1).find(".image").val():"",
                                "shareBgImage": $("#onLink").find("td").eq(8).find(".image").val()?$("#onLink").find("td").eq(8).find(".image").val():"",
                                "shareTitle": $("#onLink").find("td").eq(2).find(".title").val()?$("#onLink").find("td").eq(2).find(".title").val():"",
                                "shareDescrip": $("#onLink").find("td").eq(3).find(".content").val()?$("#onLink").find("td").eq(3).find(".content").val():"",
                                "shareUrl": onMenuShareQZoneUrl,
                                "shareSort":$("#onLink").find("td").eq(6).find(".sort").val()?$("#onLink").find("td").eq(6).find(".sort").val():0,
                                "shareType":$("#onLink").find("td").eq(7).find("select").val()
                            }
                        }
        ];
        var awardValue=0;
        if ($("#AwardType").val()=="Times") {
            var val=$("input[name='AwardValue']").val();
            var sp1=val.toString().split(".")[1]||"1";
            if (val<0||val>20||sp1.length>1) {
                alert("用户下单奖励倍数不能小于0 且不能大于20且小数点后只有一位")
                return false;
            }else{
                AwardValue=val;
            }

        }else{
            var val=$("input[name='AwardValue']").val();
            if (val<0) {
                alert("积分奖励值不能小于0")
                return false;
            }else{
                AwardValue=val;
            }

        }

        var coupons="";
        $(".GetRuleGUID").each(function(i){
            if ($(this).val()) {
                coupons+=$(this).val()+",";
            }
        })
        var dataStr = {
            "Id": $("input:[name='Id']").val(),
            "Name": $("input:[name='Name']").val(),
            "Banner": $("input[name='Banner']").val(),
            "AwardLimit": $("input[name='AwardLimit']").val(),
            "AwardType": $("#AwardType").val(),
            "AwardValue":AwardValue ,
            "GetRuleGUID":coupons,
            "RegisteredText": $("input[name='RegisteredText']").val(),
            "AwardedText": $("input[name='AwardedText']").val(),
            "ShareButtonValue": $("input[name='ShareButtonValue']").val(),
            "ShareChannel": JSON.stringify(channel),
            "Rules": encodeURIComponent(ueditor_recommend.getContent()),
            "TimeLimitCollectRules": encodeURIComponent(ueditor_convene.getContent()),
            "TabName":$("input[name='TabName']").val(),
            "IsSendCode":($("input[name='IsSendCode']:checked").val()==1? true:false),
            "UserGroupId":$("input[name='userGroupId']").val(),
            "StartTime":$("input[name='StartTime']").val(),
            "EndTime":$("input[name='EndTime']").val()
        }
        console.log(JSON.stringify(channel));
        console.log(JSON.stringify(dataStr));
        $.ajax({
            type: "POST",
            url: "/RecommendGetGiftConfig/Edit",
            data: {
                "data": JSON.stringify(dataStr)
            },
            success: function (result) {
                if (result) {
                    window.location.href = "/RecommendGetGiftConfig/Index";
                } else {
                    alert("保存失败!")
                }
            },
            error: function (result) {
                alert("失败!")
            }
        });
    }

    function UploadImg(e) {
        var $e = $(e);
        var $ee = $e.parents("tr").find("td").eq(1).find("img");
        var $smallImage = $e.parents("tr").find("td").eq(1).find("input[class='smallImage']");
        var $image = $e.parents("tr").find("td").eq(1).find("input[class='image']");
        $.ajaxFileUpload({
            url: '/Article/AddArticleImg2',
            secureuri: false,
            fileElementId: $e.attr("id"),
            dataType: 'json',
            data: {},
            type: "post",
            success: function (result) {
                if (result.BImage != "" && result.SImage != "") {
                    $ee.attr("src", result.SImage);
                    $(".vwPicture").show();
                    $smallImage.val(result.SImage);
                    $image.val(result.BImage);
                } else {
                    alert("上传失败！");
                }
            }
        })
    }
    function UploadImg2(e) {
        var $e = $(e);
        var $ee = $e.parents("tr").find("td").eq(8).find("img");
        var $smallImage = $e.parents("tr").find("td").eq(8).find("input[class='smallImage']");
        var $image = $e.parents("tr").find("td").eq(8).find("input[class='image']");
        $.ajaxFileUpload({
            url: '/Article/AddArticleImg2',
            secureuri: false,
            fileElementId: $e.attr("id"),
            dataType: 'json',
            data: {},
            type: "post",
            success: function (result) {
                if (result.BImage != "" && result.SImage != "") {
                    $ee.attr("src", result.SImage);
                    $(".vwPicture").show();
                    $smallImage.val(result.SImage);
                    $image.val(result.BImage);
                } else {
                    alert("上传失败！");
                }
            }
        })
    }
</script>