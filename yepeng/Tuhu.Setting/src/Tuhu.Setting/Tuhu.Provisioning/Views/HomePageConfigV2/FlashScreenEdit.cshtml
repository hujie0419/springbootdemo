@{
    Layout = null;
}
@model Tuhu.Provisioning.DataAccess.Entity.SE_FlashScreenConfig

<div class="modal-dialog" style="width:900px;">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                &times;
            </button>
            <h4 class="modal-title">
                编辑闪购配置
            </h4>
        </div>
        <div class="modal-body">
            <form id="form1"  class="form-horizontal" >
                <div class="form-group">
                    <label class="col-sm-2 control-label">名称:</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" id="Name" name="Name" value="@Model.Name" />
                    </div>
                    <label class="col-sm-2 control-label">渠道:</label>
                    <div class="col-sm-4">
                        
                        <select id="Channel" name="Channel">
                            @if (Model.Channel != null)
                            {
                                if (Model.Channel == 0)
                                {
                                    <option value="0" selected="selected">全部</option>
                                }
                                else
                                {
                                    <option value="0" >全部</option>
                                }
                                if (Model.Channel == 1)
                                {
                                    <option value="1" selected="selected">Android</option>
                                }
                                else
                                {
                                    <option value="1">Android</option>
                                }

                                if (Model.Channel == 2)
                                {
                                    <option value="2" selected="selected">IOS</option>
                                }
                                else
                                {
                                    <option value="2">IOS</option>
                                }

                                if (Model.Channel == 3)
                                {
                                    <option value="3" selected="selected">移动站</option>
                                }
                                else
                                {
                                    <option value="3">移动站</option>
                                }
                            }
                            else
                            {
                                <option value="0">全部</option>
                                <option value="1">Android</option>
                                <option value="2">IOS</option>
                                <option value="3">移动站</option>
                            }
                        </select>
                    </div>
                </div>
                @if (Model.Type == 2)
                {
                    <div class="form-group">
                        <label class="col-sm-2 control-label">应用市场来源：</label>
                        <div class="col-sm-4">
                            <select id="APPChannel" name="APPChannel" style="width:160px;">
                                @foreach (Tuhu.Provisioning.DataAccess.Entity.NoticeChannel item in ViewBag.ChannelDictionary)
                                {
                                    <option value="@item.Name">@item.DisplayName</option>
                                }
                            </select>
                        </div>
                        <label class="col-sm-2 control-label">应用市场渠道：</label>
                        <div class="col-sm-4">
                            <select id="NewNoticeChannel" name="NewNoticeChannel" style="width:160px;">
                                @foreach (Tuhu.Provisioning.DataAccess.Entity.NoticeChannel item in ViewBag.ChannelDictionary)
                                {
                                    <option value="@item.Name">@item.DisplayName</option>
                                }
                            </select>
                        </div>
                    </div>
                 }
                <div class="form-group">
                    <label class="col-sm-2 control-label">开始版本：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control"  id="StartVersion" name="StartVersion" value="@Model.StartVersion" />
                    </div>
                    <label class="col-sm-2 control-label">结束版本：</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" id="EndVersion" name="EndVersion" value="@Model.EndVersion" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">按钮图片:</label>
                    <div class="col-sm-4">
                        <img width="30" height="30" style="display:inline;" id="imgButton" @(string.IsNullOrWhiteSpace(Model.ButtonImage) ==false?"src="+Model.ButtonImage:"") />
                        <input type="file" id="uploadButtonImg" name="uploadButtonImg" style="display:inline;width:120px;" onchange="UploadBgImg(this, 'imgButton', 'ButtonImage')" />
                    </div>
                    <label class="col-sm-2 control-label">Banner图片：</label>
                    <div class="col-sm-4">
                        <img width="30" height="30" style="display:inline;" id="imgBanner" @(string.IsNullOrWhiteSpace(Model.BannerImage) ==false?"src="+Model.BannerImage:"") />
                        <input type="file" id="upBannerImg" name="upBannerImg" style="display:inline;width:100px;"  onchange="UploadBgImg(this, 'imgBanner', 'BannerImage')"  />
                    </div>
                </div>
                <div class="from-group">
                    <label class="col-sm-2 control-label">按钮图片Url:</label>
                    <div class="col-sm-10">
                        <input type="text" id="ButtonImage" name="ButtonImage" class="form-control" value="@Model.ButtonImage" />
                    </div>
                   
                </div>
                <div class="from-group">
                    <label class="col-sm-2 control-label">Banner图片Url:</label>
                    <div class="col-sm-10">
                        <input type="text" id="BannerImage" name="BannerImage" class="form-control" value="@Model.BannerImage" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">链  &nbsp;&nbsp;  接:</label>
                    <div class="col-sm-10">
                        <input type="text"  id="LinkUrl" name="LinkUrl" class="form-control"  value="@Model.LinkUrl"/>
                    </div>
                   
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">没有编码链接:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="NoLinkUrl" name="NoLinkUrl" value="@(Model.LinkUrl)" readonly="readonly" />
                    </div>
                </div>
               
               

                <div class="form-group">
                    <label class="col-sm-2 control-label">统计：</label>
                    <div class="col-sm-4">
                        <input type="text" id="Counts" name="Counts" class="form-control" value="@Model.Counts" />
                    </div>
                    <label class="col-sm-2 control-label">状态：</label>
                    <div class="col-sm-4">
                       <input  type="radio"  name="IsEnabled" value="true"  @(Model.IsEnabled == true?"checked=\"checked\"":"") /><span>启用</span>
                       <input type="radio" name="IsEnabled" value="false" @(Model.IsEnabled == false?"checked=\"checked\"":"") /><span>禁用</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-sm-2 control-label">开始时间:</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control Wdate"  onclick="WdatePicker({ dateFmt :'yyyy-MM-dd HH:mm:ss'})" name="StartDateTime" id="StartDateTime" value="@(string.Format("{0:yyyy-MM-dd HH:mm:ss}",Model.StartDateTime))" />
                    </div>
                    <label class="col-sm-2 control-label">结束时间:</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control Wdate" onclick="WdatePicker({ dateFmt :'yyyy-MM-dd HH:mm:ss'})" name="EndDateTime" id="EndDateTime" value="@(string.Format("{0:yyyy-MM-dd HH:mm:ss}",Model.EndDateTime))" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">上传ZIP文件:</label>
                    <div class="col-sm-4">
                        <input type="file" id="uploadZip" name="uploadZip" onchange="UploadFileZip(this)" />
                    </div>
                    <label class="col-sm-2 control-label">zip链接:</label>
                    <div class="col-sm-4">
                        <input type="text" id="Zip" name="Zip" readonly="readonly" class="form-control"  value="@Model.Zip" />
                        <input type="hidden" id="Md5" name="Md5" value="@Model.Md5" />
                    </div>
                </div>
                <input type="hidden" id="ID" name="ID" value="@Model.ID" />
                <input type="hidden" id="Type" name="Type" value="@Model.Type"/>
                <input type="hidden" id="ChannelItems" name="ChannelItems" value="@Model.APPChannel"/>
                <input type="hidden" id="NewChannelItems" name="NewChannelItems" value="@Model.NewNoticeChannel"/>
            </form>
        </div>
        <div class="modal-footer">
            <a href="javascript:void(0)" class="btn btn-danger btn-sm " id="btnToobal" onclick="Toolbar()" style="width: 80px;" data-toggle="modal" data-target="#toobal">小工具</a>
            <button type="button" id="btnSave" name="btnSave" class="btn btn-primary">
                保 存
            </button>
            <button type="button" class="btn btn-default" data-dismiss="modal">
                取 消
            </button>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {

        var type = $('#Type').val();
        if (type == 2) {
            $('#APPChannel').multipleSelect({
                selectAll: true
            });
            $('#APPChannel').multipleSelect('setSelects', []);
            $('#NewNoticeChannel').multipleSelect({
                selectAll: true
            });
            $('#NewNoticeChannel').multipleSelect('setSelects', []);
            var value = $('#ChannelItems').val();
            if (value) {

                $('#APPChannel').multipleSelect('setSelects', value.split(','));
            }
            var value1 = $('#NewChannelItems').val();
            if (value1) {
                $('#NewNoticeChannel').multipleSelect('setSelects', value1.split(','));
            }
        }

        $('#btnSave').on('click', function () {
           
            var data = {};
            data.ID = $('#ID').val();
            data.StartVersion = $('#StartVersion').val();
            data.EndVersion = $('#EndVersion').val();
            data.Name = $('#Name').val();
            data.PriorityLevel = $('#PriorityLevel').val();
            data.Channel = $('#Channel').val();
            data.ButtonImage = $('#ButtonImage').val();
            data.BannerImage = $('#BannerImage').val();

            data.LinkUrl = $('#LinkUrl').val();
            data.Counts = $('#Counts').val();
            data.IsEnabled = $('input[name="IsEnabled"]:checked').val();
            data.StartDateTime = $('#StartDateTime').val();
            data.EndDateTime = $('#EndDateTime').val();
            data.Zip = $("#Zip").val();
            data.Md5 = $("#Md5").val();
            data.APPChannel = $('#APPChannel').multipleSelect('getSelects').toString() || '';
            data.NewNoticeChannel = $('#NewNoticeChannel').multipleSelect('getSelects').toString() || '';
            data.Type = $('#Type').val();
            $(this).attr("disabled", "disabled");
            $.ajax({
                url: '/HomePageConfigV2/FlashScreenSave',
                type: 'post',
                data: data,
                dataType:'json'
            }).done(function (result) {
                if (result == 1)
                    location.reload();
                else
                    alert("保存失败");
            });
        });

        if ($('#NoLinkUrl').val()) {
            $('#NoLinkUrl').val(decodeURIComponent($('#NoLinkUrl').val()));
        }
    })
</script>
