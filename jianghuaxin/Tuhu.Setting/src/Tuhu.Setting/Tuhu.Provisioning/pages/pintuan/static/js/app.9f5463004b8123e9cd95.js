webpackJsonp([4],{"+skl":function(t,e){},"3wPY":function(t,e){},"8Vgq":function(t,e){},"9Q9G":function(t,e){},DOuM:function(t,e){},DPJw:function(t,e){},HkXY:function(t,e){},NHnr:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("7+uW"),n={props:{name:{type:String}},methods:{logout:function(){this.$emit("logout")}}},i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"header"},[t._m(0),t._v(" "),o("div",{staticClass:"header-aside"},[o("Dropdown",{on:{"on-click":t.logout}},[o("a",{staticClass:"header-aside-main",attrs:{href:"javascript:void(0)"}},[o("Icon",{staticClass:"main-icon",attrs:{type:"ios-person"}}),t._v("\n          "+t._s(t.name)+"\n          "),o("Icon",{attrs:{type:"arrow-down-b"}})],1),t._v(" "),o("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[o("DropdownItem",[t._v("退出登录")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{attrs:{href:"/pages/pintuan/"}},[e("div",{staticClass:"headerlogo"},[e("img",{staticClass:"header-logo-line",attrs:{src:"static/logo.png"}}),this._v(" "),e("div",{staticClass:"header-logo-title"},[e("h3",[this._v("拼团配置系统")]),this._v(" "),e("h4",[this._v("setting.tuhu.cn")])])])])}]};var r=o("VU/8")(n,i,!1,function(t){o("8Vgq")},null,null).exports,l={name:"setting-menu",props:{menus:{type:Array}},data:function(){return{searchVal:"",filteredMenus:[],openedmenus:[],shrinked:!1,activename:""}},watch:{$route:function(){this.setActiveName(this.$router.currentRoute.name)}},mounted:function(){this.filteredMenus=this.menus,this.setActiveName(this.$router.currentRoute.name)},methods:{goto:function(t){this.$router.push({name:t})},fliter:function(){var t=this.searchVal;this.filteredMenus=this.menus.filter(function(e){return e.name.indexOf(t)>=0}),this.updateOpenedMenus(this.util.array.select(this.filteredMenus,function(t){return t.key}))},updateOpenedMenus:function(t,e){this.openedmenus=t,e&&(this.activename=e),this.$nextTick(function(){this.$refs.orangeMenu.updateOpened(),this.$refs.orangeMenu.updateActiveName()})},setActiveName:function(t){var e;this.menus.forEach(function(o){o.children.forEach(function(a){a.key===t&&(e=o.key)})}),this.updateOpenedMenus([e],t)}}},s={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:{nav:!t.shrinked}},[o("Input",{staticClass:"search",attrs:{icon:"ios-search",placeholder:"筛选一级目录"},on:{"on-enter":t.fliter,"on-click":t.fliter},model:{value:t.searchVal,callback:function(e){t.searchVal=e},expression:"searchVal"}}),t._v(" "),o("Menu",{ref:"orangeMenu",attrs:{width:"210px","open-names":t.openedmenus,"active-name":t.activename},on:{"on-select":t.goto}},t._l(t.filteredMenus,function(e,a){return o("Submenu",{key:a,attrs:{name:e.key}},[o("template",{slot:"title"},[o("Icon",{attrs:{type:e.icon}}),t._v("\n                "+t._s(e.name)+"\n            ")],1),t._v(" "),t._l(e.children,function(e,a){return o("MenuItem",{key:a,attrs:{name:e.key}},[t._v("\n            "+t._s(e.name)+"\n            ")])})],2)})),t._v(" "),o("Button",{directives:[{name:"show",rawName:"v-show",value:t.shrinked,expression:"shrinked"}],staticClass:"hide",on:{click:function(e){t.shrinked=!t.shrinked}}},[t._v("收起")])],1)},staticRenderFns:[]};var u={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"footer"},[e("div",{staticClass:"footer-data"},[e("span",[this._v("所有内容为途虎养车网商业机密信息，切勿泄漏。版权所有 途虎养车网 2011-2015")])])])}]};var d={name:"App",data:function(){return{user:{name:""}}},computed:{menus:function(){return this.$store.state.app.menus},username:function(){return this.$store.state.user.name}},components:{settingheader:r,settingmenu:o("VU/8")(l,s,!1,function(t){o("HkXY")},null,null).exports,settingfooter:o("VU/8")({},u,!1,function(t){o("ROvl")},null,null).exports},methods:{logout:function(){var t=location.hostname.replace("yunying","yewu").replace("setting","yewu");window.location.href=location.protocol+"//"+t+"/Account/LogOff"}}},c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("settingheader",{attrs:{name:this.username},on:{logout:this.logout}}),this._v(" "),e("settingmenu",{attrs:{menus:this.menus}}),this._v(" "),e("div",{staticClass:"content"},[e("div",{staticClass:"real-content"},[e("router-view")],1),this._v(" "),e("settingfooter")],1)],1)},staticRenderFns:[]};var p=o("VU/8")(d,c,!1,function(t){o("UeEU")},null,null).exports,g=o("BTaQ"),f=o.n(g),m=(o("+skl"),o("9Q9G"),o("mXwE")),h=o("NYxO"),v={namespaced:!0,state:{menu:{menus:[],openedmenus:[],shrinked:[]},user:{name:"",permission:[]}},mutations:{init:function(t,e){console.log(e),t.menus=e}}},C={namespaced:!0,state:{name:"",permissions:[]},mutations:{logout:function(t){},init:function(t,e){t.name=e.name,t.permissions=e.permissions}}};a.default.use(h.a);var y=new h.a.Store({state:{},mutations:{},actions:{},modules:{app:v,user:C}}),I=[{key:"1",name:"拼团抽奖",children:[{key:"Lottery",name:"拼团抽奖"},{key:"LotteryRecycleBIn",name:"已过期拼团抽奖"}]},{key:"3",name:"拼团商品配置",children:[{key:"ProductConfig",name:"商品配置"}]},{key:"4",name:"拼团优惠券配置",children:[{key:"Coupon",name:"优惠券配置"}]}];a.default.use(f.a),a.default.config.productionTip=!1,a.default.prototype.ajax=m.a.ajax,a.default.prototype.util=m.a,console.log(a.default.prototype.$Message),m.a.useMessage(a.default.prototype.$Message),m.a.useModal(a.default.prototype.$Modal),a.default.prototype.$Loading.config({color:"#2ca9e1",failedColor:"#c9171e",height:2}),m.a.useLoadingbar(a.default.prototype.$Loading),m.a.ajax.get("/auth/GetBasicInformantion").then(function(t){if(t.data.success){y.commit("user/init",t.data.user),y.commit("app/init",I);var e=o("YaEn").default;e.beforeEach(function(t,e,o){(f.a.LoadingBar.start(),m.a.title(t.meta.title),console.log("pat"+t.meta.authpath),t.meta.authpath)?m.a.axiosInstance.get("/auth/haspower?path="+t.meta.authpath).then(function(t){t.data.success&&t.data.result?o():o({path:"/403"})}).catch(function(t){console.log(t),f.a.LoadingBar.error(),o({path:"/500"})}):o()}),e.afterEach(function(t){console.log("finish"),f.a.LoadingBar.finish()}),new a.default({el:"#app",router:e,store:y,components:{App:p},template:"<App/>"})}else{var n=location.hostname.replace("setting","yewu").replace("setting","yewu");window.location.href=location.protocol+"//"+n+"/Account/LogOn?ReturnUrl="+location.href}})},ROvl:function(t,e){},UeEU:function(t,e){},YaEn:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("7+uW"),n=o("/ocq"),i={render:function(){var t=this.$createElement;return(this._self._c||t)("div",[this._v("\n    欢迎进入拼团配置系统\n")])},staticRenderFns:[]},r=o("VU/8")(null,i,!1,null,null,null).exports,l=o("mXwE"),s={groupId:"",list:[],loading:!0,columns:[{title:"拼团Id",key:"ProductGroupId"},{title:"团类型",key:"GroupType",render:function(t,e){switch(e.row.GroupType){case 1:return t("span","新人团");case 2:return t("span","团长特价");default:return t("span","普通团")}}},{title:"团类别",key:"GroupCategory",render:function(t,e){return 0===e.row.GroupCategory?t("span","一般拼团"):t("span","抽奖拼团")}},{title:"商品名称",key:"ProductName"},{title:"活动价（元）",key:"FinalPrice"},{title:"开始时间",key:"BeginTime"},{title:"结束时间",key:"EndTime"},{title:"抽奖规则",key:"GroupDescription",type:"html"},{title:"操作",key:"action",render:function(t,e){return t("router-link",{attrs:{to:"lottery/"+e.row.ProductGroupId}},"查看详情")}}]},u={name:"Lottery",data:function(){return s},beforeCreate:function(){l.a.ajax.get("/GroupBuyingV2/LotteryList?groupId="+s.groupId).then(function(t){s.loading=!1,t.data&&(s.list=t.data)})},computed:{filtedList:function(){return s.groupId?s.list.filter(function(t){return t.ProductGroupId===s.groupId}):s.list}},methods:{}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"divMain"}},[o("h2",{staticClass:"title"},[t._v("拼团抽奖")]),t._v(" "),o("Form",{attrs:{role:"form",inline:""}},[o("FormItem",{attrs:{label:"拼团Id","label-width":50}},[o("Input",{attrs:{placeholder:"请输入ProductGroupId"},model:{value:t.groupId,callback:function(e){t.groupId=e},expression:"groupId"}})],1)],1),t._v(" "),o("Table",{attrs:{border:"",strip:"",loading:t.loading,columns:t.columns,data:t.filtedList,"no-data-text":"暂无拼团抽奖产品"}})],1)},staticRenderFns:[]};var c=o("VU/8")(u,d,!1,function(t){o("DOuM")},"data-v-18ac3fd4",null).exports,p={groupId:"",pageIndex:1,pageSize:10,loading:!0,totalSize:20,list:[],columns:[{title:"拼团Id",key:"ProductGroupId"},{title:"团类型",key:"GroupType",render:function(t,e){switch(e.row.GroupType){case 1:return t("span","新人团");case 2:return t("span","团长特价");default:return t("span","普通团")}}},{title:"团类别",key:"GroupCategory",render:function(t,e){return 0===e.row.GroupCategory?t("span","一般拼团"):t("span","抽奖拼团")}},{title:"商品名称",key:"ProductName"},{title:"活动价（元）",key:"FinalPrice"},{title:"开始时间",key:"BeginTime"},{title:"结束时间",key:"EndTime"},{title:"抽奖规则",key:"GroupDescription",type:"html"},{title:"操作",key:"action",render:function(t,e){return t("router-link",{attrs:{to:"lottery/"+e.row.ProductGroupId}},"查看详情")}}]},g={name:"Lottery",data:function(){return p},beforeCreate:function(){l.a.ajax.get("/GroupBuyingV2/LotteryRecycleBinList?groupId="+p.groupId+"&pageIndex="+p.pageIndex+"&pageSize="+p.pageSize).then(function(t){t.data&&(t.data.Data&&(p.pageIndex=t.data.PageIndex,p.totalSize=t.data.TotalSize,p.list=t.data.Data),p.loading=!1)})},computed:{filtedList:function(){return p.groupId?p.list.filter(function(t){return t.ProductGroupId===p.groupId}):p.list}},methods:{loadData:function(t){t||(t=1),p.loading=!0,l.a.ajax.get("/GroupBuyingV2/LotteryRecycleBinList?groupId="+p.groupId+"&pageIndex="+t+"&pageSize="+p.pageSize).then(function(t){t.data&&(t.data.Data&&(p.pageIndex=t.data.PageIndex,p.totalSize=t.data.TotalSize,p.list=t.data.Data),p.loading=!1)})}}},f={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"divMain"}},[o("Form",{attrs:{role:"form",inline:""}},[o("FormItem",{attrs:{label:"拼团Id","label-width":50}},[o("Input",{attrs:{placeholder:"请输入 ProductGroupId"},model:{value:t.groupId,callback:function(e){t.groupId=e},expression:"groupId"}})],1),t._v(" "),o("FormItem",{attrs:{"label-width":2}},[o("Button",{attrs:{type:"success"},on:{click:function(e){t.loadData()}}},[t._v("搜索")])],1)],1),t._v(" "),o("Table",{attrs:{border:"",columns:t.columns,data:t.filtedList,"no-data-text":"暂无数据"}}),t._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:t.totalSize,current:1,"show-total":""},on:{"on-change":t.loadData}})],1)])],1)},staticRenderFns:[]},m=o("VU/8")(g,f,!1,null,null,null).exports,h={groupId:"",hiddenModal:{showPushDialog:!1,showRefundDialog:!1,showCouponDialog:!1,showAddCouponDialog:!1,showLogDialog:!1},pushDialog:{pushMsgId:"1867",pushUserScope:"-1",pushUserOrderId:"",userCount:-1,onUserScopeChange:function(){"-99"!==h.pushDialog.pushUserScope?l.a.ajax.post("/GroupBuyingV2/GetLotteryUserCount?productGroupId="+h.groupId+"&tag="+h.pushDialog.pushUserScope).then(function(t){t.data&&(1===t.data.Code?h.pushDialog.userCount=t.data.Info:(l.a.message.error({top:50,duration:3,content:"获取用户数量失败"}),h.pushDialog.userCount=-1))}):h.pushDialog.userCount=1},pushMsg:function(){"-99"!==h.pushDialog.pushUserScope||h.pushDialog.pushUserOrderId?l.a.modal.confirm({title:"提示",content:"确定要给推送消息吗？",onOk:function(){l.a.ajax.post("/GroupBuyingV2/PushLotteryMessage",null,{headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{productGroupId:h.groupId,tag:h.pushDialog.pushUserScope,orderId:h.pushDialog.pushUserOrderId,batchId:h.pushDialog.pushMsgId}}).then(function(t){1===t.data.Code?l.a.message.success({top:50,duration:3,content:"操作成功"}):l.a.message.error({top:50,duration:3,content:t.data.Info})})}}):l.a.modal.error({title:"错误",content:"订单号不能为空"})}},refundDialog:{userScope:"-99",orderStatus:"1",refundOrderId:"",userCount:1,onUserScopeChange:function(){"-99"!==h.refundDialog.userScope?l.a.ajax.post("/GroupBuyingV2/GetLotteryUserCount?productGroupId="+h.groupId+"&tag="+h.refundDialog.userScope).then(function(t){t.data&&(1===t.data.Code?h.refundDialog.userCount=t.data.Info:(l.a.message.error({top:50,duration:3,content:"获取用户数量失败"}),h.refundDialog.userCount=-1))}):h.refundDialog.userCount=1},refund:function(){"-99"!==h.refundDialog.userScope||h.refundDialog.refundOrderId?l.a.modal.confirm({title:"提示",content:"确定要给"+("2"===h.refundDialog.userScope?"二等奖":"")+"用户取消订单并退款吗？",onOk:function(){l.a.ajax.post("/GroupBuyingV2/CancelLotteryOrder",null,{headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{productGroupId:h.groupId,tag:h.refundDialog.userScope,orderId:h.refundDialog.refundOrderId}}).then(function(t){1===t.data.Code?l.a.message.success({top:50,duration:3,content:"操作成功"}):l.a.message.error({top:50,duration:3,content:t.data.Info})})}}):l.a.modal.error({title:"错误",content:"订单号不能为空"})}},couponDialog:{userScope:"-1",couponOrderId:"",userCount:-1,newCoupon:{CouponId:"",CouponDesc:"",CouponCondition:"",UsefulLife:""},fetchCouponInfo:function(){h.couponDialog.newCoupon.CouponId&&l.a.ajax.get("/GroupBuyingV2/GetCouponDetail?couponId="+h.couponDialog.newCoupon.CouponId).then(function(t){1===t.data.Code&&(h.couponDialog.newCoupon.CouponDesc=t.data.CouponDesc,h.couponDialog.newCoupon.CouponCondition=t.data.CouponCondition,h.couponDialog.newCoupon.UsefulLife=t.data.UsefulLife)})},onUserScopeChange:function(){"-99"!==h.couponDialog.userScope?l.a.ajax.post("/GroupBuyingV2/GetLotteryUserCount?productGroupId="+h.groupId+"&tag="+h.couponDialog.userScope).then(function(t){t.data&&(1===t.data.Code?h.couponDialog.userCount=t.data.Info:(l.a.message.error({top:50,duration:3,content:"获取用户数量失败"}),h.couponDialog.userCount=-1))}):h.couponDialog.userCount=1},cols:[{type:"selection"},{title:"优惠券GUID",key:"CouponId"},{title:"优惠券说明",key:"CouponDesc"},{title:"使用条件",key:"CouponCondition"},{title:"有效期",key:"UsefulLife"},{title:"创建人",key:"Creator"},{title:"操作",key:"action",render:function(t,e){return t("Button",{on:{click:function(){l.a.modal.confirm({title:"警告",content:"确定要删除优惠券 "+e.row.CouponId+" 吗？",onOk:function(){var t=new URLSearchParams;t.append("productGroupId",h.groupId),t.append("couponIds",e.row.CouponId),l.a.ajax.post("/GroupBuyingV2/DeleteLotteryCoupons",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){1===t.data.Code?(h.couponDialog.loadCoupon(),l.a.message.success({top:50,duration:3,content:"操作成功"})):l.a.message.error({top:50,duration:3,content:t.data.Info})})}})}},props:{type:"error"}},"删除")}}],list:[],loadCoupon:function(){l.a.ajax.get("/GroupBuyingV2/GetLotteryCouponList?productGroupId="+h.groupId).then(function(t){t.data&&1===t.data.Code&&(h.couponDialog.list=t.data.Data)})},onAdddCouponSuccess:function(){for(var t=!1,e=0;e<h.couponDialog.list.length;e++)if(h.couponDialog.list[e].CouponId===h.couponDialog.newCoupon.CouponId){t=!0;break}t?l.a.message.error({top:50,duration:3,content:"优惠券已存在"}):l.a.modal.confirm({title:"提示",content:"确定要添加这张优惠券吗？",onOk:function(){var t=new URLSearchParams;t.append("productGroupId",h.groupId),t.append("couponId",h.couponDialog.newCoupon.CouponId),l.a.ajax.post("/GroupBuyingV2/AddLotteryCoupon",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){1===t.data.Code?(h.couponDialog.loadCoupon(),l.a.message.success({top:50,duration:3,content:"操作成功"})):l.a.message.error({top:50,duration:3,content:t.data.Info})})}})},onAddCoupon:function(){h.hiddenModal.showAddCouponDialog=!0},issueCoupon:function(){var t=document.querySelectorAll("#couponList table td .ivu-checkbox-input");if(t&&0!==t.length){for(var e=[],o=0;o<t.length;o++){var a=t[o];if(a.checked){var n=a.parentNode.parentNode.parentNode.parentNode.parentNode.childNodes[1].textContent.trim();n&&e.push(n)}}if(0!==e.length){var i=new URLSearchParams;i.append("productGroupId",h.groupId),i.append("tag",h.couponDialog.userScope),i.append("orderId",h.couponDialog.couponOrderId),i.append("couponList",e),l.a.modal.confirm({title:"提示",content:"确定要给用户塞券吗？",onOk:function(){l.a.ajax.post("/GroupBuyingV2/SendLotteryCoupon",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){1===t.data.Code?l.a.message.success({top:50,duration:3,content:"操作成功"}):l.a.message.error({top:50,duration:3,content:t.data.Info})})}})}else l.a.modal.error({title:"错误",content:"请选择优惠券"})}else l.a.modal.error({title:"错误",content:"请添加优惠券"})}},logDialog:{logType:"PushMessage",cols:[{title:"时间",key:"CreateDateTime"},{title:"操作类型",key:"OperateType"},{title:"操作人",key:"Operator"},{title:"备注",key:"Remark"}],logList:[],onLogTypeChange:function(){l.a.ajax.get("/GroupBuyingV2/GetLotteryLog?productGroupId="+h.groupId+"&type="+h.logDialog.logType).then(function(t){t.data&&1===t.data.Code&&(h.logDialog.logList=t.data.Data)})}},form:{orderId:"",lotteryLevel:0},dropdownList:[{value:0,text:"全部"},{value:-1,text:"未开奖"},{value:1,text:"一等奖"},{value:2,text:"二等奖"}],table:{loading:!0,list:[],cols:[{title:"拼团Id",key:"ProductGroupId"},{title:"订单号",key:"OrderId"},{title:"订单状态",key:"OrderStatus"},{title:"账户手机号",key:"UserPhone"},{title:"用户Id",key:"UserId"},{title:"获奖状态",key:"LotteryResult",render:function(t,e){switch(e.row.LotteryResult){case 0:return t("span","未开奖");case 1:return t("span","一等奖");default:return t("span","二等奖")}}},{title:"操作",key:"action",width:320,render:function(t,e){var o=[];return"未完成"!==e.row.OrderStatus&&0!==e.row.LotteryResult||o.push(t("Button",{props:{type:"warning"},style:{margin:"1px 4px"},on:{click:function(){v.setLotteryResult(1===e.row.LotteryResult?2:1,e.row.OrderId,e.row.UserId)}}},1===e.row.LotteryResult?"设为二等奖":"设为一等奖")),"未完成"===e.row.OrderStatus&&(o.push(t("Button",{props:{type:"primary"},style:{margin:"1px 4px"},on:{click:function(){v.finishOrder(e.row.OrderId,e.row.UserId)}}},"完成订单")),o.push(t("Button",{props:{type:"primary"},style:{margin:"1px 4px"},on:{click:function(){return v.cancelOrder(e.row.OrderId,e.row.UserId)}}},"取消订单"))),t("div",o)}}],pageIndex:0,pageSize:10,totalSize:10}},v={loadData:function(t){t||(t=1),l.a.ajax.get("/GroupBuyingV2/LotteryDetailList?groupId="+h.groupId+"&pageIndex="+t+"&pageSize="+h.table.pageSize+"&orderId="+h.form.orderId+"&lotteryResult="+h.form.lotteryLevel).then(function(t){t.data&&(t.data.Data&&(h.table.pageIndex=t.data.PageIndex,h.table.totalSize=t.data.TotalSize,h.table.list=t.data.Data),h.table.loading=!1)})},finishOrder:function(t,e){l.a.modal.confirm({title:"确认",content:"确定要完成订单 "+t+" 吗？",onOk:function(){l.a.ajax.post("/GroupBuyingV2/SetOrderStatusForOne",null,{headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{productGroupId:h.groupId,userId:e,orderId:t,status:1}}).then(function(t){1===t.data.Code?(l.a.message.success({top:50,duration:3,content:"操作成功"}),v.loadData()):l.a.message.error({top:50,duration:3,content:t.data.Info})})},onCancel:function(){}})},cancelOrder:function(t,e){l.a.modal.confirm({title:"确认",content:"确定要取消订单 "+t+" 吗？",onOk:function(){l.a.ajax.post("/GroupBuyingV2/SetOrderStatusForOne",null,{headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{productGroupId:h.groupId,userId:e,orderId:t,status:-1}}).then(function(t){1===t.data.Code?(l.a.message.success({top:50,duration:3,content:"操作成功"}),v.loadData()):l.a.message.error({top:50,duration:3,content:t.data.Info})})},onCancel:function(){}})},setLotteryResult:function(t,e,o){l.a.modal.confirm({title:"确认",content:"确定将用户 "+o+" 设置为 "+(1===t?"一等奖":"二等奖")+" 吗？",onOk:function(){l.a.ajax.post("/GroupBuyingV2/SetLotteryResult",null,{headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{productGroupId:h.groupId,userId:o,orderId:e,level:t}}).then(function(t){t.data.Code>0?(l.a.message.success({top:50,duration:3,content:"操作成功"}),v.loadData()):l.a.message.error({top:50,duration:3,content:t.data.Info})})},onCancel:function(){}})},pushMsg:function(){h.hiddenModal.showPushDialog=!0},refund:function(){h.hiddenModal.showRefundDialog=!0},issueCoupon:function(){h.hiddenModal.showCouponDialog=!0},viewLog:function(){h.hiddenModal.showLogDialog=!0}},C={name:"Lottery",data:function(){return h},beforeCreate:function(){h.groupId=this.$route.params.id,l.a.ajax.get("/GroupBuyingV2/LotteryDetailList?groupId="+h.groupId+"&pageIndex=1&pageSize="+h.table.pageSize+"&orderId="+h.form.orderId+"&lotteryResult="+h.form.lotteryLevel).then(function(t){t.data&&(t.data.Data&&(h.table.pageIndex=t.data.PageIndex,h.table.totalSize=t.data.TotalSize,h.table.list=t.data.Data),h.table.loading=!1)}),h.logDialog.onLogTypeChange(),h.couponDialog.loadCoupon()},computed:{filtedList:function(){return h.form.orderId||h.form.lotteryLevel||0!==h.form.lotteryLevel?h.table.list.filter(function(t){return h.form.orderId&&0!==h.form.lotteryLevel&&""!==h.form.lotteryLevel?t.OrderId===h.form.orderId&&t.LotteryResult===h.form.lotteryLevel:h.form.orderId?t.OrderId===h.form.orderId:t.LotteryResult===h.form.lotteryLevel}):h.table.list}},methods:v},y={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticStyle:{"margin-bottom":"20px"}},[o("h2",[t._v(t._s(t.$route.params.id)+" 拼团抽奖拼团成功订单")])]),t._v(" "),o("div",{staticClass:"page-form-header"},[o("Form",{staticStyle:{width:"500px"},attrs:{model:t.form,"label-position":"left",inline:""}},[o("FormItem",{attrs:{label:"订单号","label-width":50}},[o("Input",{attrs:{type:"text",placeholder:"请输入订单号"},model:{value:t.form.orderId,callback:function(e){t.$set(t.form,"orderId",t._n("string"==typeof e?e.trim():e))},expression:"form.orderId"}})],1),t._v(" "),o("FormItem",{attrs:{label:"获奖状态","label-width":60}},[o("Select",{staticStyle:{width:"100px"},attrs:{transfer:""},model:{value:t.form.lotteryLevel,callback:function(e){t.$set(t.form,"lotteryLevel",t._n(e))},expression:"form.lotteryLevel"}},t._l(t.dropdownList,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])}))],1),t._v(" "),o("FormItem",[o("Button",{attrs:{type:"success"},on:{click:function(e){t.loadData()}}},[t._v("搜索")])],1)],1),t._v(" "),o("div",{staticStyle:{display:"inline-block"}},[o("Button",{attrs:{type:"info"},on:{click:function(e){t.pushMsg()}}},[t._v("发消息推送")]),t._v(" "),o("Button",{attrs:{type:"info"},on:{click:function(e){t.refund()}}},[t._v("给用户退款")]),t._v(" "),o("Button",{attrs:{type:"info"},on:{click:function(e){t.issueCoupon()}}},[t._v("给用户塞券")]),t._v(" "),o("Button",{attrs:{type:"info"},on:{click:function(e){t.viewLog()}}},[t._v("查看日志")])],1)],1),t._v(" "),o("div",{staticClass:"page-main"},[o("Table",{attrs:{border:"",columns:t.table.cols,data:t.filtedList,"no-data-text":"暂无数据"}}),t._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:t.table.totalSize,current:1,"show-total":""},on:{"on-change":t.loadData}})],1)])],1),t._v(" "),o("Modal",{attrs:{title:"发送推送消息",closable:!1,"mask-closable":!1},on:{"on-ok":t.pushDialog.pushMsg},model:{value:t.hiddenModal.showPushDialog,callback:function(e){t.$set(t.hiddenModal,"showPushDialog",e)},expression:"hiddenModal.showPushDialog"}},[o("table",{staticClass:"popup"},[o("tr",[o("th",[t._v("ProductGroupId")]),t._v(" "),o("td",[o("label",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.groupId))])])]),t._v(" "),o("tr",[o("th",[t._v("推送消息ID")]),t._v(" "),o("td",[o("Select",{attrs:{transfer:""},model:{value:t.pushDialog.pushMsgId,callback:function(e){t.$set(t.pushDialog,"pushMsgId",e)},expression:"pushDialog.pushMsgId"}},[o("Option",{attrs:{value:"1867"}},[t._v("一等奖中奖通知")]),t._v(" "),o("Option",{attrs:{value:"1868"}},[t._v("二等奖中奖通知")]),t._v(" "),o("Option",{attrs:{value:"1872"}},[t._v("退款通知")])],1)],1)]),t._v(" "),o("tr",[o("th",[t._v("用户范围")]),t._v(" "),o("td",[t.pushDialog.userCount>0?o("span",[t._v("所选用户数量："+t._s(t.pushDialog.userCount))]):t._e(),t._v(" "),o("Select",{attrs:{transfer:""},on:{"on-change":t.pushDialog.onUserScopeChange},model:{value:t.pushDialog.pushUserScope,callback:function(e){t.$set(t.pushDialog,"pushUserScope",e)},expression:"pushDialog.pushUserScope"}},[o("Option",{attrs:{value:"1"}},[t._v("一等奖用户")]),t._v(" "),o("Option",{attrs:{value:"2"}},[t._v("二等奖用户")]),t._v(" "),o("Option",{attrs:{value:"-1"}},[t._v("全部用户")]),t._v(" "),o("Option",{attrs:{value:"-99"}},[t._v("单个用户")])],1)],1)]),t._v(" "),o("tr",[o("th",[t._v("订单Id")]),t._v(" "),o("td",[o("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"订单号"},model:{value:t.pushDialog.pushUserOrderId,callback:function(e){t.$set(t.pushDialog,"pushUserOrderId",t._n("string"==typeof e?e.trim():e))},expression:"pushDialog.pushUserOrderId"}})],1)])])]),t._v(" "),o("Modal",{attrs:{title:"用户退款",closable:!1,"mask-closable":!1},on:{"on-ok":t.refundDialog.refund},model:{value:t.hiddenModal.showRefundDialog,callback:function(e){t.$set(t.hiddenModal,"showRefundDialog",e)},expression:"hiddenModal.showRefundDialog"}},[o("table",{staticClass:"popup"},[o("tr",[o("th",[t._v("ProductGroupId")]),t._v(" "),o("td",[o("label",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.groupId))])])]),t._v(" "),o("tr",[o("th",[t._v("订单状态")]),t._v(" "),o("td",[o("Select",{attrs:{transfer:""},model:{value:t.refundDialog.orderStatus,callback:function(e){t.$set(t.refundDialog,"orderStatus",e)},expression:"refundDialog.orderStatus"}},[o("Option",{attrs:{value:"1",selected:"selected"}},[t._v("取消订单并退款")])],1)],1)]),t._v(" "),o("tr",[o("th",[t._v("用户范围")]),t._v(" "),o("td",[t.refundDialog.userCount>0?o("span",[t._v("所选用户数量："+t._s(t.refundDialog.userCount))]):t._e(),t._v(" "),o("Select",{attrs:{transfer:""},on:{"on-change":t.refundDialog.onUserScopeChange},model:{value:t.refundDialog.userScope,callback:function(e){t.$set(t.refundDialog,"userScope",e)},expression:"refundDialog.userScope"}},[o("Option",{attrs:{value:"2"}},[t._v("二等奖用户")]),t._v(" "),o("Option",{attrs:{value:"-99"}},[t._v("单个用户")])],1)],1)]),t._v(" "),o("tr",[o("th",[t._v("订单Id")]),t._v(" "),o("td",[o("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"订单号"},model:{value:t.refundDialog.refundOrderId,callback:function(e){t.$set(t.refundDialog,"refundOrderId",t._n("string"==typeof e?e.trim():e))},expression:"refundDialog.refundOrderId"}})],1)])])]),t._v(" "),o("Modal",{attrs:{title:"给用户塞券",width:"720",closable:!1,"mask-closable":!1},on:{"on-ok":t.couponDialog.issueCoupon},model:{value:t.hiddenModal.showCouponDialog,callback:function(e){t.$set(t.hiddenModal,"showCouponDialog",e)},expression:"hiddenModal.showCouponDialog"}},[o("table",{staticClass:"popup"},[o("tr",[o("th",[t._v("ProductGroupId")]),t._v(" "),o("td",[o("label",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.groupId))])])]),t._v(" "),o("tr",[o("th",[t._v("用户范围")]),t._v(" "),o("td",[t.couponDialog.userCount>0?o("span",[t._v("所选用户数量："+t._s(t.couponDialog.userCount))]):t._e(),t._v(" "),o("Select",{attrs:{transfer:""},on:{"on-change":t.couponDialog.onUserScopeChange},model:{value:t.couponDialog.userScope,callback:function(e){t.$set(t.couponDialog,"userScope",e)},expression:"couponDialog.userScope"}},[o("Option",{attrs:{value:"1"}},[t._v("一等奖用户")]),t._v(" "),o("Option",{attrs:{value:"2"}},[t._v("二等奖用户")]),t._v(" "),o("Option",{attrs:{value:"-1"}},[t._v("全部用户")]),t._v(" "),o("Option",{attrs:{value:"-99"}},[t._v("单个用户")])],1)],1)]),t._v(" "),o("tr",[o("th",[t._v("订单Id")]),t._v(" "),o("td",[o("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"订单号"},model:{value:t.couponDialog.couponOrderId,callback:function(e){t.$set(t.couponDialog,"couponOrderId",t._n("string"==typeof e?e.trim():e))},expression:"couponDialog.couponOrderId"}})],1)])]),t._v(" "),o("div",{attrs:{id:"couponList"}},[o("header",{staticStyle:{"background-color":"#ccc","font-size":"1.2rem","line-height":"2rem","margin-top":"0.2em"}},[t._v("\n          请选择优惠券  \n          "),o("Button",{attrs:{type:"info"},on:{click:function(e){t.couponDialog.onAddCoupon()}}},[t._v("新增优惠券")])],1),t._v(" "),o("Table",{ref:"selection",attrs:{border:"",columns:t.couponDialog.cols,data:t.couponDialog.list,"no-data-text":"暂无优惠券"}})],1)]),t._v(" "),o("Modal",{attrs:{title:"查看日志",width:"800"},model:{value:t.hiddenModal.showLogDialog,callback:function(e){t.$set(t.hiddenModal,"showLogDialog",e)},expression:"hiddenModal.showLogDialog"}},[o("div",[o("label",[t._v("日志类型")]),t._v(" "),o("Select",{attrs:{transfer:""},on:{"on-change":function(e){t.logDialog.onLogTypeChange()}},model:{value:t.logDialog.logType,callback:function(e){t.$set(t.logDialog,"logType",e)},expression:"logDialog.logType"}},[o("Option",{attrs:{value:"PushMessage"}},[t._v("推送日志")]),t._v(" "),o("Option",{attrs:{value:"CancelOrder"}},[t._v("订单操作日志")]),t._v(" "),o("Option",{attrs:{value:"SendCoupon"}},[t._v("塞券日志")]),t._v(" "),o("Option",{attrs:{value:"SetLevel->1"}},[t._v("一等奖设置日志")])],1),t._v(" "),o("br"),o("br"),t._v(" "),o("Table",{ref:"selection",attrs:{width:"740",border:"",columns:t.logDialog.cols,data:t.logDialog.logList,"no-data-text":"暂无日志"}})],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"})]),t._v(" "),o("Modal",{attrs:{title:"添加优惠券",closable:!1,"mask-closable":!1},on:{"on-ok":t.couponDialog.onAdddCouponSuccess},model:{value:t.hiddenModal.showAddCouponDialog,callback:function(e){t.$set(t.hiddenModal,"showAddCouponDialog",e)},expression:"hiddenModal.showAddCouponDialog"}},[o("table",{staticClass:"popup"},[o("tr",[o("th",[t._v("ProductGroupId")]),t._v(" "),o("td",[o("label",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.groupId))])])]),t._v(" "),o("tr",[o("th",[t._v("优惠券GUID")]),t._v(" "),o("td",[o("Input",{on:{"on-blur":function(e){t.couponDialog.fetchCouponInfo()}},model:{value:t.couponDialog.newCoupon.CouponId,callback:function(e){t.$set(t.couponDialog.newCoupon,"CouponId",e)},expression:"couponDialog.newCoupon.CouponId"}})],1)]),t._v(" "),o("tr",[o("th",[t._v("优惠券说明")]),t._v(" "),o("td",[o("Input",{attrs:{readonly:!0},model:{value:t.couponDialog.newCoupon.CouponDesc,callback:function(e){t.$set(t.couponDialog.newCoupon,"CouponDesc",e)},expression:"couponDialog.newCoupon.CouponDesc"}})],1)]),t._v(" "),o("tr",[o("th",[t._v("使用条件")]),t._v(" "),o("td",[o("Input",{attrs:{readonly:!0},model:{value:t.couponDialog.newCoupon.CouponCondition,callback:function(e){t.$set(t.couponDialog.newCoupon,"CouponCondition",e)},expression:"couponDialog.newCoupon.CouponCondition"}})],1)]),t._v(" "),o("tr",[o("th",[t._v("有效期")]),t._v(" "),o("td",[o("Input",{attrs:{readonly:!0},model:{value:t.couponDialog.newCoupon.UsefulLife,callback:function(e){t.$set(t.couponDialog.newCoupon,"UsefulLife",e)},expression:"couponDialog.newCoupon.UsefulLife"}})],1)])])])],1)},staticRenderFns:[]};var I=o("VU/8")(C,y,!1,function(t){o("hcud")},null,null).exports,_=o("pFYg"),b=o.n(_),w=o("mvHQ"),S=o.n(w),x={data:function(){var t=this;return{index:0,tablemodal:{loading:!0,visible:!1,width:1350,data:[],columns:[{title:"PID",width:100,key:"PID",align:"center",fixed:"left"},{title:"义乌可用库存",width:100,key:"YiWuAvailableStockQuantity",align:"center",fixed:"left"},{title:"义乌在途库存",width:100,key:"YiWuZaituStockQuantity",align:"center",fixed:"left"},{title:"上海可用库存",width:100,key:"SHAvailableStockQuantity",align:"center",fixed:"left"},{title:"上海在途库存",width:100,key:"SHZaituStockQuantity",align:"center",fixed:"left"},{title:"武汉可用库存",width:100,key:"WHAvailableStockQuantity",align:"center",fixed:"left"},{title:"武汉在途库存",width:100,key:"WHZaituStockQuantity",align:"center",fixed:"left"},{title:"北京可用库存",width:100,key:"BeiJingAvailableStockQuantity",align:"center",fixed:"left"},{title:"北京在途库存",width:100,key:"BeiJingZaituStockQuantity",align:"center",fixed:"left"},{title:"广州可用库存",width:100,key:"GuangZhouAvailableStockQuantity",align:"center",fixed:"left"},{title:"广州在途库存",width:100,key:"GuangZhouZaituStockQuantity",align:"center",fixed:"left"},{title:"总可用库存",width:100,key:"TotalAvailableStockQuantity",align:"center",fixed:"left"},{title:"总在途库存",width:100,key:"TotalZaituStockQuantity",align:"center",fixed:"left"}]},logmodal:{loading:!0,visible:!1,width:885,data:[],columns:[{title:"类型",width:200,key:"MethodType",align:"center",fixed:"left"},{title:"消息",width:300,key:"Msg",align:"center",fixed:"left"},{title:"操作人",width:150,key:"OperateUser",align:"center",fixed:"left"},{title:"时间",width:200,key:"CreateTime",align:"center",fixed:"left",render:function(e,o){return e("span",t.formatDate(o.row.CreateTime))}}]},productmodal:{loading:!1,visible:!1,width:980,data:[],columns:[{title:"PID",width:200,key:"PID",align:"center",fixed:"left"},{title:"活动价",width:150,key:"FinalPrice",align:"center",fixed:"left"},{title:"采购价格",width:150,key:"PurchasePrice",align:"center",fixed:"left"},{title:"代发价格",width:150,key:"ContractPrice",align:"center",fixed:"left"},{title:"采购优惠价",width:150,key:"OfferPurchasePrice",align:"center",fixed:"left"},{title:"代发优惠价",width:150,key:"OfferContractPrice",align:"center",fixed:"left"}]},table:{loading:!0,data:[],columns:[{title:"GroupId",key:"ProductGroupId"},{title:"是否展示",key:"IsShow",render:function(e,o){return e("i-switch",{props:{type:"primary",size:"small",value:o.row.IsShow},on:{"on-change":function(e){t.UpdateProductConfigIsShow(o.row.ProductGroupId,e)}}})}},{title:"团类型",key:"GroupType",render:function(t,e){switch(e.row.GroupType){case 0:return t("span","普通团");case 1:return t("span","新人团");case 2:return t("span","团长特价");case 3:return t("span","团长免单");default:return t("span","普通团")}}},{title:"团种类",key:"GroupCategory",render:function(t,e){switch(e.row.GroupCategory){case 0:return t("span","普通拼团");case 1:return t("span","抽奖拼团");case 2:return t("span","优惠券拼团");default:return t("span","普通拼团")}}},{title:"运营标签",key:"Label"},{title:"商品PID    |   商品名称   |   活动价",width:450,align:"center",render:function(t,e){var o=[];if(e.row.GroupProductDetails.length>0)for(var a=0;a<e.row.GroupProductDetails.length;a++)e.row.GroupProductDetails[a].DisPlay&&(o[a]=t("tr",[t("td",{style:{width:"200px"}},e.row.GroupProductDetails[a].PID),t("td",{style:{width:"200px"}},e.row.GroupProductDetails[a].ProductName),t("td",{style:{width:"50px"}},e.row.GroupProductDetails[a].FinalPrice)]));return t("table",[o])}},{title:"操作",key:"action",align:"center",width:200,render:function(e,o){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.search(o.row.ProductGroupId,"Search")}}},"修改"),e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.search(o.row.ProductGroupId,"Copy")}}},"复制"),e("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.SearchLog(o.row.ProductGroupId)}}},"日志")])}}]},filters:{Label:"",ProductGroupId:"",ProductName:"",PID:"",Creator:"",GroupType:-1,GroupCategory:-1,Channel:"None",IsShowPage:1,Sequence:-1},activityStatus:"Ongoing",page:{total:10,current:1,pageSize:10},isAdd:!1,labelList:["优惠券团","抽奖团","1分团","低价团","精品团","团长免单"],activityStatusList:[{label:"全部",value:"All"},{label:"进行中",value:"Ongoing"},{label:"已结束",value:"Ending"}],groupTypeList:[{label:"普通团",value:0},{label:"新人团",value:1},{label:"团长特价",value:2},{label:"团长免单",value:3}],groupCategoryList:[{label:"普通拼团",value:0},{label:"抽奖拼团",value:1},{label:"优惠券拼团",value:2}],groupChannelList:[{label:"全部",value:"None"},{label:"H5",value:"H5"},{label:"微信小程序",value:"WXAPP"}],modal:{visible:!1,loading:!0,edit:!0,productConfig:{ProductGroupId:"",BeginTime:"",EndTime:"2999-01-01",IsShow:!0,MemberCount:2,GroupType:0,TotalGroupCount:"",CurrentGroupCount:0,SpecialUserTag:0,Sequence:0,Channel:"",H5Channel:!1,WXChannel:!1,Image:"",ShareImage:"",ShareId:"",GroupCategory:0,GroupDescription:"",Label:"优惠券团",GroupProductDetails:[{PID:"",ProductName:"",UpperLimitPerOrder:1,BuyLimitCount:0,DisPlay:!1,UseCoupon:!1,IsShow:!0,OriginalPrice:"",FinalPrice:"",SpecialPrice:"",TotalStockCount:1e6,CurrentSoldCount:0,IsAutoStock:!1,IsShowApp:!1}]},rules:{}}}},created:function(){this.loadData(1)},methods:{loadData:function(t){var e=this;this.page.current=t,this.table.loading=!0,this.ajax.get("/GroupBuyingV2/SelectGroupBuyingV2Config?filterStr="+S()(this.filters)+"&pageIndex="+this.page.current+"&pageSize="+this.page.pageSize+"&activityStatus="+this.activityStatus).then(function(t){var o=t.data;e.page.total=o.totalCount,e.table.data=o.data,e.table.loading=!1})},reset:function(){this.filters.Label="",this.filters.ProductGroupId="",this.filters.PID="",this.filters.ProductName="",this.activityStatus="Ongoing",this.filters.Creator="",this.filters.GroupType=-1,this.filters.GroupCategory=-1,this.filters.Channel="None",this.filters.IsShowPage=1,this.filters.Sequence=-1},formatDateForfmt:function(t){var e=t.getFullYear(),o=t.getMonth()+1,a=t.getDate();return o>=1&&o<=9&&(o="0"+o),a>=0&&a<=9&&(a="0"+a),e+"-"+o+"-"+a},addProductConfig:function(){this.isAdd=!0,this.modal.productConfig={ProductGroupId:"",BeginTime:"",EndTime:"",IsShow:!0,MemberCount:2,GroupType:0,TotalGroupCount:"",CurrentGroupCount:0,SpecialUserTag:0,Sequence:0,Channel:"",H5Channel:!1,WXChannel:!1,Image:"",ShareImage:"",ShareId:"",GroupCategory:0,GroupDescription:"",Label:"优惠券团",GroupProductDetails:[{PID:"",ProductName:"",UpperLimitPerOrder:1,BuyLimitCount:0,DisPlay:!0,UseCoupon:!1,IsShow:!0,OriginalPrice:"0",FinalPrice:"0",SpecialPrice:"0",TotalStockCount:1e6,CurrentSoldCount:0,IsAutoStock:!1,isShowSearch:!0,IsShowApp:!1}]},this.modal.visible=!0,this.modal.productConfig.BeginTime=this.formatDate(new Date),this.modal.productConfig.EndTime=this.formatDate(new Date(2099,0,1,0,0,0))},handlePageChange:function(t){this.loadData(t)},handlePageSizeChange:function(t){this.page.pageSize=t,this.loadData(this.page.current)},ExportGroupBuyingCofig:function(){window.open("/GroupBuyingV2/ExportGroupBuyingCofig?filterStr="+S()(this.filters)+"&activityStatus="+this.activityStatus)},ok:function(t){var e=this;this.modal.loading=!0,this.modal.productConfig.BeginTime=this.formatDate(this.modal.productConfig.BeginTime),this.modal.productConfig.EndTime=this.formatDate(this.modal.productConfig.EndTime),this.ajax.post("/GroupBuyingV2/UpsertGroupBuyingConfig",{productConfigJson:S()(this.modal.productConfig),isJudge:t}).then(function(t){t.data.status?(e.$Message.success("操作成功"),e.modal.visible=!1,e.loadData(e.page.current)):t.data.priceData?(e.modal.loading=!1,e.$nextTick(function(){e.modal.loading=!0}),e.$Message.error(t.data.msg),e.productmodal.data=t.data.priceData,e.productmodal.visible=!0):(e.modal.loading=!1,e.$nextTick(function(){e.modal.loading=!0}),e.$Message.error(t.data.msg))})},UpdateProductConfigIsShow:function(t,e){var o=this;this.table.loading=!0,this.ajax.post("/GroupBuyingV2/UpdateProductConfigIsShow",{groupId:t,isShow:e}).then(function(t){t.data?(o.$Message.success("操作成功"),o.loadData(o.page.current)):o.$Message.error("操作失败")})},ChannelChange:function(t){this.modal.productConfig.channel="",this.modal.productConfig.H5Channel&&(this.modal.productConfig.channel+="kH5;"),this.modal.productConfig.WXChannel&&(this.modal.productConfig.channel+="WXAPP")},search:function(t,e){var o=this;this.ajax.post("/GroupBuyingV2/SelectGroupBuyingV2ConfigByGroupId",{groupId:t}).then(function(t){o.modal.productConfig=t.data,o.modal.visible=!0,o.isAdd=!1,o.modal.productConfig.BeginTime=o.formatDate(o.modal.productConfig.BeginTime),o.modal.productConfig.EndTime=o.formatDate(o.modal.productConfig.EndTime);var a=o.modal.productConfig.Channel.split(";");for(var n in a)"kH5"===a[n]?o.modal.productConfig.H5Channel=!0:"WXAPP"===a[n]&&(o.modal.productConfig.WXChannel=!0);"Copy"===e&&(o.isAdd=!0,o.modal.productConfig.ProductGroupId="")})},GetAllProducts:function(){var t=this;this.modal.productConfig.GroupProductDetails[0].PID?this.ajax.post("/GroupBuyingV2/GetProductsByPIDAndIsLottery?pid="+this.modal.productConfig.GroupProductDetails[0].PID+"&isLottery="+(1===this.modal.productConfig.GroupCategory)).then(function(e){if(t.modal.productConfig.GroupProductDetails=[],e.data.length>0)for(var o=0;o<e.data.length;o++)t.modal.productConfig.GroupProductDetails.push({PID:e.data[o].PID,ProductName:e.data[o].DisplayName,UpperLimitPerOrder:1,BuyLimitCount:0,OriginalPrice:e.data[o].CY_List_Price,FinalPrice:e.data[o].CY_List_Price,SpecialPrice:e.data[o].CY_List_Price,isShowSearch:0===o,UseCoupon:!0,IsShow:!0,DisPlay:0===o,TotalStockCount:1e6,CurrentSoldCount:0,IsAutoStock:!1,IsShowApp:!1});else t.modal.productConfig.GroupProductDetails=[{PID:"",ProductName:"",UpperLimitPerOrder:1,BuyLimitCount:0,DisPlay:!0,UseCoupon:!0,IsShow:!0,OriginalPrice:"0",FinalPrice:"0",SpecialPrice:"0",isShowSearch:!0,TotalStockCount:1e6,CurrentSoldCount:0,IsAutoStock:!1,IsShowApp:!1}]}):this.$Message.error("请输入产品PID")},RefreshTaskCache:function(){var t=this;this.ajax.post("/GroupBuyingV2/RefreshTaskCache").then(function(e){t.$Message.success(e.data)})},SearchStock:function(t,e){var o=this;this.tablemodal.loading=!0,this.ajax.post("/GroupBuyingV2/GetStockInfoByPIDs",{groupId:t,pid:this.modal.productConfig.GroupProductDetails[0].PID,type:e,isLottery:1===this.modal.productConfig.GroupCategory}).then(function(t){o.tablemodal.data=t.data,o.tablemodal.visible=!0,o.tablemodal.loading=!1})},SearchLog:function(t){var e=this;this.logmodal.loading=!0,this.ajax.post("/GroupBuyingV2/GetLogByGroupId",{groupId:t}).then(function(t){e.logmodal.data=t.data,e.logmodal.visible=!0,e.logmodal.loading=!1})},handleFormatError:function(t){this.$Message.warning("请选择 .jpg  or .png  or .jpeg图片")},handleMaxSize:function(t){this.$Message.warning("请选择不超过100KB的图片")},handleSuccess:function(t,e){t.Status?"shareImage"===t.Type?this.modal.productConfig.ShareImage=t.ImageUrl:this.modal.productConfig.Image=t.ImageUrl:this.$Message.warning(t.Msg)},formatDate:function(t){if(t){if("string"===(void 0===t?"undefined":b()(t))){if(t.indexOf("Date")>0){var e=new Date(parseInt(t.replace("/Date(","").replace(")/",""))),o=e.getFullYear(),a=e.getDate(),n=e.getMonth()+1,i=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),s=function(t,e){for(var o=t.toString();o.length<e;)o="0"+o;return o};return 1===o?"":s(o,4)+"-"+s(n,2)+"-"+s(a,2)+" "+s(i,2)+":"+s(r,2)+":"+s(l,2)}return t}var u=t.getFullYear(),d=t.getDate(),c=t.getMonth()+1,p=t.getHours(),g=t.getMinutes(),f=t.getSeconds(),m=function(t,e){for(var o=t.toString();o.length<e;)o="0"+o;return o};return 1===o?"":m(u,4)+"-"+m(c,2)+"-"+m(d,2)+" "+m(p,2)+":"+m(g,2)+":"+m(f,2)}}}},k={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("h1",{staticClass:"title"},[t._v("拼团产品配置")]),t._v(" "),o("div",[o("lable",[t._v("商品名称：")]),t._v(" "),o("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"商品名称"},model:{value:t.filters.ProductName,callback:function(e){t.$set(t.filters,"ProductName",e)},expression:"filters.ProductName"}}),t._v(" "),o("lable",{staticStyle:{"margin-left":"15px"}},[t._v("产品PID：")]),t._v(" "),o("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"PID"},model:{value:t.filters.PID,callback:function(e){t.$set(t.filters,"PID",e)},expression:"filters.PID"}}),t._v(" "),o("lable",{staticStyle:{"margin-left":"15px"}},[t._v("创建人：")]),t._v(" "),o("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"创建人"},model:{value:t.filters.Creator,callback:function(e){t.$set(t.filters,"Creator",e)},expression:"filters.Creator"}}),t._v(" "),o("lable",{staticStyle:{"margin-left":"15px"}},[t._v("GroupId：")]),t._v(" "),o("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"GroupId"},model:{value:t.filters.ProductGroupId,callback:function(e){t.$set(t.filters,"ProductGroupId",e)},expression:"filters.ProductGroupId"}})],1),t._v(" "),o("div",{staticStyle:{"margin-top":"18px"}},[o("lable",[t._v("运营标签：")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"运营标签"},model:{value:t.filters.Label,callback:function(e){t.$set(t.filters,"Label",e)},expression:"filters.Label"}},[o("Option",{key:"",attrs:{value:""}},[t._v("全部")]),t._v(" "),t._l(t.labelList,function(e){return o("Option",{key:e.value,attrs:{value:e}},[t._v(t._s(e))])})],2),t._v(" "),o("lable",{staticStyle:{"margin-left":"13px"}},[t._v("活动状态：")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"活动状态"},model:{value:t.activityStatus,callback:function(e){t.activityStatus=e},expression:"activityStatus"}},t._l(t.activityStatusList,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),t._v(" "),o("lable",{staticStyle:{"margin-left":"15px"}},[t._v("团类型：")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"拼团类型"},model:{value:t.filters.GroupType,callback:function(e){t.$set(t.filters,"GroupType",e)},expression:"filters.GroupType"}},[o("Option",{key:-1,attrs:{value:-1}},[t._v("全部")]),t._v(" "),t._l(t.groupTypeList,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})],2),t._v(" "),o("lable",{staticStyle:{"margin-left":"20px"}},[t._v("团种类：")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"拼团种类"},model:{value:t.filters.GroupCategory,callback:function(e){t.$set(t.filters,"GroupCategory",e)},expression:"filters.GroupCategory"}},[o("Option",{key:-1,attrs:{value:-1}},[t._v("全部")]),t._v(" "),t._l(t.groupCategoryList,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})],2)],1),t._v(" "),o("div",{staticStyle:{"margin-top":"18px"}},[o("lable",[t._v("显示渠道：")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"显示渠道"},model:{value:t.filters.Channel,callback:function(e){t.$set(t.filters,"Channel",e)},expression:"filters.Channel"}},t._l(t.groupChannelList,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),t._v(" "),o("lable",{staticStyle:{"margin-left":"13px"}},[t._v("是否显示：")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否显示"},model:{value:t.filters.IsShowPage,callback:function(e){t.$set(t.filters,"IsShowPage",e)},expression:"filters.IsShowPage"}},[o("Option",{key:-1,attrs:{value:-1}},[t._v("全部")]),t._v(" "),o("Option",{key:1,attrs:{value:1}},[t._v("显示")]),t._v(" "),o("Option",{key:0,attrs:{value:0}},[t._v("不显示")])],1),t._v(" "),o("lable",{staticStyle:{"margin-left":"13px"}},[t._v("显示顺序：")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"是否显示"},model:{value:t.filters.Sequence,callback:function(e){t.$set(t.filters,"Sequence",e)},expression:"filters.Sequence"}},[o("Option",{key:-1,attrs:{value:-1}},[t._v("全部")]),t._v(" "),o("Option",{key:1,attrs:{value:1}},[t._v("不为0")]),t._v(" "),o("Option",{key:0,attrs:{value:0}},[t._v("为0")])],1)],1),t._v(" "),o("div",{staticStyle:{"margin-top":"18px"}},[o("Button",{attrs:{type:"success",icon:"search"},on:{click:function(e){t.loadData(1)}}},[t._v("搜索")]),t._v(" "),o("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",icon:"refresh"},on:{click:t.reset}},[t._v("重置")]),t._v(" "),o("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",icon:"plus"},on:{click:t.addProductConfig}},[t._v("创建")]),t._v(" "),o("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",icon:"share"},on:{click:t.ExportGroupBuyingCofig}},[t._v("导出")]),t._v(" "),o("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",icon:"load-c"},on:{click:t.RefreshTaskCache}},[t._v("刷新缓存")])],1),t._v(" "),o("div",{staticStyle:{"margin-top":"18px"}},[o("Table",{attrs:{height:600,loading:t.table.loading,data:t.table.data,columns:t.table.columns,stripe:""}}),t._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:t.page.total,"page-size":t.page.pageSize,current:t.page.current,"page-size-opts":[5,10,20,50],"show-elevator":"","show-sizer":""},on:{"on-change":t.handlePageChange,"on-page-size-change":t.handlePageSizeChange}})],1)])],1),t._v(" "),o("Modal",{attrs:{title:"库存列表",cancelText:"取消",height:300,scrollable:"true",width:t.tablemodal.width},on:{"on-cancel":t.cancel},model:{value:t.tablemodal.visible,callback:function(e){t.$set(t.tablemodal,"visible",e)},expression:"tablemodal.visible"}},[o("Table",{attrs:{loading:t.tablemodal.loading,data:t.tablemodal.data,columns:t.tablemodal.columns,stripe:""}})],1),t._v(" "),o("Modal",{attrs:{title:"操作日志",cancelText:"取消",scrollable:"true",width:t.logmodal.width},on:{"on-cancel":t.cancel},model:{value:t.logmodal.visible,callback:function(e){t.$set(t.logmodal,"visible",e)},expression:"logmodal.visible"}},[o("Table",{attrs:{loading:t.logmodal.loading,data:t.logmodal.data,columns:t.logmodal.columns,stripe:""}})],1),t._v(" "),o("Modal",{attrs:{title:"商品价格信息确认",cancelText:"取消",scrollable:"true",width:t.productmodal.width},on:{"on-cancel":t.cancel,"on-ok":function(e){t.ok(!1)}},model:{value:t.productmodal.visible,callback:function(e){t.$set(t.productmodal,"visible",e)},expression:"productmodal.visible"}},[o("Table",{attrs:{loading:t.productmodal.loading,data:t.productmodal.data,columns:t.productmodal.columns,stripe:""}})],1),t._v(" "),o("Modal",{attrs:{"mask-closable":!1,loading:t.modal.loading,title:"拼团产品配置（编辑）",okText:"提交",transfer:!1,cancelText:"取消",scrollable:"true",width:"50%"},on:{"on-ok":function(e){t.ok(!0)},"on-cancel":t.cancel},model:{value:t.modal.visible,callback:function(e){t.$set(t.modal,"visible",e)},expression:"modal.visible"}},[o("Form",{ref:"modal.productConfig",attrs:{model:t.modal.productConfig,rules:t.modal.rules,"label-width":90}},[o("FormItem",{attrs:{label:"GroupId",prop:"ProductGroupId"}},[o("Input",{attrs:{disabled:!0,placeholder:"自动生成"},model:{value:t.modal.productConfig.ProductGroupId,callback:function(e){t.$set(t.modal.productConfig,"ProductGroupId",e)},expression:"modal.productConfig.ProductGroupId"}})],1),t._v(" "),o("FormItem",{attrs:{label:"上下架时间"}},[o("Row",[o("Col",{attrs:{span:"8"}},[o("Date-Picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",transfer:"",placeholder:"上架时间"},model:{value:t.modal.productConfig.BeginTime,callback:function(e){t.$set(t.modal.productConfig,"BeginTime",e)},expression:"modal.productConfig.BeginTime"}})],1),t._v(" "),o("Col",{attrs:{span:"8"}},[o("Date-Picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",transfer:"",placeholder:"下架时间"},model:{value:t.modal.productConfig.EndTime,callback:function(e){t.$set(t.modal.productConfig,"EndTime",e)},expression:"modal.productConfig.EndTime"}})],1)],1)],1),t._v(" "),o("FormItem",{attrs:{label:"列表页展示",prop:"IsShow"}},[o("i-switch",{attrs:{size:"large"},model:{value:t.modal.productConfig.IsShow,callback:function(e){t.$set(t.modal.productConfig,"IsShow",e)},expression:"modal.productConfig.IsShow"}},[o("span",{attrs:{slot:"open"},slot:"open"},[t._v("On")]),t._v(" "),o("span",{attrs:{slot:"close"},slot:"close"},[t._v("Off")])])],1),t._v(" "),o("FormItem",{attrs:{label:"拼团人数",prop:"MemberCount"}},[o("Input-Number",{attrs:{disabled:!t.isAdd,max:8,min:2,placeholder:"拼团人数"},model:{value:t.modal.productConfig.MemberCount,callback:function(e){t.$set(t.modal.productConfig,"MemberCount",e)},expression:"modal.productConfig.MemberCount"}})],1),t._v(" "),o("FormItem",{attrs:{label:"拼团类型",prop:"GroupType"}},[o("Select",{staticStyle:{width:"80%"},attrs:{disabled:!t.isAdd,placeholder:"拼团类型",transfer:""},model:{value:t.modal.productConfig.GroupType,callback:function(e){t.$set(t.modal.productConfig,"GroupType",e)},expression:"modal.productConfig.GroupType"}},t._l(t.groupTypeList,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1),t._v(" "),o("FormItem",{attrs:{label:"拼团种类",prop:"GroupCategory"}},[o("Select",{staticStyle:{width:"80%"},attrs:{disabled:!t.isAdd,placeholder:"拼团种类",transfer:""},model:{value:t.modal.productConfig.GroupCategory,callback:function(e){t.$set(t.modal.productConfig,"GroupCategory",e)},expression:"modal.productConfig.GroupCategory"}},t._l(t.groupCategoryList,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1),t._v(" "),o("FormItem",{attrs:{label:"运营标签",prop:"Label"}},[o("Select",{staticStyle:{width:"23%"},attrs:{placeholder:"运营标签",transfer:""},model:{value:t.modal.productConfig.Label,callback:function(e){t.$set(t.modal.productConfig,"Label",e)},expression:"modal.productConfig.Label"}},t._l(t.labelList,function(e){return o("Option",{key:e.value,attrs:{value:e}},[t._v(t._s(e))])}))],1),t._v(" "),o("FormItem",{attrs:{label:"特定人群",prop:"SpecialUserTag"}},[o("Input-Number",{attrs:{max:100,min:0,placeholder:"特定人群"},model:{value:t.modal.productConfig.SpecialUserTag,callback:function(e){t.$set(t.modal.productConfig,"SpecialUserTag",e)},expression:"modal.productConfig.SpecialUserTag"}})],1),t._v(" "),o("FormItem",{attrs:{label:"显示顺序",prop:"Sequence"}},[o("Input-Number",{attrs:{max:1e10,min:0,placeholder:"首页显示顺序"},model:{value:t.modal.productConfig.Sequence,callback:function(e){t.$set(t.modal.productConfig,"Sequence",e)},expression:"modal.productConfig.Sequence"}})],1),t._v(" "),o("FormItem",{attrs:{label:"显示渠道",prop:"Channel"}},[o("Checkbox",{attrs:{name:"Channel","data-key":"kH5"},on:{"on-change":t.ChannelChange},model:{value:t.modal.productConfig.H5Channel,callback:function(e){t.$set(t.modal.productConfig,"H5Channel",e)},expression:"modal.productConfig.H5Channel"}},[t._v("H5")]),t._v(" "),o("Checkbox",{attrs:{name:"Channel","data-key":"WXAPP"},on:{"on-change":t.ChannelChange},model:{value:t.modal.productConfig.WXChannel,callback:function(e){t.$set(t.modal.productConfig,"WXChannel",e)},expression:"modal.productConfig.WXChannel"}},[t._v("微信小程序")])],1),t._v(" "),o("FormItem",{attrs:{label:"宣传图片",prop:"Image"}},[o("Col",{directives:[{name:"show",rawName:"v-show",value:""!=t.modal.productConfig.Image,expression:"modal.productConfig.Image!=''"}],attrs:{span:"4"}},[o("a",{attrs:{href:t.modal.productConfig.Image,target:"_blank"}},[o("img",{staticStyle:{width:"50px",height:"50px"},attrs:{src:t.modal.productConfig.Image}})])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Upload",{attrs:{action:"/GroupBuyingV2/UploadImage?type=image",format:["jpg","jpeg","png"],"on-format-error":t.handleFormatError,"max-size":1e4,"on-exceeded-size":t.handleMaxSize,"on-success":t.handleSuccess,"show-upload-list":!1}},[o("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[t._v("Upload files")])],1)],1),t._v(" "),o("Col",{directives:[{name:"show",rawName:"v-show",value:""!=t.modal.productConfig.Image,expression:"modal.productConfig.Image!=''"}],attrs:{span:"5"}},[o("Button",{attrs:{type:"warning",icon:"refresh"},on:{click:function(e){t.modal.productConfig.Image=""}}},[t._v("清除")])],1)],1),t._v(" "),o("FormItem",{attrs:{label:"分享图片",prop:"ShareImage"}},[o("Col",{directives:[{name:"show",rawName:"v-show",value:""!=t.modal.productConfig.ShareImage,expression:"modal.productConfig.ShareImage!=''"}],attrs:{span:"4"}},[o("a",{attrs:{href:t.modal.productConfig.ShareImage,target:"_blank"}},[o("img",{staticStyle:{width:"50px",height:"50px"},attrs:{src:t.modal.productConfig.ShareImage}})])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Upload",{attrs:{action:"/GroupBuyingV2/UploadImage?type=shareImage",format:["jpg","jpeg","png"],"on-format-error":t.handleFormatError,"max-size":1e4,"on-exceeded-size":t.handleMaxSize,"on-success":t.handleSuccess,"show-upload-list":!1}},[o("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[t._v("Upload files")])],1)],1),t._v(" "),o("Col",{directives:[{name:"show",rawName:"v-show",value:""!=t.modal.productConfig.ShareImage,expression:"modal.productConfig.ShareImage!=''"}],attrs:{span:"5"}},[o("Button",{attrs:{type:"warning",icon:"refresh"},on:{click:function(e){t.modal.productConfig.ShareImage=""}}},[t._v("清除")])],1)],1),t._v(" "),o("FormItem",{attrs:{label:"分享文案",prop:"ShareId"}},[o("Input",{attrs:{placeholder:"分享文案"},model:{value:t.modal.productConfig.ShareId,callback:function(e){t.$set(t.modal.productConfig,"ShareId",e)},expression:"modal.productConfig.ShareId"}})],1),t._v(" "),o("FormItem",{attrs:{label:"抽奖规则描述",prop:"GroupDescription"}},[o("Input",{attrs:{type:"textarea",rows:4,placeholder:"抽奖规则描述"},model:{value:t.modal.productConfig.GroupDescription,callback:function(e){t.$set(t.modal.productConfig,"GroupDescription",e)},expression:"modal.productConfig.GroupDescription"}})],1),t._v(" "),t.isAdd?o("FormItem",[o("Button",{attrs:{type:"success",icon:"search"},on:{click:function(e){t.GetAllProducts()}}},[t._v("获取产品信息")]),t._v(" "),o("Button",{attrs:{type:"info",icon:"search"},on:{click:function(e){t.SearchStock("","PID")}}},[t._v("查看库存")])],1):t._e(),t._v(" "),t.isAdd?t._e():o("FormItem",[o("Button",{attrs:{type:"info",icon:"search"},on:{click:function(e){t.SearchStock(t.modal.productConfig.ProductGroupId,"GroupId")}}},[t._v("查看库存")])],1),t._v(" "),t._l(t.modal.productConfig.GroupProductDetails,function(e,a){return o("FormItem",{key:a,attrs:{label:"商品配置-"+ ++a,prop:"executors."+a}},[o("Row",[o("Col",{attrs:{span:"10"}},[o("Input",{attrs:{type:"text",disabled:!t.isAdd,placeholder:"商品PID"},model:{value:e.PID,callback:function(o){t.$set(e,"PID",o)},expression:"item.PID"}})],1),t._v(" "),o("Col",{attrs:{span:"10",offset:"1"}},[o("Input",{attrs:{type:"text",placeholder:"商品名称"},model:{value:e.ProductName,callback:function(o){t.$set(e,"ProductName",o)},expression:"item.ProductName"}})],1)],1),t._v(" "),o("Row",[o("Col",{attrs:{span:"11"}},[o("Checkbox",{model:{value:e.UseCoupon,callback:function(o){t.$set(e,"UseCoupon",o)},expression:"item.UseCoupon"}},[t._v("是否允许使用优惠券")])],1),t._v(" "),o("Col",{attrs:{span:"11"}},[o("Checkbox",{model:{value:e.DisPlay,callback:function(o){t.$set(e,"DisPlay",o)},expression:"item.DisPlay"}},[t._v("是否用于默认展示")])],1)],1),t._v(" "),o("Row",[o("Col",{attrs:{span:"11"}},[o("Checkbox",{model:{value:e.IsShow,callback:function(o){t.$set(e,"IsShow",o)},expression:"item.IsShow"}},[t._v("是否显示（至少有一个商品显示)")])],1),t._v(" "),o("Col",{attrs:{span:"4"}},[o("label",{staticClass:"ivu-form-item-label"},[t._v("商品售价：")])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input",{attrs:{type:"text",placeholder:"商品售价"},model:{value:e.OriginalPrice,callback:function(o){t.$set(e,"OriginalPrice",o)},expression:"item.OriginalPrice"}})],1)],1),t._v(" "),o("Row",[o("Col",{attrs:{span:"4"}},[o("label",{staticClass:"ivu-form-item-label"},[t._v("商品活动价：")])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input",{attrs:{type:"text",placeholder:"商品活动价"},model:{value:e.FinalPrice,callback:function(o){t.$set(e,"FinalPrice",o)},expression:"item.FinalPrice"}})],1),t._v(" "),o("Col",{attrs:{span:"4",offset:"1"}},[o("label",{staticClass:"ivu-form-item-label"},[t._v("商品团长价：")])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input",{attrs:{type:"text",placeholder:"商品团长价"},model:{value:e.SpecialPrice,callback:function(o){t.$set(e,"SpecialPrice",o)},expression:"item.SpecialPrice"}})],1)],1),t._v(" "),o("Row",[o("Col",{attrs:{span:"4"}},[o("label",{staticClass:"ivu-form-item-label"},[t._v("每人限购单数：")])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input-Number",{attrs:{max:100,min:0,placeholder:"每人限购单数："},model:{value:e.BuyLimitCount,callback:function(o){t.$set(e,"BuyLimitCount",o)},expression:"item.BuyLimitCount"}})],1),t._v(" "),o("Col",{attrs:{span:"4",offset:"1"}},[o("label",{staticClass:"ivu-form-item-label"},[t._v("每单限购数量：")])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input-Number",{attrs:{max:100,min:1,placeholder:"每单限购数量"},model:{value:e.UpperLimitPerOrder,callback:function(o){t.$set(e,"UpperLimitPerOrder",o)},expression:"item.UpperLimitPerOrder"}})],1)],1),t._v(" "),o("Row",[o("Col",{attrs:{span:"4"}},[o("label",{staticClass:"ivu-form-item-label"},[t._v("配置总库存：")])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input-Number",{attrs:{max:1e6,min:0,placeholder:"配置总库存："},model:{value:e.TotalStockCount,callback:function(o){t.$set(e,"TotalStockCount",o)},expression:"item.TotalStockCount"}})],1),t._v(" "),o("Col",{attrs:{span:"4",offset:"1"}},[o("label",{staticClass:"ivu-form-item-label"},[t._v("产品已消耗库存：")])]),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input-Number",{attrs:{disabled:!0,max:1e6,min:0,placeholder:"产品已消耗库存："},model:{value:e.CurrentSoldCount,callback:function(o){t.$set(e,"CurrentSoldCount",o)},expression:"item.CurrentSoldCount"}})],1)],1),t._v(" "),o("Row",[o("Col",{attrs:{span:"11"}},[o("Checkbox",{model:{value:e.IsAutoStock,callback:function(o){t.$set(e,"IsAutoStock",o)},expression:"item.IsAutoStock"}},[t._v("是否自动库存")])],1),t._v(" "),o("Col",{attrs:{span:"11"}},[o("Checkbox",{model:{value:e.IsShowApp,callback:function(o){t.$set(e,"IsShowApp",o)},expression:"item.IsShowApp"}},[t._v("是否在APP详情页显示")])],1)],1)],1)})],2)],1)],1)},staticRenderFns:[]};var D=o("VU/8")(x,k,!1,function(t){o("3wPY")},null,null).exports,P={data:function(){var t=this;return{index:0,isAdd:1,page:{total:0,current:1,pageSize:5},logpage:{total:0,current:1,pageSize:5},filters:{PID:""},tablemodel:{loading:!0,visible:!1,width:1355,data:[]},logmodal:{loading:!0,visible:!1,width:635,data:[],columns:[{title:"操作人",width:150,key:"Creator",align:"center",fixed:"left"},{title:"时间",width:150,key:"CreateDateTime",render:function(e,o){return e("span",t.formatDate(o.row.CreateDateTime))}},{title:"操作内容",width:300,key:"Remark",align:"center",fixed:"left"}]},table:{loading:!0,data:[],columns:[{title:"#",width:50,align:"center",fixed:"left",type:"index"},{title:"商品PID",key:"PID",width:180},{title:"商品名称",key:"ProductName"},{title:"上下架状态",width:100,key:"IsActiveStr"},{title:"商品价格",width:100,key:"ProductPrice"},{title:"优惠券数量",width:100,key:"CouponCount"},{title:"创建时间",width:150,key:"CreateTimeStr"},{title:"更新时间",width:150,key:"UpdateTimeStr"},{title:"操作",width:100,align:"center",render:function(e,o){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.search(o.row.PID,"Search")}}},"修改/查询")])}}]},modal:{visible:!1,loading:!0,edit:!0,productConfig:{PID:"",ProductName:"",ProductPrice:0,IsActive:!0,CouponCount:0,CreateTime:"",UpdateTime:"",Coupons:[],CreateTimeStr:"",UpdateTimeStr:"",IsActiveStr:""}},coupon:{CouponId:"",CouponName:"",CouponPrice:"",CouponRate:"",CouponLeastPrice:"",CouponDescription:"",AvailablePeriod:"",AllowEdit:!0}}},created:function(){this.loadData(1)},methods:{loadData:function(t){var e=this;this.page.current=t,this.table.loading=!0;var o="?PID="+this.filters.PID;o+="&pageIndex="+this.page.current,o+="&pageSize="+this.page.pageSize,this.ajax.get("/GroupBuyingV2/PT_GetCouponList"+o).then(function(t){var o=t.data;e.page.total=o.totalCount,e.table.data=o.data,e.table.loading=!1})},search:function(t){var e=this;t?this.ajax.get("/GroupBuyingV2/VirtualProductCouponConfigDetail?pid="+t).then(function(t){2===t.data.status?e.$Message.warning(t.data.errMsg):0===t.data.status&&(e.modal.productConfig=t.data.data,e.modal.visible=!0,e.isAdd=2)}):(this.modal.productConfig={PID:"",ProductName:"",ProductPrice:0,IsActive:!0,CouponCount:0,CreateTime:"",UpdateTime:"",Coupons:[],CreateTimeStr:"",UpdateTimeStr:"",IsActiveStr:""},this.modal.visible=!0,this.isAdd=1)},SearchLog:function(t){var e=this;this.logmodal.loading=!0,this.logpage.current=t,this.ajax.post("/CommonConfigLog/GetCommonConfigLogList",{objectType:"VirtualProductCouponConfig",page:this.logpage.current,rows:this.logpage.pageSize,sord:"asc"}).then(function(t){var o=t.data;e.logmodal.data=o.rows,e.logpage.total=o.records,e.logmodal.visible=!0,e.logmodal.loading=!1})},AddCoupon:function(){this.modal.productConfig.ProductName?this.modal.productConfig.Coupons.push({CouponId:"",CouponName:"",CouponPrice:"",CouponRate:"",CouponLeastPrice:"",CouponDescription:"",AvailablePeriod:"",AllowEdit:!0}):this.$Message.warning("请先输入有效的商品信息")},FetchCouponInfo:function(t,e){var o=this;t&&o.ajax.post("/GroupBuyingV2/FetchCouponInfo",{couponId:t}).then(function(t){t.data?(o.modal.productConfig.Coupons[e].AvailablePeriod=t.data.AvailablePeriod,o.modal.productConfig.Coupons[e].CouponDescription=t.data.CouponDescription,o.modal.productConfig.Coupons[e].CouponId=t.data.CouponId,o.modal.productConfig.Coupons[e].CouponLeastPrice=t.data.CouponLeastPrice,o.modal.productConfig.Coupons[e].CouponName=t.data.CouponName,o.modal.productConfig.Coupons[e].CouponPrice=t.data.CouponPrice):o.$Message.warning("优惠券 PID 无效")})},SaveProductCouponConfig:function(){var t=this,e=this,o=[],a=0;if(!e.modal.productConfig.PID||!e.modal.productConfig.ProductName||!e.modal.productConfig.ProductPrice)return e.$Message.warning("商品信息不能为空或者不正确"),e.$nextTick(function(){e.modal.loading=!0}),void(e.modal.loading=!1);for(var n=0;n<e.modal.productConfig.Coupons.length;n++)if(e.modal.productConfig.Coupons[n].CouponId){if(!(e.modal.productConfig.Coupons[n].CouponRate>0))return e.$Message.warning("优惠券的成本比例只能是不能为0的整数"),e.$nextTick(function(){e.modal.loading=!0}),void(e.modal.loading=!1);a+=parseInt(e.modal.productConfig.Coupons[n].CouponRate),o.push({PKID:e.modal.productConfig.Coupons[n].PKID,PID:e.modal.productConfig.PID,CouponId:e.modal.productConfig.Coupons[n].CouponId,CouponRate:e.modal.productConfig.Coupons[n].CouponRate})}if(100!==a)return e.$Message.warning("优惠券的百分百总和不为100%"),e.$nextTick(function(){e.modal.loading=!0}),void(e.modal.loading=!1);if(0===o.length)return e.$Message.warning("商品优惠券不能为空"),e.$nextTick(function(){t.modal.loading=!0}),void(e.modal.loading=!1);var i=S()(o);e.modal.loading=!0,e.ajax.post("/GroupBuyingV2/SaveProductCouponConfig",{configJson:i,operType:e.isAdd}).then(function(t){t.data?(e.$Message.error(t.data),e.$nextTick(function(){e.modal.loading=!0})):(e.$Message.success("操作成功"),e.modal.visible=!1,e.loadData(e.page.current)),e.modal.loading=!1})},FetchProductInfo:function(t){var e=this;t&&e.ajax.post("/GroupBuyingV2/FetchProductInfo",{pid:t}).then(function(t){t.data?(e.modal.productConfig.PID=t.data.PID,e.modal.productConfig.ProductName=t.data.ProductName,e.modal.productConfig.ProductPrice=t.data.ProductPrice):e.$Message.warning("商品 PID 无效")})},handlePageChange:function(t){this.loadData(t)},handlePageSizeChange:function(t){this.page.pageSize=t,this.loadData(this.page.current)},deleteCoupon:function(t){this.modal.productConfig.Coupons.splice(t,1)},handleLogPageChange:function(t){this.SearchLog(t)},handleLogPageSizeChange:function(t){this.logpage.pageSize=t,this.loadData(this.logpage.current)},formatDate:function(t){if(t){var e=new Date(t),o=e.getFullYear(),a=e.getDate(),n=e.getMonth()+1,i=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),s=function(t,e){for(var o=t.toString();o.length<e;)o="0"+o;return o};return 1===o?"":s(o,4)+"-"+s(n,2)+"-"+s(a,2)+" "+s(i,2)+":"+s(r,2)+":"+s(l,2)}}}},G={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("h1",{staticClass:"title"},[t._v("拼团优惠券配置")]),t._v(" "),o("div",[o("label",[t._v("商品PID")]),t._v(" "),o("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"商品名称"},model:{value:t.filters.PID,callback:function(e){t.$set(t.filters,"PID",e)},expression:"filters.PID"}})],1),t._v(" "),o("div",{staticStyle:{"margin-top":"18px"}},[o("Button",{attrs:{type:"success",icon:"search"},on:{click:function(e){t.loadData(1)}}},[t._v("搜索")]),t._v(" "),o("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",icon:"plus"},on:{click:function(e){t.search(0)}}},[t._v("创建")]),t._v(" "),o("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",icon:"load-c"},on:{click:function(e){t.SearchLog(1)}}},[t._v("日志")])],1),t._v(" "),o("div",{staticStyle:{"margin-top":"18px"}},[o("Table",{staticStyle:{width:"100%"},attrs:{loading:t.table.loading,data:t.table.data,columns:t.table.columns,stripe:""}}),t._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:t.page.total,"page-size":t.page.pageSize,current:t.page.current,"page-size-opts":[5,10,20,50],"show-sizer":""},on:{"on-change":t.handlePageChange,"on-page-size-change":t.handlePageSizeChange}})],1)])],1),t._v(" "),o("Modal",{attrs:{loading:t.modal.loading,title:"拼团优惠券配置（编辑）",okText:"提交",transfer:!1,cancelText:"取消",width:"50%"},on:{"on-ok":t.SaveProductCouponConfig},model:{value:t.modal.visible,callback:function(e){t.$set(t.modal,"visible",e)},expression:"modal.visible"}},[o("Form",{ref:"modal.productConfig",attrs:{model:t.modal.productConfig,rules:t.modal.rules,"label-width":90}},[o("FormItem",{attrs:{label:"PID",prop:"PID"}},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.modal.productConfig.PID,expression:"modal.productConfig.PID"}],attrs:{disabled:!t.isAdd,placeholder:"自动生成"},domProps:{value:t.modal.productConfig.PID},on:{blur:function(e){t.FetchProductInfo(t.modal.productConfig.PID)},input:function(e){e.target.composing||t.$set(t.modal.productConfig,"PID",e.target.value)}}})]),t._v(" "),o("FormItem",{attrs:{label:"商品名称"}},[o("Input",{attrs:{disabled:!0},model:{value:t.modal.productConfig.ProductName,callback:function(e){t.$set(t.modal.productConfig,"ProductName",e)},expression:"modal.productConfig.ProductName"}})],1),t._v(" "),o("FormItem",{attrs:{label:"商品价格"}},[o("Input",{attrs:{disabled:!0},model:{value:t.modal.productConfig.ProductPrice,callback:function(e){t.$set(t.modal.productConfig,"ProductPrice",e)},expression:"modal.productConfig.ProductPrice"}})],1),t._v(" "),t._l(t.modal.productConfig.Coupons,function(e,a){return o("FormItem",{key:a,attrs:{label:"优惠券-"+(a+1),prop:"executors."+a}},[o("Row",[o("input",{directives:[{name:"model",rawName:"v-model",value:e.CouponId,expression:"item.CouponId"}],key:a,staticStyle:{display:"inline-block",width:"200px"},attrs:{type:"text",disabled:!e.AllowEdit,placeholder:"优惠券PID"},domProps:{value:e.CouponId},on:{blur:function(o){t.FetchCouponInfo(e.CouponId,a)},input:function(o){o.target.composing||t.$set(e,"CouponId",o.target.value)}}}),t._v(" "),o("Input",{staticStyle:{display:"inline-block",width:"200px"},attrs:{type:"text",disabled:!0,placeholder:"优惠券名称"},model:{value:e.CouponName,callback:function(o){t.$set(e,"CouponName",o)},expression:"item.CouponName"}}),t._v(" "),o("label",{staticStyle:{display:"inline-block",width:"50px","font-size":"10px"}},[t._v("面额(元)")]),t._v(" "),o("Input",{staticStyle:{display:"inline-block",width:"100px"},attrs:{type:"text",disabled:!0},model:{value:e.CouponPrice,callback:function(o){t.$set(e,"CouponPrice",o)},expression:"item.CouponPrice"}})],1),t._v(" "),o("Row",[o("label",{staticStyle:{display:"inline-block",width:"100px","font-size":"10px"}},[t._v("虚拟成本比例(%)")]),t._v(" "),o("Input",{staticStyle:{display:"inline-block",width:"200px"},attrs:{type:"text",placeholder:"1-100"},model:{value:e.CouponRate,callback:function(o){t.$set(e,"CouponRate",o)},expression:"item.CouponRate"}}),t._v(" "),o("label",{staticStyle:{display:"inline-block",width:"100px","font-size":"10px"}},[t._v("使用条件(元)")]),t._v(" "),o("Input",{staticStyle:{display:"inline-block",width:"200px"},attrs:{type:"text",disabled:!0},model:{value:e.CouponLeastPrice,callback:function(o){t.$set(e,"CouponLeastPrice",o)},expression:"item.CouponLeastPrice"}})],1),t._v(" "),o("Row",[o("label",{staticStyle:{display:"inline-block",width:"100px","font-size":"10px"}},[t._v("优惠券描述")]),t._v(" "),o("Input",{staticStyle:{display:"inline-block",width:"200px"},attrs:{type:"text",disabled:!0},model:{value:e.CouponDescription,callback:function(o){t.$set(e,"CouponDescription",o)},expression:"item.CouponDescription"}}),t._v(" "),o("label",{staticStyle:{display:"inline-block",width:"100px","font-size":"10px"}},[t._v("优惠券有效期")]),t._v(" "),o("Input",{staticStyle:{display:"inline-block",width:"200px"},attrs:{type:"text",disabled:!0},model:{value:e.AvailablePeriod,callback:function(o){t.$set(e,"AvailablePeriod",o)},expression:"item.AvailablePeriod"}})],1)],1)}),t._v(" "),o("formItem",[o("button",{on:{click:t.AddCoupon}},[t._v("添加优惠券 ")])])],2)],1),t._v(" "),o("Modal",{attrs:{title:"操作日志",cancelText:"取消",width:t.logmodal.width},model:{value:t.logmodal.visible,callback:function(e){t.$set(t.logmodal,"visible",e)},expression:"logmodal.visible"}},[o("Table",{attrs:{loading:t.logmodal.loading,data:t.logmodal.data,columns:t.logmodal.columns,stripe:""}}),t._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:t.logpage.total,"page-size":t.logpage.pageSize,current:t.logpage.current,"page-size-opts":[5,10],"show-sizer":""},on:{"on-change":t.handleLogPageChange,"on-page-size-change":t.handleLogPageSizeChange}})],1)])],1)],1)},staticRenderFns:[]};var L=o("VU/8")(P,G,!1,function(t){o("DPJw")},null,null).exports;o.d(e,"page404",function(){return T}),o.d(e,"page403",function(){return $}),o.d(e,"page500",function(){return O}),a.default.use(n.a);var T={path:"/*",name:"error-404",meta:{title:"404-页面不存在"},component:function(){return o.e(0).then(o.bind(null,"LWjT"))}},$={path:"/403",meta:{title:"403-权限不足"},name:"error-403",component:function(){return o.e(1).then(o.bind(null,"J7+d"))}},O={path:"/500",meta:{title:"500-服务端错误"},name:"error-500",component:function(){return o.e(2).then(o.bind(null,"0Gql"))}};e.default=new n.a({routes:[{path:"/",name:"index",component:r,meta:{title:"首页"}},{path:"/Lottery",name:"Lottery",component:c,meta:{title:"拼团抽奖后台",authpath:"/GroupBuyingV2/LotteryList"}},{path:"/Lottery/:id",name:"LotteryDetail",component:I,meta:{title:"拼团抽奖详情",authpath:"/GroupBuyingV2/LotteryDetailList"}},{path:"/LotteryRecycleBIn",name:"LotteryRecycleBIn",component:m,meta:{title:"已过期拼团抽奖",authpath:"/GroupBuyingV2/LotteryRecycleBinList"}},{path:"/ProductConfig",name:"ProductConfig",component:D,meta:{title:"拼团产品配置",authpath:"/GroupBuyingV2/ProductConfig"}},{path:"/Coupon",name:"Coupon",component:L,meta:{title:"拼团优惠券配置",authpath:"/GroupBuyingV2/PT_GetCouponList"}},$,O,T]})},hcud:function(t,e){},mXwE:function(t,e,o){"use strict";var a,n=o("mvHQ"),i=o.n(n),r=o("//Fk"),l=o.n(r),s=o("mtWM"),u=o.n(s),d={message:null,modal:null};d.title=function(t){t=t||"拼团配置系统",window.document.title=t},u.a.interceptors.request.use(function(t){return a.start(),t},function(t){return a.error(),l.a.reject(t)}),u.a.interceptors.response.use(function(t){console.log(t);var e=/Msg[\s|\S]*[-]*.*IsPower/;return e.test(t.data)&&d.message.error({content:t.data.match(e)[0].replace("Msg:","").replace(",IsPower",""),duration:10,closable:!0}),a.finish(),t},function(t){a.error(),d.message.error({content:i()(t.response.data),duration:10,closable:!0})}),d.ajax=u.a,d.axiosInstance=u.a.create(),d.useModal=function(t){d.modal=t},d.useMessage=function(t){d.message=t},d.useLoadingbar=function(t){a=t},d.inOf=function(t,e){var o=!0;return t.forEach(function(t){e.indexOf(t)<0&&(o=!1)}),o},d.oneOf=function(t,e){return e.indexOf(t)>=0},d.deepCopy=function(t){return JSON.parse(i()(t))},d.array={},d.array.select=function(t,e){var o=[];return t.forEach(function(t,a){o.push(e(t))}),o},d.formatTime=function(t){return new Date(parseInt(t.replace("/Date(","").replace(")/",""),10)).Format("yyyy-MM-dd hh:mm:ss")},d.formatDate=function(t){return new Date(parseInt(t.replace("/Date(","").replace(")/",""),10)).Format("yyyy-MM-dd")},e.a=d}},["NHnr"]);
//# sourceMappingURL=app.9f5463004b8123e9cd95.js.map