webpackJsonp([4],{"+skl":function(t,e){},"25Jt":function(t,e){},"9Q9G":function(t,e){},HkXY:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("7+uW"),r={props:{name:{type:String}},methods:{logout:function(){this.$emit("logout")}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"header"},[t._m(0),t._v(" "),a("div",{staticClass:"header-aside"},[a("Dropdown",{on:{"on-click":t.logout}},[a("a",{staticClass:"header-aside-main",attrs:{href:"javascript:void(0)"}},[a("Icon",{staticClass:"main-icon",attrs:{type:"ios-person"}}),t._v("\n          "+t._s(t.name)+"\n          "),a("Icon",{attrs:{type:"arrow-down-b"}})],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",[t._v("退出登录")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"headerlogo"},[e("img",{staticClass:"header-logo-line",attrs:{src:"static/logo.png"}}),this._v(" "),e("div",{staticClass:"header-logo-title"},[e("h3",[this._v("途虎运营系统")]),this._v(" "),e("h4",[this._v("setting.tuhu.cn")])])])}]};var s=a("VU/8")(r,n,!1,function(t){a("pDZY")},null,null).exports,i={name:"setting-menu",props:{menus:{type:Array}},data:function(){return{searchVal:"",filteredMenus:[],openedmenus:[],shrinked:!1,activename:""}},watch:{$route:function(){this.setActiveName(this.$router.currentRoute.name)}},mounted:function(){this.filteredMenus=this.menus,this.setActiveName(this.$router.currentRoute.name)},methods:{goto:function(t){this.$router.push({name:t})},fliter:function(){var t=this.searchVal;this.filteredMenus=this.menus.filter(function(e){return e.name.indexOf(t)>=0}),this.updateOpenedMenus(this.util.array.select(this.filteredMenus,function(t){return t.key}))},updateOpenedMenus:function(t,e){this.openedmenus=t,e&&(this.activename=e),this.$nextTick(function(){this.$refs.orangeMenu.updateOpened(),this.$refs.orangeMenu.updateActiveName()})},setActiveName:function(t){var e;this.menus.forEach(function(a){a.children.forEach(function(o){o.key===t&&(e=a.key)})}),this.updateOpenedMenus([e],t)}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:{nav:!t.shrinked}},[a("Input",{staticClass:"search",attrs:{icon:"ios-search",placeholder:"筛选一级目录"},on:{"on-enter":t.fliter,"on-click":t.fliter},model:{value:t.searchVal,callback:function(e){t.searchVal=e},expression:"searchVal"}}),t._v(" "),a("Menu",{ref:"orangeMenu",attrs:{width:"210px","open-names":t.openedmenus,"active-name":t.activename},on:{"on-select":t.goto}},t._l(t.filteredMenus,function(e,o){return a("Submenu",{key:o,attrs:{name:e.key}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:e.icon}}),t._v("\n                "+t._s(e.name)+"\n            ")],1),t._v(" "),t._l(e.children,function(e,o){return a("MenuItem",{key:o,attrs:{name:e.key}},[t._v("\n            "+t._s(e.name)+"\n            ")])})],2)})),t._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:t.shrinked,expression:"shrinked"}],staticClass:"hide",on:{click:function(e){t.shrinked=!t.shrinked}}},[t._v("收起")])],1)},staticRenderFns:[]};var c={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"footer"},[e("div",{staticClass:"footer-data"},[e("span",[this._v("所有内容为途虎养车网商业机密信息，切勿泄漏。版权所有 途虎养车网 2011-2015")])])])}]};var u={name:"App",data:function(){return{user:{name:""}}},computed:{menus:function(){return this.$store.state.app.menus},username:function(){return this.$store.state.user.name}},components:{settingheader:s,settingmenu:a("VU/8")(i,l,!1,function(t){a("HkXY")},null,null).exports,settingfooter:a("VU/8")({},c,!1,function(t){a("ROvl")},null,null).exports},methods:{logout:function(){var t=location.hostname.replace("yunying","yewu").replace("setting","yewu");window.location.href=location.protocol+"//"+t+"/Account/LogOff"}}},d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("settingheader",{attrs:{name:this.username},on:{logout:this.logout}}),this._v(" "),e("settingmenu",{attrs:{menus:this.menus}}),this._v(" "),e("div",{staticClass:"content"},[e("div",{staticClass:"real-content"},[e("router-view")],1),this._v(" "),e("settingfooter")],1)],1)},staticRenderFns:[]};var p=a("VU/8")(u,d,!1,function(t){a("UeEU")},null,null).exports,h=a("BTaQ"),f=a.n(h),m=(a("+skl"),a("9Q9G"),a("mXwE")),v=a("NYxO"),g={namespaced:!0,state:{menu:{menus:[],openedmenus:[],shrinked:[]},user:{name:"",permission:[]}},mutations:{init:function(t,e){console.log(e),t.menus=e}}},_={namespaced:!0,state:{name:"",permissions:[]},mutations:{logout:function(t){},init:function(t,e){t.name=e.name,t.permissions=e.permissions}}};o.default.use(v.a);var S=new v.a.Store({state:{},mutations:{},actions:{},modules:{app:g,user:_}}),y=[{key:"1",name:"门店优惠券",icon:"ios-speedometer",children:[{key:"shoppromotionIndex",name:"优惠券列表"}]}];o.default.use(f.a),o.default.config.productionTip=!1,o.default.prototype.ajax=m.a.ajax,o.default.prototype.util=m.a,console.log(o.default.prototype.$Message),m.a.useMessage(o.default.prototype.$Message),o.default.prototype.$Loading.config({color:"#2ca9e1",failedColor:"#c9171e",height:2}),m.a.useLoadingbar(o.default.prototype.$Loading),m.a.ajax.get("/auth/GetBasicInformantion").then(function(t){if(t.data.success){S.commit("user/init",t.data.user),S.commit("app/init",y);var e=a("YaEn").default;e.beforeEach(function(t,e,a){(f.a.LoadingBar.start(),m.a.title(t.meta.title),console.log("pat"+t.meta.authpath),t.meta.authpath)?m.a.axiosInstance.get("/auth/haspower?path="+t.meta.authpath).then(function(t){t.data.success&&t.data.result?a():a({path:"/403"})}).catch(function(t){console.log(t),f.a.LoadingBar.error(),a({path:"/500"})}):a()}),e.afterEach(function(t){console.log("finish"),f.a.LoadingBar.finish()}),new o.default({el:"#app",router:e,store:S,components:{App:p},template:"<App/>"})}else{var r=location.hostname.replace("yunying","yewu").replace("setting","yewu");window.location.href=location.protocol+"//"+r+"/Account/LogOn?ReturnUrl="+location.href}})},ROvl:function(t,e){},UeEU:function(t,e){},YaEn:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("7+uW"),r=a("/ocq"),n={data:function(){return{search:{keywords:"",discount:"",filterStartDate:"",filterEndDate:"",time:0}}},methods:{ok:function(){this.search.time=(new Date).getTime(),this.$emit("filter",this.search)}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{padding:"10px"}},[a("Row",[a("Col",{attrs:{span:"6"}},[t._v("名称关键字："),a("Input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入关键词"},model:{value:t.search.keywords,callback:function(e){t.$set(t.search,"keywords",e)},expression:"search.keywords"}})],1),t._v(" "),a("Col",{attrs:{span:"4"}},[t._v("面值："),a("Input",{staticStyle:{width:"100px"},attrs:{placeholder:""},model:{value:t.search.discount,callback:function(e){t.$set(t.search,"discount",e)},expression:"search.discount"}})],1),t._v(" "),a("Col",{attrs:{span:"8"}},[t._v("创建时间：\n        "),a("DatePicker",{staticStyle:{width:"150px"},attrs:{type:"date","show-week-numbers":""},model:{value:t.search.filterStartDate,callback:function(e){t.$set(t.search,"filterStartDate",e)},expression:"search.filterStartDate"}}),t._v(" - \n    "),a("DatePicker",{staticStyle:{width:"150px"},attrs:{type:"date","show-week-numbers":""},model:{value:t.search.filterEndDate,callback:function(e){t.$set(t.search,"filterEndDate",e)},expression:"search.filterEndDate"}})],1),t._v(" "),a("Col",{attrs:{span:"3"}},[a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:t.ok}},[t._v("搜索")])],1)],1)],1)},staticRenderFns:[]},i=a("VU/8")(n,s,!1,null,null,null).exports,l=a("mXwE"),c={props:["filter"],data:function(){return{allServiceCategory:[]}},created:function(){this.loadData()},methods:{loadData:function(){var t=this;l.a.ajax.get("/shoppromotion/GetShopServesAllCatogry").then(function(e){200===e.status&&(t.allServiceCategory=e.data.data)})},search:function(){this.$emit("search")},checkAllGroupChange:function(){this.$emit("checkAllGroupChange")}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[a("Col",{attrs:{span:"3"}},[t._v("类目选择：")]),t._v(" "),a("Col",{attrs:{span:"20"}},[a("CheckboxGroup",{on:{"on-change":t.checkAllGroupChange},model:{value:t.filter.CatogryIDs,callback:function(e){t.$set(t.filter,"CatogryIDs",e)},expression:"filter.CatogryIDs"}},t._l(t.allServiceCategory,function(e){return a("Checkbox",{key:e.PKID,attrs:{label:e.PKID}},[t._v(t._s(e.ServersName))])}))],1)],1),t._v(" "),a("br"),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[t._v("价格区间：")]),t._v(" "),a("Col",{attrs:{span:"2"}},[a("Input",{attrs:{size:"small"},model:{value:t.filter.StartDefaultPrice,callback:function(e){t.$set(t.filter,"StartDefaultPrice",e)},expression:"filter.StartDefaultPrice"}})],1),t._v(" "),a("Col",{attrs:{span:"2"}},[t._v(" 元  ~ ")]),t._v(" "),a("Col",{attrs:{span:"2"}},[a("Input",{attrs:{size:"small"},model:{value:t.filter.EndDefaultPrice,callback:function(e){t.$set(t.filter,"EndDefaultPrice",e)},expression:"filter.EndDefaultPrice"}})],1),t._v(" "),a("Col",{attrs:{span:"2"}},[t._v(" 元")]),t._v(" "),a("Col",{attrs:{span:"3"}},[t._v("名称关键字：")]),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Input",{attrs:{size:"small"},model:{value:t.filter.ServersName,callback:function(e){t.$set(t.filter,"ServersName",e)},expression:"filter.ServersName"}})],1),t._v(" "),a("Col",{attrs:{span:"1"}},[t._v(" ")]),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:t.search}},[t._v("搜索")])],1)],1)],1)},staticRenderFns:[]},d=a("VU/8")(c,u,!1,null,null,null).exports,p={props:["showSelection","total"],data:function(){var t=[{title:"服务PID",key:"ProductID",width:160},{title:"服务名称",key:"ServersName",width:180},{title:"销售价格",key:"DefaultPrice",width:100},{title:"服务说明",key:"ServiceRemark"}];return this.showSelection&&t.unshift({type:"selection",width:60,align:"center",checked:!0}),{columns:t,data:[],page:{total:0,current:1,pageSize:10},selectServices:{},filter:null}},created:function(){},methods:{selectChange:function(t){this.$emit("selectChange",t,this.data)},loadList:function(t,e,a){var o=this;this.selectServices=a||this.selectServices,this.filter=e,this.page.current=t||this.page.current;var r={PageIndex:this.page.current,PageSize:this.page.pageSize,ServersName:e.ServersName,CatogryIDs:e.CatogryIDs,ProductIDs:e.ProductIDs,StartDefaultPrice:e.StartDefaultPrice,EndDefaultPrice:e.EndDefaultPrice};l.a.ajax.post("/shoppromotion/GetServiceList",r).then(function(t){if(200===t.status&&(o.showSelection?o.data=t.data.data.map(function(t){return o.selectServices[t.ProductID]&&(t._checked=!0),t}):o.data=t.data.data,o.data.length)){var e=o.data[0];o.page.total=e.TotalCount,o.$emit("update:total",o.page.total)}})},clearData:function(){this.data=[],this.page.total=0},handlePageChange:function(t){this.loadList(t,this.filter)},handlePageSizeChange:function(t){this.page.pageSize=t,this.loadList(1,this.filter)}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Table",{attrs:{columns:t.columns,data:t.data},on:{"on-selection-change":t.selectChange}}),t._v(" "),a("div",{staticStyle:{margin:"10px"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.page.total,"page-size":t.page.pageSize,current:t.page.current,"page-size-opts":[10,20,50],"show-elevator":"","show-sizer":""},on:{"on-change":t.handlePageChange,"on-page-size-change":t.handlePageSizeChange}})],1)])],1)},staticRenderFns:[]},f=a("VU/8")(p,h,!1,null,null,null).exports,m={props:["opts","showFilter","productType"],data:function(){return{filter:{CatogryIDs:[],StartDefaultPrice:null,EndDefaultPrice:null,ServersName:null,ProductIDs:[]},selectServices:{}}},created:function(){},components:{ServiceFilter:d,ServiceTable:f},methods:{loadList:function(t){this.selectServices=t||this.selectServices,this.filter={CatogryIDs:[],StartDefaultPrice:null,EndDefaultPrice:null,ServersName:null,ProductIDs:[]};var e=[];for(var a in this.selectServices)e.push(a);this.filter.ProductIDs=e,this.total=this.filter.ProductIDs.length,this.filter.ProductIDs.length?this.loadServiceList(1):this.showFilter?this.loadServiceList(1):this.$refs.table.clearData()},checkAllGroupChange:function(){this.loadServiceList(1)},search:function(){this.loadServiceList(1)},loadServiceList:function(t){this.$refs.table.loadList(t,this.filter)}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-bottom":"100px"}},[t.showFilter?a("div",[a("ServiceFilter",{attrs:{filter:t.filter},on:{search:t.search,checkAllGroupChange:t.checkAllGroupChange,"update:filter":function(e){t.filter=e}}})],1):t._e(),t._v(" "),a("ServiceTable",{ref:"table"})],1)},staticRenderFns:[]},g=a("VU/8")(m,v,!1,null,null,null).exports,_={props:["status","opts","total","tabIndex"],data:function(){var t=this;return{showAlert:!1,showModal:!1,selectServices:{},reloadSelectServices:null,alertText:"",columns:[{title:"RuleId",key:"RuleId"},{title:"券类型",key:"PromotionType",render:function(t,e){var a="";return 0===e.row.PromotionType&&(a="满减券"),t("span",{props:{}},a)}},{title:"优惠券规则名称",key:"PromotionName",render:function(e,a){return e("a",{on:{click:function(){t.$router.push({name:"shoppromotionDetail",params:{ruleId:a.row.RuleId}})}}},a.row.PromotionName)}},{title:"面值",key:"Discount",render:function(t,e){return t("span",{props:{}},e.row.Discount+"元")}},{title:"使用级别",key:"MinMoney",render:function(t,e){return t("span",{props:{}},"满"+e.row.MinMoney+"减"+e.row.Discount)}},{title:"支持产品",key:"ShopProduct",render:function(e,a){var o=[];return a.row.Products&&a.row.Products.length?(0===a.row.Products[0].Type?o.push(e("a",{props:{},on:{click:function(){t.selectServices={},t.showModal=!0,t.$refs.service.loadList(t.selectServices)}}},"全部服务")):o.push(e("a",{props:{},on:{click:function(){t.selectServices={},a.row.Products.forEach(function(e){t.selectServices[e.ConfigValue]={ProductID:e.ConfigValue}}),t.showModal=!0,t.$refs.service.loadList(t.selectServices)}}},"指定服务")),e("div",o)):e("span",{props:{}},"没有配置服务")}},{title:"创建时间",key:"CreateDateTimeString"},{title:"最后编辑时间",key:"LastUpdateDateTimeString"},{title:"操作",key:"Operate",render:function(e,a){var o=[];return 1===a.row.Status&&o.push(e("Button",{props:{type:"text",size:"small"},on:{click:function(){t.updateStatus(a.row.RuleId,2)}}},"暂停领取")),2!==a.row.Status&&0!==a.row.Status||o.push(e("Button",{props:{type:"text",size:"small"},on:{click:function(){t.updateStatus(a.row.RuleId,1)}}},"上架领取")),3===a.row.Status?o.push(e("Button",{props:{type:"text",size:"small"},on:{click:function(){t.$router.push({name:"shoppromotionCreate",params:{ruleId:a.row.RuleId}})}}},"复制新建")):o.push(e("Button",{props:{type:"text",size:"small"},on:{click:function(){t.updateStatus(a.row.RuleId,3)}}},"作废")),e("div",o)}}],data:[],page:{total:0,current:1,pageSize:10}}},components:{ServiceTableList:g},created:function(){var t=this;this.$watch("opts.time",function(e){t.page.current=1,t.loadData()}),this.$watch("showAlert",function(e){e&&setTimeout(function(){t.showAlert=!1},1e3)}),this.loadData()},methods:{loadData:function(){var t=this,e={status:this.status,pageIndex:this.page.current,pageSize:this.page.pageSize};this.opts&&(e.keywords=this.opts.keywords,e.discount=this.opts.discount,e.startDate=this.opts.filterStartDate,e.endDate=this.opts.filterEndDate),l.a.ajax.get("/shoppromotion/GetCouponList",{params:e}).then(function(e){200===e.status&&(t.data=e.data.Source,t.page.total=e.data.Pager.TotalItem,t.$emit("update:total",t.page.total))})},updateStatus:function(t,e){var a=this;l.a.ajax.post("/shoppromotion/UpdateCouponStatus",{ruleId:t,status:e}).then(function(t){200===t.status&&t.data.data&&(a.alertText="操作成功",a.showAlert=!0,a.$emit("loadListData"))})},toEdit:function(t){this.$router.push({name:"shoppromotionCreate",params:{ruleId:t}})},copy:function(t){var e=this;l.a.ajax.post("/shoppromotion/CopyCouponRule",{ruleId:t}).then(function(t){200===t.status&&t.data.data&&(e.alertText="操作成功",e.showAlert=!0,e.$emit("loadListData"))})},handlePageChange:function(t){this.page.current=t,this.loadData()},handlePageSizeChange:function(t){this.page.pageSize=t,this.loadData()},ok:function(){this.showModal=!1}}},S={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-bottom":"200px"}},[t.showAlert?a("Alert",{attrs:{type:"success","show-icon":"",closable:""}},[t._v("\n        成功提示\n        "),a("span",{attrs:{slot:"desc"},slot:"desc"},[t._v(t._s(this.alertText))])]):t._e(),t._v(" "),a("Table",{attrs:{columns:t.columns,data:t.data}}),t._v(" "),a("div",{staticStyle:{margin:"10px"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.page.total,"page-size":t.page.pageSize,current:t.page.current,"page-size-opts":[10,20,50],"show-elevator":"","show-sizer":""},on:{"on-change":t.handlePageChange,"on-page-size-change":t.handlePageSizeChange}})],1)]),t._v(" "),a("Modal",{attrs:{title:"查看优惠券的服务产品",width:"900"},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("ServiceTableList",{ref:"service",attrs:{opts:t.selectServices,times:t.reloadSelectServices,showFilter:!0}}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]},y={data:function(){return{searchParams:{time:null},tabIndex:1,tabTotals:{total0:0,total1:0,total2:0,total3:0}}},created:function(){},computed:{},components:{Search:i,List:a("VU/8")(_,S,!1,null,null,null).exports},methods:{filter:function(t){this.searchParams=t},tabChanged:function(t){this.tabIndex=Number(t.substr(3))},loadListData:function(){console.log(this.searchParams),this.searchParams.time=(new Date).getTime()},toCreate:function(){this.$router.push({name:"shoppromotionCreate"})}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[t._v("运营 > 优惠券 > 门店优惠券规则")]),t._v(" "),a("Search",{on:{filter:t.filter}}),t._v(" "),a("div",{attrs:{align:"right"}},[a("Button",{attrs:{type:"primary",shape:"circle",icon:"plus-round"},on:{click:t.toCreate}},[t._v("新建规则")])],1),t._v(" "),a("Tabs",{attrs:{type:"card"},on:{"on-click":t.tabChanged}},[a("TabPane",{attrs:{label:"可领取 ("+t.tabTotals.total1+")",name:"tab1"}},[a("List",{ref:"list1",attrs:{status:1,total:t.tabTotals.total1,opts:t.searchParams,tabIndex:t.tabIndex},on:{loadListData:t.loadListData,"update:total":function(e){t.$set(t.tabTotals,"total1",e)}}})],1),t._v(" "),a("TabPane",{attrs:{label:"待发布 ("+t.tabTotals.total0+")",name:"tab0"}},[a("List",{ref:"list0",attrs:{status:0,total:t.tabTotals.total0,opts:t.searchParams,tabIndex:t.tabIndex},on:{loadListData:t.loadListData,"update:total":function(e){t.$set(t.tabTotals,"total0",e)}}})],1),t._v(" "),a("TabPane",{attrs:{label:"暂停领取("+t.tabTotals.total2+")",name:"tab2"}},[a("List",{ref:"list2",attrs:{status:2,total:t.tabTotals.total2,opts:t.searchParams,tabIndex:t.tabIndex},on:{loadListData:t.loadListData,"update:total":function(e){t.$set(t.tabTotals,"total2",e)}}})],1),t._v(" "),a("TabPane",{attrs:{label:"已作废("+t.tabTotals.total3+")",name:"tab3"}},[a("List",{ref:"list3",attrs:{status:3,total:t.tabTotals.total3,opts:t.searchParams,tabIndex:t.tabIndex},on:{loadListData:t.loadListData,"update:total":function(e){t.$set(t.tabTotals,"total3",e)}}})],1)],1)],1)},staticRenderFns:[]},P=a("VU/8")(y,w,!1,null,null,null).exports,b={props:["opts"],data:function(){return{filter:{CatogryIDs:[],StartDefaultPrice:null,EndDefaultPrice:null,ServersName:null},total:0,selectServices:{}}},created:function(){},components:{ServiceFilter:d,ServiceTable:f},methods:{loadList:function(t){this.selectServices=t,this.$refs.table.loadList(1,this.filter,this.selectServices)},checkAllGroupChange:function(){this.$refs.table.loadList(1,this.filter,this.selectServices)},search:function(){this.$refs.table.loadList(1,this.filter,this.selectServices)},selectChange:function(t,e){for(var a=0;a<e.length;a++)this.selectServices[e[a].ProductID]&&delete this.selectServices[e[a].ProductID];for(var o=0;o<t.length;o++)this.selectServices[t[o].ProductID]=t[o];this.$emit("update:opts",this.selectServices)}}},D={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-bottom":"30px"}},[a("ServiceFilter",{attrs:{filter:t.filter},on:{search:t.search,checkAllGroupChange:t.checkAllGroupChange,"update:filter":function(e){t.filter=e}}}),t._v(" "),a("div",[t._v("共"+t._s(t.total)+"个服务产品")]),t._v(" "),a("ServiceTable",{ref:"table",attrs:{total:t.total,showSelection:!0},on:{selectChange:t.selectChange,"update:total":function(e){t.total=e}}})],1)},staticRenderFns:[]},k=a("VU/8")(b,D,!1,null,null,null).exports,C={data:function(){var t=this;return{formValidate:{PromotionName:"",Discount:0,MinMoney:0,PromotionType:0,DisplayName:"",SupportUserRange:0,Description:"",ProductType:0,Pids:[]},ruleValidate:{PromotionName:[{trigger:"blur",validator:function(t,e,a){""===e?a(new Error("优惠券名称不能为空")):e.length>15?a(new Error("字数不能超过15个字")):a()}}],Discount:[{trigger:"blur",validator:function(e,a,o){""===a?o(new Error("折扣不能为空")):isNaN(Number(a))?o(new Error("折扣请输入数字")):Number(a)<=0?o(new Error("折扣必须大于0")):""===t.formValidate.MinMoney?o(new Error("最低金额不能为空")):isNaN(Number(t.formValidate.MinMoney))?o(new Error("最低金额请输入数字")):Number(t.formValidate.Discount)>Number(t.formValidate.MinMoney)?o(new Error("不能高于优惠券最低价")):o()}}],ProductType:[{trigger:"blur",validator:function(e,a,o){1===a&&(null==t.formValidate.Pids||0===t.formValidate.Pids.length)?o(new Error("请至少配置一个产品")):o()}}]},showModal:!1,selectServices:{}}},created:function(){var t=this,e=this.$route.params.ruleId||0;e>0&&this.loadDetail(e).then(function(e){return e?(t.formValidate.PromotionType=e.PromotionType,t.formValidate.PromotionName=e.PromotionName,t.formValidate.Description=e.Description,t.formValidate.Discount=e.Discount.toString(),t.formValidate.MinMoney=e.MinMoney.toString(),e.Pids.length&&(t.formValidate.Pids=e.Pids,t.formValidate.ProductType=1),t.formValidate.Pids):[]}).then(function(e){e.forEach(function(e){t.selectServices[e]={ProductID:e}}),t.formValidate.Pids.length&&t.$refs.showService.loadList(t.selectServices)})},components:{ServiceList:k,ServiceTableList:g},methods:{onProductTypeChange:function(){1===this.formValidate.ProductType&&(this.formValidate.Pids.length||this.showServiceModal(),this.$refs.showService.loadList(this.selectServices))},showServiceModal:function(){this.showModal=!0,this.$refs.service.loadList(this.selectServices)},handleSubmit:function(t,e){var a=this;this.$refs[t].validate(function(t){t&&a.saveData().then(function(t){if(t.data&&e)return a.updateStatus(t.ruleId,1)}).then(function(){a.$router.push({name:"shoppromotionIndex"})})})},loadDetail:function(t){return l.a.ajax.get("/shoppromotion/GetCouponRuleDetail",{params:{ruleId:t}}).then(function(t){return 200===t.status?t.data.data:null})},saveData:function(){var t=this;return 0===this.formValidate.ProductType&&(this.formValidate.Pids=[]),l.a.ajax.post("/shoppromotion/SaveCouponRules",this.formValidate).then(function(e){if(200===e.status)return t.$Message.success("保存成功"),e.data})},updateStatus:function(t,e){return l.a.ajax.post("/shoppromotion/UpdateCouponStatus",{ruleId:t,status:e})},handleReset:function(t){this.$refs[t].resetFields()},ok:function(){this.showModal=!1;var t=[];for(var e in this.selectServices)t.push(e);this.formValidate.Pids=t,this.$refs.showService.loadList(this.selectServices)}}},I={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[t._v("运营 > 优惠券 > "),a("router-link",{attrs:{to:"/shoppromotion/index"}},[t._v("门店优惠券规则")]),t._v(" > 新建规则")],1),t._v(" "),a("div",{staticStyle:{padding:"20px"}},[a("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":150}},[a("FormItem",{attrs:{label:"优惠券类型",prop:"PromotionType"}},[a("RadioGroup",{model:{value:t.formValidate.PromotionType,callback:function(e){t.$set(t.formValidate,"PromotionType",e)},expression:"formValidate.PromotionType"}},[a("Radio",{attrs:{label:0}},[t._v("满减券")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"优惠券规则名称：",prop:"PromotionName"}},[a("Row",[a("Col",{attrs:{span:"12"}},[a("Input",{attrs:{placeholder:"用于区分不同的优惠券规则和关键字搜索"},model:{value:t.formValidate.PromotionName,callback:function(e){t.$set(t.formValidate,"PromotionName",e)},expression:"formValidate.PromotionName"}})],1),t._v(" "),a("Col",{staticStyle:{color:"red"},attrs:{span:"4"}},[t._v("\n              限15个字\n              ")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"优惠券面值",prop:"Discount"}},[a("Row",[a("Col",{attrs:{span:"8"}},[a("FormItem",[a("Input",{model:{value:t.formValidate.Discount,callback:function(e){t.$set(t.formValidate,"Discount",e)},expression:"formValidate.Discount"}})],1)],1),t._v(" "),a("Col",{attrs:{span:"2"}},[t._v("元")]),t._v(" "),a("Col",{attrs:{span:"2"}},[t._v("/")]),t._v(" "),a("Col",{attrs:{span:"1"}},[t._v("满")]),t._v(" "),a("Col",{attrs:{span:"8"}},[a("FormItem",[a("Input",{model:{value:t.formValidate.MinMoney,callback:function(e){t.$set(t.formValidate,"MinMoney",e)},expression:"formValidate.MinMoney"}})],1)],1),t._v(" "),a("Col",{attrs:{span:"2"}},[t._v("元可使用")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"用户限定",prop:"SupportUserRange"}},[a("RadioGroup",{model:{value:t.formValidate.SupportUserRange,callback:function(e){t.$set(t.formValidate,"SupportUserRange",e)},expression:"formValidate.SupportUserRange"}},[a("Radio",{attrs:{label:0}},[t._v("全部")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"可使用产品",prop:"ProductType"}},[a("RadioGroup",{on:{"on-change":t.onProductTypeChange},model:{value:t.formValidate.ProductType,callback:function(e){t.$set(t.formValidate,"ProductType",e)},expression:"formValidate.ProductType"}},[a("Radio",{attrs:{label:0}},[t._v("全部服务产品")]),t._v(" "),a("Radio",{attrs:{label:1}},[t._v("自定义可用产品ID")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.formValidate.ProductType,expression:"formValidate.ProductType === 1"}]},[a("div",[t._v("共"+t._s(t.formValidate.Pids.length)+"个自定义产品"),a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){t.showServiceModal()}}},[t._v("修改")])]),t._v(" "),a("ServiceTableList",{ref:"showService",attrs:{opts:t.selectServices}})],1)],1),t._v(" "),a("FormItem",{attrs:{label:"使用说明"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5}},model:{value:t.formValidate.Description,callback:function(e){t.$set(t.formValidate,"Description",e)},expression:"formValidate.Description"}})],1),t._v(" "),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:function(e){t.handleSubmit("formValidate")}}},[t._v("保存")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(e){t.handleSubmit("formValidate",!0)}}},[t._v("保存并上架")]),t._v(" "),a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:function(e){t.handleReset("formValidate")}}},[t._v("取消")])],1)],1)],1),t._v(" "),a("Modal",{attrs:{title:"选择可以使用优惠券的服务产品",width:"900"},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("ServiceList",{ref:"service",attrs:{opts:t.selectServices,showModal:t.showModal},on:{"update:opts":function(e){t.selectServices=e}}}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var V=a("VU/8")(C,I,!1,function(t){a("yfXl")},null,null).exports,x={data:function(){return{formValidate:{RuleId:0,PromotionName:"",Discount:0,MinMoney:0,PromotionType:0,DisplayName:"",SupportUserRange:0,Description:"",ProductType:0,Pids:[]},ruleStatus:-1,showModal:!1,showConfirm:!1,promotionCount:0,selectServices:{}}},created:function(){var t=this,e=this.$route.params.ruleId||0;this.formValidate.RuleId=e,this.formValidate.RuleId>0&&this.loadDetail().then(function(){t.$refs.showService.loadList(t.selectServices)})},components:{ServiceList:k,ServiceTableList:g},methods:{onProductTypeChange:function(){1===this.formValidate.ProductType&&(this.formValidate.Pids.length||this.showServiceModal())},showServiceModal:function(){this.showModal=!0,this.$refs.service.loadList(this.selectServices)},saveData:function(){return 0===this.formValidate.ProductType&&(this.formValidate.Pids=[]),l.a.ajax.post("/shoppromotion/SaveCouponRules",this.formValidate)},loadDetail:function(){var t=this;return l.a.ajax.get("/shoppromotion/GetCouponRuleDetail",{params:{ruleId:this.formValidate.RuleId}}).then(function(e){if(200===e.status){var a=e.data.data;if(a)return t.formValidate.PromotionType=a.PromotionType,t.formValidate.PromotionName=a.PromotionName,t.formValidate.Description=a.Description,t.formValidate.Discount=a.Discount.toString(),t.formValidate.MinMoney=a.MinMoney.toString(),a.Pids.length&&(t.formValidate.Pids=a.Pids,t.formValidate.ProductType=1,t.selectServices={},t.formValidate.Pids.forEach(function(e){t.selectServices[e]={ProductID:e}})),t.ruleStatus=a.Status,a}return null})},updateStatus:function(t){var e=this;return l.a.ajax.post("/shoppromotion/UpdateCouponStatus",{ruleId:this.formValidate.RuleId,status:t}).then(function(t){200===t.status&&(e.$Message.success("操作成功"),e.loadDetail())})},ok:function(){this.showModal=!1;var t=[];for(var e in this.selectServices)t.push(e);this.formValidate.Pids=t,this.$refs.showService.loadList(this.selectServices)},showConfirmModal:function(){var t=this;this.loadPromotionCount().then(function(e){t.showConfirm=!0})},loadPromotionCount:function(){var t=this;return l.a.ajax.get("/shoppromotion/GetNotUserdPromotionCount",{params:{ruleId:this.formValidate.RuleId}}).then(function(e){return t.promotionCount=e.data.data,e})},confirmOk:function(){this.saveData()},confirmCancel:function(){}}},M={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[t._v("运营 > 优惠券 > "),a("router-link",{attrs:{to:"/shoppromotion/index"}},[t._v("门店优惠券规则")]),t._v(" > 查看规则 > ID:"+t._s(t.formValidate.RuleId)+" \n    (\n      "),0===t.ruleStatus?a("span",[t._v("待发布")]):t._e(),t._v(" "),1===t.ruleStatus?a("span",[t._v("可领取")]):t._e(),t._v(" "),2===t.ruleStatus?a("span",[t._v("暂停领取")]):t._e(),t._v(" "),3===t.ruleStatus?a("span",[t._v("已作废")]):t._e(),t._v("\n    )\n  ")],1),t._v(" "),a("div",{staticStyle:{padding:"20px"}},[a("Form",{ref:"formValidate",attrs:{model:t.formValidate,"label-width":150}},[a("FormItem",{attrs:{label:"优惠券规则名称："}},[a("b",[t._v(t._s(t.formValidate.PromotionName))])]),t._v(" "),a("FormItem",{attrs:{label:"优惠券类型："}},[t._v("\n        "+t._s(0===t.formValidate.PromotionType?"满减券":"")+"\n      ")]),t._v(" "),a("FormItem",{attrs:{label:"优惠券面额："}},[a("b",[t._v(t._s(t.formValidate.Discount))]),t._v("元 / 满"),a("b",[t._v(t._s(t.formValidate.MinMoney))]),t._v("元可用\n      ")]),t._v(" "),a("FormItem",{attrs:{label:"用户限定："}},[t._v("\n          全部\n      ")]),t._v(" "),a("FormItem",{attrs:{label:"可使用产品",prop:"ProductType"}},[a("RadioGroup",{on:{"on-change":t.onProductTypeChange},model:{value:t.formValidate.ProductType,callback:function(e){t.$set(t.formValidate,"ProductType",e)},expression:"formValidate.ProductType"}},[a("Radio",{attrs:{disabled:3===t.ruleStatus,label:0}},[t._v("全部服务产品")]),t._v(" "),a("Radio",{attrs:{disabled:3===t.ruleStatus,label:1}},[t._v("自定义可用产品ID")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.formValidate.ProductType,expression:"formValidate.ProductType === 1"}]},[a("div",[t._v("共"+t._s(t.formValidate.Pids.length)+"个自定义产品"),3!==t.ruleStatus?a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){t.showServiceModal()}}},[t._v("修改")]):t._e()]),t._v(" "),a("ServiceTableList",{ref:"showService",attrs:{opts:t.selectServices}})],1)],1),t._v(" "),a("FormItem",{attrs:{label:"使用说明："}},[t._v("\n          "+t._s(t.formValidate.Description)+"\n      ")]),t._v(" "),a("FormItem",[0===t.ruleStatus||2===t.ruleStatus?a("Button",{attrs:{type:"primary"},on:{click:function(e){t.updateStatus(1)}}},[t._v("上架领取")]):t._e(),t._v(" "),1===t.ruleStatus?a("Button",{attrs:{type:"primary"},on:{click:function(e){t.updateStatus(2)}}},[t._v("暂停领取")]):t._e(),t._v(" "),3!==t.ruleStatus?a("Button",{attrs:{type:"primary"},on:{click:function(e){t.updateStatus(3)}}},[t._v("作废")]):t._e(),t._v(" "),3!==t.ruleStatus?a("Button",{attrs:{type:"primary"},on:{click:function(e){t.showConfirmModal()}}},[t._v("保存")]):t._e()],1)],1)],1),t._v(" "),a("Modal",{attrs:{title:"选择可以使用优惠券的服务产品",width:"900"},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("ServiceList",{ref:"service",attrs:{opts:t.selectServices,showModal:t.showModal},on:{"update:opts":function(e){t.selectServices=e}}}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定")])],1)],1),t._v(" "),a("Modal",{attrs:{title:"确认更改",width:"500"},on:{"on-ok":t.confirmOk,"on-cancel":t.confirmCancel},model:{value:t.showConfirm,callback:function(e){t.showConfirm=e},expression:"showConfirm"}},[a("div",[t._v("修改将影响到"+t._s(t.promotionCount)+"张未使用的优惠券，确认修改?")])])],1)},staticRenderFns:[]};var T=a("VU/8")(x,M,!1,function(t){a("25Jt")},null,null).exports;a.d(e,"page404",function(){return $}),a.d(e,"page403",function(){return L}),a.d(e,"page500",function(){return R}),o.default.use(r.a);var $={path:"/*",name:"error-404",meta:{title:"404-页面不存在"},component:function(){return a.e(1).then(a.bind(null,"LWjT"))}},L={path:"/403",meta:{title:"403-权限不足"},name:"error-403",component:function(){return a.e(0).then(a.bind(null,"J7+d"))}},R={path:"/500",meta:{title:"500-服务端错误"},name:"error-500",component:function(){return a.e(2).then(a.bind(null,"0Gql"))}};e.default=new r.a({routes:[{path:"/",redirect:"shoppromotion/Index"},{path:"/shoppromotion/index",name:"shoppromotionIndex",component:P,meta:{title:"门店优惠券规则",authpath:"shoppromotion/GetCouponList"}},{path:"/shoppromotion/create",name:"shoppromotionCreate",component:V,meta:{title:"创建门店优惠券规则",authpath:"shoppromotion/GetCouponList"}},{path:"/shoppromotion/detail",name:"shoppromotionDetail",component:T,meta:{title:"查看门店优惠券规则",authpath:"shoppromotion/GetCouponList"}},L,R,$]})},mXwE:function(t,e,a){"use strict";var o,r,n=a("mvHQ"),s=a.n(n),i=a("//Fk"),l=a.n(i),c=a("mtWM"),u=a.n(c),d={};d.title=function(t){t=t||"优惠券",window.document.title=t},u.a.interceptors.request.use(function(t){return r.start(),t},function(t){return r.error(),l.a.reject(t)}),u.a.interceptors.response.use(function(t){return console.log(t),r.finish(),t},function(t){r.error(),o.error({content:s()(t.response.data),duration:10,closable:!0})}),d.ajax=u.a,d.axiosInstance=u.a.create(),d.useMessage=function(t){o=t},d.useLoadingbar=function(t){r=t},d.message=o,d.array={},d.array.select=function(t,e){var a=[];return t.forEach(function(t,o){a.push(e(t))}),a},e.a=d},pDZY:function(t,e){},yfXl:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.7aa326398d6c2a8a8b8b.js.map