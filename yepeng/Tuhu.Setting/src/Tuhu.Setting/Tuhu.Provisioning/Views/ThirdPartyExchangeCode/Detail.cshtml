@model List<Tuhu.Provisioning.DataAccess.Entity.ThirdPartyExchangeCode>
@{
    ViewBag.Title = "兑换码明细";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section head{
    <link href="~/Content/nfine/js/bootstrap/bootstrap.min.css" rel="stylesheet"/>
    <link href="~/Content/ProductVehicleType/css/bootstrap-datetimepicker.css" rel="stylesheet"/>
}
<script src="https://file-tuhu-cn.alikunlun.com/yewu/oms/scripts/md503.js" type="text/javascript"></script>
<script src="https://file-tuhu-cn.alikunlun.com/yewu/oms/scripts/verifyBtn.js" type="text/javascript"></script>


<div class="title">
    <h2>兑换码明细</h2>
</div>
<div class="content">
    <form class="form-inline">
        <div class="form-group">
            <label for="exampleInputName2">筛选条件</label>
        </div>
        <div class="form-group form-group-sm">
            <label for="exampleInputEmail2">状态</label>
            <select class="form-control" onchange="StatusChange(this)">
                <option>全部</option>
                <option>未领取</option>
                <option>已领取</option>
                <option>未过期</option>
                <option>已过期</option>
                <option>禁用</option>
            </select>
        </div>
    </form>
    <p>
        <br/>
    </p>
    <form class="form-inline" role="form">
        <div class="form-group">
            <label for="name">排序条件</label>
        </div>
        <div class="form-group">
            <button type="button" class="btn btn-primary" value="10" onclick="BtnSort(this)">兑换开始日期</button>
            <button type="button" class="btn btn-primary" value="20" onclick="BtnSort(this)">兑换截至日期</button>
            <button type="button" class="btn btn-primary" value="30" onclick="BtnSort(this)">创建时间</button>
            <button type="button" class="btn btn-primary" value="40" onclick="BtnSort(this)">领取时间</button>             
        </div>
    </form>
    <p>
        <br/>
    </p>
   
    <div class="table-responsive">
        <table class="table table-striped table-hover table-condensed">
            @*<caption>条纹表格布局</caption>*@
            <thead>
            <tr>
                <th>状态</th>
                <th>是否领取</th>
                <th>是否过期</th>
                <th>兑换码</th>
                <th>兑换开始日期</th>
                <th>兑换截至日期</th>
                <th>导入日期</th>
                <th>用户ID</th>
                <th>领取日期</th>              
            </tr>
            </thead>
            <tbody id="SerchExchangeCodeDetail" >
            
            @foreach (var p in Model)
            {
               
                <tr>
                    <td>@((p.IsEnabled==true)?"显示":"不显示")</td>
                    <td>@((p.IsGain==false)?"未领取":"已领取")</td>
                    <td>@((p.EndDateTime>DateTime.Now)?"未过期":"已过期")</td>
                    <td>@(string.IsNullOrWhiteSpace(p.ExchangeCode) ? "——" : p.ExchangeCode)</td>
                    <td>@p.StartDateTime</td>
                    <td>@p.EndDateTime</td>
                    <td>@p.ImportDateTime</td>
                    <td>@(string.IsNullOrWhiteSpace(p.UserId.ToString()) ? "——" : p.UserId.ToString())</td>
                    <td>@(string.IsNullOrWhiteSpace(p.GainDateTime.ToString()) ? "——" : p.GainDateTime.ToString())</td>
                </tr>
            }
            </tbody>
        </table>
    </div>
    <form class="form-inline" id="page" >
        <div class="form-group form-group-sm">
            
            <div class="button-group">
                <button type="button" class="btn btn-primary btn-small" onclick="PrivatePage(this)">上一页</button>
                <input type="text" class="form-control" id="currentPage" value="1">
                <button type="button" class="btn btn-primary btn-small" onclick="NextPage(this)">下一页</button>
            </div>
        </div>
        <button type="button" class="btn btn-primary btn-small" onclick="tragePage(this)">跳转</button>
    </form>
</div>
@section scripts{
<script src="~/Content/listmenu/js/jquery.min.js"></script>
<script src="~/Content/ProductVehicleType/js/bootstrap.min.js"></script>
<script src="~/Content/ProductVehicleType/js/bootstrap-datetimepicker.min.js"></script>
<script src="~/Content/ProductVehicleType/js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script>
        var sort = "10";
        var pageSize = 50, pageNumber = 1, isGain = null, outTime = null, ontime = null, isenabled = null;
        //排序
        function StatusChange(e) {
            pageSize = 50, pageNumber = 1, isGain = null, outTime = null, ontime = null, isenabled = null;
            var option = $(e).val();
            if (option == "未领取") { isGain = false; }
            if (option == "已领取") { isGain = true; }
            if (option == "已过期") { ontime = 1; }
            if (option == "未过期") { outTime= 1; }
            if (option == "禁用") { isenabled = false; }
            var postdata = { pageSize: pageSize, pageNumber: pageNumber, sort: sort, isGain: isGain, outTime: outTime, ontime: ontime, isenabled: isenabled };
            Serch(postdata);
        }

        //查询兑换码明细
        function Serch(postdata) {
            $('#page').show();
            $.post("@Url.Action("SelectExchangCode")", postdata, function (data) {
                if (data != null && data.length) {
                    var tr = "";
                    $.each(data, function (i, item) {
                        var startDateTime = formatDate(item.StartDateTime),
                            endDateTime = formatDate(item.EndDateTime),
                            importDateTime = formatDate(item.ImportDateTime),
                            enable = (item.IsEnabled == true) ? "显示" : "不显示",
                            gain = (item.IsGain == false) ? "未领取" : "已领取",
                            outtime = (new Date(parseInt(item.EndDateTime.replace(/\/Date\(/, "").replace(")/", ""))) > new Date()) ? "未过期" : "已过期",
                           
                        gaindate = item.GainDateTime == null ? "——" : formatDate(item.GainDateTime);
                        tr += '<tr><td>' + enable + '</td><td>' + gain + '</td><td>' + outtime + '</td><td>' + item.ExchangeCode + '</td><td>' + startDateTime + '</td><td>' + endDateTime + '</td><td>' + importDateTime + '</td><td>' + (item.UserId == null || item.UserId == "" ? "——" : item.UserId) + '</td><td>' + gaindate + '</td></tr>';
                    });
                    $('#SerchExchangeCodeDetail').empty().append(tr);
                    setPower("EditCode", 2);
                } else {
                    $('#SerchExchangeCodeDetail').html("");
                }
                $('#currentPage').val(pageNumber);
            });
        }
        //分页
         //前一页
         function PrivatePage(e) {
             var pageNum = $(e).next().val();
             if (pageNum > 1) {
                 pageNumber = pageNum - 1;
                 FenPage()
             }
         }
         //后一页
         function NextPage(e) {
             var pageNum = $(e).prev().val();
             if (pageNum > 0) {
                 pageNumber = Number(pageNum) + 1;
                 FenPage();
             }
         }
        //跳转
         function tragePage(e) {
             var pageNum = $('#currentPage').val();
             if (pageNum > 0) {
                 pageNumber = Number(pageNum);
                 FenPage();
             }
         }
        //分页
         function FenPage() {
             var postdata = { pageSize: pageSize, pageNumber: pageNumber, sort: sort, isGain: isGain, outTime: outTime, ontime: ontime, isenabled: isenabled };
             Serch(postdata);
         }

         function btn(e)
         {
             var e;
         }
        //排序
         function BtnSort(e) {
             var num = $(e).val();
             sort = num;
             if (num % 2 == 0)
             { $(e).val(Number(num) + 1); }
             else { $(e).val(Number(num) - 1); }
             var postdata = { pageSize: pageSize, pageNumber: pageNumber, sort: sort, isGain: isGain, outTime: outTime, ontime: ontime, isenabled: isenabled };
             Serch(postdata);
         }
         //处理时间类型的字符串
         function formatDate(now) {
             now = now.replace(/\/Date\(/, "").replace(")/", "");
             now = new Date(parseInt(now));
             var year = now.getFullYear();
             var month = jia0(now.getMonth() + 1);
             var date = jia0(now.getDate());
             var hour = jia0(now.getHours());
             var minute = jia0(now.getMinutes());
             var second = jia0(now.getSeconds());
             return year + "年" + month + "月" + date + "日   " + hour + ":" + minute + ":" + second;
         }
         $('#btn').click(function (){
             var e = $('#btn');
             })

         function formatDate1(now) {
             now = now.replace(/\/Date\(/, "").replace(")/", "");
             now = new Date(parseInt(now));
             var year = now.getFullYear();
             var month = jia0(now.getMonth() + 1);
             var date = jia0(now.getDate());
             var hour = jia0(now.getHours());
             var minute = jia0(now.getMinutes());
             var second = jia0(now.getSeconds());
             return year + "-" + month + "-" + date;
         }
         function jia0(n) {
             if (n < 10)
                 n = "0" + n;
             return n;
         }
         function Day() {
             var now = new Date()
         }
    </script>
}
