function getQueryString(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t!=null?unescape(t[2]):null}function getSortFun(n,t){var i=n=="asc"?">":"<";return new Function("a","b","return a."+t+i+"b."+t+"?1:-1")}function Tiaozhuan(n,t){window.location.href=urlStr+"/ActivityHtml/Iflashbuy/"+n+"&change="+t}function connectWebViewJavascriptBridge(n){window.WebViewJavascriptBridge?n(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){n(WebViewJavascriptBridge)},!1)}function Login(){userAgentInfo.indexOf("Android")>=0?window.WebViewJavascriptBridge.callHandler("actityBridge",{param:""},function(n){n!=null&&CallBackAppLoginResponse(n)}):iosend("aboutTuhuUserinfologin","CallBackAppLoginResponse")}function CallBackAppLoginResponse(n){var t=null;t=userAgentInfo.indexOf("Android")>=0?JSON.parse(n):n;UserId=t.userid;Phone=t.phone;Uuid=t.uuid}function iosend(n,t){location.href="#testapp#"+n+"#"+encodeURIComponent(t)}function VersionForIos(){isIosVersion=!0}function Countloading(){var e=new Date,t="",i="",r="",n,f,u;GetCookie("loadCookie")||SetCookie("loadCookie",GetDateTime1()+CreateNum());i=GetCookie("loadCookie");n=Uuid;Uuid||(n="");f=navigator.userAgent;t=f.indexOf("Android")>=0?"Android|"+n:"IOS|"+n;$(".lists .list").each(function(){r+=$(this).attr("id")+","});console.log(GetDateTime());console.log(window.location.href);console.log(t);console.log(r);console.log(i);try{u=new Image;u.id="Iflashbuy";u.src="http://t.tuhu.cn/act?tm="+encodeURIComponent(GetDateTime())+"&cp="+encodeURIComponent(window.location.href)+"&uid="+encodeURIComponent(t)+"&pids="+encodeURIComponent(r)+"&c_id="+i}catch(u){}}function GetDateTime(){var t=new Date,o=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),u=t.getHours(),f=t.getMinutes(),e=t.getSeconds(),n=o+"-";return i<10&&(n+="0"),n+=i+"-",r<10&&(n+="0"),n+=r+" ",u<10&&(n+="0"),n+=u+":",f<10&&(n+="0"),n+=f+":",e<10&&(n+="0"),n+e}function GetDateTime1(){var t=new Date,o=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),u=t.getHours(),f=t.getMinutes(),e=t.getSeconds(),n=o.toString();return i<10&&(n+="0"),n+=i,r<10&&(n+="0"),n+=r,u<10&&(n+="0"),n+=u,f<10&&(n+="0"),n+=f,e<10&&(n+="0"),n+e}function CreateNum(){for(var n="",t=0;t<8;t++)n+=Math.floor(Math.random()*10);return n}function SetCookie(n,t){var i=new Date;i.setTime(i.getTime()+2592e6);document.cookie=n+"="+escape(t)+";path=/;expires="+i.toGMTString()}function GetCookie(n){var t=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}function touchStart(n){var t=n.touches[0];startY=t.pageY;startX=t.pageX}function touchMove(n){var t=n.touches[0];endX=t.pageX}function touchEnd(){}var activityId="",UserId="",urlStr="http://huodong.tuhu.cn",urlWX="http://wx.tuhu.cn",userAgentInfo,isIosVersion,Uuid,startX,startY,endX,endY;$(function(){var n={},u,f;n.TopDomain=".tuhu.cn";/\.tuhu\.(\w+)$/.test(location.host)&&(n.TopDomain=".tuhu."+RegExp.$1);n.ApiSite="//api"+n.TopDomain;var i=!1,t="",r=!0;$.ajax({type:"GET",url:urlWX+"/TuHuGas/SelectShanGouProducts",data:{},async:!1,dataType:"jsonp",success:function(u){var f,s,e,l,tt;if(console.log(u),(u.list||"").length>0){var h="",y=-1,c=0;for(f in u.list){if(y++,u.list[f].Products[0].PID.substr(0,2)=="TR"?u.list[f].EndDateTime<u.date?h+='<div class="swiper-slide" type="Tire.html?actid='+u.list[f].ActivityID+'"><span>'+u.list[f].StartDateTime.substr(11,5)+"<\/span><span>已结束<\/span><\/div>":u.date>=u.list[f].StartDateTime&&u.date<=u.list[f].EndDateTime?(h+='<div class="swiper-slide" type="Tire.html?actid='+u.list[f].ActivityID+'"><span>'+u.list[f].StartDateTime.substr(11,5)+"<\/span><span>进行中<\/span><\/div>",t=urlStr+"/ActivityHtml/Iflashbuy/Tire.html?actid="+u.list[f].ActivityID):u.list[f].StartDateTime>u.date&&(h+='<div class="swiper-slide" type="Tire.html?actid='+u.list[f].ActivityID+'"><span>'+u.list[f].StartDateTime.substr(11,5)+"<\/span><span>即将开始<\/span><\/div>"):u.list[f].EndDateTime<u.date?h+='<div class="swiper-slide" type="Index.html?actid='+u.list[f].ActivityID+'"><span>'+u.list[f].StartDateTime.substr(11,5)+"<\/span><span>已结束<\/span><\/div>":u.date>=u.list[f].StartDateTime&&u.date<=u.list[f].EndDateTime?(h+='<div class="swiper-slide" type="Index.html?actid='+u.list[f].ActivityID+'"><span>'+u.list[f].StartDateTime.substr(11,5)+"<\/span><span>进行中<\/span><\/div>",t=urlStr+"/ActivityHtml/Iflashbuy/Index.html?actid="+u.list[f].ActivityID):u.list[f].StartDateTime>u.date&&(h+='<div class="swiper-slide" type="Index.html?actid='+u.list[f].ActivityID+'"><span>'+u.list[f].StartDateTime.substr(11,5)+"<\/span><span>即将开始<\/span><\/div>"),s=u.list.sort(getSortFun("asc","StartDateTime")),u.date>=u.list[f].StartDateTime&&u.date<=u.list[f].EndDateTime)activityId=u.list[f].ActivityID,c=y+2;else for(e=0;e<s.length;e++)if(s[e].StartDateTime.substr(11,2)>=u.date.substr(11,2)){c=e+2;activityId=s[e].ActivityID;break}for(e=0;e<s.length;e++)if(u.date>=s[e].StartDateTime&&u.date<=s[e].EndDateTime){c=e+2;activityId=s[e].ActivityID;break}}$("#ii").after(h);l=2;getQueryString("change")!=null&&getQueryString("change")!=""&&(c=getQueryString("change"));getQueryString("actid")!=null&&getQueryString("actid")!=""?activityId=getQueryString("actid"):(r=!1,window.location.href=t);$slides=$(".swiper-slide");$slides.eq(c).addClass("active");var rt=new Swiper(".swiper-container",{initialSlide:c-l,slidesPerView:5,onInit:function(){i=!0},onTransitionEnd:function(n){if(i){var t=n.activeIndex+l;$slides.removeClass("active").eq(t).addClass("active");Tiaozhuan($slides.eq(t).attr("type"),t)}}}).on("click",function(n){var i=$slides.length,t;if(n.clickedIndex<l||n.clickedIndex>i-l-1)return!1;t=n.clickedIndex-l;n.slideTo(t,500,!1);setTimeout(function(){$slides.removeClass("active").eq(n.clickedIndex).addClass("active")},500);Tiaozhuan($slides.eq(n.clickedIndex).attr("type"),n.clickedIndex)}),p,w,k=document,ut=window,d='<div class="header" ><label class="txt" v-text="tips[status]">活动已结束<\/label>\t\t<b v-show="showTime"><span v-text="hour">10<\/span> : <span v-text="minute">13<\/span> : <span v-text="second">36<\/span><\/b><\/div>',ft=function(){var n=window.location.search,t={};return n=n.substring(1,n.length),n.split("&").forEach(function(n){var i=n.split("=");i.length>0&&(t[i[0]]=i.length>1?i[1]:"")}),t}(),o=function(){var t=$("#tipsContent"),n=$("#popTips");return function(i){t.text(i);n.show();setTimeout(function(){n.hide()},3e3)}}(),a={getProducts:function(){return $.ajax({type:"get",url:n.ApiSite+"/action/GetFlashSaleProduct",data:{actid:activityId},dataType:"jsonp"}).then(function(n){if(n)return n.Products||(n.Products=[]),n.Products=n.Products.map(function(t){return t.SaleOutPercentage=parseInt(t.SaleOutQuantity/t.TotalQuantity*100)>100?100:parseInt(t.SaleOutQuantity/t.TotalQuantity*100),t.surplusQuantity=t.TotalQuantity-t.SaleOutQuantity,t.Quantity=0,t.enSub=!1,t.enAdd=!0,t.InstallAndPay,t.IsUsePcode,t.PID,t.IsEnd=+new Date(n.EndDateTime)<=+new Date(n.ServiceTime),t.IsStart=+new Date(n.StartTime)>=+new Date(n.ServiceTime),t}),n.IsEnd=+new Date(n.EndDateTime)<=+new Date(n.ServiceTime),n.IsStart=+new Date(n.StartTime)>=+new Date(n.ServiceTime),IsEnd=+new Date(n.EndDateTime)<=+new Date(n.ServiceTime),IsStart=+new Date(n.StartTime)>=+new Date(n.ServiceTime),n.TotalPrice=0,n.TotalQuantity=0,n;o("活动不存在")},function(){o("加载出错")})},getBuyRecords:function(t,i){return $.ajax({type:"get",url:n.ApiSite+"/action/GetFlashSaleBuyRecord",data:{userID:t,phone:i,actid:activityId},dataType:"jsonp"}).then(function(n){return n||[]},function(){o("加载出错")})}};r&&TuhuWebViewBridge.login(function(n){function t(n){return n==="(null)"||n==="null"||!n}t(n.userid)||t(n.phone)?a.getProducts().then(function(n){b(n,[])}):(p=n.userid,w=n.phone,Uuid=n.uuid,$.when(a.getProducts(),a.getBuyRecords(p,w)).then(function(n,t){b(n,t||[])}))});function ot(){var n=navigator.userAgent.toLowerCase(),t=n.indexOf("android")>-1;return t?!0:!1}function st(){var n=navigator.userAgent.toLowerCase(),t=n.indexOf("iphone")>-1;return t?!0:!1}function g(n){return n.IsBannerAndroid==1?n.BannerUrlAndroid:""}function nt(n){return n.IsEndImage?n.EndImage:""}function v(n,t){var r=n/1e3,u=Math.floor(r/3600),i=Math.floor((r-u*3600)/60),f=Math.floor(r-u*3600-i*60);t.hour=u;t.minute=i>=10?i:"0"+i;t.second=f>=10?f:"0"+f}tt=new Date;function it(){var n,t;try{n=getQueryString("PID");n&&(t=$("div[id='"+n+"']").offset().top,$(window).scrollTop(t))}catch(i){}}function b(n,t){function f(n,i){var r=function(t,i){var r={ouSurplusMAX:["您购买的",n.PName,"数量超出该商品的剩余数量！该商品剩余",n.surplusQuantity,"件"].join(""),hasBUYMAX:["该产品限购买",n.MaxQuantity,"件，您已不能再次购买！"].join(""),hasBUY:["该产品限购买",n.MaxQuantity,"件，您已购买",i,"件！"].join(""),outLimitMAX:["该产品限购",n.MaxQuantity,"件哦！"].join("")};return o(r[t]||""),!1},f,u;if(n.TotalQuantity>0&&i>n.surplusQuantity)return r("ouSurplusMAX");if(f=t.filter(function(t){return t.PID==n.PID}),f.length){if(u=f[0].Quantity,n.MaxQuantity!==0){if(u>=n.MaxQuantity)return r("hasBUYMAX");if(u+i>n.MaxQuantity)return r("hasBUY",u)}}else if(i>n.MaxQuantity&&n.MaxQuantity>0)return r("outLimitMAX");return!0}var r=g(n),u=nt(n);u.toLowerCase().indexOf("http")>=0?$("#endImg").attr("src",u):$("#endImg").css("display","none");r.toLowerCase().indexOf("http")>=0?$("#bannerImg").attr("src",r):$("#bannerImg").css("display","none");$("body").css("backgroundColor",n.BackgoundColor);n.bannerImg=r;n.ActivityName&&(document.title=n.ActivityName);var e={add:function(n,t){var r,u,i;try{r=n.toString().split(".")[1].length}catch(f){r=0}try{u=t.toString().split(".")[1].length}catch(f){u=0}return i=Math.pow(10,Math.max(r,u)),(this.mul(n,i)+this.mul(t,i))/i},mul:function(n,t){var i=0,r=n.toString(),u=t.toString();try{i+=r.split(".")[1].length}catch(f){}try{i+=u.split(".")[1].length}catch(f){}return Number(r.replace(".",""))*Number(u.replace(".",""))/Math.pow(10,i)}},s={add:function(n){if(IsEnd)o("活动已结束");else if(IsStart)o("活动未开始");else{var t=Number(n.Quantity+1)||0;f(n,t)&&(n.Quantity=t,this.update());n.Quantity>0&&!n.enSub&&(n.enSub=!0)}},sub:function(n){IsEnd?o("活动已结束"):IsStart?o("活动未开始"):n.enSub&&(n.Quantity=Math.max(n.Quantity-1,0),n.Quantity===0&&(n.enSub=!1),this.update())},input:function(n){n.Quantity=Number(n.Quantity)||0;f(n,n.Quantity)||(n.Quantity=0);this.update()},toDetail:function(n){var f=i._children[0].status,t=n.PID.split("|"),u=!1,r;n.PID.indexOf("TR")==0&&(u=!0);r=activityId;switch(f){case"DNS":case"END":r=""}TuhuWebViewBridge.os==="Android"?TuhuWebViewBridge.toDetail({ProductID:t[0],VariantID:t[1],FunctionID:u?"cn.TuHu.Activity.TireInfoUI":"cn.TuHu.Activity.AutomotiveProducts.AutomotiveProductsDetialUI",activityId:r,flashSaleNum:n.Quantity},n.PID.indexOf("TR-")>=0?"Tire":"ChePing"):u?TuhuWebViewBridge.send("TNTireInfoVC",JSON.stringify({ProductID:t[0],VariantID:t[1],activityId:r}),null,1):TuhuWebViewBridge.send("TNGoodsListDetailViewController",JSON.stringify({productID:t[0],VariantID:t[1],activityId:r}),null,1)},update:function(){var n=0,t=0;[].concat(this.Products).filter(function(n){return n.Quantity>0}).forEach(function(i){n=e.add(n,e.mul(i.Quantity,i.Price));t+=i.Quantity});this.TotalPrice=n;this.TotalQuantity=t},submit:function(){var f,t,u,r;Login();f=i._children[0].status;switch(f){case"DNS":o("活动还未开始");break;case"END":o("活动已结束");break;case"BEG":if(t=[].concat(this.Products).filter(function(n){return n.Quantity>0}),t.length===0){o("还未选择商品");return}var e=[],s=[],h=3;TuhuWebViewBridge.os==="IOS"?(Login(),UserId!=null&&UserId!=""&&(u=0,t=t.map(function(n){return n.PID.indexOf("TR")==0||n.PID.indexOf("LG")==0?e.push(n.PID):s.push(n.PID),u+=n.Quantity*n.Price,{name:n.DisplayName,count:n.Quantity,price:n.Price.toFixed(2),productID:n.PID.split("|")[0],variantID:n.PID.split("|")[1],image:n.Image}}),r={"goods<THGoods>":t,totalPrice:u,orderType:h,orderAddressType:n.ShippType,couponType:8,activityId:activityId},console.log(r),TuhuWebViewBridge.send("THCreatOrderVC",JSON.stringify(r),null,1))):(t=t.map(function(n){return n.PID.indexOf("TR")==0||n.PID.indexOf("LG")==0?e.push(n.PID):s.push(n.PID),{orderTitle:n.DisplayName,orderNum:n.Quantity,orderPrice:n.Price.toFixed(2),ProductID:n.PID.split("|")[0],VariantID:n.PID.split("|")[1],produteImg:n.Image}}),r={activityId:activityId,OrderChannel:"1",CouponType:"8",orderType:h,carTypeSize:"",ChePingTyPe:"6",typeService:{Type:"",Name:"",Description:"",Count:""},quanType:"tire",Goods:t,Car:{VehicleID:"",VehicleName:"",Brand:"",Nian:"",PaiLiang:"",LiYangID:""}},TuhuWebViewBridge.send("toOrder",JSON.stringify(r)))}}},i=new Vue({el:k.body,data:{currentView:n.ShowType===2?"singleView":"listView",Products:n.Products,ShowCountDown:n.IsNoActiveTime,isEnd:+new Date(n.EndDateTime)<=+new Date(n.ServiceTime)},components:{countDown:{template:d,replace:!0,data:function(){function f(){var n=+new Date-o+e;n>u||u<=r?(v(0,t),t.status==="END"||(t.status="END",i&&(i.isEnd=!0)),t.showTime=!1,clearInterval(s)):n<r?(v(r-n,t),t.status==="DNS"||(t.status="DNS")):(v(u-n,t),t.status==="BEG"||(t.status="BEG"))}var e=+new Date(n.ServiceTime),o=+new Date,r=+new Date(n.StartTime),u=+new Date(n.EndDateTime),t={hour:0,minute:0,second:0,tips:{DNS:"活动开始倒计时",BEG:"距离本场结束还剩",END:"活动已结束"},status:"DNS",showTime:!0},s=setInterval(f,1e3);return f(),t}},listView:{template:"#tmpl_list",methods:s,data:function(){return n}},singleView:{template:"#tmpl_single",methods:s,data:function(){return n.Products=n.Products[0],n}}},compiled:function(){it();$(".progress").hide();var n=$(".footer").height();$("body").css("padding-bottom",n);Countloading()}})}}}});setTimeout(function(){var r=$(".swiper-container"),i=$(".middle"),n=$(".arrow"),t=$("#bannerImg");$timeBarHei=r.height();i.height($timeBarHei);t.css("margin-top",$timeBarHei);n.css({"margin-bottom":-n.height(),left:(i.width()-n.width())/2});(t.css("display")=="none"||t.css("display")=="inline")&&$(".top-header ").css("padding-top",$timeBarHei)},200);u=[{},{},{},{},{},{},{},{}];f=$("#tmpl_list").html();laytpl(f).render(u,function(n){$("#view").find(".lists").hide().end().html(n)})});userAgentInfo=navigator.userAgent;connectWebViewJavascriptBridge(function(n){n.init(function(n,t){t({"Javascript Responds":"Wee!"})});n.registerHandler("functionInJs",function(n,t){t("Javascript Says Right back aka!")})});isIosVersion=!1;Uuid="";document.getElementById("divADBox").addEventListener("touchstart",touchStart,!1);document.getElementById("divADBox").addEventListener("touchmove",touchMove,!1);document.getElementById("divADBox").addEventListener("touchend",touchEnd,!1);