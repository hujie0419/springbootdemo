function GetAreaFor3M(n){$.ajax({method:"GET",url:"http://api.tuhu.cn/shops/GetMaintenanceArea",data:{serviceList:n},dataType:"jsonp"}).done(function(n){var t,i,r;for(t in n.Area)n.Area[t].Belong!="\u5168\u90e8\u5730\u533a"&&(n.Area[t].Region==n.Area[t].Belong&&(i=$("<li  data-parentName="+n.Area[t].Belong+" class='province'><div  class='province'>"+n.Area[t].Belong+"<\/div><ul><\/ul><\/li>"),$(".list-multilevel").append(i)),r="<li onclick = 'CityClick(this)'  data-region="+n.Area[t].Region+">"+n.Area[t].Region+"<\/li>",$(".province[data-parentName='"+n.Area[t].Belong+"'] ul").append(r))}).fail(function(){})}function CityClick(n){dataEnd=0;console.log($(n).parent().find("li").eq(0).attr("data-region"));console.log($(n).attr("data-region"));Province=$(n).parent().find("li").eq(0).attr("data-region");City=$(n).attr("data-region");$(".location p").html("\u5f53\u524d\u4f4d\u7f6e\uff1a"+Province+City);$("#select_city").removeClass("active");console.log(Province);console.log(City);pageindex=1;$(".shop-list").html("");GetShopsFor3M(Province,City,"",serviceList,UserloginObject3M.latitude,UserloginObject3M.longitude,"",pageindex)}function GetShopDistance(n,t,i,r){var f=Rad(n),e=Rad(i),o=f-e,s=Rad(t)-Rad(r),u=2*Math.asin(Math.sqrt(Math.pow(Math.sin(o/2),2)+Math.cos(f)*Math.cos(e)*Math.pow(Math.sin(s/2),2)));return u=u*6378.137,u=Math.round(u*1e4)/1e4,u.toFixed(2)}function Rad(n){return n*Math.PI/180}function GetShopInstallPriceFor3M(n,t,i,r){var u=[];for(var f in Selected3MPackage.InstallServiceses)u.push(Selected3MPackage.InstallServiceses[f].PID);console.log(n);console.log(t);console.log(i);console.log(r);console.log(u);$.ajax({method:"GET",url:"http://by.tuhu.cn/home/GetBaoYangInstallServices.html",data:{vid:n,paiLiang:t,nian:i,shopIds:JSON.stringify(r),servicePIds:JSON.stringify(u)},dataType:"jsonp"}).done(function(n){$.each(n,function(n,t){$("#"+n).html("\u00a5"+t);$("#"+n).attr("data-price",t);t||$("#"+n).parents(".item").hide()})}).fail(function(){})}function GetShopsFor3M(n,t,i,r,u,f,e,o){$.ajax({method:"GET",url:"http://api.tuhu.cn/shops/GetMaintenanceShops",data:{Province:n,City:t,Sort:i,serviceList:r,LatBegin:u,LngBegin:f,ShopBusinessType:e,PageIndex:o,PageSize:10},dataType:"jsonp"}).done(function(n){var f,t,e,r,i,u,o;if(countSize=n.Count,n.Code=="1")if(console.log(JSON.stringify(n.ShopList[0])),n.ShopList.length==0)dataEnd==0&&$(".shop-list").append('<div class="item clearfix" id="end" style="text-align: center;color:red;display:block;">\u6ca1\u6709\u6570\u636e\u4e86...<\/div>'),++dataEnd;else{f=[];for(t in n.ShopList)f.push(n.ShopList[t].PKID),e="",UserloginObject3M.latitude&&(e=GetShopDistance(n.ShopList[t].LngBegin,n.ShopList[t].LatBegin,UserloginObject3M.latitude,UserloginObject3M.longitude)+"km"),r="",n.ShopList[t].ShopClassification==="\u5feb\u4fee\u5e97"?r="green":n.ShopList[t].ShopClassification==="\u7ef4\u4fee\u5382"?r="xiu":n.ShopList[t].ShopClassification==="4S\u5e97"&&(r="blue"),i="",n.ShopList[t].POS.indexOf("\u652f\u4ed8\u5b9d")>-1&&(i+='<span class="i-alpay">\u652f\u4ed8\u5b9d<\/span>'),n.ShopList[t].POS.indexOf("\u5fae\u4fe1")>-1&&(i+='<span class="i-wx">\u5fae\u4fe1<\/span>'),n.ShopList[t].POS.indexOf("\u5237\u5361")>-1&&(i+='<span class="i-bank">\u7f51\u94f6<\/span>'),n.ShopList[t].POS.indexOf("\u73b0\u91d1")>-1&&(i+='<span class="i-cash">\u73b0\u91d1<\/span>'),u="",(n.ShopList[t].ShopType&8)==8&&(u+='<span class="i-z">\u76f4<\/span>'),(n.ShopList[t].ShopType&16)==16&&(u+='<span class="i-hu">\u864e<\/span>'),(n.ShopList[t].ShopType&128)==128&&(u+='<span class="i-star">\u661f<\/span>'),o=' <div class="item clearfix"><div class="data-type" style="display:none;">'+JSON.stringify(n.ShopList[t])+'<\/div><div class="img"><img src="'+n.ShopList[t].ShopImg+'" alt="" width="90" height="70" /><p class="label '+r+'">'+n.ShopList[t].ShopClassification+'<\/p><\/div><div class="filed clearfix"><p class="name">'+n.ShopList[t].CarParName+'<\/p><span class="price" id="'+n.ShopList[t].PKID+'" name="'+n.ShopList[t].CarParName+'"><\/span><div class="other"><ul class="clearfix"><li>\u8bc4\u4ef7<span>'+n.ShopList[t].BaoYangCommentRate+"<\/span><\/li><li>"+n.ShopList[t].BaoYangInstallQuantity+'\u5355<\/li><\/ul><\/div><p class="address">'+n.ShopList[t].Address+'<\/p><span class="km">'+e+'<\/span><\/div><div class="icon clearfix"><div class="left">'+i+'<\/div><div class="right">'+u+"<\/div><\/div><\/div>",$(".shop-list").append(o);GetShopInstallPriceFor3M(SelectedCarDataFor3M.ProductID,SelectedCarDataFor3M.Pailiang,SelectedCarDataFor3M.Nian,f)}}).fail(function(){})}function GetQueryString(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t!=null?unescape(t[2]):null}function SetCookie(n,t){var i=new Date;i.setTime(i.getTime()+6048e5);document.cookie=n+"="+escape(t)+";path=/;expires="+i.toGMTString()}function GetCookie(n){var t=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}var pageIndex,ScrollBind,Province,City,dataEnd,countSize;$(function(){for(var n in Selected3MPackage.InstallServiceses)serviceList+=Selected3MPackage.InstallServiceses[n].PID+";";$(".select").on("tap",".value",function(n){$(".select").not($(this).parents(".select")).removeClass("active");$(this).parents(".select").toggleClass("active");n.stopPropagation()}).on("tap",".list li",function(n){var t=$(this).text();$(this).parents(".list").prev().children("span").text(t);$(".select").removeClass("active");order=$(this).attr("data-type");console.log(order);pageIndex=1;dataEnd=0;$(".shop-list").html("");GetShopsFor3M(Province,City,order,serviceList,UserloginObject3M.latitude,UserloginObject3M.longitude,"",pageIndex);n.stopPropagation()});$("#select_city").on("tap",".province",function(n){var t=$(this);t.hasClass("active")?$(this).removeClass("active").next("ul").hide():$(this).addClass("active").next("ul").show();n.stopPropagation()});$("#filter").on("tap",".list a",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active");$(this).hasClass("active")&&$(this).text()!="\u5b8c\u6210"&&$(this).attr("data-type",$(this).text())}).on("tap",".btn a",function(){shopBusinessType="";$("#filter a").each(function(){var n=$(this).attr("data-type");n&&(n=="\u5feb\u4fee\u5e97"?shopBusinessType+="b\u5feb\u4fee\u5e97|":n=="4S\u5e97"?shopBusinessType+="a4S\u5e97|":n=="\u7ef4\u4fee\u5382"&&(shopBusinessType+="c\u4fee\u7406\u5382|"),$(this).attr("data-type",""))});order="";$("#filter").removeClass("active");$("#filter a").removeClass("active");console.log(shopBusinessType.RightSubLast());dataEnd=0;pageIndex=1;$(".shop-list").html("");GetShopsFor3M(Province,City,"",serviceList,UserloginObject3M.latitude,UserloginObject3M.longitude,shopBusinessType.RightSubLast(),pageIndex)});$(".location p").html("\u5f53\u524d\u4f4d\u7f6e\uff1a"+Province+City);console.log(JSON.stringify(Selected3MPackage));GetAreaFor3M(serviceList);pageIndex=1;GetShopsFor3M(Province,City,"",serviceList,UserloginObject3M.latitude,UserloginObject3M.longitude,"b\u5feb\u4fee\u5e97|a4S\u5e97|c\u4fee\u7406\u5382",pageIndex);$(".shop-list").on("tap",".item",function(){var n=$(this).find(".data-type").text(),t=$(this).find(".price").attr("data-price"),i=$(this).find(".km").text(),r=$(this).find(".price").attr("id"),u=$(this).find(".price").attr("name");SetCookie("SelectedShopBy3M",n);console.log(JSON.parse(GetCookie("SelectedShopBy3M")));window.location.href="/ActivityHtml/3M/SubmitOrder.html?km="+i+"&name="+u+"&price="+t+"&id="+r});ScrollBind.Init()});pageIndex=1;ScrollBind={Init:function(){var n=0,t=0,r=$(".shop-list"),i=r.height();$(".shop-list").on("scroll",function(){var r=parseInt(countSize)/10;if(r<1&&(r=1),i=document.documentElement.scrollTop==0?document.body.clientHeight:document.documentElement.clientHeight,t=document.documentElement.scrollTop==0?document.body.scrollTop:document.documentElement.scrollTop,n=document.documentElement.scrollTop==0?document.body.scrollHeight:document.documentElement.scrollHeight,t+i+100>=n){if(pageIndex>=r)return!1;pageIndex<r&&(++pageIndex,GetShopsFor3M(Province,City,order,serviceList,UserloginObject3M.latitude,UserloginObject3M.longitude,shopBusinessType.RightSubLast(),pageIndex))}})}};String.prototype.RightSubLast=function(){return this.substring(0,this.length-1)};String.prototype.LeftSubFrist=function(){return this.substring(0,1)};var shopBusinessType="",order="",ProductID="",VariantID="",serviceList="",Selected3MPackage=JSON.parse(window.name),UserloginObject3M=JSON.parse(GetCookie("UserloginObject3M")),SelectedCarDataFor3M=JSON.parse(GetCookie("SelectedCarDataFor3M"));Province=UserloginObject3M.Province;City=UserloginObject3M.City;dataEnd=0;countSize=0;