function IsMobile(n){return n.match(/^[1][3|4|5|6|7|8]{1}[0-9]{9}$/)!=null?!0:!1}function GetQueryString(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t!=null?decodeURIComponent(t[2]):null}function VersionForIos(){isIosVersion=!0}function VersionForAndroid(){isAndroidVersion=!0}function connectWebViewJavascriptBridge(n){window.WebViewJavascriptBridge?n(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){n(WebViewJavascriptBridge)},!1)}function CreateOrderInfo(n,t,i,r,u,f){Count(f);userAgentInfo.indexOf("Android")>=0?isAndroidVersion?window.WebViewJavascriptBridge.callHandler("toActityBridge",{FunctionID:"cn.TuHu.Activity.OrderSubmit.PayOrderConfirm",SerialNumbers:n,PayAmount:t,subject:i,body:r,OrderNO:f},function(){}):window.WebViewJavascriptBridge.callHandler("toActityBridge",{FunctionID:"cn.TuHu.Activity.OrderInfomation",OrderNO:f},function(){}):isIosVersion?iosend("customSegue#THOrderCashiersVC",'{"casgiersData":'+JSON.stringify(u)+',"orderID":"'+f+'"}'):iosend("customSegue#TNOrderDetailVC",'{ "orderID":"'+f+'"}')}function iosend(n,t){location.href="#testapp#"+n+"#"+encodeURIComponent(t)}function SetCookie(n,t){var i=new Date;i.setTime(i.getTime()+6048e5);document.cookie=n+"="+escape(t)+";path=/;expires="+i.toGMTString()}function GetCookie(n){var t=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}function GetProduct(){var n="";productList.Image&&(n=productList.Image.replace("https","http"));$(".order-info .prod-name").text(productList.DisplayName);$(".order-info .price span").text(productList.Price);$(".order-info img").attr("src",n)}function GetUserAddressDetailList(n,t,i){$("#region").val(t+""+i);$.ajax({url:"http://wx.tuhu.cn/Battery/GetUserAddressDetailList",type:"GET",async:!1,data:{userId:n,province:t,city:i},dataType:"jsonp",success:function(n){var t=eval("("+n+")");$(t).each(function(n){AddressID=t[n].AddressID;$("#name").val(t[n].Consignees);$("#mobile").val(t[n].Cellphone);$("#address").val(t[n].AddressDetail)})}})}function GetCouponsList(n,t){$.ajax({url:"http://api.tuhu.cn/User/SelectPromotion",type:"POST",async:!1,data:{Products:n,UserID:t,ActivityId:"",OrderType:"Battery"},dataType:"jsonp",success:function(n){var r=JSON.parse(JSON.stringify(n)),t,i,u;r.Code=="1"&&r.PromotionCodeList.length>0?(t=r.PromotionCodeList,t.length>0?($("#selectQuan").html(t[0].Discount+"元  优惠券"),$("#selectQuan").attr("pkid",t[0].PKID),$("#selectQuan").attr("price",t[0].Discount),i="",$(t).each(function(n){i+='<div yh="1" pkid="'+t[n].PKID+'" price="'+t[n].Discount+'" class="quan"><span>'+t[n].Discount+"<\/span>优惠券 <\/div>"}),i+='<div yh="0" pkid="" price="0" class="quan"> <span>&nbsp;<\/span>不使用优惠券<\/div>',$(".quan-list").append(i),$(".quan-list div").eq(0).addClass("active"),$(".quan").click(function(n){$(this).attr("yh")=="0"?$("#selectQuan").html("不使用优惠券").removeClass("active"):$("#selectQuan").html($(this).attr("price")+"元  优惠券").removeClass("active");$(".quan").not(n).removeClass("active");$(this).toggleClass("active");$("#selectQuan").attr("pkid",$(this).attr("pkid"));$("#selectQuan").attr("price",$(this).attr("price"));$(".quan-list").toggle();Costing();n.stopPropagation()}),$(".yhq").show(),u=new IScroll(".container",{mouseWheel:!0,click:!0}),u.refresh()):$(".yhq").hide()):$(".yhq").hide();Costing()}})}function Costing(){var n=$("#selectQuan").attr("price"),t;n<=0||n==undefined||n=="undefined"?$(".p-price").html(productList.Price):(t=productList.Price-n,$(".p-price").html(t))}function SubmitForm(){var n,r,t,i,u;if($("#name").val().length<=0)return $("#name").attr("placeholder","请填写完整信息"),!1;if($.trim($("#mobile").val()).length<=0)return $("#mobile").attr("placeholder","请填写完整信息"),!1;if(!IsMobile($.trim($("#mobile").val().toString())))return $("#mobile").val("").attr("placeholder","请输入正确的手机号码"),!1;if($("#address").val().length<=0)return $("#address").attr("placeholder","请填写完整信息"),!1;n=new DataDetailModel;r=[];r[0]=new OrderDetailModel;t=new CarDetailModel;i=new AddressDetailModel;n.BookType=2;n.Name=$.trim($("#name").val());n.Cellphone=$.trim($("#mobile").val());n.UserId=userId;userAgentInfo.indexOf("Android")>=0?isAndroidVersion?(n.PayMothed=4,n.OrderChannel="8手机"):(n.PayMothed=1,n.OrderChannel="8手机"):isIosVersion?(n.PayMothed=4,n.OrderChannel="JIOS"):(n.PayMothed=1,n.OrderChannel="JIOS");n.PromotionCode=$("#selectQuan").attr("pkid");n.BookType=3;n.Name=$.trim($("#name").val());n.Cellphone=$.trim($("#mobile").val());n.UserId=userId;r[0].ProductId=productList.ProductID==undefined?"":productList.ProductID;r[0].Quantity=1;r[0].VariantId=productList.VariantID==undefined?"":productList.VariantID;r[0].Price=productList.Price==undefined?"":productList.Price;t.CarID=carList.CarID;t.Brand=carList.Brand;t.ProductID=carList.ProductID;t.Vehicle=carList.Vehicle;t.LIYANGID=carList.LIYANGID;t.Nian=carList.Nian;t.Pailiang=carList.Pailiang;t.TID=carList.TID;t.VehicleLogin=carList.VehicleLogin;t.SalesName=carList.SalesName;i.AddressID=AddressID;i.AddressDetail=$.trim($("#address").val());i.CityID=addressList.CityId;i.City=addressList.CityName;i.ProvinceID=addressList.ProvinceId;i.Province=addressList.ProvinceName;i.Cellphone=$.trim($("#mobile").val());i.Consignees=$.trim($("#name").val());n.OrderList=r;n.DefaultCar=t;n.DefaultAddress=i;u=JSON.stringify(n);$.ajax({url:"http://api.tuhu.cn/Order/CreateOrder?",type:"POST",dataType:"json",data:{jsonStr:u},success:function(n){for(var r,t=JSON.parse(JSON.stringify(n)),u=t.PayInfo.SerialNumbers,f=t.PayInfo.Price,e=t.PayInfo.Title,o=t.PayInfo.Body,s=t.PayInfo.OrderNO,i=0;i<t.Cashier.length;i++)t.Cashier[i].Payment_way_name!="支付宝"&&t.Cashier[i].Payment_way_name!="微信"&&delete t.Cashier[i];r=t;CreateOrderInfo(u,f,e,o,r,s);window.location.reload()}})}function Count(n){var r="",t=GetCookie("Uuid"),i;GetCookie("Uuid")||(t="");r=userAgentInfo.indexOf("Android")>=0?"Android|"+t:"IOS|"+t;try{i=new Image;i.id="BatteryV1";i.src="http://t.tuhu.cn/ord?tm="+encodeURIComponent(GetDateTime())+"&cp="+encodeURIComponent(window.location.href)+"&uid="+encodeURIComponent(r)+"&o_num="+encodeURIComponent(n)}catch(i){}}function GetDateTime(){var t=new Date,o=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),u=t.getHours(),f=t.getMinutes(),e=t.getSeconds(),n=o+"-";return i<10&&(n+="0"),n+=i+"-",r<10&&(n+="0"),n+=r+" ",u<10&&(n+="0"),n+=u+":",f<10&&(n+="0"),n+=f+":",e<10&&(n+="0"),n+e}var isIosVersion,isAndroidVersion,userAgentInfo,AddressID;$(function(){$(".notice, .notice-bg").show();$(".service-info").click(function(){$(".notice, .notice-bg").show()});$(".btn").click(function(){$(".notice, .notice-bg").hide()});var n=$(".quan-list");$(".yhq").click(function(){$(this).find("div").eq(1).addClass("active");n.show()});$(".yhq").hide();GetUserAddressDetailList(userId,addressList.ProvinceName,addressList.CityName);GetCouponsList('{"'+productList.ProductID+"|"+productList.VariantID+'":"1"}',userId);GetProduct()});isIosVersion=!1;isAndroidVersion=!1;userAgentInfo=navigator.userAgent;connectWebViewJavascriptBridge(function(n){n.init(function(n,t){t({"Javascript Responds":"Wee!"})});n.registerHandler("functionInJs",function(n,t){t("Javascript Says Right back aka!")})});var DataDetailModel=function(){this.BookType="";this.Name="";this.Cellphone="";this.UserId="";this.PayMothed="";this.OrderChannel="";this.PromotionCode="";this.OrderList="";this.DefaultCar="";this.DefaultAddress=""},OrderDetailModel=function(){this.ProductId="";this.VariantId="";this.Quantity="";this.Price=""},CarDetailModel=function(){this.CarID="";this.Brand="";this.ProductID="";this.Vehicle="";this.LIYANGID="";this.Nian="";this.Pailiang="";this.TID="";this.VehicleLogin="";this.SalesName=""},AddressDetailModel=function(){this.AddressID="";this.AddressDetail="";this.CityID="";this.City="";this.ProvinceID="";this.Province="";this.Cellphone="";this.Consignees=""},userId=GetCookie("UserId"),productList=JSON.parse(GetCookie("currentSelectProduct")),addressList=JSON.parse(GetQueryString("RegionSelect")),carList=JSON.parse(GetCookie("carData"));AddressID="";