@model IEnumerable<Tuhu.Provisioning.DataAccess.Entity.GaiZhuangCategoryModel>

@{
    var title = "改装类目配置";

    ViewBag.Title = title;
}
<style>
    .ui-dialog {
        border-radius: 3px;
        padding: 0px;
        width: auto;
    }

    .ui-dialog-grid {
        width: 100%;
    }

    .ui-dialog-title {
        width: 75%;
        padding: 8px 15px 8px 15px;
    }

    .ui-dialog-close {
        top: 8px;
    }

    .ui-dialog-body {
        padding: 10px;
    }

    .ui-dialog-content {
        padding: 0px;
    }

    .ui-dialog-footer {
        padding: 5px 10px 5px 5px;
        background: #ffffff;
        border-top: 1px solid #eee;
    }

        .ui-dialog-footer button {
            padding: 3px 15px;
            border-radius: 2px;
            box-shadow: 0 1px 1px rgba(0,0,0,.15);
            font-size: 12px;
        }

            .ui-dialog-footer button.ui-dialog-autofocus {
                font-weight: 700;
                text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
            }

    .expanded_table_icon {
        background: url(/Scripts/TableTree/images/tree.gif) no-repeat 0px -4px;
        width: 9px;
        cursor: pointer;
        padding-top: 0px;
        margin: 0px;
        padding-left: 13px;
        zoom: 1;
    }

    .collapsed_table_icon {
        background: url(/Scripts/TableTree/images/tree.gif) no-repeat 0px -24px;
        width: 9px;
        cursor: pointer;
        padding-top: 0px;
        margin: 0px;
        padding-left: 13px;
        zoom: 1;
    }


    .button1 {
        border-radius: 5px;
        padding: 5px 25px;
        border: none;
        color: #F0F0F0;
        font-size: 12px;
        font-family: "Microsoft Yahei";
        outline: none;
        cursor: pointer;
        background: #0088cc;
        border-color: #0088cc;
    }

    table th {
        color: white;
        padding: 6px 5px;
        text-align: left;
        background-color: #0088cc;
        border: solid 1px #0088cc;
    }
</style>
<script src="../../Scripts/ajaxfileupload.js" type="text/javascript"></script>
<link rel="stylesheet" href="/Scripts/artDialog6.0.4/css/ui-dialog.css" />
<script src="~/Scripts/artDialog6.0.4/dist/dialog-min.js"></script>
<script src="~/Scripts/artDialog6.0.4/dist/dialog-plus-min.js"></script>

@*<script src="~/Scripts/TableTree/jquery-1.7.2.min.js"></script>
<script src="~/Scripts/TableTree/jquery-ui-1.7.1.js"></script>
<script src="~/Scripts/TableTree/pa_ui.js"></script>
<script src="~/Scripts/TableTree/pa_ui_misc.js"></script>*@
@*<script src="~/Scripts/TableTree/pa_ui_date.js"></script>*@

@*<link href="~/Scripts/TableTree/pa_ui.css" rel="stylesheet"/>*@

<link href="~/Scripts/jQuery-EasyUI/themes/default/easyui.css" type="text/css" rel="stylesheet" />
<link href="~/Scripts/jQuery-EasyUI/themes/icon.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="~/Scripts/jQuery-EasyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="~/Scripts/jQuery-EasyUI/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="~/Scripts/layer/layer.js"></script>
<h2 style="">改装类目配置</h2>
<div id="LookOplog"></div>
<div id="changecategoryconfig" style="">
    <div id="changecategoryconfigList">
        <div>
            <a class="button1" href="javascript:;" style="margin-bottom: 20px; float: left;" onclick="quanshou();">全部收起</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a class="button1" href="javascript:;" style="margin-bottom: 20px; float: left; margin: 0 6px;" onclick="quankai();">全部展开</a>
            <a class="button1" href="javascript:;" style="margin-bottom: 20px; float: right;" onclick="insertcategory();">添加主类目</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a class="button1" href="javascript:;" style="margin-bottom: 20px; float: right; margin: 0 6px;" onclick="LookOplog();">查看日志</a>
            <a class="button1" href="javascript:;" style="margin-bottom: 20px; float: right;" onclick="insertAdvert();">【推荐】-添加广告</a>
        </div>

        <table id="categoryList" style="text-align: center; width: 100%;">
            <tr>
                <th>改装类目</th>
                <th>是否显示</th>
                <th>排序</th>
                <th>显示商品个数</th>
                <th>操作</th>
            </tr>
            @foreach (var item in Model)
            {
                <tr id="(@item.PKID)_tr">
                    <td style="display: none">@item.ParentCategoryID</td>
                    @if (item.ParentCategoryID == null)
                    {
                        <td style="width: 30%; text-align: left; padding-left: 5px;"><span id="@item.PKID" class="expanded_table_icon" onclick="shoukai(@item.PKID)"></span>@item.CategoryName</td>
                    }
                    else
                    {
                        <td style="width: 30%; text-align: left; padding-left: 20px;">@item.CategoryName</td>
                    }
                    <td style="width: 10%">@(item.IsShow ? "是" : "否")</td>
                    <td style="width: 10%">@item.Sort</td>
                    <td style="width: 10%">@item.ShowNum</td>
                    <td style="width: 40%">
                        @if (item.CategoryLevel == 0)
                        {
                            <a class="EditItem" value="@(item.PKID)" id="@(item.PKID)_Update" onclick="UpdateChangeCategory(@(item.PKID))">编辑</a>
                            <a class="AddChildItem" value="@(item.PKID)" id="@(item.PKID)_AddChild" onclick="AddChildChangeCategory(@(item.PKID))">添加子类目</a>
                            <a class="AddAdvertItem" value="@(item.PKID)" id="@(item.PKID)_AddAdvert" href="/ConfigCategory/AdvertCategoryList?categoryid=@item.PKID">关联广告</a>
                            <a class="DeleteItem" value="@(item.PKID)" id="@(item.PKID)_Delete" onclick="deleteModel(@(item.PKID))">删除</a>
                        }
                        @if (item.CategoryLevel == 1)
                        {
                            <a class="EditChildItem" value="@(item.PKID)" id="@(item.PKID)_UpdateChild" onclick="UpdateChildChangeCategory(@(item.PKID))">编辑</a>
                            <a class="RelateItem" value="@(item.PKID)" id="@(item.PKID)_Relate" href="/ConfigCategory/RelateProductList?categoryId=@(item.PKID)" target="_blank">关联商品</a>
                            <a class="RelateItem" value="@(item.PKID)" id="@(item.PKID)_Article" href="/ConfigCategory/ArticleCategoryList?categoryid=@(item.PKID)">关联文章</a>
                            <a class="DeleteItem" value="@(item.PKID)" id="@(item.PKID)_Delete" onclick="deleteModel(@(item.PKID))">删除</a>
                        }
                    </td>
                </tr>
            }
        </table>
    </div>
</div>
<div id="EditItemDIV"></div>
<input type="hidden" id="hidObjectType" value="GaiZhuang"/>
<input type="hidden" id="hidShou" value="" />
<script>
    
    $(function () {
        var hidShou = $("#hidShou").val();
        if (hidShou == "")
            {
                quanshou();
            }
    }
    );
    function insertcategory() {
        window.location.href = "/ConfigCategory/ChangeCategoryItem";
        //var dialgpResult = dialog({
        //    height: 350,
        //    width: 700,
        //    title: "添加主类目",
        //    button: [
        //    {
        //        value: "保存",
        //        callback: function () {
        //            $.ajax({
        //                type: "POST",
        //                url: "/ConfigCategory/InsertCategoryItem",
        //                data: {
        //                    "categoryName": $("#CategoryName").val(),
        //                    "sort": $("#Sort").val(),
        //                    "isShow": $("input[type='radio']:checked").val()
        //                },
        //                success: function (result) {
        //                    if (result) {
        //                        window.location.reload(true);
        //                    }
        //                    else {
        //                        alert("保存失败！");
        //                    }
        //                }
        //            });
        //        }
        //    },
        //    {
        //        value: "关闭"
        //    }]
        //});
        //$.ajax({
        //    url: "/ConfigCategory/ChangeCategoryItem",
        //    data: {  },
        //    type: "GET",
        //    success: function (result) {
        //        dialgpResult.content(result);
        //        dialgpResult.showModal();
        //    }
        //});
    };

    function UpdateChangeCategory(e) {
        window.location.href = "/ConfigCategory/ChangeCategoryItem?pkid=" + e;
        //var dialgpResult = dialog({
        //    height: 200,
        //    width: 500,
        //    fixed: true,
        //    title: "编辑主类目",
        //    button: [{
        //        value: "保存",
        //        callback: function () {
        //            $.ajax({
        //                type: "POST",
        //                url: "/ConfigCategory/UpdateCategoryItem",
        //                data: {
        //                    "pkid": e,
        //                    "categoryName": $("#CategoryName").val(),
        //                    "parentCategoryID": $("#ParentCategoryID").val(),
        //                    "categoryLevel": $("#CategoryLevel").text(),
        //                    "categoryType": $("#CategoryType").val(),
        //                    "subTitle": $("#SubTitle").val(),
        //                    "sort": $("#Sort").val(),
        //                    "isShow": $("input[type='radio']:checked").val(),
        //                    "showNum": $("#ShowNum").val(),
        //                },
        //                success: function (result) {
        //                    if (result) {
        //                        alert("保存成功！");
        //                        window.location.reload(true);
        //                    }
        //                    else {
        //                        alert("保存失败！");
        //                    }
        //                }
        //            });
        //        }
        //    },
        //    {
        //        value: "关闭"
        //    }]
        //});
        //$.ajax({
        //    url: "/ConfigCategory/ChangeCategoryItem?pkid=" + e,
        //    data: { pkid: e },
        //    type: "GET",
        //    success: function (result) {
        //        dialgpResult.content(result);
        //        dialgpResult.showModal();
        //    }
        //});
    };

    function deleteModel(e) {
        if (confirm("确定要删除吗")) {
            $.ajax({
                type: "POST",
                url: "/ConfigCategory/DeleteChangeCategoryItem",
                data: {
                    "pkid": e
                },
                success: function (result) {
                    if (result) {
                        alert("删除成功！");
                        window.location.reload(true);

                    }
                    else {
                        alert("删除失败！");

                    }
                }
            });
        };
    }

    function AddChildChangeCategory(e) {
        window.location.href = "/ConfigCategory/ChildChangeCategoryItem?parentPkid=" + e;
        //var dialgpResult = dialog({
        //    height: 350,
        //    width: 700,
        //    title: "添加子类目",
        //    button: [
        //    {
        //        value: "保存",
        //        callback: function () {
        //            $.ajax({
        //                type: "POST",
        //                url: "/ConfigCategory/InsertChildCategoryItem",
        //                data: {
        //                    "categoryName": $("#CategoryName").val(),
        //                    "parentCategoryID": $("#ParentCategoryID").val(),
        //                    "subTitle": $("#SubTitle").val(),
        //                    "showNum": $("#ShowNum").val(),
        //                    "sort": $("#Sort").val(),
        //                    "isShow": $("input[type='radio']:checked").val()
        //                },
        //                success: function (result) {
        //                    if (result) {
        //                        alert("保存成功！");
        //                        window.location.reload(true);
        //                    }
        //                    else {
        //                        alert("保存失败！");
        //                    }
        //                }
        //            });
        //        }
        //    },
        //    {
        //        value: "关闭"
        //    }]
        //});
        //$.ajax({
        //    url: "/ConfigCategory/ChildChangeCategoryItem?parentPkid="+e,
        //    data: {parentPkid:e},
        //    type: "GET",
        //    success: function (result) {
        //        dialgpResult.content(result);
        //        dialgpResult.showModal();
        //    }
        //});
    };

    function UpdateChildChangeCategory(e) {
        window.location.href = "/ConfigCategory/ChildChangeCategoryItem?pkid=" + e;
        //var dialgpResult = dialog({
        //    height: 200,
        //    width: 500,
        //    fixed: true,
        //    title: "编辑子类目",
        //    button: [
        //    {
        //        value: "保存",
        //        callback: function () {
        //            $.ajax({
        //                type: "POST",
        //                url: "/ConfigCategory/UpdateChildCategoryItem",
        //                data: {
        //                    "pkid": e,
        //                    "categoryName": $("#CategoryName").val(),
        //                    "parentCategoryID": $("#ParentCategoryID").val(),
        //                    "subTitle": $("#SubTitle").val(),
        //                    "showNum": $("#ShowNum").val(),
        //                    "sort": $("#Sort").val(),
        //                    "isShow": $("input[type='radio']:checked").val(),
        //                    "remark": $("#Remark").val()
        //                },
        //                success: function (result) {
        //                    if (result) {
        //                        alert("保存成功！");
        //                        window.location.reload(true);
        //                    }
        //                    else {
        //                        alert("保存失败！");
        //                    }
        //                }
        //            });
        //        }
        //    },
        //    {
        //        value: "关闭"
        //    }]
        //});
        //$.ajax({
        //    url: "/ConfigCategory/ChildChangeCategoryItem?pkid=" + e,
        //    data: { pkid: e },
        //    type: "GET",
        //    success: function (result) {
        //        dialgpResult.content(result);
        //        dialgpResult.showModal();
        //    }
        //});
    };

    function shoukai(pkid) {
        
        var css = $("#"+pkid).attr("class");
        
        var flag = 1;
        if(css==="expanded_table_icon")
        {
            $("#" +pkid ).attr("class","collapsed_table_icon");
            flag = 2;
            $("#categoryList tr").each(function () {
                if ($("td:first", this).html() === pkid.toString()) {
                    $(this).hide();
                }
            });
        }
        else if(css==="collapsed_table_icon" && flag!=2)
        {
            $("#" + pkid ).attr("class","expanded_table_icon");
            $("#categoryList tr").each(function () {
                if ($("td:first", this).html() === pkid.toString()) {
                    $(this).show();
                }
            });
        }
    }

    function quanshou() {
       
        $("#categoryList tr").each(function () {
            if ($("td:first", this).html() != null && $("td:first", this).html() != "") {
                $(this).hide();
            } else {
                $("span").attr("class", "collapsed_table_icon");
            }
        });
        $("#hidShou").val("1");
    }

    function quankai() {

        $("#categoryList tr").each(function () {
            if ($("td:first", this).html() != null && $("td:first", this).html() != "") {
                $(this).show();
            } else {
                $("span").attr("class", "expanded_table_icon");
            }
        });
        
    }

    function LookOplog() {
        $("#LookOplog").html("").load('/Logger/list?objectType=GaiZhuang');
        $("#LookOplog").dialog({
            title: "查看日志",
            width: 850,
            height: 450,
            modal: true,
            resizable: false,
            buttons: {
                "取消": function() {
                    $(this).dialog("close");
                }
            }
        });
    }

    function insertAdvert() {
        window.location.href = "/ConfigCategory/AdvertCategoryList?categoryid=0";
    };
</script>
