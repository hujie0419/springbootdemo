@model Tuhu.Provisioning.DataAccess.Entity.Coupon

@{
    Layout = null;
}

<script src="../../Scripts/ajaxfileupload.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        $("form").submit(function () {
            var _ParValue = $("#ParValue").val();
            var _MinValue = $("#MinValue").val();
            if (_ParValue == "" || _MinValue == "") {
                alert('面值和最低消费不能为空');
                return false;
            }
            var reg = /^[0-9]*$/;
            if (!reg.test(_ParValue)) {
                alert('面值须为正整数');
                return false;
            }
            if (!reg.test(_MinValue)) {
                alert('最低消费须为正整数');
                return false;
            }
            if (parseInt(_ParValue) > parseInt(_MinValue)) {
                alert('最低消费大于或等于面值');
                return false;
            }
        });

    });
</script>
@using (Html.BeginForm(new { @enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    @Html.HiddenFor(m => m.PKID)
    @Html.HiddenFor(m => m.CategoryID)

    <table style="background:#ffffff;font-size:12px;width:100%;">
        @*<tr>
            <td align="right">内容图：</td>
            <td>
                <img height="40" class="vwPicture" src="@Model.ContentSmallImage" />
                <input type="hidden" name="ContentImage" class="image" value="@Model.ContentImage" />
                <input type="hidden" name="ContentSmallImage" value="@Model.ContentSmallImage" class="smallImage" />
                <form method="post" action="" enctype="multipart/form-data">
                    <input style="width:150px;" type="file" onchange="UploadImg(this)" id="1" name="1" />
                </form>

            </td>
        </tr>
        <tr>
            <td align="right">背景图：</td>
            <td>
                <img height="40" class="vwPicture" src="@Model.BackgroundSmallImage" />
                <input type="hidden" name="BackgroundImage" class="image" value="@Model.BackgroundImage" />
                <input type="hidden" name="BackgroundSmallImage" class="smallImage" value="@Model.BackgroundSmallImage" />
                <form method="post" action="" enctype="multipart/form-data">
                    <input style="width:150px;" type="file" onchange="UploadImg(this)" id="2" name="2" />
                </form>

            </td>
        </tr>
        <tr>
            <td align="right">翻中时图：</td>
            <td>
                <img height="40" class="vwPicture" src="@Model.SpinSmallImage" />
                <input type="hidden" name="SpinImage" class="image" value="@Model.SpinImage" />
                <input type="hidden" name="SpinSmallImage" class="smallImage" value="@Model.SpinSmallImage" />
                <form method="post" action="" enctype="multipart/form-data">
                    <input style="width:150px;" type="file" onchange="UploadImg(this)" id="3" name="3" />
                </form>

            </td>
        </tr>*@
        <tr>
            <td align="right" style="width:30%;">面值：</td>
            <td style="width:70%;">@Html.TextBoxFor(model => model.ParValue, new { @style = "width:150px" })</td>
        </tr>
        <tr>
            <td align="right">最低消费：</td>
            <td>@Html.TextBoxFor(model => model.MinValue, new { @style = "width:150px" })</td>
        </tr>
        <tr>
            <td align="right">中红包描述语：</td>
            <td>@Html.TextBoxFor(model => model.Remark, new { @style = "width:150px" })</td>
        </tr>
        <tr>
            <td align="right">状态：</td>
            <td>
                @Html.RadioButtonFor(m => m.IsActive, 1) 启用
                @Html.RadioButtonFor(m => m.IsActive, 0) 停用
            </td>
        </tr>

        <tr>
            <td align="right"></td>
            <td>
                <input type="submit" value="保存" />
                &nbsp;&nbsp;&nbsp;&nbsp;
                <input type="button" value="取消并返回" onclick="location = 'Coupon?CategoryID=@Model.CategoryID'" />
            </td>
        </tr>
    </table>
}
<script>

    function UploadImg(e) {
        var $e = $(e);
        var $ee = $e.parents("tr").find("td").eq(1).find("img");
        var $smallImage = $e.parents("tr").find("td").eq(1).find("input[class='smallImage']");
        var $image = $e.parents("tr").find("td").eq(1).find("input[class='image']");
        $.ajaxFileUpload({
            url: '/Article/AddArticleImg2',
            secureuri: false,
            fileElementId: $e.attr("id"),
            dataType: 'json',
            data: {},
            type: "post",
            success: function (result) {
                if (result.BImage != "" && result.SImage != "") {
                    $ee.attr("src", result.SImage);
                    $(".vwPicture").show();
                    $smallImage.val(result.SImage);
                    $image.val(result.BImage);
                } else {
                    alert("上传失败！");
                }
            }
        });
    };
</script>