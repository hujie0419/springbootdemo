@{
    ViewBag.Title = "服务码服务类型配置";
    Layout = "~/Views/Shared/_LayoutNew.cshtml";
}
@section css{
    <link href="~/css/beautyPackage.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/iview/iview.css" rel="stylesheet" />
}

<div id="div">
    <h2>
        <a href="/BankMRActivity/MrCooperateUser">公司配置</a>
        <a href="/BeautyServicePackage/ServiceCodeTypeConfig">服务码类型配置</a>
    </h2>
    <h2><button v-on:click="showEditBeautyServiceCodeTypeConfig()">添加服务码类型</button></h2>
    <table class="table table-striped table-bordered table-hover dataTables-example">
        <thead>
            <tr>
                <th>ID</th>
                <th>名称</th>
                <th>关联PID</th>
                <th>描述</th>
                <th>适配车型</th>
                <th>服务类型</th>
                <th>Logo</th>
                <th>操作</th>
            </tr>
        </thead>
        <tr v-for="item in beautyServiceCodeTypeConfig">
            <td>{{item.PKID}}</td>
            <td>{{item.Name}}</td>
            <td>{{item.PID}}</td>
            <td>{{item.Description}}</td>
            <td>{{item.AdapterVehicleName}}</td>
            <td>{{item.ServerTypeString}}</td>
            <td><img :src="item.LogoUrl" style="width:50px;height:50px;" /></td>
            <td><input type="button" v-on:click="showEditBeautyServiceCodeTypeConfig(item)" value="编辑" /></td>
        </tr>
    </table>
    <div id="editBeautyServiceCodeTypeConfig">
        <div class="content">
            <modal v-if="editBeautyServiceCodeTypeConfigDialog.show" v-on:close="editBeautyServiceCodeTypeConfigDialog.show=false">
                <h3 slot="header">编辑</h3>
                <div slot="body" class="vertical-group">
                    <div>
                        <label>产品PID</label><input type="text" v-model="editBeautyServiceCodeTypeConfig.PID" />
                    </div>
                    <div>
                        <label>名字</label><input type="text" v-model="editBeautyServiceCodeTypeConfig.Name" />
                    </div>
                    <div>
                        <label>描述</label><textarea v-model="editBeautyServiceCodeTypeConfig.Description"></textarea>
                    </div>
                    <div>
                        <label>适配车型</label>
                        <select v-model="editBeautyServiceCodeTypeConfig.AdapterVehicle">
                            <option v-for="item in AdapterVehicleList" v-bind:value="item.Id">{{item.Name}}</option>
                        </select>
                    </div>
                    <div>
                        <label>服务类型</label>
                        <select v-model="editBeautyServiceCodeTypeConfig.ServerType" v-bind:disabled="IsEdit">
                            <option v-for="item in ServerTypes" v-bind:value="item.Id">{{item.Name}}</option>
                        </select>
                    </div>
                    <div>
                        <label>LogoUrl</label>
                        <input v-model="editBeautyServiceCodeTypeConfig.LogoUrl" readonly="readonly" placeholder="URL" style="align-content:center;">
                    </div>
                    <div>
                        <img :src="editBeautyServiceCodeTypeConfig.LogoUrl" style="width:100px;height:100px;" />
                        <Upload action="/BeautyServicePackage/UploadServiceCodeTypeConfigLogo"
                                :format="['jpg','jpeg','png']"
                                :on-format-error="handleFormatError"
                                :max-size="10000"
                                :on-exceeded-size="handleMaxSize"
                                :on-success="handleSuccess"
                                :show-upload-list="false">
                            <input type="button" value="上传图片" style="width:100px;" />
                        </Upload>
                    </div>
                </div>
                <div slot="footer">
                    <button class="modal-default-button" v-on:click="upsertBeautyServiceCodeTypeConfig()" v-bind:disabled="disableConfirmButton">确定</button>
                    <button class="modal-default-button" v-on:click="closeEditBeautyServiceCodeTypeConfig()">取消</button>
                </div>
            </modal>
        </div>
    </div>
</div>
<script type="text/x-template" id="modal-template">
    <transition name="modal">
        <div class="modal-mask">
            <div class="modal-wrapper">
                <div class="modal-container">
                    <div class="modal-header">
                        <slot name="header"></slot>
                    </div>
                    <div class="modal-body">
                        <slot name="body"></slot>
                    </div>
                    <div class="modal-footer">
                        <slot name="footer">
                            <button class="modal-default-button" v-on:click="">OK</button>
                        </slot>
                    </div>
                </div>
            </div>
        </div>
    </transition>
</script>
@section scripts{
    <script type="text/javascript" src="~/Scripts/vue.min.js"></script>
    <script src="~/Scripts/iview/iview.min.js"></script>

    <script type="text/javascript">
        Vue.component('modal', {
            template: '#modal-template'
        });
        var vue = new Vue({
            el: "#div",
            data: {
                beautyServiceCodeTypeConfig: [],
                editBeautyServiceCodeTypeConfigDialog: {
                    show: false
                },
                editBeautyServiceCodeTypeConfig: {
                    PKID: 0,
                    PID: "",
                    Name: "",
                    Description: "",
                    IsActive: true,
                    LogoUrl: "",
                    AdapterVehicle: 0,
                    ServerType: ""
                },
                ServerTypes: [
                    { Id: 0, Name: '正式' },
                    { Id: 1, Name: '测试' },
                ],
                AdapterVehicleList: [
                    { Id: 1, Name: '五座轿车' },
                    { Id: 2, Name: 'SUV/MPV' },
                    { Id: 3, Name: 'SUV' },
                    { Id: 4, Name: 'MPV' },
                    { Id: 5, Name: '七座轿车' },
                    { Id: 6, Name: '全部车型' }
                ],
                disableConfirmButton: false,
                IsEdit: false
            },
            created: function () {
                this.load();
            },
            watch: {
            },
            methods: {
                load: function () {
                    var self = this;
                    self.getAllBeautyServiceCodeTypeConfig();
                },
                delayLoad: function (callback) {
                    var self = this;
                    setTimeout(function () { self.load(); return callback() }, 1500);
                },
                getAllBeautyServiceCodeTypeConfig: function () {
                    var self = this;
                    $.get("GetAllBeautyServiceCodeTypeConfig?ServerType=2", function (rsp) {
                        if (rsp) {
                            self.beautyServiceCodeTypeConfig = rsp;
                        } else {
                            alert("获取失败");
                        }
                    });
                },
                showEditBeautyServiceCodeTypeConfig: function (item) {
                    var self = this;
                    if (item && item.PKID > 0) {
                        self.editBeautyServiceCodeTypeConfig.PKID = item.PKID;
                        self.editBeautyServiceCodeTypeConfig.PID = item.PID;
                        self.editBeautyServiceCodeTypeConfig.Name = item.Name;
                        self.editBeautyServiceCodeTypeConfig.Description = item.Description;
                        self.editBeautyServiceCodeTypeConfig.LogoUrl = item.LogoUrl;
                        self.editBeautyServiceCodeTypeConfig.AdapterVehicle = item.AdapterVehicle;
                        self.editBeautyServiceCodeTypeConfig.ServerType = item.ServerType;
                        self.IsEdit = true;
                    } else {
                        self.editBeautyServiceCodeTypeConfig.PKID = 0;
                        self.editBeautyServiceCodeTypeConfig.PID = "";
                        self.editBeautyServiceCodeTypeConfig.Name = "";
                        self.editBeautyServiceCodeTypeConfig.Description = "";
                        self.editBeautyServiceCodeTypeConfig.LogoUrl = "";
                        self.editBeautyServiceCodeTypeConfig.AdapterVehicle = '';
                        self.editBeautyServiceCodeTypeConfig.ServerType = '';
                        self.IsEdit = false;
                    }
                    self.editBeautyServiceCodeTypeConfigDialog.show = true;
                },
                upsertBeautyServiceCodeTypeConfig: function () {
                    var self = this;
                    self.disableConfirmButton = true;
                    $.post("UpsertBeautyServiceCodeTypeConfig", { config: self.editBeautyServiceCodeTypeConfig }, function (result) {
                        if (result && result.IsSuccess) {
                            self.load();
                            self.editBeautyServiceCodeTypeConfigDialog.show = false;
                        } else if (result) {
                            alert(result.Msg);
                        } else {
                            alert("更新失败");
                        }
                        self.disableConfirmButton = false;
                    })
                },
                closeEditBeautyServiceCodeTypeConfig: function () {
                    var self = this;
                    self.editBeautyServiceCodeTypeConfigDialog.show = false;
                },
                handleFormatError(file) {
                    this.$Notice.warning({
                        title: '文件格式不正确',
                        desc: "请选择 .jpg  or .png  or .jpeg图片"
                    });
                },
                handleMaxSize(file) {
                    this.$Notice.warning({
                        title: '文件大小不符合要求',
                        desc: "请选择不超过100KB的图片"
                    });
                },
                handleSuccess(res, file) {
                    if (res != null) {
                        if (res.Item1) {
                            this.editBeautyServiceCodeTypeConfig.LogoUrl = res.Item2;
                        }
                        else {
                            this.$Notice.warning({
                                title: '上传图片失败',
                                desc: res.Item2
                            });
                        }
                    }
                    else {
                        this.$Notice.warning({
                            title: '上传图片异常',
                            desc: "服务端异常"
                        });
                    }
                },
            }
        })
    </script>
}