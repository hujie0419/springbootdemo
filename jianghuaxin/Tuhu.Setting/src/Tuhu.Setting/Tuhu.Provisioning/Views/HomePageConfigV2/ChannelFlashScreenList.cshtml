@{
    ViewBag.Title = "渠道闪屏";
}
@model IEnumerable<Tuhu.Provisioning.DataAccess.Entity.SE_FlashScreenConfig>



<div class="row ibox ibox-content">
    <div class="row" style="text-align:right; margin-bottom:5px;">
        <a href="javascript:void(0)" class="btn btn-default btn-sm" style="width:150px;" id="btnAdd" data-toggle="modal" data-target="#edit">新 增</a>
    </div>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>名 称</th>
                <th>开始版本</th>
                <th>结束版本</th>
                <th>开始时间</th>
                <th>结束时间</th>
                <th>渠 道</th>
                @*<th>链接</th>*@
                <th>状态</th>

                <th>更新时间</th>
                <th>管  理</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null)
            {
                foreach (var item in Model)
                {
                    <tr>
                        <td>@item.ID</td>
                        <td>@item.Name</td>
                        <td>@item.StartVersion</td>
                        <td>@item.EndVersion</td>
                        <td>@(string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.StartDateTime))</td>
                        <td>@(string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.EndDateTime))</td>
                        <td>@(item.Channel == 1 ? "Android" : (item.Channel == 2 ? "IOS" : item.Channel == 3 ? "移动站" : "全部"))</td>
                        @*<td>@item.LinkUrl</td>*@

                        <td>@(item.IsEnabled == true ? "启用" : "禁用")</td>

                        <td>@(string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.UpdateDateTime))</td>
                        <td>
                            <a href="javascript:void(0)" class="btn btn-danger btn-sm" name="btnEdit" data-id="@item.ID" data-toggle="modal" data-target="#edit">编 辑</a>
                            <a href="javascript:void(0)" class="btn btn-default btn-sm" name="btnDel" data-id="@item.ID">删 除</a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<div id="edit" class="modal fade" aria-hidden="true" role="dialog" tabindex="-1">

</div>
<link href="~/Scripts/multiple/multiple-select.css" rel="stylesheet" type="text/css" />

@section scripts{
   <script src="~/Scripts/multiple/multiple-select.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            $('#btnAdd').on('click', function () {
                var url = "/HomePageConfigV2/FlashScreenEdit?id=0&Type=2";
                // dialogOpen("新增首页", url, "edit");
                var dialog = $('#edit');
                dialog.empty();
                dialog.html(dialog.load(url));
            });


            $('a[name="btnEdit"]').on('click', function () {
                var url = "/HomePageConfigV2/FlashScreenEdit?id=" + $(this).data("id");

                // dialogOpen("新增首页", url, "edit");
                var dialog = $('#edit');
                dialog.empty();
                dialog.html(dialog.load(url));
            });

            $('a[name="btnDel"]').on('click', function () {
                var r = confirm("您确定删除?");
                if (r) {
                    var id = $(this).data("id");
                    $.ajax({
                        url: '/HomePageConfigV2/FlashScreenDelete',
                        data: { id: id },
                        type: 'post'
                    }).done(function (result) {
                        if (result == 1) {
                            location.reload();
                        } else {
                            alert("删除失败");
                        }
                    });
                }
            });
        });





        function UploadBgImg(obj, showImg, showUrl) {

            var pobj = $(obj);
            var fileSize = pobj[0].files[0].size / 1024 * 1.0;
            if ($('#Type').val() == 2) {
                if (fileSize > 100) {
                    alert("不能上传大于100KB的图片");
                    return false;
                }
            }
            if (fileSize > 1024) {
                alert("不能上传大于1024KB的图片");
                return false;
            }
            var rd = Math.ceil(Math.random() * 9999) + 1;
            var fileElId = $(obj).attr("id");
            console.log(fileElId);
            $.ajaxFileUpload({
                url: '/Article/ImageUploadToAli?rd=' + rd,
                secureuri: false,
                fileElementId: fileElId,
                dataType: 'json',
                async: false,
                success: function (result) {
                    if (result.BImage != "" && result.SImage != "") {
                        $("#" + showImg).attr("src", result.SImage).show();
                        $("#" + showUrl).val(result.BImage);
                    } else {
                        alert("上传失败！");
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            });
        }

        function UploadFileZip(obj) {

            var pobj = $(obj);
            var fileSize = pobj[0].files[0].size / 1024 * 1.0;
            if (fileSize > 25600) {
                alert("不能上传大于25M的文件");
                return false;
            }
            var rd = Math.ceil(Math.random() * 9999) + 1;
            var fileElId = $(obj).attr("id");
            console.log(fileElId);
            $.ajaxFileUpload({
                url: '/UploadFile/UploadFileByZip?rd=' + rd,
                secureuri: false,
                fileElementId: fileElId,
                dataType: 'json',
                async: false,
                success: function (result) {
                    if (result.Code == 1) {
                        $("#Zip").val(result.Zip);
                        $("#Md5").val(result.Md5);
                    } else {
                        alert(result.Msg);
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            });
        }

    </script>
}
 