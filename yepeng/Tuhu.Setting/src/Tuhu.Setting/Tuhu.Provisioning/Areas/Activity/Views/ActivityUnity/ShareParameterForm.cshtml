
@{
    ViewBag.Title = "ShareParameterForm";
    Layout = "~/Views/Shared/_Form.cshtml";
}

<form id="form1">
    <div style="padding-top:20px;margin-right:20px;">
        <table class="form">
            <tr>
                <th class="formTitle">标题：</th>
                <td class="formValue">
                    <input type="text" class="form-control" id="shareTitle" name="shareTitle" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">分享链接:</th>
                <td class="formValue">
                    <input type="text" class="form-control" id="shareUrl" name="shareUrl" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">分享图片:</th>
                <td class="formValue">
                    <img id="imgUrl" width="30" height="30" />
                    <input type="hidden" id="shareImage" name="shareImage" />
                    <input type="file" id="fileImage1" name="fileIamge1" style="display:inline;" onchange="fileImage()" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">描 述:</th>
                <td class="formValue">
                    <textarea id="shareDescrip" class="form-control" name="shareDescrip"></textarea>
                </td>
            </tr>
            <tr>
                <th class="formTitle">App链接:</th>
                <td class="formValue">
                    <input type="text" id="URL" name="URL" class="form-control" />
                </td>
            </tr>
            <tr>
                <td class="formTitle">分享类型:</td>
                <td class="formValue">
                    <select name="shareType" id="shareType">
                        <option value="0">分享链接</option>
                        <option value="3">小程序</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th class="formTitle">小程序路径:</th>
                <td class="formValue">
                    <input type="text" id="wxAppPath" name="wxAppPath" class="form-control" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">分享大图:</th>
                <td class="formValue"> 
                    <img id="imgUrlHd" width="30" height="30" />
                    <input type="hidden" id="wxAppImg" name="wxAppImg" />
                    <input type="file" id="fileImageHd" name="fileIamgeHd" style="display:inline;" onchange="UploadfileImageHd()" />
                </td>
            </tr>
        </table>
    </div>
    <input type="hidden" id="Type" name="Type" value="2"/>
</form>

<script type="text/javascript">
    var keyValue = $.request("keyValue");

    function UploadfileImageHd() {
        $.uploadFile({
            id: $("#fileImageHd").attr("id"),
            preBack: function () {
                $("#fileImageHd")[0].files[0].size / 1024 * 1.0;
                return true;
            },
            callBack: function (res) {
                console.log(res);
                $('#imgUrlHd').attr("src", res.BImage);
                $("#wxAppImg").val(res.BImage);
            },
            complete: function () {
                //$("#fileImage1").on("change", fileImage1);
            }
        });
    }


    function fileImage() {
        $.uploadFile({
            id: $("#fileImage1").attr("id"),
            preBack: function () {
                $("#fileImage1")[0].files[0].size / 1024 * 1.0;
                return true;
            },
            callBack: function (res) {
                console.log(res);
                $('#imgUrl').attr("src", res.BImage);
                $("#shareImage").val(res.BImage);
            },
            complete: function () {
                //$("#fileImage1").on("change", fileImage1);
            }
        });
    }

    function submitForm(iframe) {
        var formData = $("#form1").formSerialize();
        var data = {};
        data.shareUrl = formData.shareUrl;
        if (data.shareUrl.indexOf("&type=2") < 0) {
            data.shareUrl = data.shareUrl+"&type=2"
        }


        data.shareImage = formData.shareImage;
        data.shareDescrip = formData.shareDescrip;
        data.URL = formData.URL;
        data.shareTitle = formData.shareTitle;
        data.Type = 2;
        data.shareType = parseInt(formData.shareType);
        if (data.shareType == 3) {
            data.wxAppPath = formData.wxAppPath;
            data.wxAppImg = formData.wxAppImg;
        }
        iframe.$("#DataParames").val(JSON.stringify(data));
        top.ShareParameter.$.modalClose();
    }

    $(function () {
            var data = top.frames["ListForm" + keyValue].$("#DataParames").val();
            if (data) {
                data = JSON.parse(data);
                $("#form1").formSerialize(data);
                $("#imgUrl").attr("src", data.shareImage);
                $("#imgUrlHd").attr("src", data.wxAppImg);
            }
    })
</script>
