@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "银行活动使用记录";
}
<link rel="stylesheet" href="/Scripts/artDialog6.0.4/css/ui-dialog.css" />
<link href="~/Content/iview/iview.css" rel="stylesheet" />
<style type="text/css">
    [v-cloak] {
        display: none;
    }

    .tableContainer {
        width: 100%;
    }

        .tableContainer th {
            background: #66ABEF;
            color: #F3F7FA;
            border: 1px solid #559BD0;
            font-weight: 600;
            font-family: "Microsoft Yahei";
            text-align: center;
        }

        .tableContainer td {
            font-size: 75%;
            padding: 8px 3px 8px 3px;
            font-family: "Microsoft Yahei";
            text-align: center;
            border: 1px solid #eee;
        }

    .pager > button {
        float: right;
        margin-right: 4px;
    }

    .ui-dialog {
        width: auto;
    }

    .demo-upload-list {
        display: inline-block;
        width: 60px;
        height: 60px;
        text-align: center;
        line-height: 60px;
        border: 1px solid transparent;
        border-radius: 4px;
        overflow: hidden;
        background: #fff;
        position: relative;
        box-shadow: 0 1px 1px rgba(0,0,0,.2);
        margin-right: 4px;
    }

    img:hover {
        transform: scale(12);
    }
</style>
<div id="div" style="margin-top:20px" v-cloak>
    <div style="margin-bottom:20px">
        <i-input style="width:200px;margin-left:15px" placeholder="服务码" v-model="filterCondition.code"></i-input>
        <i-input style="width:200px;margin-left:15px" placeholder="手机号" v-model="filterCondition.mobile"></i-input>
        <i-button type="success" v-on:click="pager.currentPage=0;" style="margin-left:15px;height:30px;width:90px">查询</i-button>
    </div>
    <table class="tableContainer" style="margin-top:30px">
        <thead>
            <tr>
                <th>手机号</th>
                <th>其他号码</th>
                <th>银行卡号</th>
                <th>FW码</th>
                <th>订单号</th>
                <th>状态</th>
                <th>核销时间</th>
                <th>核销门店</th>
                <th>所属银行活动</th>
                <th>有效期</th>
                @*<th>手机号限购</th>
                <th>卡号限购</th>*@
                <th>所属场次</th>
                <th>场次限购</th>
                <th>每日限购</th>
            </tr>
        </thead>
        <tr v-if="list.length<=0&&!loading">
            <td colspan="13">无数据</td>
        </tr>
        <tr v-if="loading">
            <td colspan="13"><img src="/Images/loading.gif" /></td>
        </tr>
        <tr v-for="(item,index) in list">
            <td>{{item.Mobile}}<i-button type="primary" v-if="item.Mobile" size="small" v-on:click="SearchByType(item,'SearchMobile')" style="margin-left:15px">查看</i-button> </td>
            <td>{{item.OtherNum}}<i-button type="primary" v-if="item.OtherNum" size="small" v-on:click="SearchByType(item,'SearchOtherNum')" style="margin-left:15px">查看</i-button> </td>
            <td>{{item.BankNum }}<i-button type="primary" v-if="item.BankNum" size="small" v-on:click="SearchByType(item,'SearchBankNum')" style="margin-left:15px">查看</i-button> </td>
            <td>{{item.ServiceCode}}<i-button type="primary" v-if="item.ServiceCode" size="small" v-on:click="SearchByType(item,'SearchCode')" style="margin-left:15px">查看</i-button> </td>
            <td><a v-if="item.TuhuOrderId>0" :href="'https://oms.tuhu.cn/Order/Details/'+item.TuhuOrderId" target="_blank">{{item.TuhuOrderId}}</a></td>
            <td>{{item.Status|formatCheckStatus}}</td>
            <td>{{item.VerifyTime|formatDate}}</td>
            <td>{{item.ShopId}}</td>
            <td><a :href="'https://wx.tuhu.cn/vue/bankwash/pages/home/index?activityId='+item.ActivityId" target="_blank">{{item.ActivityId}}</a></td>
            <td>{{item.ValidityTime}}天</td>
            @*<td>{{item.MobileDayLimit}}</td>
            <td>{{item.BankDayLimit}}</td>*@
            <td>{{item.RoundStartTime|formatDate}}-{{item.RoundEndTime|formatDate}}</td>
            <td>{{item.RoundDayLimit}}</td>
            <td>{{item.DayLimit}}</td>
        </tr>
    </table>
    <div style="margin-top:20px;">
        <i-span>
            每页显示:
            <i-select v-model="pager.size" style="width:100px">
                <i-option v-for="size in sizes" v-bind:value="size">{{size}}</i-option>
            </i-select>
            条
        </i-span>
        <i-span>
            <i-button type="info" v-on:click="pager.currentPage=1" v-bind:disabled="pager.currentPage<=1">首页</i-button>
            <i-button type="info" v-on:click="pager.currentPage-=1" v-bind:disabled="pager.currentPage<=1">上一页</i-button>
            <i-button type="info" v-on:click="pager.currentPage+=1" v-bind:disabled="pager.currentPage>=pager.pages">下一页</i-button>
            <i-button type="info" v-on:click="pager.currentPage=pager.pages" v-bind:disabled="pager.currentPage>=pager.pages">尾页</i-button>
        </i-span>
        <i-span style="float:right">
            <i-span>当前第{{pager.currentPage}}页/共{{pager.pages}}页&nbsp;&nbsp;转到<input style="width:30px" type="text" v-model="pager.inputPage">页</i-span>
            <i-button type="info" v-on:click="pager.currentPage=pager.inputPage" v-bind:disabled="pager.inputPage<=0 || pager.inputPage>pager.pages">确定</i-button>
        </i-span>
    </div>
</div>

<script type="text/javascript" src="~/Scripts/vue.min.js"></script>
<script type="text/javascript" src="~/Content/My97DatePicker/WdatePicker.js"></script>
<script src="/Scripts/artDialog6.0.4/dist/dialog-min.js"></script>
<script src="/Scripts/artDialog6.0.4/dist/dialog-plus-min.js"></script>
<script src="~/Scripts/ajaxfileupload.js"></script>
<script src="~/Scripts/vue.common.js"></script>
<script src="~/Scripts/iview/iview.min.js"></script>
<script type="text/javascript">
    function formatCheckStatus(value) {
        var result = "无";
        switch (value) {
            case 0:
                result = "";
                break;
            case 1:
            case 2:
                result = "已发码";
                break;
            case 3:
                result = "已核销";
                break;
            case 4:
                result = "已取消";
                break;
            case 5:
                result = "已过期";
                break;
            case 6:
                result = "已撤销";
                break;
        }
        return result;
    }
    Vue.filter('formatCheckStatus', formatCheckStatus);
    var vue = new Vue({
        el: "#div",
        data: {
            pager: {
                total: 0,
                pages: 0,
                currentPage: 1,
                size: 10,
                inputPage: 0,
            },
            buttons: "",
            users: [],
            loading: false,
            list: [],
            sizes: [5, 10],
            filterCondition: {
                code: "",
                mobile: ""
            },
        },
        watch: {
            "pager.total": function () {
                var self = this;
                self.pager.pages = Math.ceil(self.pager.total / self.pager.size);
            },
            "pager.size": function () {
                var self = this;
                if (self.pager.size <= 0) {
                    self.pager.size = 1;
                    return;
                }
                if (self.pager.size > 200) {
                    self.pager.size = 200;
                    return;
                }
                self.pager.pages = Math.ceil(self.pager.total / self.pager.size);
                this.Init();
            },
            "pager.currentPage": function () {
                var self = this;
                if (self.pager.currentPage <= 0) {
                    self.pager.currentPage = 1;
                    return;
                }
                if (self.pager.pages > 1 && self.pager.currentPage > self.pager.pages) {
                    self.pager.currentPage = self.pager.pages;
                    return;
                }
                self.Init();
            }
        },
        created: function () {
           // this.Init();
        },
        methods: {
            Init: function () {
                var self = this;
                self.loading = true;
                self.list = [];
                $.get("SelectBankMrActivityUsageRecode", {
                    mobile: self.filterCondition.mobile,
                    code: self.filterCondition.code,
                    pageIndex: self.pager.currentPage,
                    pageSize: self.pager.size
                }, function (result) {
                    self.loading = false;
                    self.list = result;
                    self.pager.total = result.length > 0 ? result[0].Total : 0;
                });
            },
            SearchByType: function (item, type) {
                var self = this;
                $.get("SearchBankMrActivityInfoByType", { pkid: item.PKID, type: type }, function (result) {
                    switch (type) {
                        case "SearchMobile":
                            item.Mobile = result.Mobile;
                            break;
                        case "SearchOtherNum":
                            item.OtherNum = result.OtherNum;
                            break;
                        case "SearchBankNum":
                            item.BankNum = result.BankCardNum;
                            break;
                        case "SearchCode":
                            item.ServiceCode = result.ServiceCode;
                            break;
                    };
                });
            }
        },
    });
</script>
