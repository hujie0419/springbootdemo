@using Tuhu.Provisioning.DataAccess.Entity.Discovery;
@model List<SpecialColumn>
@{
    ViewBag.Title = "专题配制管理";
    var pagerModel = ViewData["PagerModel"] as PagerModel;
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>专题管理</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Index", "Home")">首页</a>
            </li>
            <li class="active">
                <strong>专题管理</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight ecommerce">

    <div class="ibox-content m-b-sm border-bottom">
        <div class="row">
            <div class="col-sm-4">
                <div class="form-group">
                    <button type="button" class="btn   btn-primary" data-toggle="modal" onclick="location.href = '/ArticleManage/AddColumn'">新增专题</button>
                </div>
            </div>

        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-content">

                    <table class="footable table table-stripped toggle-arrow-tiny" data-page-size="500">
                        <thead>
                            <tr>
                                <th data-hide="phone">专题名称</th>
                                <th>是否显示</th>
                                <th>发布时间</th>
                                <th class="text-right">管理</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Count > 0)
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@item.ColumnName</td>
                                        <td class="clsIsShow">@Html.Raw(item.IsShow?"是": "<span style='color:red'>否</span>")</td>
                                        <td>@item.PublishTime</td>
                                        <td class="text-right">
                                            <div class="btn-group">
                                                <button class="btn-white btn btn-xs" onclick="location.href = '/ArticleManage/EditColumn?id=@item.ID'">编辑</button>
                                                <button class='btn-white btn btn-xs btnIsShow'  scid="@item.ID">@(item.IsShow ? "设为不显示" : "设为显示")</button>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="7">
                                    <ul class="pagination pull-right"></ul>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                    <div class="text-center">
                        <div class="btn-group" id="tcdPageCode"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Styles {
    @Styles.Render("~/plugins/footableStyles")
    <style type="text/css">
        #myModal5 .form-group {
            height: 40px;
        }

        #myModal6 .form-group {
            height: 40px;
        }
    </style>
}

@section Scripts {
    @Scripts.Render("~/plugins/footable")
<script src="~/Scripts/CommentFile/jquery.page.js"></script>
<script type="text/javascript">

    $(document).ready(function () {
        $("#tcdPageCode").createPage({
            pageCount: @pagerModel.TotalPage,
            current: @pagerModel.CurrentPage,
            backFn: function (p) {
                //单击回调方法，p是当前页码
                location.href="/ArticleManage/ColumnManage?pageIndex="+p;
            }
        });
        //设为显示&不显示
        $(".btnIsShow").click(function(){
            var thisObj=$(this);
            var id=thisObj.attr("scid");
            var tdShow=thisObj.parents("tr").children(".clsIsShow");
            var isShow=thisObj.text()=="设为不显示"?false:true;
            var str=thisObj.text()=="设为不显示"?"设为显示":"设为不显示";
            if(confirm("确定要将此专题"+thisObj.text()+"吗？")){
                $.ajax({
                    type:"get",
                    url:"/ArticleManage/SetIsShow?id="+id+"&isShow="+isShow+"",
                    success:function(res){
                        if(res=="ok"){
                            thisObj.text(str);
                            tdShow.html(isShow?"是":"<span style='color:red'>否</span>");
                        }else{
                            alert("设置失败");
                        }
                    }
                });
            }
        });

    });

</script>
}