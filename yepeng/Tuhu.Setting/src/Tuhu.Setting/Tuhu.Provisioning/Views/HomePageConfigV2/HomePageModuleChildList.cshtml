@{
    ViewBag.Title = "HomePageModuleChildList";
}

@model IEnumerable<Tuhu.Provisioning.DataAccess.Entity.SE_HomePageModuleHelperConfig>

<div class="ibox ibox-content">
    <div class="row" style="text-align:right;margin-bottom:5px;">
        <a href="javascript:void(0)" class="btn btn-danger btn-small " id="btnAdd" style="width: 150px;" data-toggle="modal" data-target="#edit">新 增</a>
    </div>

    <div class="row">
        <table class="table table-bordered" style="text-align:center;">
            <thead>
                <tr>
                    <th style="text-align:center;">
                        ID
                    </th>
                    <th style="text-align:center;">
                        模块名称
                    </th>
                    <th>
                        模块类型
                    </th>
                    <th style="text-align:center;">
                        开始版本
                    </th>
                    <th style="text-align:center;">
                        结束版本
                    </th>
                    <th style="text-align:center;">
                        状 态
                    </th>
                    <th style="text-align:center;">
                        管 理
                    </th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.ID</td>
                            <td>@item.ModuleName</td>
                            <td>@ViewBag.ModuleTypeName</td>
                            <td>@item.StartVersion</td>
                            <td>@item.EndVersion</td>
                            <td>@(item.IsEnabled == true?"启用":"禁用")</td>
                            <td>
                                <a class="btn btn-default btn-sm btnedit" href="javascript:void(0)" data-id="@item.ID" data-toggle="modal" data-target="#edit">编 辑</a>
                                @if (User.Identity.Name.Contains("chenyutao"))
                                {
                                    <a class="btn btn-danger btn-sm btndelete" href="javascript:void(0)" data-id="@item.ID">删 除</a>
                                }
                               
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <input type="hidden" id="hiddenModuleType" name="hiddenModuleType" value="@ViewBag.ModuleType" />
    <input type="hidden" id="hiddenModuleID" name="hiddenModuleID"  value="@ViewBag.ModuleID"/>
</div>
<div id="edit" class="modal fade" aria-hidden="true" role="dialog" tabindex="-1">

</div>
@section scripts{
    <script type="text/javascript">
        $(function () {
            $('#btnAdd').on('click',function(){
                var url = "/HomePageConfigV2/HomePageModuleChildEdit?ModeulType=" + $('#hiddenModuleType').val() + "&id=0&parentModuleID=" + $('#hiddenModuleID').val();
                // dialogOpen("新增首页", url, "edit");
                var dialog = $('#edit');
                dialog.empty();
                dialog.html(dialog.load(url));
            });


            $('.btnedit').on('click',function(){
                var id = $(this).data("id");
                var url = "/HomePageConfigV2/HomePageModuleChildEdit?ModeulType=" + $('#hiddenModuleType').val() + "&id=" + id + "&parentModuleID=" + $('#hiddenModuleID').val();
                // dialogOpen("新增首页", url, "edit");
                var dialog = $('#edit');
                dialog.empty();
                dialog.html(dialog.load(url));
            });

            $('.btndelete').on('click',function(){
                if(confirm("您确定删除吗？")){
                    var id =$(this).data("id");
                    $.ajax({
                        url: '/HomePageConfigV2/DeleteHomePageModuleHelper',
                        type: 'post',
                        data: { moduleHelperID: id }
                    }).done(function (result) {
                        if (result == 1) {
                            location.reload();
                        } else {
                            alert("删除失败");
                        }
                    }).fail(function () {
                        alert("删除失败");
                    });
                }
            })

        });

        ///showImg：上传时Image显示的标签ID
        //showUrl:真正显示的
        function UploadBgImg(obj, showImg, showUrl) {
            debugger;
            var pobj = $(obj);
            var fileSize = pobj[0].files[0].size / 1024 * 1.0;
            if (fileSize > 1024) {
                alert("不能上传大于1024KB的图片");
                return false;
            }
            var rd = Math.ceil(Math.random() * 9999) + 1;
            var fileElId = $(obj).attr("id");
            console.log(fileElId);
            $.ajaxFileUpload({
                url: '/Article/ImageUploadToAli?rd=' + rd,
                secureuri: false,
                fileElementId: fileElId,
                dataType: 'json',
                async: false,
                success: function (result) {
                    if (result.BImage != "" && result.SImage != "") {
                        $("#" + showImg).attr("src", result.SImage).show();
                        $("#" + showUrl).val(result.BImage);
                    } else {
                        alert("上传失败！");
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            });
        }


        function UploadBgImg2(obj) {
            debugger;
            var pobj = $(obj);
            var fileSize = pobj[0].files[0].size / 1024 * 1.0;
            if (fileSize > 2024) {
                alert("文件不能超过2M，超大会影响前台展示效率");
                return false;
            }
            var rd = Math.ceil(Math.random() * 9999) + 1;
            var fileElId = $(obj).attr("id");
            console.log(fileElId);
            $.ajaxFileUpload({
                url: '/UploadFile/UploadFileByParam?directoryName=' + 'HomePageAe',
                secureuri: false,
                fileElementId: fileElId,
                dataType: 'json',
                async: false,
                success: function (result) {
                    if (result.Code == 1) {
                        $("#fileUrl").val(result.File);
                    } else {
                        alert(result.Msg);
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            });
        }
    </script>
    }