@{
    ViewBag.Title = "首页菜单配置";
}


@model IEnumerable<Tuhu.Provisioning.DataAccess.Entity.SE_HomePageMenuListConfig>



<div class="row ibox-content">
    <div class="col-lg-12 ibox-content">
        <div class="row" style="text-align:right;margin-bottom:5px;">
            <span>下次请求时间:</span>
            <input type="text" class="Wdate" onclick="WdatePicker({ dateFmt :'yyyy-MM-dd HH:mm:ss'})" name="UpdateDateTime" id="UpdateDateTime" value="@(string.Format("{0:yyyy-MM-dd}", ViewBag.UpdateDateTime))" />
           <a href="javascript:void(0)" class="btn btn-default btn-sm" id="btnUpdateDate" name="btnUpdateDate" style="margin-right:30px;">更新下次访问时间</a>
            <a href="javascript:void(0)" class="btn btn-danger btn-small " id="btnAdd" style="width: 150px;" data-toggle="modal" data-target="#edit">新 增</a>
        </div>
        <div class="row">
            <table class="table table-bordered" style="text-align:center;">
                <thead>
                    <tr>
                        <th style="text-align:center;">
                            ID
                        </th>
                        <th style="text-align:center;">
                            名称
                        </th>
                        <th style="text-align:center">开始版本</th>
                        <th style="text-align:center">结束版本</th>
                        <th style="text-align:center">
                            开始时间
                        </th>
                        <th style="text-align:center">
                            结束时间
                        </th>
                        <th style="text-align:center;">
                            创建时间
                        </th>
                        <th style="text-align:center;">
                            更新时间
                        </th>
                        <th style="text-align:center;">
                            管 理
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.ID </td>
                                <td>@item.Name</td>
                                <td>@item.StartVersion</td>
                                <td>@item.EndVersion</td>
                                <td>
                                    @string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.StartDateTime)
                                </td>
                                <td>
                                    @string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.EndDateTime)
                                </td>
                                <td>
                                    @string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.CreateDateTime)
                                </td>
                                <td>
                                    @string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.UpdateDateTime)
                                </td>
                                <td>
                                    <a class="btn btn-default btn-sm btnedit" href="javascript:void(0)" data-id="@item.ID" data-toggle="modal" data-target="#edit">编 辑</a>
                                    <a class="btn btn-danger btn-sm" target="_self" href="/HomePageConfigV2/HomePageMenuList?id=@item.ID" data-id="@item.ID">查看菜单</a>
                                    <a class="btn btn-danger btn-sm" href="javascript:void(0)" name="btnDelete" data-id="@item.ID">删 除</a>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

    </div>
</div>

<div id="edit" class="modal fade" aria-hidden="true" role="dialog" tabindex="-1">

</div>


@section scripts{
    <script type="text/javascript">

        $(function () {
            $('#btnUpdateDate').on('click', function () {
                $.ajax({
                    url: '/HomePageConfigV2/UpdateNextDateTime',
                    type: 'post',
                    data: { date: $('#UpdateDateTime').val() }
                }).done(function (result) {
                    if (result == 1) {
                        alert("下次获取的时间更新成功");
                        location.reload();
                    }
                    else
                        alert("下次获取的时间更新失败");
                });

            });


            $('#btnAdd').on('click', function () {
                var url = "/HomePageConfigV2/HomePageMenuGroupEdit?id=0";
                // dialogOpen("新增首页", url, "edit");
                var dialog = $('#edit');
                dialog.empty();
                dialog.html(dialog.load(url));
            });


            $('.btnedit').on('click', function () {
                var id = $(this).data("id");
                if (id) {
                    var url = "/HomePageConfigV2/HomePageMenuGroupEdit?id=" + id;
                    var dialog = $('#edit');
                    dialog.empty();
                    dialog.html(dialog.load(url));
                }
            });


            $('a[name="btnDelete"]').on('click', function () {
                var id = $(this).data("id")
                if (confirm("您确定删除吗?")) {
                    $.ajax({
                        url: '/HomePageConfigV2/HomePageMenuGroupDelete',
                        type: 'post',
                        data: { id: id },
                        dataType: 'json'
                    }).done(function (result) {
                        if (result == 1) {
                            location.reload();
                        } else {
                            alert("删除失败");
                        }
                    });
                }
            });
        });







    </script>

}
