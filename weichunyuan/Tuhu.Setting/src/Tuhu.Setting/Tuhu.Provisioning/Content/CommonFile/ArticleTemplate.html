<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>$BigTitle$</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        img {
            border: 0;
            display: block;
            margin: 0 auto;
        }

        .banner {
            position: relative;
        }

        .title {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            padding: 10px;
            position: absolute;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            width: 100%;
            box-sizing: border-box;
        }

        .content {
            padding: 10px;
        }

            .content img {
                display: inline-block;
                margin: 0 auto;
                width: 99%;
                max-width: 99%;
            }

            .content p {
                color: #666;
                font-size: 14px;
                line-height: 22px;
                margin: 5px 0;
            }

        .evaluate {
            display: block;
            width: 90px;
            height: 39px;
            background: url(//res.tuhu.cn/img/article/evaluate.png) 0 0 no-repeat;
            -webkit-background-size: contain;
            background-size: contain;
            margin: 20px auto;
        }

        .evaluateaa {
            display: block;
            width: 90px;
            height: 39px;
            background: url(//res.tuhu.cn/img/article/evaluate-h.png) 0 0 no-repeat;
            -webkit-background-size: contain;
            background-size: contain;
            margin: 20px auto;
        }

        .evaluate.on {
            background: url(//res.tuhu.cn/img/article/evaluate-h.png) 0 0 no-repeat;
            -webkit-background-size: contain;
            background-size: contain;
        }
    </style>

    <script src="http://resource.tuhu.cn/Scripts/jquery-2.1.0.js"></script>
    <script src="http://resource.tuhu.cn/Js/WebViewJavascriptBridge.js"></script>
    <script src="http://file.tuhu.cn/activity/scripts/jsonSerialization.js"></script>
    
    <script type="text/javascript">
        var domain = '//res.tuhu.cn';
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("iPhone", "iPad", "iPod");
        var flag = true;
        var isIosVersion = false;
        var isAndroidVersion = false;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        function connectWebViewJavascriptBridge(callback) {
            if (window.WebViewJavascriptBridge) {
                callback(WebViewJavascriptBridge)
            } else {
                document.addEventListener(
                    'WebViewJavascriptBridgeReady'
                    , function () {
                        callback(WebViewJavascriptBridge)
                    },
                    false
                );
            }
        }
        connectWebViewJavascriptBridge(function (bridge) {
            bridge.init(function (message, responseCallback) {
                var data = {
                    'Javascript Responds': 'Wee!'
                };
                responseCallback(data);
            });
            bridge.registerHandler("functionInJs", function (data, responseCallback) {
                var responseData = "Javascript Says Right back aka!";
                responseCallback(responseData);
            });
        })

        //-----------------------------------IOS版本判断
        function VersionForIos(version){
            isIosVersion = true;
        }
        //-----------------------------------安卓版本判断
        function VersionForAndroid(version) {
            isAndroidVersion = true;
        }
        //-----------------------------------全局替换
        String.prototype.ReplaceAll = function (reallyDo, replaceWith, ignoreCase) {
            if (!RegExp.prototype.isPrototypeOf(reallyDo)) {
                return this.replace(new RegExp(reallyDo, (ignoreCase ? "gi" : "g")), replaceWith);
            } else {
                return this.replace(reallyDo, replaceWith);
            }
        }
     
        function sendCommand(cmd, param) {
            var url = "#testapp#" + cmd + "#" + param;
            document.location = url;
        }
        //javascript:GoTo("123", "12");
        //javascript:GoToTaobao("123", ProductID);
        function GoTo(ProductID, VariantID) {
            if (userAgentInfo.indexOf("Android") >= 0) {
                window.WebViewJavascriptBridge.callHandler(
				'toChePinBridge'
					, {
					    'ProductID': ProductID,
					    'VariantID': VariantID
					}
				, function (responseData) {
				})
            } else {
                var dt = {
                    'ProductID': ProductID,
                    'VariantID': VariantID
                }
                sendCommand("gotoMonovularCarAccessoriesDetail", JSON.stringify(dt));
            }

            //跳转页面地址
            var currentAddress = document.location.toString();
            if (ProductID != "") {
                skipAddress(currentAddress, ProductID, 1);
            }
        }

        //---------------------------------------------移动设备跳转淘宝
        function GoToTaobao(ProductUrl, ProductID, ProductType) {
            if (userAgentInfo.indexOf("Android") >= 0) {
                if (isAndroidVersion) {
                    window.WebViewJavascriptBridge.callHandler(
                    'toTaobaoKe'
                        , {
                            'itemId': ProductID,        //商品真实id
                            'itemType': ProductType,    //商品类型 1：淘宝商品;2：天猫商品
                            'pid': 'mm_100829024_0_0',  //pid
                        }
                    , function (responseData) {
                    });
                }
                else {
                    document.location = ProductUrl;
                }
            } else {
                if (isIosVersion) {
                    var replaceUrl = "";
                    if (ProductUrl.toLocaleLowerCase().indexOf("https") >= 0) {
                        replaceUrl = ProductUrl.ReplaceAll("https:", "taobao:", "gi");
                    }
                    else {
                        replaceUrl = ProductUrl.ReplaceAll("http:", "taobao:", "gi");
                    }
                    document.location = replaceUrl;
                } else {
                    document.location = ProductUrl;
                }
            }

            //跳转页面地址
            var currentAddress = document.location.toString();
            if (ProductID != "")
            {
                skipAddress(currentAddress, ProductID, 2);
            }
        }

        //记录跳转数据
        function skipAddress(currentAddress, productId, type)
        {
            try {
                var articleId = currentAddress.substring((currentAddress.lastIndexOf("_") + 1));
                articleId = articleId.substring(0, articleId.lastIndexOf("."));
                $.ajax({
                    type: "POST",
                    url: "http://huodong.tuhu.cn/ArticleNewList/AddArticleNewList?",
                    data: {
                        "ArticleId": articleId, "ArticleUrl": currentAddress, "ProductId": productId, "Type": type
                    },
                    success: function (result) {
                    }
                });
            }
            catch (e) {
            }
        }



        function getNewDay(dateTemp, days) {
            var dateTemp = dateTemp.split("-");
            var nDate = new Date(dateTemp[1] + '-' + dateTemp[2] + '-' + dateTemp[0]); //转换为MM-DD-YYYY格式
            var millSeconds = Math.abs(nDate) + (days * 24 * 60 * 60 * 1000);
            var rDate = new Date(millSeconds);
            var year = rDate.getFullYear();
            var month = rDate.getMonth() + 1;
            if (month < 10) month = "0" + month;
            var date = rDate.getDate();
            if (date < 10) date = "0" + date;
            return (year + "-" + month + "-" + date);
        }

        //---------------------------------------------取消点赞
        function uvcmp(da) {
            if (da == null) {
                return false;
            }
            $.ajax({
                url: "http://huodong.tuhu.cn/Advertise/UnVote.html",
                data: { pkid: pakid, userId: da.userid },
                type: 'post',
                datatype: 'json',
                success: function (data) {
                    var jsonData = JSON.parse(data);
                    var voteModel = new Object();
                    voteModel.resultState = 0;//未点赞状态
                    voteModel.AllVoteCount = jsonData.AllVoteCount;
                    SetCookie(phone + pakid, JSON.stringify(voteModel));//获取是否点赞的cookie
                },
            });
        }

        //------------------------------------------点赞
        function vcmp(da) {
            if (da == null) {
                return false;
            }
            $.ajax({
                url: "http://huodong.tuhu.cn/Advertise/Vote.html",
                data: { pkid: pakid, userId: da.userid },
                type: 'post',
                datatype: 'json',
                success: function (data) {
                    var jsonData = JSON.parse(data);
                    var voteModel = new Object();
                    voteModel.resultState = 1;//点赞状态
                    voteModel.AllVoteCount = jsonData.AllVoteCount;
                    SetCookie(phone + pakid, JSON.stringify(voteModel));//获取是否点赞的cookie
                },
            });
        }

        function getPhone(cb, state) {
            if (userAgentInfo.indexOf("Android") >= 0) {
                window.WebViewJavascriptBridge.callHandler(
                    'actityBridge'
                    , { 'state': state }
                    , function (responseData) {
                        if (responseData != null) {
                            try {
                                var da = JSON.parse(responseData);
                                if (window[cb] != null) {
                                    window[cb](da);
                                }
                            } catch (e) {
                                // alert(e);
                            }
                        }
                    });
            } else {
                sendCommand("Userinfologin", cb);
            }
        }

        function getPhoneNotToLogin(cb) {
            if (userAgentInfo.indexOf("Android") >= 0) {
                window.WebViewJavascriptBridge.callHandler(
                    'toLoginBridge'
                    , { 'param': "" }
                    , function (responseData) {
                        if (responseData != null) {
                            try {
                                var da = JSON.parse(responseData);
                                if (window[cb] != null) {
                                    window[cb](da);
                                }
                            } catch (e) {
                                //alert(e);
                            }
                        }
                    });
            } else {
                sendCommand("UserinfologinNotToLogin", cb);
            }
        }

        function setPhone(da) {
            phone = da.phone;
            //alert(phone);
            // alert(getCookie(phone + pakid));
            if (getCookie(phone + pakid) != null) {
                var jsonVoteMode = JSON.parse(getCookie(phone + pakid));//获取是否点赞的cookie
                if (jsonVoteMode.resultState == 1) {//说明是已点赞状态
                    $("#evaluate").attr("class", "evaluateaa");//红色
                }
                else if (jsonVoteMode.resultState == 0) {//未点赞状态
                    $("#evaluate").attr("class", "evaluate");//百色
                }
            }
            else {//cookie为null
                $("#evaluate").attr("class", "evaluate");//百色
            }
        }
        //---------------------------------------获取cookie
        function getCookie(name) {
            var arr = document.cookie.match(new RegExp("(^| )" + name + "=([^;]*)(;|$)"));
            if (arr != null) return unescape(arr[2]); return null;
        }
        //--------------------------------------设置cookie
        function SetCookie(name, value) {
            var Days = 3600;
            var exp = new Date();
            //  domain = "tuhu.cn";
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
            document.cookie = name + "=" + escape(value) + ";path=/;expires=" + exp.toGMTString();
        }
        //--------------------------------------删除ookie
        function delCookie(name) {
            var exp = new Date();
            exp.setTime(exp.getTime() - 1);
            var cval = getCookie(name);
            if (cval != null)
                document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString() + "; path=/";
        }
        //------------------------------------获取android版本
    </script>

</head>
<body>
    <div class="banner">
        <img src="$headimg$" width="100%" alt="">
        <p class="title">$BigTitle$</p>
        <input type="hidden" id="PKID" name="PKID" value="$PKID$" />
    </div>
    <div class="content">
        $Content$<br />
        <!--<a href="javascript:void(0);" id="evaluate" class="evaluate" style="display:none;" ontouchstart=""></a>-->
        <br />
        <br />
    </div>
    <div>
        <style>
            .btn-fixed {
                position: fixed;
                z-index: 1;
                bottom: 0;
                width: 100%;
                height: 60px;
            }

            .coup-section {
                overflow: hidden;
                padding: 0 .8em;
            }

            .bgc-w {
                background-color: #fff;
            }
        </style>
        <section class="coup-section bgc-w btn-fixed" id="ActivitiesDownAppSe" style="position: fixed;z-index: 1;bottom: 0;width: 100%;height: 50px;background-color: rgba(0,0,0,.5);padding-top: 5px;padding-bottom: 5px;text-align: center;padding-left:8px;display:none;">
            <p style="white-space:nowrap;">
                <img src="http://wx.tuhu.cn/Css/images/luckmoney/tuhu_logo.png" style="width: 45px; height: 45px;  vertical-align: -22px;  padding-bottom: 5px;display:inline-block" />
                <a href="#" id="ActivitiesDownApp" style="font-size: 18px; line-height: 43px; width: 216px; height: 43px; text-align: center; text-decoration: none; color: #fff; border-radius: 5px; background-color: #b9100f;display:inline-block;margin-left:15px;font-weight: 700;">下载App，洗车只要5分钱</a>
            </p>
            <span style="position:absolute;top:-5px;left:5px;font-size:2.2rem;color:#c7c7c7;" id="ActivitiesDownAppClose">×</span>
        </section>
        <script>
            $(function () {
                if (isWeiXin()) {

                    $("#ActivitiesDownAppSe").css("display", "block")
                    $("#ActivitiesDownApp").click(function () {
                        window.location.href = "http://a.app.qq.com/o/simple.jsp?pkgname=cn.TuHu.android";
                    })

                    $("#ActivitiesDownAppClose").click(function () {

                        $("#ActivitiesDownAppSe").hide();
                    })
                }
            });

            function isWeiXin() {
                var ua = window.navigator.userAgent.toLowerCase();
                if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                    return true;
                } else {
                    return false;
                }
            };

        </script>
    </div>
</body>
</html>
<script type="text/javascript">
    function showvote() {
        $('#evaluate').show();
        $.ajax({
            url: "http://huodong.tuhu.cn/Advertise/AddHeat.html?pkId= " + pakid,
            dataType: "json",
        }).done(function (data) {
        });
    }

    function showvoteForAndroid(state) {
        if (state == 0) {
            $("#evaluate").attr("class", "evaluate");//百色
        }
        else if (state == 1) {
            $("#evaluate").attr("class", "evaluateaa");//红色
        }
        return false;

    }
    pakid = $("#PKID").val();

    (function AddArticleClickNew() {
        var _newsPKID = $("#PKID").val();
        if (_newsPKID.length > 0) {
            $.ajax({
                url: "http://huodong.tuhu.cn/Advertise/AddArticleClickNew?callback=?",
                data: {
                    "PKID": _newsPKID,
                },
                dataType: "jsonp",
                type: "get",
                success: function (data) {
                    console.log(data);
                }
            });
        }
    })();

    $(function () {
        try{
            var phone;
            var pakid;
            $('#evaluate').hide();
            if (userAgentInfo.indexOf("Android") < 0) {
                getPhoneNotToLogin("setPhone");
            }
            //document.getElementById('evaluate').onclick = function () {
            //    var state = this.getAttribute('class');
            //    if (state == 'evaluate') {//没有点赞=》执行点赞功能
            //        $("#evaluate").attr("class", "evaluateaa");//红色=》提高用户体验所以先变色
            //        getPhone('vcmp', '1');
            //    } else {//已点过赞-》执行取消点赞
            //        $("#evaluate").attr("class", "evaluate");//百色=》提高用户体验
            //        getPhone('uvcmp', '0');
            //    }
            //};
        } catch (e) { }
    });

</script>