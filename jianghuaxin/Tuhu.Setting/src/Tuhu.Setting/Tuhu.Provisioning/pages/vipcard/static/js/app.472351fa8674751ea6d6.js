webpackJsonp([4],{"+skl":function(t,e){},"9Q9G":function(t,e){},HkXY:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("7+uW"),i={props:{name:{type:String}},methods:{logout:function(){this.$emit("logout")}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"header"},[t._m(0),t._v(" "),a("div",{staticClass:"header-aside"},[a("Dropdown",{on:{"on-click":t.logout}},[a("a",{staticClass:"header-aside-main",attrs:{href:"javascript:void(0)"}},[a("Icon",{staticClass:"main-icon",attrs:{type:"ios-person"}}),t._v("\n          "+t._s(t.name)+"\n          "),a("Icon",{attrs:{type:"arrow-down-b"}})],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",[t._v("退出登录")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"headerlogo"},[e("img",{staticClass:"header-logo-line",attrs:{src:"static/logo.png"}}),this._v(" "),e("div",{staticClass:"header-logo-title"},[e("h3",[this._v("途虎运营系统")]),this._v(" "),e("h4",[this._v("setting.tuhu.cn")])])])}]};var r=a("VU/8")(i,s,!1,function(t){a("pDZY")},null,null).exports,o={name:"setting-menu",props:{menus:{type:Array}},data:function(){return{searchVal:"",filteredMenus:[],openedmenus:[],shrinked:!1,activename:""}},watch:{$route:function(){this.setActiveName(this.$router.currentRoute.name)}},mounted:function(){this.filteredMenus=this.menus,this.setActiveName(this.$router.currentRoute.name)},methods:{goto:function(t){this.$router.push({name:t})},fliter:function(){var t=this.searchVal;this.filteredMenus=this.menus.filter(function(e){return e.name.indexOf(t)>=0}),this.updateOpenedMenus(this.util.array.select(this.filteredMenus,function(t){return t.key}))},updateOpenedMenus:function(t,e){this.openedmenus=t,e&&(this.activename=e),this.$nextTick(function(){this.$refs.orangeMenu.updateOpened(),this.$refs.orangeMenu.updateActiveName()})},setActiveName:function(t){var e;this.menus.forEach(function(a){a.children.forEach(function(n){n.key===t&&(e=a.key)})}),this.updateOpenedMenus([e],t)}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:{nav:!t.shrinked}},[a("Input",{staticClass:"search",attrs:{icon:"ios-search",placeholder:"筛选一级目录"},on:{"on-enter":t.fliter,"on-click":t.fliter},model:{value:t.searchVal,callback:function(e){t.searchVal=e},expression:"searchVal"}}),t._v(" "),a("Menu",{ref:"orangeMenu",attrs:{width:"210px","open-names":t.openedmenus,"active-name":t.activename},on:{"on-select":t.goto}},t._l(t.filteredMenus,function(e,n){return a("Submenu",{key:n,attrs:{name:e.key}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:e.icon}}),t._v("\n                "+t._s(e.name)+"\n            ")],1),t._v(" "),t._l(e.children,function(e,n){return a("MenuItem",{key:n,attrs:{name:e.key}},[t._v("\n            "+t._s(e.name)+"\n            ")])})],2)})),t._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:t.shrinked,expression:"shrinked"}],staticClass:"hide",on:{click:function(e){t.shrinked=!t.shrinked}}},[t._v("收起")])],1)},staticRenderFns:[]};var l={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"footer"},[e("div",{staticClass:"footer-data"},[e("span",[this._v("所有内容为途虎养车网商业机密信息，切勿泄漏。版权所有 途虎养车网 2011-2015")])])])}]};var u={name:"App",data:function(){return{user:{name:""}}},computed:{menus:function(){return this.$store.state.app.menus},username:function(){return this.$store.state.user.name}},components:{settingheader:r,settingmenu:a("VU/8")(o,c,!1,function(t){a("HkXY")},null,null).exports,settingfooter:a("VU/8")({},l,!1,function(t){a("ROvl")},null,null).exports},methods:{logout:function(){var t=location.hostname.replace("yunying","yewu").replace("setting","yewu");window.location.href=location.protocol+"//"+t+"/Account/LogOff"}}},d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("settingheader",{attrs:{name:this.username},on:{logout:this.logout}}),this._v(" "),e("settingmenu",{attrs:{menus:this.menus}}),this._v(" "),e("div",{staticClass:"content"},[e("div",{staticClass:"real-content"},[e("router-view")],1),this._v(" "),e("settingfooter")],1)],1)},staticRenderFns:[]};var h,p,m=a("VU/8")(u,d,!1,function(t){a("UeEU")},null,null).exports,f=a("BTaQ"),v=a.n(f),g=(a("+skl"),a("9Q9G"),a("mvHQ")),y=a.n(g),k=a("//Fk"),I=a.n(k),_=a("mtWM"),D=a.n(_),w={};w.title=function(t){t=t||"",window.document.title=t},D.a.interceptors.request.use(function(t){return p.start(),t},function(t){return p.error(),I.a.reject(t)}),D.a.interceptors.response.use(function(t){return console.log(t),p.finish(),t},function(t){p.error(),h.error({content:y()(t.response.data),duration:10,closable:!0})}),w.ajax=D.a,w.axiosInstance=D.a.create(),w.useMessage=function(t){h=t},w.useLoadingbar=function(t){p=t},w.message=h,w.array={},w.array.select=function(t,e){var a=[];return t.forEach(function(t,n){a.push(e(t))}),a};var C=w,x=a("NYxO"),S={namespaced:!0,state:{menu:{menus:[],openedmenus:[],shrinked:[]},user:{name:"",permission:[]}},mutations:{init:function(t,e){console.log(e),t.menus=e}}},N={namespaced:!0,state:{name:"",permissions:[]},mutations:{logout:function(t){},init:function(t,e){t.name=e.name,t.permissions=e.permissions}}};n.default.use(x.a);var $=new x.a.Store({state:{},mutations:{},actions:{},modules:{app:S,user:N}}),b=[{key:"1",name:"vip卡",icon:"ios-speedometer",children:[{key:"vipcardindex",name:"vip卡售卖场次"}]}];n.default.use(v.a),n.default.config.productionTip=!1,n.default.prototype.ajax=C.ajax,n.default.prototype.util=C,console.log(n.default.prototype.$Message),C.useMessage(n.default.prototype.$Message),n.default.prototype.$Loading.config({color:"#2ca9e1",failedColor:"#c9171e",height:2}),C.useLoadingbar(n.default.prototype.$Loading),C.ajax.get("/auth/GetBasicInformantion").then(function(t){if(t.data.success){$.commit("user/init",t.data.user),$.commit("app/init",b);var e=a("YaEn").default;e.beforeEach(function(t,e,a){(v.a.LoadingBar.start(),C.title(t.meta.title),console.log("pat"+t.meta.authpath),t.meta.authpath)?C.axiosInstance.get("/auth/haspower?path="+t.meta.authpath).then(function(t){t.data.success&&t.data.result?a():a({path:"/403"})}).catch(function(t){console.log(t),v.a.LoadingBar.error(),a({path:"/500"})}):a()}),e.afterEach(function(t){console.log("finish"),v.a.LoadingBar.finish()}),new n.default({el:"#app",router:e,store:$,components:{App:m},template:"<App/>"})}else{var i=location.hostname.replace("yunying","yewu").replace("setting","yewu");window.location.href=location.protocol+"//"+i+"/Account/LogOn?ReturnUrl="+location.href}})},ROvl:function(t,e){},UeEU:function(t,e){},YaEn:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("7+uW"),i=a("/ocq"),s={props:{client:{type:Number|String},disabled:{type:Boolean,default:!1}},data:function(){return{clients:[],clientId:0,clientName:""}},watch:{client:function(t){this.clientId=t}},mounted:function(){this.clientId=this.client,this.getclients()},methods:{getclients:function(){var t=this,e=this;this.ajax.get("/VipCard/GetAllClients").then(function(a){null!=a.data&&a.data.length>0?a.data.forEach(function(t,a){e.clients.push({clientId:t.ClientId,clientName:t.ClientName})}):t.$Notice.warning({title:"获取客户信息异常！",desc:"获取客户信息异常！"})})},onchange:function(t){this.$emit("on-change",t)}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",disabled:t.disabled},on:{"on-change":t.onchange},model:{value:t.clientId,callback:function(e){t.clientId=e},expression:"clientId"}},t._l(t.clients,function(e){return a("Option",{key:e.clientName,attrs:{value:e.clientId}},[t._v(t._s(e.clientName))])}))},staticRenderFns:[]},o=a("VU/8")(s,r,!1,null,null,null).exports,c={data:function(){var t=this;return{columns:[{title:"场次ID",key:"ActivityId"},{title:"场次名",key:"ActivityName"},{title:"企业客户",key:"ClientName"},{title:"场内VIP卡",key:"VipCards"},{title:"自动生成的url地址",key:"Url",render:function(t,e){return t("a",{domProps:{href:e.row.Url,target:"_blank"}},e.row.Url)}},{title:"创建时间",key:"CreateDateTime",render:function(e,a){return e("span",t.formatDate(a.row.CreateDateTime))}},{title:"更新时间",key:"LastUpdateDateTime",render:function(e,a){return e("span",t.formatDate(a.row.LastUpdateDateTime))}},{title:"操作",key:"action",width:150,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.toedit(a.index)}}},"编辑"),e("Button",{props:{type:"primary",size:"small"},on:{click:function(){t.getlog(a.row.ActivityId)}}},"查看日志"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.refreshcache(a.row.ActivityId)}}},"刷新缓存")])}}],data:[],page:{total:5,current:1,pageSize:5},logmodal:{loading:!0,visible:!1,width:800,data:[],columns:[{title:"操作",width:150,key:"Title",align:"center",fixed:"left"},{title:"操作人",width:100,key:"Name",align:"center"},{title:"时间",width:200,key:"CreateDateTime",align:"center",fixed:"left",render:function(e,a){return e("span",t.formatDate(a.row.CreateDateTime))}},{title:"明细",width:300,key:"Remark",align:"center",fixed:"left"}]},clientId:0}},created:function(){this.loadData(1)},computed:{},components:{selectclient:o},methods:{search:function(){this.loadData(1)},changeSelect:function(t){this.clientId=t},loadData:function(t){var e=this;this.page.current=t;var a={clientId:""===this.clientId?0:this.clientId,pageIndex:this.page.current,pageSize:this.page.pageSize};this.ajax.get("/VipCard/GetVipCardList",{params:a}).then(function(t){e.page.total=t.data.Pager.TotalItem,e.data=t.data.Source})},handlePageChange:function(t){this.loadData(t)},handlePageSizeChange:function(t){this.page.pageSize=t,this.loadData(this.page.current)},toCreate:function(){this.$router.push({name:"vipcardCreate"})},toedit:function(t){this.$router.push({name:"vipcardEdit",query:{activityId:this.data[t].ActivityId,clientId:this.data[t].ClientId,activityName:this.data[t].ActivityName}})},formatDate:function(t){if(null==t)return null;var e=new Date(parseInt(t.replace("/Date(","").replace(")/",""))),a=e.getFullYear(),n=e.getDate();return a+"-"+(e.getMonth()+1)+"-"+n+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},getlog:function(t){var e=this;this.logmodal.loading=!0,this.ajax.post("/VipCard/GetLogList",{activityId:t}).then(function(t){e.logmodal.data=t.data,e.logmodal.visible=!0,e.logmodal.loading=!1})},refreshcache:function(t){var e=this;console.log(t),this.ajax.post("/VipCard/RefreshCache",{activityId:t}).then(function(t){!0===t.data?e.$Message.success("刷新成功了"):e.$Message.error("刷新失败了")})}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h1",{staticClass:"title"},[t._v("VIP卡售卖场次")]),t._v(" "),a("div",[a("selectclient",{on:{"on-change":function(e){t.changeSelect(e)}}}),t._v(" "),a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:t.search}},[t._v("搜索")])],1),t._v(" "),a("div",{attrs:{align:"right"}},[a("Button",{attrs:{type:"primary",shape:"circle",icon:"plus-round"},on:{click:t.toCreate}},[t._v("售卖场次")])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"18px"}},[a("Table",{attrs:{height:600,data:t.data,columns:t.columns,stripe:""}}),t._v(" "),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.page.total,"show-total":"","page-size":t.page.pageSize,current:t.page.current,"page-size-opts":[5,10,20,50],"show-elevator":"","show-sizer":""},on:{"on-change":t.handlePageChange,"on-page-size-change":t.handlePageSizeChange}})],1)])],1),t._v(" "),a("Modal",{attrs:{title:"操作日志",width:t.logmodal.width},model:{value:t.logmodal.visible,callback:function(e){t.$set(t.logmodal,"visible",e)},expression:"logmodal.visible"}},[a("Table",{attrs:{loading:t.logmodal.loading,data:t.logmodal.data,columns:t.logmodal.columns,stripe:""}})],1)],1)},staticRenderFns:[]},u=a("VU/8")(c,l,!1,null,null,null).exports,d=a("mvHQ"),h=a.n(d),p={data:function(){var t=this;return{columns:[{type:"selection",width:60,align:"center"},{title:"批次ID",key:"BatchId"},{title:"VIP卡名称",key:"CardName"},{title:"VIP卡面额",key:"CardValue"},{title:"销售单价",key:"SalePrice"},{title:"库存数量",key:"Stock"},{title:"使用范围",key:"UseRange"},{title:"开始时间",key:"StartDate",render:function(e,a){return e("span",t.formatDate(a.row.StartDate))}},{title:"结束时间",key:"EndDate",render:function(e,a){return e("span",t.formatDate(a.row.EndDate))}}],data:[],checkDatas:[],clientId:-1,cleintName:"",activityName:""}},components:{selectclient:o},methods:{search:function(){this.loadData()},loadData:function(){if(""===this.clientId)this.$Message.error("请先选中客户");else{var t={clientId:this.clientId},e=this;this.ajax.get("/VipCard/GetBatchesByClientId",{params:t}).then(function(t){e.data=t.data})}},save:function(){var t=this,e=this,a=[];0===this.checkDatas.length?this.$Message.success("至少选中一条"):""===this.activityName?this.$Message.success("活动名称要在前端展示，请编辑下"):(this.checkDatas.forEach(function(t,n){var i={BatchId:t.BatchId,CardName:t.CardName,CardValue:t.CardValue,SalePrice:t.SalePrice,Stock:t.Stock,UseRange:t.UseRange,StartDate:e.formatDate(t.StartDate),EndDate:e.formatDate(t.EndDate)};a.push(i)}),this.ajax.post("/vipcard/Save",{data:h()(a),activityName:this.activityName,clientId:this.clientId}).then(function(e){!0===e.data?t.$Message.success("保存成功了"):t.$Message.error("保存失败了")}))},selectChange:function(t){this.checkDatas=t},formatDate:function(t){if(null==t)return null;var e=new Date(parseInt(t.replace("/Date(","").replace(")/",""))),a=e.getFullYear(),n=e.getDate();return a+"-"+(e.getMonth()+1)+"-"+n+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[t._v("运营 > VIP卡>\n    "),a("router-link",{attrs:{to:"/vipcard/index"}},[t._v("VIP卡售卖场次")]),t._v(" >新增售卖场次")],1),t._v(" "),a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写场次名称"},model:{value:t.activityName,callback:function(e){t.activityName=e},expression:"activityName"}}),t._v(" "),a("selectclient",{on:{"on-change":function(e){t.clientId=e}}}),t._v(" "),a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),a("Button",{attrs:{type:"success"},on:{click:t.save}},[t._v("保存")]),t._v(" "),a("div",{ref:"divSelect",staticStyle:{"margin-top":"18px"}},[a("Table",{ref:"selection",attrs:{border:"",columns:t.columns,data:t.data},on:{"on-selection-change":t.selectChange}})],1),t._v(" "),a("br"),a("br")],1)},staticRenderFns:[]},f=a("VU/8")(p,m,!1,null,null,null).exports,v={data:function(){var t=this;return{columns:[{type:"selection",width:60,align:"center"},{title:"批次ID",key:"BatchId"},{title:"VIP卡名称",key:"CardName"},{title:"VIP卡面额",key:"CardValue"},{title:"销售单价",key:"SalePrice"},{title:"库存数量",key:"Stock"},{title:"使用范围",key:"UseRange"},{title:"开始时间",key:"StartDate",render:function(e,a){return e("span",t.formatDate(a.row.StartDate))}},{title:"结束时间",key:"EndDate",render:function(e,a){return e("span",t.formatDate(a.row.EndDate))}}],disabled:!1,data:[],checkDatas:[],clientId:1,cleintName:"",activityName:"",activityId:"",ischeck:!1}},created:function(){this.loadEditData()},components:{selectclient:o},methods:{search:function(){this.loadEditData()},loadEditData:function(){this.activityId=this.$route.query.activityId,this.clientId=parseInt(this.$route.query.clientId),this.activityName=this.$route.query.activityName;var t={activityName:this.activityName,activityId:this.activityId,clientId:this.clientId},e=this;this.ajax.get("/VipCard/GetEditDatasByActivityId",{params:t}).then(function(t){e.data=t.data})},save:function(){var t=this,e=this,a=[];this.ischeck&&0===this.checkDatas.length?this.$Message.success("至少选中一条"):(this.checkDatas.forEach(function(t,n){var i={BatchId:t.BatchId,CardName:t.CardName,CardValue:t.CardValue,SalePrice:t.SalePrice,Stock:t.Stock,UseRange:t.UseRange,StartDate:e.formatDate(t.StartDate),EndDate:e.formatDate(t.EndDate)};a.push(i)}),this.ajax.post("/vipcard/Edit",{data:h()(a),activityName:this.activityName,activityId:this.activityId,clientId:this.clientId}).then(function(e){!0===e.data?t.$Message.success("保存成功了"):t.$Message.error("保存失败了")}))},selectChange:function(t){this.ischeck=!0,this.checkDatas=t},formatDate:function(t){if(null==t)return null;var e=new Date(parseInt(t.replace("/Date(","").replace(")/",""))),a=e.getFullYear(),n=e.getDate();return a+"-"+(e.getMonth()+1)+"-"+n+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[t._v("运营 > VIP卡>\n        "),a("router-link",{attrs:{to:"/vipcard/index"}},[t._v("VIP卡售卖场次")]),t._v(" >编辑售卖场次")],1),t._v(" "),a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写场次名称"},model:{value:t.activityName,callback:function(e){t.activityName=e},expression:"activityName"}}),t._v(" "),a("Input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:t.activityId,callback:function(e){t.activityId=e},expression:"activityId"}}),t._v(" "),a("selectclient",{attrs:{client:t.clientId,disabled:!0},on:{"on-change":function(e){t.clientId=e}}}),t._v(" "),a("Button",{attrs:{type:"success"},on:{click:t.save}},[t._v("保存")]),t._v(" "),a("div",{ref:"divSelect",staticStyle:{"margin-top":"18px"}},[a("Table",{ref:"selection",attrs:{border:"",columns:t.columns,data:t.data},on:{"on-selection-change":t.selectChange}})],1),t._v(" "),a("br"),a("br")],1)},staticRenderFns:[]},y=a("VU/8")(v,g,!1,null,null,null).exports;a.d(e,"page404",function(){return k}),a.d(e,"page403",function(){return I}),a.d(e,"page500",function(){return _}),n.default.use(i.a);var k={path:"/*",name:"error-404",meta:{title:"404-页面不存在"},component:function(){return a.e(1).then(a.bind(null,"LWjT"))}},I={path:"/403",meta:{title:"403-权限不足"},name:"error-403",component:function(){return a.e(0).then(a.bind(null,"J7+d"))}},_={path:"/500",meta:{title:"500-服务端错误"},name:"error-500",component:function(){return a.e(2).then(a.bind(null,"0Gql"))}};e.default=new i.a({routes:[{path:"/",redirect:"vipcard/Index"},{path:"/vipcard/create",name:"vipcardCreate",component:f,meta:{title:"新增售卖场次"}},{path:"/vipcard/edit",name:"vipcardEdit",component:y,meta:{title:"编辑售卖场次"}},{path:"/vipcard/index",name:"vipcardindex",component:u,meta:{title:"VIP卡售卖场次"}},I,_,k]})},pDZY:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.472351fa8674751ea6d6.js.map