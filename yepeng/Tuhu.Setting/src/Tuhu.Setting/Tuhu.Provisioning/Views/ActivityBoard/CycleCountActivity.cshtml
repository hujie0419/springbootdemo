@{
    ViewBag.Title = "活动盘点";
    Layout = "~/Views/Shared/_Layout_ActivityBoard.cshtml";
}
<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <style type="text/css">
        * { list-style: none; }

        .wrapper { width: 100%; margin: 0 auto; padding-top: 30px; }

        .head { height: 60px; width: 100%; line-height: 30px; margin-bottom: 20px; }

        /*.date { float: left; }*/

        .btns { float: right; height: 30px; }

        /*.start, .end { float: left; height: 28px; line-height: 28px; width: 76px; text-align: center; border: 2px solid #ddd; margin-left: 10px; font-weight: bold; color: #676a6c; font-size: 14px; cursor: pointer; background-color: #F9F9F9; }*/

        /*.choosed { height: 28px; line-height: 28px; border: 2px solid #009F95; background-color: #fff; color: #222222; }*/

        .containerBox { width: 100%; height: 700px; position: relative; background-color: #fff; border: 1px solid #ddd; border-right: none; }

        .containerBox .fixedTop { margin-right: 17px; -webkit-box-sizing: border-box; box-sizing: border-box; position: relative; }

        .containerBox .fixedTop .rightblank { position: absolute; top: -1px; right: -17px; height: 49px; width: 17px; border: 1px solid #aaa; border-left: none; }

        .weeks, .dates { width: 100%; overflow: hidden; padding-left: 0 !important; margin-bottom: 0 !important; }

        .weeks li { background-color: #F5F5F6; color: #222222; font-weight: bold; font-size: 15px; }

        .dates li { font-size: 13px; }

        .weeks li, .dates li { float: left; height: 24px; line-height: 23px; width: 12.5%; text-align: center; border: 1px solid #aaa; border-left: none; border-top: none; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -o-box-sizing: border-box; box-sizing: border-box; }

        .blocks { position: absolute; width: 100%; height: 100%; top: 50px; left: 0; overflow-y: scroll; overflow-x: hidden; background-color: #fff; }

        .blocks div .item { width: 100%; height: 22px; line-height: 22px; color: #fff; font-size: 12px; text-indent: 5px; border-bottom: 1px solid #fff; border-radius: 3px;white-space:nowrap; }

        .blocks .toEnd .item { /*background-color: red;*/ cursor: pointer; }

        .blocks .going .item { /*background-color: yellow;*/ cursor: pointer; }

        .blocks .toStart .item { /*background-color: green;*/ cursor: pointer; }

        .load { width: 100%; text-align: center; padding-top: 100px; }

        .paddingTop { padding-top: 5% }

        @@media screen and (max-width: 1400px) {
            .containerBox { height: 360px; }
        }

        @@media screen and (min-width: 1401px) {
            .containerBox { height: 680px; }
        }
    </style>
</head>
<body>
    <div class="wrapper" style="padding-top:0 !important;">
        <div>
            <div style="margin-top:10px;">
                @if (ViewBag.ZongHe)
                {
                    <input type="checkbox" data-key="ZongHe" name="activity_type" checked="checked" />
                }
                else
                {
                    <input type="checkbox" data-key="ZongHe" name="activity_type" />
                }
                <span style="background-color:#e74c3c;color:white;font-weight:200">综合</span>
                @if (ViewBag.Tires)
                {
                    <input type="checkbox" data-key="Tires" name="activity_type" checked="checked" />
                }
                else
                {
                    <input type="checkbox" data-key="Tires" name="activity_type" />
                }
                <span style="background-color:#f1c40f;color:white;font-weight:200">轮胎</span>
                @if (ViewBag.BaoYang)
                {
                    <input type="checkbox" data-key="BaoYang" name="activity_type" checked="checked" />
                }
                else
                {
                    <input type="checkbox" data-key="BaoYang" name="activity_type" />
                }
                <span style="background-color:#8e44ad;color:white;font-weight:200">保养</span>
                @if (ViewBag.ChePin)
                {
                    <input type="checkbox" data-key="ChePin" name="activity_type" checked="checked" />
                }
                else
                {
                    <input type="checkbox" data-key="ChePin" name="activity_type" />
                }
                <span style="background-color:#3498db;color:white;font-weight:200;">车品</span>
                @if (ViewBag.GaiZhuang)
                {
                    <input type="checkbox" data-key="GaiZhuang" name="activity_type" checked="checked" />
                }
                else
                {
                    <input type="checkbox" data-key="GaiZhuang" name="activity_type" />
                }
                <span style="background-color:#2ecc71;color:white;font-weight:200">美容改装</span>
                @if (ViewBag.Outside)
                {
                    <input type="checkbox" data-key="Outside" name="activity_type" checked="checked" />
                }
                else
                {
                    <input type="checkbox" data-key="Outside" name="activity_type" />
                }
                <span style="background-color:#1abc9c;color:white;font-weight:200">外部投放</span>
            </div>
        </div>
        <div class="head" style="margin-top:10px">
            <div class="date" style="float:left">
                起始日期:
                <input type="text" id="date" onchange="load()" value="@ViewBag.NowTime" onclick="WdatePicker({ dateFmt :'yyyy/MM/dd'})">
            </div>
            <div style="float:left;">
                <input type="text" id="activity-title" value="@ViewBag.Name" style="margin-left:5px" placeholder="活动名称" />
                <input type="text" id="activity-createdUser" value="@ViewBag.CreatedUser" placeholder="创建人" />
                <input type="text" id="activity-owner" value="@ViewBag.Owner" placeholder="负责人" />
            </div>
            <div class="form-group" style="float:right">
                <button type="button" class="btn  btn-primary search" data-toggle="modal" data-target="#myModal5">搜索</button>
                <button type="button" class="btn  btn-primary start" data-toggle="modal" data-target="#myModal5">即将开始</button>
                <button type="button" class="btn  btn-primary end choosed" data-toggle="modal" data-target="#myModal5">即将结束</button>
                <button type="button" class="btn  btn-primary qiehuan" data-toggle="modal" data-target="#myModal5">切换</button>
            </div>
        </div>
        <div class="containerBox">
            <div class="fixedTop">
                <ul id="weeks" class="weeks"></ul>
                <ul id="dates" class="dates"></ul>
                <span class="rightblank"></span>
            </div>
            <div class="blocks">
                <div class="load">
                    <img src="~/Content/ActivityBoard/Image/loading2.gif">
                </div>
                <div class="toEnd"></div>
                <div class="going"></div>
                <div class="toStart"></div>
            </div>
        </div>
    </div>
    <div class="modal-content" style="display:none">
        <div class="modal-body">
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-2 control-label">类型</label>
                    <div class="col-sm-10">
                        <div class="btn-group pull-left">
                            <button type="button" class="btn btn-default activity-type">请选择</button>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                <span class="caret"></span>
                            </button>
                            @Html.Partial("ActivityType")
                        </div>
                        <label class="col-sm-3 control-label">负责人</label>
                        <div class="col-sm-5">
                            <input type="text" class="form-control" id="activity-principal" placeholder="tuhu@tuhu.cn" />
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">创建人</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="activity-createdUser" placeholder="tuhu@tuhu.cn" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">活动名称</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="activity-name" placeholder="活动名称" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">开始日期</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="activity-startTime" onclick="WdatePicker({ dateFmt :'yyyy-MM-dd HH:mm:ss'})" placeholder="开始日期" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">结束日期</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="activity-endTime" onclick="WdatePicker({ dateFmt :'yyyy-MM-dd HH:mm:ss'})" placeholder="结束日期" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"><a href="#" class="gotoUrl">手机链接</a></label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="activity-h5Url" placeholder="手机链接" /><input type="button" value="跳转到此页面" class="gotoUrl" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"><a href="#" class="gotoUrl">网站链接</a></label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="activity-webUrl" placeholder="网站链接" /><input type="button" value="跳转到此页面" class="gotoUrl" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">活动规则</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="activity-rules" style="width:100%;resize:vertical" rows="15" placeholder="活动规则"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<input class="IsViewEffect" value="@ViewBag.IsViewEffect" type="hidden" />
@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            loaddata();
        });

        var getDays = function (strDateStart, strDateEnd) {
            var d1 = new Date(strDateStart);
            var d2 = new Date(strDateEnd);
            return Math.ceil((d2 - d1) / (24 * 60 * 60 * 1000));
        }

        $(".search").click(function () {
            var activityType = GetActivityType();
            location.href = "/ActivityBoard/CycleCountActivity?title=" + $("#activity-title").val() + "&createdUser=" + $("#activity-createdUser").val() + "&owner=" + $("#activity-owner").val() + "&typeStr=" + activityType + "&start=" + $("#date").val();
        });

        function loaddata() {
            $(".load").show();

            $(".toEnd").html("");
            $(".going").html("");
            $(".toStart").html("");

            $.ajax({
                type: "get",
                url: "/ActivityBoard/GetCycleCountActivity",
                dataType: "json",
                data: {
                    start: $("#date").val(),
                    title: $("#activity-title").val(),
                    createdUser: $("#activity-createdUser").val(),
                    owner: $("#activity-owner").val(),
                    typeStr: GetActivityType()
                },
                success: function (data) {
                    if (data) {
                        //即将结束的板块.toEnd
                        $.each(data.ToEnd, function (index, el) {
                            var marginLeft = (getDays($("#date").val(), formatTime(el.StartTime))) * 12.5;
                            var width = el.DiffDays * 12.5;
                            var divHtml = "<div class='item " + el.ActivityType + "-class' data-key=" + el.ActivityId + " data-isNew=" + el.IsNew + " data-hashKey='" + el.HashKey + "' style='background-color:" + ConvertColorForActivityType(el.ActivityType) + ";margin-left:" + marginLeft + "%;width:" + width + "%;'>" + formatTitle(el.Title, formatTime(el.StartTime), formatTime(el.EndTime)) + "</div>";
                            $(".toEnd").append(divHtml);
                        });

                        //正在进行的板块.going
                        $.each(data.Going, function (index, el) {
                            var marginLeft = (getDays($("#date").val(), formatTime(el.StartTime))) * 12.5;
                            var width = el.DiffDays * 12.5;
                            var divHtml = "<div class='item " + el.ActivityType + "-class' data-key=" + el.ActivityId + " data-isNew=" + el.IsNew + " data-hashKey='" + el.HashKey+ "' style='background-color:" + ConvertColorForActivityType(el.ActivityType) + ";margin-left:" + marginLeft + "%;width:" + width + "%;'>" + formatTitle(el.Title, formatTime(el.StartTime), formatTime(el.EndTime)) + "</div>";
                            $(".going").append(divHtml);
                        });

                        //即将开始的板块.toStart
                        $.each(data.ToStart, function (index, el) {
                            var marginLeft = (getDays($("#date").val(), formatTime(el.StartTime))) * 12.5;
                            var width = el.DiffDays * 12.5;
                            var divHtml = "<div class='item " + el.ActivityType + "-class' data-key=" + el.ActivityId + " data-isNew=" + el.IsNew + " data-hashKey='" + el.HashKey+ "' style='background-color:" + ConvertColorForActivityType(el.ActivityType) + ";margin-left:" + marginLeft + "%;width:" + width + "%'>" + formatTitle(el.Title, formatTime(el.StartTime), formatTime(el.EndTime)) + "</div>";
                            $(".toStart").append(divHtml);
                        });
                    }
                    $(".containerBox .item").click(function () {
                        var activityId = $(this).attr("data-key");
                        EditActivityBoard("TuhuActivity", activityId, "search-activity", $(this).attr("data-isNew"), $(this).attr("data-hashKey"));
                    });
                    $("input[name='activity_type']").on("click", function () {
                        var key = $(this).attr("data-key");
                        if ($(this).prop("checked")) {
                            $("." + key + "-class").show();
                        } else {
                            $("." + key + "-class").hide();
                        }
                    });
                    $(".load").hide();
                }
            });
        }

        var addDay = function (dayNumber, date) {
            date = date ? date : new Date();
            var ms = dayNumber * (1000 * 60 * 60 * 24);
            var newDate = new Date(date.getTime() + ms);
            return newDate;
        };
        var weekday = new Array(7);
        weekday[0] = "周日";
        weekday[1] = "周一";
        weekday[2] = "周二";
        weekday[3] = "周三";
        weekday[4] = "周四";
        weekday[5] = "周五";
        weekday[6] = "周六";
        //日期初始化为当前日期
        function addZero(str) {
            if (parseInt(str) < 10) {
                str = "0" + str;
            }
            return str;
        }
        var defaultDate = new Date($("#date").val());
        //$("#date").val(defaultDate.getFullYear() + "-" + addZero((defaultDate.getMonth() + 1)) + "-" + addZero(defaultDate.getDate()));

        $("#weeks").html("").append("<li>" + weekday[defaultDate.getDay()] + "</li>");
        $("#dates").html("").append("<li>" + (defaultDate.getMonth() + 1) + "月" + defaultDate.getDate() + "日" + "</li>");
        for (var i = 1; i < 8; i++) {
            var newdata = addDay(i, defaultDate);
            $("#weeks").append("<li>" + weekday[newdata.getDay()] + "</li>");
            $("#dates").append("<li>" + (newdata.getMonth() + 1) + "月" + newdata.getDate() + "日" + "</li>");
        }

        function load() {
            //选择日期完毕的回调
            var selectedData = new Date($("#date").val());
            $("#weeks").html("").append("<li>" + weekday[selectedData.getDay()] + "</li>");
            $("#dates").html("").append("<li>" + (selectedData.getMonth() + 1) + "月" + selectedData.getDate() + "日" + "</li>");
            for (var i = 1; i < 8; i++) {
                var newdata = addDay(i, selectedData);
                $("#weeks").append("<li>" + weekday[newdata.getDay()] + "</li>");
                $("#dates").append("<li>" + (newdata.getMonth() + 1) + "月" + newdata.getDate() + "日" + "</li>");
            }
            loaddata(selectedData);
        };
        //即将开始  即将结束
        $(".start").click(function (event) {
            $(this).addClass('choosed').siblings().removeClass('choosed');
            var $tostart = $(".blocks .toStart");
            var $toend = $(".blocks .toEnd");
            $tostart.prependTo('.blocks');
            $toend.appendTo('.blocks');
        });
        $(".end").click(function (event) {
            $(this).addClass('choosed').siblings().removeClass('choosed');
            var $tostart = $(".blocks .toStart");
            var $toend = $(".blocks .toEnd");
            $tostart.appendTo('.blocks');
            $toend.prependTo('.blocks');
        });

        $(".qiehuan").click(function () {
            location.href = "/ActivityBoard/Index?activityBoardType=TuhuActivity";
        });
    </script>
}
